const __vite__fileDeps=["../chunks/browser.BVZztmgU.js","../chunks/viewport.CNTsduTY.js","../chunks/index.BCKwTHzZ.js","../chunks/scheduler.DWvxBnEd.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var Qb=Object.defineProperty;var ew=(t,e,i)=>e in t?Qb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var v=(t,e,i)=>(ew(t,typeof e!="symbol"?e+"":e,i),i);import{s as en,e as H,k as mr,C as Xm,c as W,d as L,p as O,f as U,n as pt,H as kl,i as oe,N as qm,ac as Zd,_ as Gd,a4 as Ym,h as wn,o as Nl,a as se,q as Ne,Z as _n,r as fh,j as ae,w as Re,l as ce,E as gt,ad as pn,ae as tw,t as Ut,b as zt,x as Jd,af as iw,L as In,G as Qo,g as Sn,a9 as Km,aa as Zm,$ as yo,a0 as vo,ag as Qd,ah as nw,a6 as ep}from"../chunks/scheduler.DWvxBnEd.js";import{S as On,i as kn,n as sw,l as rw,h as Ui,a as ue,g as ei,t as Se,c as ti,j as qf,b as hs,d as fs,m as ds,e as ps,k as ow}from"../chunks/index.C32fdg8C.js";import{e as An}from"../chunks/each.D6YF6ztN.js";import{g as Yf,c as cr,a as aw,l as cw,v as lw}from"../chunks/viewport.CNTsduTY.js";import{d as uw,i as hw}from"../chunks/transform.BIl3ljzv.js";import{w as Dl}from"../chunks/index.BCKwTHzZ.js";import{_ as yr}from"../chunks/preload-helper.D6kgxu3v.js";function fw(t,e){for(var i=0;i<e.length;i++){const n=e[i];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in t)){const r=Object.getOwnPropertyDescriptor(n,s);r&&Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}function tp(t,e,i){const n=t.slice();return n[1]=e[i],n}function ip(t){let e;return{c(){e=H("link"),this.h()},l(i){e=W(i,"LINK",{rel:!0,href:!0,as:!0,type:!0,crossorigin:!0}),this.h()},h(){O(e,"rel","preload"),O(e,"href",t[1]),O(e,"as","font"),O(e,"type","font/woff2"),O(e,"crossorigin","")},m(i,n){oe(i,e,n)},p:pt,d(i){i&&L(e)}}}function dw(t){let e,i,n,s,r,o,a,c,l,u,h,f,d,p,g,_,m,b,w,S,R,M,k;document.title=e=pa;let F=An(t[0]),I=[];for(let N=0;N<F.length;N+=1)I[N]=ip(tp(t,F,N));return{c(){i=H("meta"),n=H("meta"),s=H("meta"),r=H("meta"),o=H("meta"),a=H("meta"),c=H("meta"),l=H("meta"),u=H("meta"),h=H("meta"),f=H("meta"),d=H("meta"),p=H("meta"),g=H("meta"),_=H("meta"),m=H("meta"),b=H("meta"),w=H("meta"),S=H("meta"),R=H("meta"),M=H("link");for(let N=0;N<I.length;N+=1)I[N].c();k=mr(),this.h()},l(N){const C=Xm("svelte-1req58p",document.head);i=W(C,"META",{name:!0,content:!0}),n=W(C,"META",{name:!0,content:!0}),s=W(C,"META",{name:!0,content:!0}),r=W(C,"META",{property:!0,content:!0}),o=W(C,"META",{property:!0,content:!0}),a=W(C,"META",{property:!0,content:!0}),c=W(C,"META",{property:!0,content:!0}),l=W(C,"META",{property:!0,content:!0}),u=W(C,"META",{property:!0,content:!0}),h=W(C,"META",{property:!0,content:!0}),f=W(C,"META",{property:!0,content:!0}),d=W(C,"META",{property:!0,content:!0}),p=W(C,"META",{property:!0,content:!0}),g=W(C,"META",{name:!0,content:!0}),_=W(C,"META",{name:!0,content:!0}),m=W(C,"META",{name:!0,content:!0}),b=W(C,"META",{name:!0,content:!0}),w=W(C,"META",{name:!0,content:!0}),S=W(C,"META",{name:!0,content:!0}),R=W(C,"META",{name:!0,content:!0}),M=W(C,"LINK",{rel:!0,href:!0});for(let V=0;V<I.length;V+=1)I[V].l(C);k=mr(),C.forEach(L),this.h()},h(){O(i,"name","description"),O(i,"content",ru),O(n,"name","author"),O(n,"content","The Pudding"),O(s,"name","news_keywords"),O(s,"content",pw),O(r,"property","og:title"),O(r,"content",pa),O(o,"property","og:site_name"),O(o,"content","The Pudding"),O(a,"property","og:url"),O(a,"content",ga),O(c,"property","og:description"),O(c,"content",ru),O(l,"property","og:type"),O(l,"content","article"),O(u,"property","og:locale"),O(u,"content","en_US"),O(h,"property","og:image"),O(h,"content",ga+"/assets/social.jpg"),O(f,"property","og:image:type"),O(f,"content","image/jpeg"),O(d,"property","og:image:width"),O(d,"content","1200"),O(p,"property","og:image:height"),O(p,"content","630"),O(g,"name","twitter:card"),O(g,"content","summary_large_image"),O(_,"name","twitter:site"),O(_,"content","https://pudding.cool"),O(m,"name","twitter:creator"),O(m,"content","@puddingviz"),O(b,"name","twitter:title"),O(b,"content",pa),O(w,"name","twitter:description"),O(w,"content",ru),O(S,"name","twitter:image:src"),O(S,"content",ga+"/assets/social.jpg"),O(R,"name","robots"),O(R,"content","max-image-preview:large"),O(M,"rel","canonical"),O(M,"href",ga+"/")},m(N,C){U(document.head,i),U(document.head,n),U(document.head,s),U(document.head,r),U(document.head,o),U(document.head,a),U(document.head,c),U(document.head,l),U(document.head,u),U(document.head,h),U(document.head,f),U(document.head,d),U(document.head,p),U(document.head,g),U(document.head,_),U(document.head,m),U(document.head,b),U(document.head,w),U(document.head,S),U(document.head,R),U(document.head,M);for(let V=0;V<I.length;V+=1)I[V]&&I[V].m(document.head,null);U(document.head,k)},p(N,[C]){if(C&0&&e!==(e=pa)&&(document.title=e),C&1){F=An(N[0]);let V;for(V=0;V<F.length;V+=1){const X=tp(N,F,V);I[V]?I[V].p(X,C):(I[V]=ip(X),I[V].c(),I[V].m(k.parentNode,k))}for(;V<I.length;V+=1)I[V].d(1);I.length=F.length}},i:pt,o:pt,d(N){L(i),L(n),L(s),L(r),L(o),L(a),L(c),L(l),L(u),L(h),L(f),L(d),L(p),L(g),L(_),L(m),L(b),L(w),L(S),L(R),L(M),kl(I,N),L(k)}}}let pa="Every Outdoor Basketball Court in the U.S.A.",ru="Explore Satellite Imagery of 59,507 Basketball Courts",ga="https://pudding.cool/2024/09/courts",pw="basketball,courts,satellite,images";function gw(t){return[[]]}class _w extends On{constructor(e){super(),kn(this,e,gw,dw,en,{})}}function sc(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Gm(t){let e,i,n;t.length!==2?(e=sc,i=(a,c)=>sc(t(a),c),n=(a,c)=>t(a)-c):(e=t===sc||t===uw?t:mw,i=t,n=t);function s(a,c,l=0,u=a.length){if(l<u){if(e(c,c)!==0)return u;do{const h=l+u>>>1;i(a[h],c)<0?l=h+1:u=h}while(l<u)}return l}function r(a,c,l=0,u=a.length){if(l<u){if(e(c,c)!==0)return u;do{const h=l+u>>>1;i(a[h],c)<=0?l=h+1:u=h}while(l<u)}return l}function o(a,c,l=0,u=a.length){const h=s(a,c,l,u-1);return h>l&&n(a[h-1],c)>-n(a[h],c)?h-1:h}return{left:s,center:o,right:r}}function mw(){return 0}function yw(t){return t===null?NaN:+t}const vw=Gm(sc),bw=vw.right;Gm(yw).center;class gs{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const i=this._partials;let n=0;for(let s=0;s<this._n&&s<32;s++){const r=i[s],o=e+r,a=Math.abs(e)<Math.abs(r)?e-(o-r):r-(o-e);a&&(i[n++]=a),e=o}return i[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let i=this._n,n,s,r,o=0;if(i>0){for(o=e[--i];i>0&&(n=o,s=e[--i],o=n+s,r=s-(o-n),!r););i>0&&(r<0&&e[i-1]<0||r>0&&e[i-1]>0)&&(s=r*2,n=o+s,s==n-o&&(o=n))}return o}}const ww=Math.sqrt(50),Tw=Math.sqrt(10),Ew=Math.sqrt(2);function _c(t,e,i){const n=(e-t)/Math.max(0,i),s=Math.floor(Math.log10(n)),r=n/Math.pow(10,s),o=r>=ww?10:r>=Tw?5:r>=Ew?2:1;let a,c,l;return s<0?(l=Math.pow(10,-s)/o,a=Math.round(t*l),c=Math.round(e*l),a/l<t&&++a,c/l>e&&--c,l=-l):(l=Math.pow(10,s)*o,a=Math.round(t/l),c=Math.round(e/l),a*l<t&&++a,c*l>e&&--c),c<a&&.5<=i&&i<2?_c(t,e,i*2):[a,c,l]}function Sw(t,e,i){if(e=+e,t=+t,i=+i,!(i>0))return[];if(t===e)return[t];const n=e<t,[s,r,o]=n?_c(e,t,i):_c(t,e,i);if(!(r>=s))return[];const a=r-s+1,c=new Array(a);if(n)if(o<0)for(let l=0;l<a;++l)c[l]=(r-l)/-o;else for(let l=0;l<a;++l)c[l]=(r-l)*o;else if(o<0)for(let l=0;l<a;++l)c[l]=(s+l)/-o;else for(let l=0;l<a;++l)c[l]=(s+l)*o;return c}function dh(t,e,i){return e=+e,t=+t,i=+i,_c(t,e,i)[2]}function Aw(t,e,i){e=+e,t=+t,i=+i;const n=e<t,s=n?dh(e,t,i):dh(t,e,i);return(n?-1:1)*(s<0?1/-s:s)}function*Rw(t){for(const e of t)yield*e}function Jm(t){return Array.from(Rw(t))}function Kf(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function Qm(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function ea(){}var No=.7,mc=1/No,lr="\\s*([+-]?\\d+)\\s*",Do="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Bi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Cw=/^#([0-9a-f]{3,8})$/,xw=new RegExp(`^rgb\\(${lr},${lr},${lr}\\)$`),Pw=new RegExp(`^rgb\\(${Bi},${Bi},${Bi}\\)$`),Mw=new RegExp(`^rgba\\(${lr},${lr},${lr},${Do}\\)$`),Iw=new RegExp(`^rgba\\(${Bi},${Bi},${Bi},${Do}\\)$`),Ow=new RegExp(`^hsl\\(${Do},${Bi},${Bi}\\)$`),kw=new RegExp(`^hsla\\(${Do},${Bi},${Bi},${Do}\\)$`),np={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Kf(ea,Fo,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:sp,formatHex:sp,formatHex8:Nw,formatHsl:Dw,formatRgb:rp,toString:rp});function sp(){return this.rgb().formatHex()}function Nw(){return this.rgb().formatHex8()}function Dw(){return ey(this).formatHsl()}function rp(){return this.rgb().formatRgb()}function Fo(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=Cw.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?op(e):i===3?new Xt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?_a(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?_a(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=xw.exec(t))?new Xt(e[1],e[2],e[3],1):(e=Pw.exec(t))?new Xt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Mw.exec(t))?_a(e[1],e[2],e[3],e[4]):(e=Iw.exec(t))?_a(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Ow.exec(t))?lp(e[1],e[2]/100,e[3]/100,1):(e=kw.exec(t))?lp(e[1],e[2]/100,e[3]/100,e[4]):np.hasOwnProperty(t)?op(np[t]):t==="transparent"?new Xt(NaN,NaN,NaN,0):null}function op(t){return new Xt(t>>16&255,t>>8&255,t&255,1)}function _a(t,e,i,n){return n<=0&&(t=e=i=NaN),new Xt(t,e,i,n)}function Fw(t){return t instanceof ea||(t=Fo(t)),t?(t=t.rgb(),new Xt(t.r,t.g,t.b,t.opacity)):new Xt}function ph(t,e,i,n){return arguments.length===1?Fw(t):new Xt(t,e,i,n??1)}function Xt(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}Kf(Xt,ph,Qm(ea,{brighter(t){return t=t==null?mc:Math.pow(mc,t),new Xt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?No:Math.pow(No,t),new Xt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Xt(ns(this.r),ns(this.g),ns(this.b),yc(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ap,formatHex:ap,formatHex8:Lw,formatRgb:cp,toString:cp}));function ap(){return`#${Qn(this.r)}${Qn(this.g)}${Qn(this.b)}`}function Lw(){return`#${Qn(this.r)}${Qn(this.g)}${Qn(this.b)}${Qn((isNaN(this.opacity)?1:this.opacity)*255)}`}function cp(){const t=yc(this.opacity);return`${t===1?"rgb(":"rgba("}${ns(this.r)}, ${ns(this.g)}, ${ns(this.b)}${t===1?")":`, ${t})`}`}function yc(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ns(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Qn(t){return t=ns(t),(t<16?"0":"")+t.toString(16)}function lp(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new yi(t,e,i,n)}function ey(t){if(t instanceof yi)return new yi(t.h,t.s,t.l,t.opacity);if(t instanceof ea||(t=Fo(t)),!t)return new yi;if(t instanceof yi)return t;t=t.rgb();var e=t.r/255,i=t.g/255,n=t.b/255,s=Math.min(e,i,n),r=Math.max(e,i,n),o=NaN,a=r-s,c=(r+s)/2;return a?(e===r?o=(i-n)/a+(i<n)*6:i===r?o=(n-e)/a+2:o=(e-i)/a+4,a/=c<.5?r+s:2-r-s,o*=60):a=c>0&&c<1?0:o,new yi(o,a,c,t.opacity)}function gh(t,e,i,n){return arguments.length===1?ey(t):new yi(t,e,i,n??1)}function yi(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}Kf(yi,gh,Qm(ea,{brighter(t){return t=t==null?mc:Math.pow(mc,t),new yi(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?No:Math.pow(No,t),new yi(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,s=2*i-n;return new Xt(ou(t>=240?t-240:t+120,s,n),ou(t,s,n),ou(t<120?t+240:t-120,s,n),this.opacity)},clamp(){return new yi(up(this.h),ma(this.s),ma(this.l),yc(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=yc(this.opacity);return`${t===1?"hsl(":"hsla("}${up(this.h)}, ${ma(this.s)*100}%, ${ma(this.l)*100}%${t===1?")":`, ${t})`}`}}));function up(t){return t=(t||0)%360,t<0?t+360:t}function ma(t){return Math.max(0,Math.min(1,t||0))}function ou(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}const Zf=t=>()=>t;function Bw(t,e){return function(i){return t+i*e}}function Uw(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}function zw(t){return(t=+t)==1?ty:function(e,i){return i-e?Uw(e,i,t):Zf(isNaN(e)?i:e)}}function ty(t,e){var i=e-t;return i?Bw(t,i):Zf(isNaN(t)?e:t)}const hp=function t(e){var i=zw(e);function n(s,r){var o=i((s=ph(s)).r,(r=ph(r)).r),a=i(s.g,r.g),c=i(s.b,r.b),l=ty(s.opacity,r.opacity);return function(u){return s.r=o(u),s.g=a(u),s.b=c(u),s.opacity=l(u),s+""}}return n.gamma=t,n}(1);function iy(t,e){e||(e=[]);var i=t?Math.min(e.length,t.length):0,n=e.slice(),s;return function(r){for(s=0;s<i;++s)n[s]=t[s]*(1-r)+e[s]*r;return n}}function Vw(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function jw(t,e){var i=e?e.length:0,n=t?Math.min(i,t.length):0,s=new Array(n),r=new Array(i),o;for(o=0;o<n;++o)s[o]=Gf(t[o],e[o]);for(;o<i;++o)r[o]=e[o];return function(a){for(o=0;o<n;++o)r[o]=s[o](a);return r}}function $w(t,e){var i=new Date;return t=+t,e=+e,function(n){return i.setTime(t*(1-n)+e*n),i}}function Lo(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}function Hw(t,e){var i={},n={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?i[s]=Gf(t[s],e[s]):n[s]=e[s];return function(r){for(s in i)n[s]=i[s](r);return n}}var _h=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,au=new RegExp(_h.source,"g");function Ww(t){return function(){return t}}function Xw(t){return function(e){return t(e)+""}}function qw(t,e){var i=_h.lastIndex=au.lastIndex=0,n,s,r,o=-1,a=[],c=[];for(t=t+"",e=e+"";(n=_h.exec(t))&&(s=au.exec(e));)(r=s.index)>i&&(r=e.slice(i,r),a[o]?a[o]+=r:a[++o]=r),(n=n[0])===(s=s[0])?a[o]?a[o]+=s:a[++o]=s:(a[++o]=null,c.push({i:o,x:Lo(n,s)})),i=au.lastIndex;return i<e.length&&(r=e.slice(i),a[o]?a[o]+=r:a[++o]=r),a.length<2?c[0]?Xw(c[0].x):Ww(e):(e=c.length,function(l){for(var u=0,h;u<e;++u)a[(h=c[u]).i]=h.x(l);return a.join("")})}function Gf(t,e){var i=typeof e,n;return e==null||i==="boolean"?Zf(e):(i==="number"?Lo:i==="string"?(n=Fo(e))?(e=n,hp):qw:e instanceof Fo?hp:e instanceof Date?$w:Vw(e)?iy:Array.isArray(e)?jw:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Hw:Lo)(t,e)}function Yw(t,e){return t=+t,e=+e,function(i){return Math.round(t*(1-i)+e*i)}}function ya(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var fp={},cu={},lu=34,Yr=10,uu=13;function ny(t){return new Function("d","return {"+t.map(function(e,i){return JSON.stringify(e)+": d["+i+'] || ""'}).join(",")+"}")}function Kw(t,e){var i=ny(t);return function(n,s){return e(i(n),s,t)}}function dp(t){var e=Object.create(null),i=[];return t.forEach(function(n){for(var s in n)s in e||i.push(e[s]=s)}),i}function Wt(t,e){var i=t+"",n=i.length;return n<e?new Array(e-n+1).join(0)+i:i}function Zw(t){return t<0?"-"+Wt(-t,6):t>9999?"+"+Wt(t,6):Wt(t,4)}function Gw(t){var e=t.getUTCHours(),i=t.getUTCMinutes(),n=t.getUTCSeconds(),s=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":Zw(t.getUTCFullYear())+"-"+Wt(t.getUTCMonth()+1,2)+"-"+Wt(t.getUTCDate(),2)+(s?"T"+Wt(e,2)+":"+Wt(i,2)+":"+Wt(n,2)+"."+Wt(s,3)+"Z":n?"T"+Wt(e,2)+":"+Wt(i,2)+":"+Wt(n,2)+"Z":i||e?"T"+Wt(e,2)+":"+Wt(i,2)+"Z":"")}function Jw(t){var e=new RegExp('["'+t+`
\r]`),i=t.charCodeAt(0);function n(h,f){var d,p,g=s(h,function(_,m){if(d)return d(_,m-1);p=_,d=f?Kw(_,f):ny(_)});return g.columns=p||[],g}function s(h,f){var d=[],p=h.length,g=0,_=0,m,b=p<=0,w=!1;h.charCodeAt(p-1)===Yr&&--p,h.charCodeAt(p-1)===uu&&--p;function S(){if(b)return cu;if(w)return w=!1,fp;var M,k=g,F;if(h.charCodeAt(k)===lu){for(;g++<p&&h.charCodeAt(g)!==lu||h.charCodeAt(++g)===lu;);return(M=g)>=p?b=!0:(F=h.charCodeAt(g++))===Yr?w=!0:F===uu&&(w=!0,h.charCodeAt(g)===Yr&&++g),h.slice(k+1,M-1).replace(/""/g,'"')}for(;g<p;){if((F=h.charCodeAt(M=g++))===Yr)w=!0;else if(F===uu)w=!0,h.charCodeAt(g)===Yr&&++g;else if(F!==i)continue;return h.slice(k,M)}return b=!0,h.slice(k,p)}for(;(m=S())!==cu;){for(var R=[];m!==fp&&m!==cu;)R.push(m),m=S();f&&(R=f(R,_++))==null||d.push(R)}return d}function r(h,f){return h.map(function(d){return f.map(function(p){return u(d[p])}).join(t)})}function o(h,f){return f==null&&(f=dp(h)),[f.map(u).join(t)].concat(r(h,f)).join(`
`)}function a(h,f){return f==null&&(f=dp(h)),r(h,f).join(`
`)}function c(h){return h.map(l).join(`
`)}function l(h){return h.map(u).join(t)}function u(h){return h==null?"":h instanceof Date?Gw(h):e.test(h+="")?'"'+h.replace(/"/g,'""')+'"':h}return{parse:n,parseRows:s,format:o,formatBody:a,formatRows:c,formatRow:l,formatValue:u}}var Qw=Jw(","),eT=Qw.parse;function tT(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function iT(t,e){return fetch(t,e).then(tT)}function nT(t){return function(e,i,n){return arguments.length===2&&typeof i=="function"&&(n=i,i=void 0),iT(e,i).then(function(s){return t(s,n)})}}var sT=nT(eT);function rT(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function vc(t,e){if((i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var i,n=t.slice(0,i);return[n.length>1?n[0]+n.slice(2):n,+t.slice(i+1)]}function vr(t){return t=vc(Math.abs(t)),t?t[1]:NaN}function oT(t,e){return function(i,n){for(var s=i.length,r=[],o=0,a=t[0],c=0;s>0&&a>0&&(c+a+1>n&&(a=Math.max(1,n-c)),r.push(i.substring(s-=a,s+a)),!((c+=a+1)>n));)a=t[o=(o+1)%t.length];return r.reverse().join(e)}}function aT(t){return function(e){return e.replace(/[0-9]/g,function(i){return t[+i]})}}var cT=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function bc(t){if(!(e=cT.exec(t)))throw new Error("invalid format: "+t);var e;return new Jf({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}bc.prototype=Jf.prototype;function Jf(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Jf.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function lT(t){e:for(var e=t.length,i=1,n=-1,s;i<e;++i)switch(t[i]){case".":n=s=i;break;case"0":n===0&&(n=i),s=i;break;default:if(!+t[i])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(s+1):t}var sy;function uT(t,e){var i=vc(t,e);if(!i)return t+"";var n=i[0],s=i[1],r=s-(sy=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,o=n.length;return r===o?n:r>o?n+new Array(r-o+1).join("0"):r>0?n.slice(0,r)+"."+n.slice(r):"0."+new Array(1-r).join("0")+vc(t,Math.max(0,e+r-1))[0]}function pp(t,e){var i=vc(t,e);if(!i)return t+"";var n=i[0],s=i[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}const gp={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:rT,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>pp(t*100,e),r:pp,s:uT,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function _p(t){return t}var mp=Array.prototype.map,yp=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function hT(t){var e=t.grouping===void 0||t.thousands===void 0?_p:oT(mp.call(t.grouping,Number),t.thousands+""),i=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",r=t.numerals===void 0?_p:aT(mp.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"−":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function l(h){h=bc(h);var f=h.fill,d=h.align,p=h.sign,g=h.symbol,_=h.zero,m=h.width,b=h.comma,w=h.precision,S=h.trim,R=h.type;R==="n"?(b=!0,R="g"):gp[R]||(w===void 0&&(w=12),S=!0,R="g"),(_||f==="0"&&d==="=")&&(_=!0,f="0",d="=");var M=g==="$"?i:g==="#"&&/[boxX]/.test(R)?"0"+R.toLowerCase():"",k=g==="$"?n:/[%p]/.test(R)?o:"",F=gp[R],I=/[defgprs%]/.test(R);w=w===void 0?6:/[gprs]/.test(R)?Math.max(1,Math.min(21,w)):Math.max(0,Math.min(20,w));function N(C){var V=M,X=k,K,B,re;if(R==="c")X=F(C)+X,C="";else{C=+C;var be=C<0||1/C<0;if(C=isNaN(C)?c:F(Math.abs(C),w),S&&(C=lT(C)),be&&+C==0&&p!=="+"&&(be=!1),V=(be?p==="("?p:a:p==="-"||p==="("?"":p)+V,X=(R==="s"?yp[8+sy/3]:"")+X+(be&&p==="("?")":""),I){for(K=-1,B=C.length;++K<B;)if(re=C.charCodeAt(K),48>re||re>57){X=(re===46?s+C.slice(K+1):C.slice(K))+X,C=C.slice(0,K);break}}}b&&!_&&(C=e(C,1/0));var Ce=V.length+C.length+X.length,fe=Ce<m?new Array(m-Ce+1).join(f):"";switch(b&&_&&(C=e(fe+C,fe.length?m-X.length:1/0),fe=""),d){case"<":C=V+C+X+fe;break;case"=":C=V+fe+C+X;break;case"^":C=fe.slice(0,Ce=fe.length>>1)+V+C+X+fe.slice(Ce);break;default:C=fe+V+C+X;break}return r(C)}return N.toString=function(){return h+""},N}function u(h,f){var d=l((h=bc(h),h.type="f",h)),p=Math.max(-8,Math.min(8,Math.floor(vr(f)/3)))*3,g=Math.pow(10,-p),_=yp[8+p/3];return function(m){return d(g*m)+_}}return{format:l,formatPrefix:u}}var va,Qf,ry;fT({thousands:",",grouping:[3],currency:["$",""]});function fT(t){return va=hT(t),Qf=va.format,ry=va.formatPrefix,va}function dT(t){return Math.max(0,-vr(Math.abs(t)))}function pT(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(vr(e)/3)))*3-vr(Math.abs(t)))}function gT(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,vr(e)-vr(t))+1}var je=1e-6,_T=1e-12,Ae=Math.PI,oi=Ae/2,vp=Ae/4,hi=Ae*2,Hi=180/Ae,Qt=Ae/180,nt=Math.abs,mT=Math.atan,br=Math.atan2,tt=Math.cos,Qe=Math.sin,yT=Math.sign||function(t){return t>0?1:t<0?-1:0},Nn=Math.sqrt;function vT(t){return t>1?0:t<-1?Ae:Math.acos(t)}function _s(t){return t>1?oi:t<-1?-oi:Math.asin(t)}function ai(){}function wc(t,e){t&&wp.hasOwnProperty(t.type)&&wp[t.type](t,e)}var bp={Feature:function(t,e){wc(t.geometry,e)},FeatureCollection:function(t,e){for(var i=t.features,n=-1,s=i.length;++n<s;)wc(i[n].geometry,e)}},wp={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var i=t.coordinates,n=-1,s=i.length;++n<s;)t=i[n],e.point(t[0],t[1],t[2])},LineString:function(t,e){mh(t.coordinates,e,0)},MultiLineString:function(t,e){for(var i=t.coordinates,n=-1,s=i.length;++n<s;)mh(i[n],e,0)},Polygon:function(t,e){Tp(t.coordinates,e)},MultiPolygon:function(t,e){for(var i=t.coordinates,n=-1,s=i.length;++n<s;)Tp(i[n],e)},GeometryCollection:function(t,e){for(var i=t.geometries,n=-1,s=i.length;++n<s;)wc(i[n],e)}};function mh(t,e,i){var n=-1,s=t.length-i,r;for(e.lineStart();++n<s;)r=t[n],e.point(r[0],r[1],r[2]);e.lineEnd()}function Tp(t,e){var i=-1,n=t.length;for(e.polygonStart();++i<n;)mh(t[i],e,1);e.polygonEnd()}function Ys(t,e){t&&bp.hasOwnProperty(t.type)?bp[t.type](t,e):wc(t,e)}function yh(t){return[br(t[1],t[0]),_s(t[2])]}function wr(t){var e=t[0],i=t[1],n=tt(i);return[n*tt(e),n*Qe(e),Qe(i)]}function ba(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Tc(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function hu(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function wa(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function vh(t){var e=Nn(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function bh(t,e){function i(n,s){return n=t(n,s),e(n[0],n[1])}return t.invert&&e.invert&&(i.invert=function(n,s){return n=e.invert(n,s),n&&t.invert(n[0],n[1])}),i}function wh(t,e){return nt(t)>Ae&&(t-=Math.round(t/hi)*hi),[t,e]}wh.invert=wh;function bT(t,e,i){return(t%=hi)?e||i?bh(Sp(t),Ap(e,i)):Sp(t):e||i?Ap(e,i):wh}function Ep(t){return function(e,i){return e+=t,nt(e)>Ae&&(e-=Math.round(e/hi)*hi),[e,i]}}function Sp(t){var e=Ep(t);return e.invert=Ep(-t),e}function Ap(t,e){var i=tt(t),n=Qe(t),s=tt(e),r=Qe(e);function o(a,c){var l=tt(c),u=tt(a)*l,h=Qe(a)*l,f=Qe(c),d=f*i+u*n;return[br(h*s-d*r,u*i-f*n),_s(d*s+h*r)]}return o.invert=function(a,c){var l=tt(c),u=tt(a)*l,h=Qe(a)*l,f=Qe(c),d=f*s-h*r;return[br(h*s+f*r,u*i+d*n),_s(d*i-u*n)]},o}function wT(t,e,i,n,s,r){if(i){var o=tt(e),a=Qe(e),c=n*i;s==null?(s=e+n*hi,r=e-c/2):(s=Rp(o,s),r=Rp(o,r),(n>0?s<r:s>r)&&(s+=n*hi));for(var l,u=s;n>0?u>r:u<r;u-=c)l=yh([o,-a*tt(u),-a*Qe(u)]),t.point(l[0],l[1])}}function Rp(t,e){e=wr(e),e[0]-=t,vh(e);var i=vT(-e[1]);return((-e[2]<0?-i:i)+hi-je)%hi}function oy(){var t=[],e;return{point:function(i,n,s){e.push([i,n,s])},lineStart:function(){t.push(e=[])},lineEnd:ai,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var i=t;return t=[],e=null,i}}}function rc(t,e){return nt(t[0]-e[0])<je&&nt(t[1]-e[1])<je}function Ta(t,e,i,n){this.x=t,this.z=e,this.o=i,this.e=n,this.v=!1,this.n=this.p=null}function ay(t,e,i,n,s){var r=[],o=[],a,c;if(t.forEach(function(p){if(!((g=p.length-1)<=0)){var g,_=p[0],m=p[g],b;if(rc(_,m)){if(!_[2]&&!m[2]){for(s.lineStart(),a=0;a<g;++a)s.point((_=p[a])[0],_[1]);s.lineEnd();return}m[0]+=2*je}r.push(b=new Ta(_,p,null,!0)),o.push(b.o=new Ta(_,null,b,!1)),r.push(b=new Ta(m,p,null,!1)),o.push(b.o=new Ta(m,null,b,!0))}}),!!r.length){for(o.sort(e),Cp(r),Cp(o),a=0,c=o.length;a<c;++a)o[a].e=i=!i;for(var l=r[0],u,h;;){for(var f=l,d=!0;f.v;)if((f=f.n)===l)return;u=f.z,s.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(a=0,c=u.length;a<c;++a)s.point((h=u[a])[0],h[1]);else n(f.x,f.n.x,1,s);f=f.n}else{if(d)for(u=f.p.z,a=u.length-1;a>=0;--a)s.point((h=u[a])[0],h[1]);else n(f.x,f.p.x,-1,s);f=f.p}f=f.o,u=f.z,d=!d}while(!f.v);s.lineEnd()}}}function Cp(t){if(e=t.length){for(var e,i=0,n=t[0],s;++i<e;)n.n=s=t[i],s.p=n,n=s;n.n=s=t[0],s.p=n}}function fu(t){return nt(t[0])<=Ae?t[0]:yT(t[0])*((nt(t[0])+Ae)%hi-Ae)}function TT(t,e){var i=fu(e),n=e[1],s=Qe(n),r=[Qe(i),-tt(i),0],o=0,a=0,c=new gs;s===1?n=oi+je:s===-1&&(n=-oi-je);for(var l=0,u=t.length;l<u;++l)if(f=(h=t[l]).length)for(var h,f,d=h[f-1],p=fu(d),g=d[1]/2+vp,_=Qe(g),m=tt(g),b=0;b<f;++b,p=S,_=M,m=k,d=w){var w=h[b],S=fu(w),R=w[1]/2+vp,M=Qe(R),k=tt(R),F=S-p,I=F>=0?1:-1,N=I*F,C=N>Ae,V=_*M;if(c.add(br(V*I*Qe(N),m*k+V*tt(N))),o+=C?F+I*hi:F,C^p>=i^S>=i){var X=Tc(wr(d),wr(w));vh(X);var K=Tc(r,X);vh(K);var B=(C^F>=0?-1:1)*_s(K[2]);(n>B||n===B&&(X[0]||X[1]))&&(a+=C^F>=0?1:-1)}}return(o<-je||o<je&&c<-_T)^a&1}function cy(t,e,i,n){return function(s){var r=e(s),o=oy(),a=e(o),c=!1,l,u,h,f={point:d,lineStart:g,lineEnd:_,polygonStart:function(){f.point=m,f.lineStart=b,f.lineEnd=w,u=[],l=[]},polygonEnd:function(){f.point=d,f.lineStart=g,f.lineEnd=_,u=Jm(u);var S=TT(l,n);u.length?(c||(s.polygonStart(),c=!0),ay(u,ST,S,i,s)):S&&(c||(s.polygonStart(),c=!0),s.lineStart(),i(null,null,1,s),s.lineEnd()),c&&(s.polygonEnd(),c=!1),u=l=null},sphere:function(){s.polygonStart(),s.lineStart(),i(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function d(S,R){t(S,R)&&s.point(S,R)}function p(S,R){r.point(S,R)}function g(){f.point=p,r.lineStart()}function _(){f.point=d,r.lineEnd()}function m(S,R){h.push([S,R]),a.point(S,R)}function b(){a.lineStart(),h=[]}function w(){m(h[0][0],h[0][1]),a.lineEnd();var S=a.clean(),R=o.result(),M,k=R.length,F,I,N;if(h.pop(),l.push(h),h=null,!!k){if(S&1){if(I=R[0],(F=I.length-1)>0){for(c||(s.polygonStart(),c=!0),s.lineStart(),M=0;M<F;++M)s.point((N=I[M])[0],N[1]);s.lineEnd()}return}k>1&&S&2&&R.push(R.pop().concat(R.shift())),u.push(R.filter(ET))}}return f}}function ET(t){return t.length>1}function ST(t,e){return((t=t.x)[0]<0?t[1]-oi-je:oi-t[1])-((e=e.x)[0]<0?e[1]-oi-je:oi-e[1])}const xp=cy(function(){return!0},AT,CT,[-Ae,-oi]);function AT(t){var e=NaN,i=NaN,n=NaN,s;return{lineStart:function(){t.lineStart(),s=1},point:function(r,o){var a=r>0?Ae:-Ae,c=nt(r-e);nt(c-Ae)<je?(t.point(e,i=(i+o)/2>0?oi:-oi),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(a,i),t.point(r,i),s=0):n!==a&&c>=Ae&&(nt(e-n)<je&&(e-=n*je),nt(r-a)<je&&(r-=a*je),i=RT(e,i,r,o),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(a,i),s=0),t.point(e=r,i=o),n=a},lineEnd:function(){t.lineEnd(),e=i=NaN},clean:function(){return 2-s}}}function RT(t,e,i,n){var s,r,o=Qe(t-i);return nt(o)>je?mT((Qe(e)*(r=tt(n))*Qe(i)-Qe(n)*(s=tt(e))*Qe(t))/(s*r*o)):(e+n)/2}function CT(t,e,i,n){var s;if(t==null)s=i*oi,n.point(-Ae,s),n.point(0,s),n.point(Ae,s),n.point(Ae,0),n.point(Ae,-s),n.point(0,-s),n.point(-Ae,-s),n.point(-Ae,0),n.point(-Ae,s);else if(nt(t[0]-e[0])>je){var r=t[0]<e[0]?Ae:-Ae;s=i*r/2,n.point(-r,s),n.point(0,s),n.point(r,s)}else n.point(e[0],e[1])}function xT(t){var e=tt(t),i=2*Qt,n=e>0,s=nt(e)>je;function r(u,h,f,d){wT(d,t,i,f,u,h)}function o(u,h){return tt(u)*tt(h)>e}function a(u){var h,f,d,p,g;return{lineStart:function(){p=d=!1,g=1},point:function(_,m){var b=[_,m],w,S=o(_,m),R=n?S?0:l(_,m):S?l(_+(_<0?Ae:-Ae),m):0;if(!h&&(p=d=S)&&u.lineStart(),S!==d&&(w=c(h,b),(!w||rc(h,w)||rc(b,w))&&(b[2]=1)),S!==d)g=0,S?(u.lineStart(),w=c(b,h),u.point(w[0],w[1])):(w=c(h,b),u.point(w[0],w[1],2),u.lineEnd()),h=w;else if(s&&h&&n^S){var M;!(R&f)&&(M=c(b,h,!0))&&(g=0,n?(u.lineStart(),u.point(M[0][0],M[0][1]),u.point(M[1][0],M[1][1]),u.lineEnd()):(u.point(M[1][0],M[1][1]),u.lineEnd(),u.lineStart(),u.point(M[0][0],M[0][1],3)))}S&&(!h||!rc(h,b))&&u.point(b[0],b[1]),h=b,d=S,f=R},lineEnd:function(){d&&u.lineEnd(),h=null},clean:function(){return g|(p&&d)<<1}}}function c(u,h,f){var d=wr(u),p=wr(h),g=[1,0,0],_=Tc(d,p),m=ba(_,_),b=_[0],w=m-b*b;if(!w)return!f&&u;var S=e*m/w,R=-e*b/w,M=Tc(g,_),k=wa(g,S),F=wa(_,R);hu(k,F);var I=M,N=ba(k,I),C=ba(I,I),V=N*N-C*(ba(k,k)-1);if(!(V<0)){var X=Nn(V),K=wa(I,(-N-X)/C);if(hu(K,k),K=yh(K),!f)return K;var B=u[0],re=h[0],be=u[1],Ce=h[1],fe;re<B&&(fe=B,B=re,re=fe);var Ze=re-B,_t=nt(Ze-Ae)<je,xe=_t||Ze<je;if(!_t&&Ce<be&&(fe=be,be=Ce,Ce=fe),xe?_t?be+Ce>0^K[1]<(nt(K[0]-B)<je?be:Ce):be<=K[1]&&K[1]<=Ce:Ze>Ae^(B<=K[0]&&K[0]<=re)){var Le=wa(I,(-N+X)/C);return hu(Le,k),[K,yh(Le)]}}}function l(u,h){var f=n?t:Ae-t,d=0;return u<-f?d|=1:u>f&&(d|=2),h<-f?d|=4:h>f&&(d|=8),d}return cy(o,a,r,n?[0,-t]:[-Ae,t-Ae])}function PT(t,e,i,n,s,r){var o=t[0],a=t[1],c=e[0],l=e[1],u=0,h=1,f=c-o,d=l-a,p;if(p=i-o,!(!f&&p>0)){if(p/=f,f<0){if(p<u)return;p<h&&(h=p)}else if(f>0){if(p>h)return;p>u&&(u=p)}if(p=s-o,!(!f&&p<0)){if(p/=f,f<0){if(p>h)return;p>u&&(u=p)}else if(f>0){if(p<u)return;p<h&&(h=p)}if(p=n-a,!(!d&&p>0)){if(p/=d,d<0){if(p<u)return;p<h&&(h=p)}else if(d>0){if(p>h)return;p>u&&(u=p)}if(p=r-a,!(!d&&p<0)){if(p/=d,d<0){if(p>h)return;p>u&&(u=p)}else if(d>0){if(p<u)return;p<h&&(h=p)}return u>0&&(t[0]=o+u*f,t[1]=a+u*d),h<1&&(e[0]=o+h*f,e[1]=a+h*d),!0}}}}}var ro=1e9,Ea=-ro;function MT(t,e,i,n){function s(l,u){return t<=l&&l<=i&&e<=u&&u<=n}function r(l,u,h,f){var d=0,p=0;if(l==null||(d=o(l,h))!==(p=o(u,h))||c(l,u)<0^h>0)do f.point(d===0||d===3?t:i,d>1?n:e);while((d=(d+h+4)%4)!==p);else f.point(u[0],u[1])}function o(l,u){return nt(l[0]-t)<je?u>0?0:3:nt(l[0]-i)<je?u>0?2:1:nt(l[1]-e)<je?u>0?1:0:u>0?3:2}function a(l,u){return c(l.x,u.x)}function c(l,u){var h=o(l,1),f=o(u,1);return h!==f?h-f:h===0?u[1]-l[1]:h===1?l[0]-u[0]:h===2?l[1]-u[1]:u[0]-l[0]}return function(l){var u=l,h=oy(),f,d,p,g,_,m,b,w,S,R,M,k={point:F,lineStart:V,lineEnd:X,polygonStart:N,polygonEnd:C};function F(B,re){s(B,re)&&u.point(B,re)}function I(){for(var B=0,re=0,be=d.length;re<be;++re)for(var Ce=d[re],fe=1,Ze=Ce.length,_t=Ce[0],xe,Le,Ct=_t[0],le=_t[1];fe<Ze;++fe)xe=Ct,Le=le,_t=Ce[fe],Ct=_t[0],le=_t[1],Le<=n?le>n&&(Ct-xe)*(n-Le)>(le-Le)*(t-xe)&&++B:le<=n&&(Ct-xe)*(n-Le)<(le-Le)*(t-xe)&&--B;return B}function N(){u=h,f=[],d=[],M=!0}function C(){var B=I(),re=M&&B,be=(f=Jm(f)).length;(re||be)&&(l.polygonStart(),re&&(l.lineStart(),r(null,null,1,l),l.lineEnd()),be&&ay(f,a,B,r,l),l.polygonEnd()),u=l,f=d=p=null}function V(){k.point=K,d&&d.push(p=[]),R=!0,S=!1,b=w=NaN}function X(){f&&(K(g,_),m&&S&&h.rejoin(),f.push(h.result())),k.point=F,S&&u.lineEnd()}function K(B,re){var be=s(B,re);if(d&&p.push([B,re]),R)g=B,_=re,m=be,R=!1,be&&(u.lineStart(),u.point(B,re));else if(be&&S)u.point(B,re);else{var Ce=[b=Math.max(Ea,Math.min(ro,b)),w=Math.max(Ea,Math.min(ro,w))],fe=[B=Math.max(Ea,Math.min(ro,B)),re=Math.max(Ea,Math.min(ro,re))];PT(Ce,fe,t,e,i,n)?(S||(u.lineStart(),u.point(Ce[0],Ce[1])),u.point(fe[0],fe[1]),be||u.lineEnd(),M=!1):be&&(u.lineStart(),u.point(B,re),M=!1)}b=B,w=re,S=be}return k}}const Th=t=>t;var du=new gs,Eh=new gs,ly,uy,Sh,Ah,qi={point:ai,lineStart:ai,lineEnd:ai,polygonStart:function(){qi.lineStart=IT,qi.lineEnd=kT},polygonEnd:function(){qi.lineStart=qi.lineEnd=qi.point=ai,du.add(nt(Eh)),Eh=new gs},result:function(){var t=du/2;return du=new gs,t}};function IT(){qi.point=OT}function OT(t,e){qi.point=hy,ly=Sh=t,uy=Ah=e}function hy(t,e){Eh.add(Ah*t-Sh*e),Sh=t,Ah=e}function kT(){hy(ly,uy)}var Tr=1/0,Ec=Tr,Bo=-Tr,Sc=Bo,Ac={point:NT,lineStart:ai,lineEnd:ai,polygonStart:ai,polygonEnd:ai,result:function(){var t=[[Tr,Ec],[Bo,Sc]];return Bo=Sc=-(Ec=Tr=1/0),t}};function NT(t,e){t<Tr&&(Tr=t),t>Bo&&(Bo=t),e<Ec&&(Ec=e),e>Sc&&(Sc=e)}var Rh=0,Ch=0,oo=0,Rc=0,Cc=0,Gs=0,xh=0,Ph=0,ao=0,fy,dy,Ni,Di,ri={point:ms,lineStart:Pp,lineEnd:Mp,polygonStart:function(){ri.lineStart=LT,ri.lineEnd=BT},polygonEnd:function(){ri.point=ms,ri.lineStart=Pp,ri.lineEnd=Mp},result:function(){var t=ao?[xh/ao,Ph/ao]:Gs?[Rc/Gs,Cc/Gs]:oo?[Rh/oo,Ch/oo]:[NaN,NaN];return Rh=Ch=oo=Rc=Cc=Gs=xh=Ph=ao=0,t}};function ms(t,e){Rh+=t,Ch+=e,++oo}function Pp(){ri.point=DT}function DT(t,e){ri.point=FT,ms(Ni=t,Di=e)}function FT(t,e){var i=t-Ni,n=e-Di,s=Nn(i*i+n*n);Rc+=s*(Ni+t)/2,Cc+=s*(Di+e)/2,Gs+=s,ms(Ni=t,Di=e)}function Mp(){ri.point=ms}function LT(){ri.point=UT}function BT(){py(fy,dy)}function UT(t,e){ri.point=py,ms(fy=Ni=t,dy=Di=e)}function py(t,e){var i=t-Ni,n=e-Di,s=Nn(i*i+n*n);Rc+=s*(Ni+t)/2,Cc+=s*(Di+e)/2,Gs+=s,s=Di*t-Ni*e,xh+=s*(Ni+t),Ph+=s*(Di+e),ao+=s*3,ms(Ni=t,Di=e)}function gy(t){this._context=t}gy.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:{this._context.moveTo(t,e),this._point=1;break}case 1:{this._context.lineTo(t,e);break}default:{this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,hi);break}}},result:ai};var Mh=new gs,pu,_y,my,co,lo,Uo={point:ai,lineStart:function(){Uo.point=zT},lineEnd:function(){pu&&yy(_y,my),Uo.point=ai},polygonStart:function(){pu=!0},polygonEnd:function(){pu=null},result:function(){var t=+Mh;return Mh=new gs,t}};function zT(t,e){Uo.point=yy,_y=co=t,my=lo=e}function yy(t,e){co-=t,lo-=e,Mh.add(Nn(co*co+lo*lo)),co=t,lo=e}let Ip,xc,Op,kp;class Np{constructor(e){this._append=e==null?vy:VT(e),this._radius=4.5,this._=""}pointRadius(e){return this._radius=+e,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(e,i){switch(this._point){case 0:{this._append`M${e},${i}`,this._point=1;break}case 1:{this._append`L${e},${i}`;break}default:{if(this._append`M${e},${i}`,this._radius!==Op||this._append!==xc){const n=this._radius,s=this._;this._="",this._append`m0,${n}a${n},${n} 0 1,1 0,${-2*n}a${n},${n} 0 1,1 0,${2*n}z`,Op=n,xc=this._append,kp=this._,this._=s}this._+=kp;break}}}result(){const e=this._;return this._="",e.length?e:null}}function vy(t){let e=1;this._+=t[0];for(const i=t.length;e<i;++e)this._+=arguments[e]+t[e]}function VT(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return vy;if(e!==Ip){const i=10**e;Ip=e,xc=function(s){let r=1;this._+=s[0];for(const o=s.length;r<o;++r)this._+=Math.round(arguments[r]*i)/i+s[r]}}return xc}function jT(t,e){let i=3,n=4.5,s,r;function o(a){return a&&(typeof n=="function"&&r.pointRadius(+n.apply(this,arguments)),Ys(a,s(r))),r.result()}return o.area=function(a){return Ys(a,s(qi)),qi.result()},o.measure=function(a){return Ys(a,s(Uo)),Uo.result()},o.bounds=function(a){return Ys(a,s(Ac)),Ac.result()},o.centroid=function(a){return Ys(a,s(ri)),ri.result()},o.projection=function(a){return arguments.length?(s=a==null?(t=null,Th):(t=a).stream,o):t},o.context=function(a){return arguments.length?(r=a==null?(e=null,new Np(i)):new gy(e=a),typeof n!="function"&&r.pointRadius(n),o):e},o.pointRadius=function(a){return arguments.length?(n=typeof a=="function"?a:(r.pointRadius(+a),+a),o):n},o.digits=function(a){if(!arguments.length)return i;if(a==null)i=null;else{const c=Math.floor(a);if(!(c>=0))throw new RangeError(`invalid digits: ${a}`);i=c}return e===null&&(r=new Np(i)),o},o.projection(t).digits(i).context(e)}function ed(t){return function(e){var i=new Ih;for(var n in t)i[n]=t[n];return i.stream=e,i}}function Ih(){}Ih.prototype={constructor:Ih,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function td(t,e,i){var n=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),n!=null&&t.clipExtent(null),Ys(i,t.stream(Ac)),e(Ac.result()),n!=null&&t.clipExtent(n),t}function by(t,e,i){return td(t,function(n){var s=e[1][0]-e[0][0],r=e[1][1]-e[0][1],o=Math.min(s/(n[1][0]-n[0][0]),r/(n[1][1]-n[0][1])),a=+e[0][0]+(s-o*(n[1][0]+n[0][0]))/2,c=+e[0][1]+(r-o*(n[1][1]+n[0][1]))/2;t.scale(150*o).translate([a,c])},i)}function $T(t,e,i){return by(t,[[0,0],e],i)}function HT(t,e,i){return td(t,function(n){var s=+e,r=s/(n[1][0]-n[0][0]),o=(s-r*(n[1][0]+n[0][0]))/2,a=-r*n[0][1];t.scale(150*r).translate([o,a])},i)}function WT(t,e,i){return td(t,function(n){var s=+e,r=s/(n[1][1]-n[0][1]),o=-r*n[0][0],a=(s-r*(n[1][1]+n[0][1]))/2;t.scale(150*r).translate([o,a])},i)}var Dp=16,XT=tt(30*Qt);function Fp(t,e){return+e?YT(t,e):qT(t)}function qT(t){return ed({point:function(e,i){e=t(e,i),this.stream.point(e[0],e[1])}})}function YT(t,e){function i(n,s,r,o,a,c,l,u,h,f,d,p,g,_){var m=l-n,b=u-s,w=m*m+b*b;if(w>4*e&&g--){var S=o+f,R=a+d,M=c+p,k=Nn(S*S+R*R+M*M),F=_s(M/=k),I=nt(nt(M)-1)<je||nt(r-h)<je?(r+h)/2:br(R,S),N=t(I,F),C=N[0],V=N[1],X=C-n,K=V-s,B=b*X-m*K;(B*B/w>e||nt((m*X+b*K)/w-.5)>.3||o*f+a*d+c*p<XT)&&(i(n,s,r,o,a,c,C,V,I,S/=k,R/=k,M,g,_),_.point(C,V),i(C,V,I,S,R,M,l,u,h,f,d,p,g,_))}}return function(n){var s,r,o,a,c,l,u,h,f,d,p,g,_={point:m,lineStart:b,lineEnd:S,polygonStart:function(){n.polygonStart(),_.lineStart=R},polygonEnd:function(){n.polygonEnd(),_.lineStart=b}};function m(F,I){F=t(F,I),n.point(F[0],F[1])}function b(){h=NaN,_.point=w,n.lineStart()}function w(F,I){var N=wr([F,I]),C=t(F,I);i(h,f,u,d,p,g,h=C[0],f=C[1],u=F,d=N[0],p=N[1],g=N[2],Dp,n),n.point(h,f)}function S(){_.point=m,n.lineEnd()}function R(){b(),_.point=M,_.lineEnd=k}function M(F,I){w(s=F,I),r=h,o=f,a=d,c=p,l=g,_.point=w}function k(){i(h,f,u,d,p,g,r,o,s,a,c,l,Dp,n),_.lineEnd=S,S()}return _}}var KT=ed({point:function(t,e){this.stream.point(t*Qt,e*Qt)}});function ZT(t){return ed({point:function(e,i){var n=t(e,i);return this.stream.point(n[0],n[1])}})}function GT(t,e,i,n,s){function r(o,a){return o*=n,a*=s,[e+t*o,i-t*a]}return r.invert=function(o,a){return[(o-e)/t*n,(i-a)/t*s]},r}function Lp(t,e,i,n,s,r){if(!r)return GT(t,e,i,n,s);var o=tt(r),a=Qe(r),c=o*t,l=a*t,u=o/t,h=a/t,f=(a*i-o*e)/t,d=(a*e+o*i)/t;function p(g,_){return g*=n,_*=s,[c*g-l*_+e,i-l*g-c*_]}return p.invert=function(g,_){return[n*(u*g-h*_+f),s*(d-h*g-u*_)]},p}function wy(t){return JT(function(){return t})()}function JT(t){var e,i=150,n=480,s=250,r=0,o=0,a=0,c=0,l=0,u,h=0,f=1,d=1,p=null,g=xp,_=null,m,b,w,S=Th,R=.5,M,k,F,I,N;function C(B){return F(B[0]*Qt,B[1]*Qt)}function V(B){return B=F.invert(B[0],B[1]),B&&[B[0]*Hi,B[1]*Hi]}C.stream=function(B){return I&&N===B?I:I=KT(ZT(u)(g(M(S(N=B)))))},C.preclip=function(B){return arguments.length?(g=B,p=void 0,K()):g},C.postclip=function(B){return arguments.length?(S=B,_=m=b=w=null,K()):S},C.clipAngle=function(B){return arguments.length?(g=+B?xT(p=B*Qt):(p=null,xp),K()):p*Hi},C.clipExtent=function(B){return arguments.length?(S=B==null?(_=m=b=w=null,Th):MT(_=+B[0][0],m=+B[0][1],b=+B[1][0],w=+B[1][1]),K()):_==null?null:[[_,m],[b,w]]},C.scale=function(B){return arguments.length?(i=+B,X()):i},C.translate=function(B){return arguments.length?(n=+B[0],s=+B[1],X()):[n,s]},C.center=function(B){return arguments.length?(r=B[0]%360*Qt,o=B[1]%360*Qt,X()):[r*Hi,o*Hi]},C.rotate=function(B){return arguments.length?(a=B[0]%360*Qt,c=B[1]%360*Qt,l=B.length>2?B[2]%360*Qt:0,X()):[a*Hi,c*Hi,l*Hi]},C.angle=function(B){return arguments.length?(h=B%360*Qt,X()):h*Hi},C.reflectX=function(B){return arguments.length?(f=B?-1:1,X()):f<0},C.reflectY=function(B){return arguments.length?(d=B?-1:1,X()):d<0},C.precision=function(B){return arguments.length?(M=Fp(k,R=B*B),K()):Nn(R)},C.fitExtent=function(B,re){return by(C,B,re)},C.fitSize=function(B,re){return $T(C,B,re)},C.fitWidth=function(B,re){return HT(C,B,re)},C.fitHeight=function(B,re){return WT(C,B,re)};function X(){var B=Lp(i,0,0,f,d,h).apply(null,e(r,o)),re=Lp(i,n-B[0],s-B[1],f,d,h);return u=bT(a,c,l),k=bh(e,re),F=bh(u,k),M=Fp(k,R),K()}function K(){return I=N=null,C}return function(){return e=t.apply(this,arguments),C.invert=e.invert&&V,X()}}function QT(t){return function(e,i){var n=Nn(e*e+i*i),s=t(n),r=Qe(s),o=tt(s);return[br(e*r,n*o),_s(n&&i*r/n)]}}function Ty(t,e){return[tt(e)*Qe(t),Qe(e)]}Ty.invert=QT(_s);function eE(){return wy(Ty).scale(249.5).clipAngle(90+je)}function tE(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function iE(t){return function(){return t}}function nE(t){return+t}var Bp=[0,1];function mn(t){return t}function Oh(t,e){return(e-=t=+t)?function(i){return(i-t)/e}:iE(isNaN(e)?NaN:.5)}function sE(t,e){var i;return t>e&&(i=t,t=e,e=i),function(n){return Math.max(t,Math.min(e,n))}}function rE(t,e,i){var n=t[0],s=t[1],r=e[0],o=e[1];return s<n?(n=Oh(s,n),r=i(o,r)):(n=Oh(n,s),r=i(r,o)),function(a){return r(n(a))}}function oE(t,e,i){var n=Math.min(t.length,e.length)-1,s=new Array(n),r=new Array(n),o=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<n;)s[o]=Oh(t[o],t[o+1]),r[o]=i(e[o],e[o+1]);return function(a){var c=bw(t,a,1,n)-1;return r[c](s[c](a))}}function aE(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function cE(){var t=Bp,e=Bp,i=Gf,n,s,r,o=mn,a,c,l;function u(){var f=Math.min(t.length,e.length);return o!==mn&&(o=sE(t[0],t[f-1])),a=f>2?oE:rE,c=l=null,h}function h(f){return f==null||isNaN(f=+f)?r:(c||(c=a(t.map(n),e,i)))(n(o(f)))}return h.invert=function(f){return o(s((l||(l=a(e,t.map(n),Lo)))(f)))},h.domain=function(f){return arguments.length?(t=Array.from(f,nE),u()):t.slice()},h.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},h.rangeRound=function(f){return e=Array.from(f),i=Yw,u()},h.clamp=function(f){return arguments.length?(o=f?!0:mn,u()):o!==mn},h.interpolate=function(f){return arguments.length?(i=f,u()):i},h.unknown=function(f){return arguments.length?(r=f,h):r},function(f,d){return n=f,s=d,u()}}function lE(t,e,i,n){var s=Aw(t,e,i),r;switch(n=bc(n??",f"),n.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(r=pT(s,o))&&(n.precision=r),ry(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(r=gT(s,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=r-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(r=dT(s))&&(n.precision=r-(n.type==="%")*2);break}}return Qf(n)}function uE(t){var e=t.domain;return t.ticks=function(i){var n=e();return Sw(n[0],n[n.length-1],i??10)},t.tickFormat=function(i,n){var s=e();return lE(s[0],s[s.length-1],i??10,n)},t.nice=function(i){i==null&&(i=10);var n=e(),s=0,r=n.length-1,o=n[s],a=n[r],c,l,u=10;for(a<o&&(l=o,o=a,a=l,l=s,s=r,r=l);u-- >0;){if(l=dh(o,a,i),l===c)return n[s]=o,n[r]=a,e(n);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;c=l}return t},t}function Up(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function hE(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function fE(t){return t<0?-t*t:t*t}function dE(t){var e=t(mn,mn),i=1;function n(){return i===1?t(mn,mn):i===.5?t(hE,fE):t(Up(i),Up(1/i))}return e.exponent=function(s){return arguments.length?(i=+s,n()):i},uE(e)}function kh(){var t=dE(cE());return t.copy=function(){return aE(t,kh()).exponent(t.exponent())},tE.apply(t,arguments),t}function id(t,e,i){i===void 0&&(i={});var n={type:"Feature"};return(i.id===0||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=e||{},n.geometry=t,n}function pE(t,e,i){if(i===void 0&&(i={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!zp(t[0])||!zp(t[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:t};return id(n,e,i)}function gE(t,e,i){i===void 0&&(i={});for(var n=0,s=t;n<s.length;n++){var r=s[n];if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<r[r.length-1].length;o++)if(r[r.length-1][o]!==r[0][o])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:t};return id(a,e,i)}function _E(t,e){e===void 0&&(e={});var i={type:"FeatureCollection"};return e.id&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.features=t,i}function mE(t,e,i){i===void 0&&(i={});var n={type:"MultiPoint",coordinates:t};return id(n,e,i)}function zp(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function Ey(t,e,i){if(t!==null)for(var n,s,r,o,a,c,l,u=0,h=0,f,d=t.type,p=d==="FeatureCollection",g=d==="Feature",_=p?t.features.length:1,m=0;m<_;m++){l=p?t.features[m].geometry:g?t.geometry:t,f=l?l.type==="GeometryCollection":!1,a=f?l.geometries.length:1;for(var b=0;b<a;b++){var w=0,S=0;if(o=f?l.geometries[b]:l,o!==null){c=o.coordinates;var R=o.type;switch(u=i&&(R==="Polygon"||R==="MultiPolygon")?1:0,R){case null:break;case"Point":if(e(c,h,m,w,S)===!1)return!1;h++,w++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(e(c[n],h,m,w,S)===!1)return!1;h++,R==="MultiPoint"&&w++}R==="LineString"&&w++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(s=0;s<c[n].length-u;s++){if(e(c[n][s],h,m,w,S)===!1)return!1;h++}R==="MultiLineString"&&w++,R==="Polygon"&&S++}R==="Polygon"&&w++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(S=0,s=0;s<c[n].length;s++){for(r=0;r<c[n][s].length-u;r++){if(e(c[n][s][r],h,m,w,S)===!1)return!1;h++}S++}w++}break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(Ey(o.geometries[n],e,i)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function yE(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var i=0;i<t.features.length&&e(t.features[i],i)!==!1;i++);}function Vp(t,e){var i,n,s,r,o,a,c,l,u,h,f=0,d=t.type==="FeatureCollection",p=t.type==="Feature",g=d?t.features.length:1;for(i=0;i<g;i++){for(a=d?t.features[i].geometry:p?t.geometry:t,l=d?t.features[i].properties:p?t.properties:{},u=d?t.features[i].bbox:p?t.bbox:void 0,h=d?t.features[i].id:p?t.id:void 0,c=a?a.type==="GeometryCollection":!1,o=c?a.geometries.length:1,s=0;s<o;s++){if(r=c?a.geometries[s]:a,r===null){if(e(null,f,l,u,h)===!1)return!1;continue}switch(r.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(r,f,l,u,h)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<r.geometries.length;n++)if(e(r.geometries[n],f,l,u,h)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}f++}}function vE(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function bE(t){return t.type==="Feature"?t.geometry:t}function jp(t,e,i){if(i===void 0&&(i={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=vE(t),s=bE(e),r=s.type,o=e.bbox,a=s.coordinates;if(o&&wE(n,o)===!1)return!1;r==="Polygon"&&(a=[a]);for(var c=!1,l=0;l<a.length&&!c;l++)if($p(n,a[l][0],i.ignoreBoundary)){for(var u=!1,h=1;h<a[l].length&&!u;)$p(n,a[l][h],!i.ignoreBoundary)&&(u=!0),h++;u||(c=!0)}return c}function $p(t,e,i){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var s=0,r=e.length-1;s<e.length;r=s++){var o=e[s][0],a=e[s][1],c=e[r][0],l=e[r][1],u=t[1]*(o-c)+a*(c-t[0])+l*(t[0]-o)===0&&(o-t[0])*(c-t[0])<=0&&(a-t[1])*(l-t[1])<=0;if(u)return!i;var h=a>t[1]!=l>t[1]&&t[0]<(c-o)*(t[1]-a)/(l-a)+o;h&&(n=!n)}return n}function wE(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}function TE(t,e){var i=[];return yE(t,function(n){var s=!1;if(n.geometry.type==="Point")Vp(e,function(o){jp(n,o)&&(s=!0)}),s&&i.push(n);else if(n.geometry.type==="MultiPoint"){var r=[];Vp(e,function(o){Ey(n,function(a){jp(a,o)&&(s=!0,r.push(a))})}),s&&i.push(mE(r))}else throw new Error("Input geometry must be a Point or MultiPoint")}),_E(i)}function EE(t){return t}function SE(t){if(t==null)return EE;var e,i,n=t.scale[0],s=t.scale[1],r=t.translate[0],o=t.translate[1];return function(a,c){c||(e=i=0);var l=2,u=a.length,h=new Array(u);for(h[0]=(e+=a[0])*n+r,h[1]=(i+=a[1])*s+o;l<u;)h[l]=a[l],++l;return h}}function AE(t,e){for(var i,n=t.length,s=n-e;s<--n;)i=t[s],t[s++]=t[n],t[n]=i}function RE(t,e){return typeof e=="string"&&(e=t.objects[e]),e.type==="GeometryCollection"?{type:"FeatureCollection",features:e.geometries.map(function(i){return Hp(t,i)})}:Hp(t,e)}function Hp(t,e){var i=e.id,n=e.bbox,s=e.properties==null?{}:e.properties,r=CE(t,e);return i==null&&n==null?{type:"Feature",properties:s,geometry:r}:n==null?{type:"Feature",id:i,properties:s,geometry:r}:{type:"Feature",id:i,bbox:n,properties:s,geometry:r}}function CE(t,e){var i=SE(t.transform),n=t.arcs;function s(u,h){h.length&&h.pop();for(var f=n[u<0?~u:u],d=0,p=f.length;d<p;++d)h.push(i(f[d],d));u<0&&AE(h,p)}function r(u){return i(u)}function o(u){for(var h=[],f=0,d=u.length;f<d;++f)s(u[f],h);return h.length<2&&h.push(h[0]),h}function a(u){for(var h=o(u);h.length<4;)h.push(h[0]);return h}function c(u){return u.map(a)}function l(u){var h=u.type,f;switch(h){case"GeometryCollection":return{type:h,geometries:u.geometries.map(l)};case"Point":f=r(u.coordinates);break;case"MultiPoint":f=u.coordinates.map(r);break;case"LineString":f=o(u.arcs);break;case"MultiLineString":f=u.arcs.map(o);break;case"Polygon":f=c(u.arcs);break;case"MultiPolygon":f=u.arcs.map(c);break;default:return null}return{type:h,coordinates:f}}return l(e)}function xE(t,e){e===void 0&&(e={});var i=Number(t[0]),n=Number(t[1]),s=Number(t[2]),r=Number(t[3]);if(t.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var o=[i,n],a=[i,r],c=[s,r],l=[s,n];return gE([[o,l,c,a,o]],e.properties,{bbox:t,id:e.id})}var nd={exports:{}};nd.exports=Fl;nd.exports.default=Fl;function Fl(t,e,i){i=i||2;var n=e&&e.length,s=n?e[0]*i:t.length,r=Sy(t,0,s,i,!0),o=[];if(!r||r.next===r.prev)return o;var a,c,l,u,h,f,d;if(n&&(r=kE(t,e,r,i)),t.length>80*i){a=l=t[0],c=u=t[1];for(var p=i;p<s;p+=i)h=t[p],f=t[p+1],h<a&&(a=h),f<c&&(c=f),h>l&&(l=h),f>u&&(u=f);d=Math.max(l-a,u-c),d=d!==0?32767/d:0}return zo(r,o,i,a,c,d,0),o}function Sy(t,e,i,n,s){var r,o;if(s===Fh(t,e,i,n)>0)for(r=e;r<i;r+=n)o=Wp(r,t[r],t[r+1],o);else for(r=i-n;r>=e;r-=n)o=Wp(r,t[r],t[r+1],o);return o&&Ll(o,o.next)&&(jo(o),o=o.next),o}function ys(t,e){if(!t)return t;e||(e=t);var i=t,n;do if(n=!1,!i.steiner&&(Ll(i,i.next)||it(i.prev,i,i.next)===0)){if(jo(i),i=e=i.prev,i===i.next)break;n=!0}else i=i.next;while(n||i!==e);return e}function zo(t,e,i,n,s,r,o){if(t){!o&&r&&BE(t,n,s,r);for(var a=t,c,l;t.prev!==t.next;){if(c=t.prev,l=t.next,r?ME(t,n,s,r):PE(t)){e.push(c.i/i|0),e.push(t.i/i|0),e.push(l.i/i|0),jo(t),t=l.next,a=l.next;continue}if(t=l,t===a){o?o===1?(t=IE(ys(t),e,i),zo(t,e,i,n,s,r,2)):o===2&&OE(t,e,i,n,s,r):zo(ys(t),e,i,n,s,r,1);break}}}}function PE(t){var e=t.prev,i=t,n=t.next;if(it(e,i,n)>=0)return!1;for(var s=e.x,r=i.x,o=n.x,a=e.y,c=i.y,l=n.y,u=s<r?s<o?s:o:r<o?r:o,h=a<c?a<l?a:l:c<l?c:l,f=s>r?s>o?s:o:r>o?r:o,d=a>c?a>l?a:l:c>l?c:l,p=n.next;p!==e;){if(p.x>=u&&p.x<=f&&p.y>=h&&p.y<=d&&Js(s,a,r,c,o,l,p.x,p.y)&&it(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function ME(t,e,i,n){var s=t.prev,r=t,o=t.next;if(it(s,r,o)>=0)return!1;for(var a=s.x,c=r.x,l=o.x,u=s.y,h=r.y,f=o.y,d=a<c?a<l?a:l:c<l?c:l,p=u<h?u<f?u:f:h<f?h:f,g=a>c?a>l?a:l:c>l?c:l,_=u>h?u>f?u:f:h>f?h:f,m=Nh(d,p,e,i,n),b=Nh(g,_,e,i,n),w=t.prevZ,S=t.nextZ;w&&w.z>=m&&S&&S.z<=b;){if(w.x>=d&&w.x<=g&&w.y>=p&&w.y<=_&&w!==s&&w!==o&&Js(a,u,c,h,l,f,w.x,w.y)&&it(w.prev,w,w.next)>=0||(w=w.prevZ,S.x>=d&&S.x<=g&&S.y>=p&&S.y<=_&&S!==s&&S!==o&&Js(a,u,c,h,l,f,S.x,S.y)&&it(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;w&&w.z>=m;){if(w.x>=d&&w.x<=g&&w.y>=p&&w.y<=_&&w!==s&&w!==o&&Js(a,u,c,h,l,f,w.x,w.y)&&it(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;S&&S.z<=b;){if(S.x>=d&&S.x<=g&&S.y>=p&&S.y<=_&&S!==s&&S!==o&&Js(a,u,c,h,l,f,S.x,S.y)&&it(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function IE(t,e,i){var n=t;do{var s=n.prev,r=n.next.next;!Ll(s,r)&&Ay(s,n,n.next,r)&&Vo(s,r)&&Vo(r,s)&&(e.push(s.i/i|0),e.push(n.i/i|0),e.push(r.i/i|0),jo(n),jo(n.next),n=t=r),n=n.next}while(n!==t);return ys(n)}function OE(t,e,i,n,s,r){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&VE(o,a)){var c=Ry(o,a);o=ys(o,o.next),c=ys(c,c.next),zo(o,e,i,n,s,r,0),zo(c,e,i,n,s,r,0);return}a=a.next}o=o.next}while(o!==t)}function kE(t,e,i,n){var s=[],r,o,a,c,l;for(r=0,o=e.length;r<o;r++)a=e[r]*n,c=r<o-1?e[r+1]*n:t.length,l=Sy(t,a,c,n,!1),l===l.next&&(l.steiner=!0),s.push(zE(l));for(s.sort(NE),r=0;r<s.length;r++)i=DE(s[r],i);return i}function NE(t,e){return t.x-e.x}function DE(t,e){var i=FE(t,e);if(!i)return e;var n=Ry(i,t);return ys(n,n.next),ys(i,i.next)}function FE(t,e){var i=e,n=t.x,s=t.y,r=-1/0,o;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>r&&(r=a,o=i.x<i.next.x?i:i.next,a===n))return o}i=i.next}while(i!==e);if(!o)return null;var c=o,l=o.x,u=o.y,h=1/0,f;i=o;do n>=i.x&&i.x>=l&&n!==i.x&&Js(s<u?n:r,s,l,u,s<u?r:n,s,i.x,i.y)&&(f=Math.abs(s-i.y)/(n-i.x),Vo(i,t)&&(f<h||f===h&&(i.x>o.x||i.x===o.x&&LE(o,i)))&&(o=i,h=f)),i=i.next;while(i!==c);return o}function LE(t,e){return it(t.prev,t,e.prev)<0&&it(e.next,t,t.next)<0}function BE(t,e,i,n){var s=t;do s.z===0&&(s.z=Nh(s.x,s.y,e,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,UE(s)}function UE(t){var e,i,n,s,r,o,a,c,l=1;do{for(i=t,t=null,r=null,o=0;i;){for(o++,n=i,a=0,e=0;e<l&&(a++,n=n.nextZ,!!n);e++);for(c=l;a>0||c>0&&n;)a!==0&&(c===0||!n||i.z<=n.z)?(s=i,i=i.nextZ,a--):(s=n,n=n.nextZ,c--),r?r.nextZ=s:t=s,s.prevZ=r,r=s;i=n}r.nextZ=null,l*=2}while(o>1);return t}function Nh(t,e,i,n,s){return t=(t-i)*s|0,e=(e-n)*s|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function zE(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Js(t,e,i,n,s,r,o,a){return(s-o)*(e-a)>=(t-o)*(r-a)&&(t-o)*(n-a)>=(i-o)*(e-a)&&(i-o)*(r-a)>=(s-o)*(n-a)}function VE(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!jE(t,e)&&(Vo(t,e)&&Vo(e,t)&&$E(t,e)&&(it(t.prev,t,e.prev)||it(t,e.prev,e))||Ll(t,e)&&it(t.prev,t,t.next)>0&&it(e.prev,e,e.next)>0)}function it(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Ll(t,e){return t.x===e.x&&t.y===e.y}function Ay(t,e,i,n){var s=Aa(it(t,e,i)),r=Aa(it(t,e,n)),o=Aa(it(i,n,t)),a=Aa(it(i,n,e));return!!(s!==r&&o!==a||s===0&&Sa(t,i,e)||r===0&&Sa(t,n,e)||o===0&&Sa(i,t,n)||a===0&&Sa(i,e,n))}function Sa(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Aa(t){return t>0?1:t<0?-1:0}function jE(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Ay(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function Vo(t,e){return it(t.prev,t,t.next)<0?it(t,e,t.next)>=0&&it(t,t.prev,e)>=0:it(t,e,t.prev)<0||it(t,t.next,e)<0}function $E(t,e){var i=t,n=!1,s=(t.x+e.x)/2,r=(t.y+e.y)/2;do i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==t);return n}function Ry(t,e){var i=new Dh(t.i,t.x,t.y),n=new Dh(e.i,e.x,e.y),s=t.next,r=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function Wp(t,e,i,n){var s=new Dh(t,e,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function jo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Dh(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Fl.deviation=function(t,e,i,n){var s=e&&e.length,r=s?e[0]*i:t.length,o=Math.abs(Fh(t,0,r,i));if(s)for(var a=0,c=e.length;a<c;a++){var l=e[a]*i,u=a<c-1?e[a+1]*i:t.length;o-=Math.abs(Fh(t,l,u,i))}var h=0;for(a=0;a<n.length;a+=3){var f=n[a]*i,d=n[a+1]*i,p=n[a+2]*i;h+=Math.abs((t[f]-t[p])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[p+1]-t[f+1]))}return o===0&&h===0?0:Math.abs((h-o)/o)};function Fh(t,e,i,n){for(var s=0,r=e,o=i-n;r<i;r+=n)s+=(t[o]-t[r])*(t[r+1]+t[o+1]),o=r;return s}Fl.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,s=0;s<t.length;s++){for(var r=0;r<t[s].length;r++)for(var o=0;o<e;o++)i.vertices.push(t[s][r][o]);s>0&&(n+=t[s-1].length,i.holes.push(n))}return i};var HE=nd.exports;const WE=Yf(HE);function XE(t,e,i){if(console.log(e),i=="bbox"){let n=e.result.bbox,s=xE(n),r=t.map(a=>pE(a.center.split(","),{id:a.id}));return r={type:"FeatureCollection",features:r},TE(r,s).features.map(a=>a.properties.id)}}function qE(t,e){let i=t.filter(n=>{let s=n.color,r=gh(s),o=gh(e),a=r.s,c=r.h-o.h;if(c<70&&c>-70&&a>.3)return n}).map(n=>n.id);return console.log(i.length),i}function Xp(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Cy=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),qp=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);qp&&parseFloat(qp[1]);const Ra=globalThis,Ls=globalThis.process||{},YE=globalThis.navigator||{};function xy(t){var n,s;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,i=t||e;return!!(i&&i.indexOf("Electron")>=0)}function Dn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||xy()}function KE(t){return!t&&!Dn()?"Node":xy(t)?"Electron":(t||YE.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const Py="4.0.7";function ZE(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch{return null}}class GE{constructor(e,i,n="sessionStorage"){this.storage=ZE(n),this.id=e,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let e={};if(this.storage){const i=this.storage.getItem(this.id);e=i?JSON.parse(i):{}}return Object.assign(this.config,e),this}}function JE(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function QE(t,e=8){const i=Math.max(e-t.length,0);return`${" ".repeat(i)}${t}`}var Pc;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Pc||(Pc={}));const eS=10;function Yp(t){return typeof t!="string"?t:(t=t.toUpperCase(),Pc[t]||Pc.WHITE)}function tS(t,e,i){return!Dn&&typeof t=="string"&&(e&&(t=`\x1B[${Yp(e)}m${t}\x1B[39m`),i&&(t=`\x1B[${Yp(i)+eS}m${t}\x1B[49m`)),t}function iS(t,e=["constructor"]){const i=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(i),s=t;for(const r of n){const o=s[r];typeof o=="function"&&(e.find(a=>r===a)||(s[r]=o.bind(t)))}}function sd(t,e){if(!t)throw new Error(e||"Assertion failed")}function Bs(){var e,i,n;let t;if(Dn()&&Ra.performance)t=(i=(e=Ra==null?void 0:Ra.performance)==null?void 0:e.now)==null?void 0:i.call(e);else if("hrtime"in Ls){const s=(n=Ls==null?void 0:Ls.hrtime)==null?void 0:n.call(Ls);t=s[0]*1e3+s[1]/1e6}else t=Date.now();return t}const Us={debug:Dn()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},nS={enabled:!0,level:0};function zs(){}const Kp={},Zp={once:!0};class ta{constructor({id:e}={id:""}){this.VERSION=Py,this._startTs=Bs(),this._deltaTs=Bs(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new GE(`__probe-${this.id}__`,nS),this.timeStamp(`${this.id} started`),iS(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Bs()-this._startTs).toPrecision(10))}getDelta(){return Number((Bs()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,i){this._storage.setConfiguration({[e]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,i){if(!e)throw new Error(i||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Us.warn,arguments,Zp)}error(e){return this._getLogFunction(0,e,Us.error,arguments)}deprecated(e,i){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${i}\` instead`)}removed(e,i){return this.error(`\`${e}\` has been removed. Use \`${i}\` instead`)}probe(e,i){return this._getLogFunction(e,i,Us.log,arguments,{time:!0,once:!0})}log(e,i){return this._getLogFunction(e,i,Us.debug,arguments)}info(e,i){return this._getLogFunction(e,i,console.info,arguments)}once(e,i){return this._getLogFunction(e,i,Us.debug||Us.info,arguments,Zp)}table(e,i,n){return i?this._getLogFunction(e,i,console.table||zs,n&&[n],{tag:rS(i)}):zs}time(e,i){return this._getLogFunction(e,i,console.time?console.time:console.info)}timeEnd(e,i){return this._getLogFunction(e,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,i){return this._getLogFunction(e,i,console.timeStamp||zs)}group(e,i,n={collapsed:!1}){const s=Gp({logLevel:e,message:i,opts:n}),{collapsed:r}=n;return s.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,i,n={}){return this.group(e,i,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||zs)}withGroup(e,i,n){this.group(e,i)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=My(e)}_getLogFunction(e,i,n,s,r){if(this._shouldLog(e)){r=Gp({logLevel:e,message:i,args:s,opts:r}),n=n||r.method,sd(n),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Bs();const o=r.tag||r.message;if(r.once&&o)if(!Kp[o])Kp[o]=Bs();else return zs;return i=sS(this.id,r.message,r),n.bind(console,i,...r.args)}return zs}}ta.VERSION=Py;function My(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return sd(Number.isFinite(e)&&e>=0),e}function Gp(t){const{logLevel:e,message:i}=t;t.logLevel=My(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==i;);switch(typeof e){case"string":case"function":i!==void 0&&n.unshift(i),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return sd(s==="string"||s==="object"),Object.assign(t,{args:n},t.opts)}function sS(t,e,i){if(typeof e=="string"){const n=i.time?QE(JE(i.total)):"";e=i.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=tS(e,i.color,i.background)}return e}function rS(t){for(const e in t)for(const i in t[e])return i||"untitled";return"empty"}function oS(t,e){return Iy(t||{},e)}function Iy(t,e,i=0){if(i>3)return e;const n={...t};for(const[s,r]of Object.entries(e))r&&typeof r=="object"&&!Array.isArray(r)?n[s]=Iy(n[s]||{},e[s],i+1):n[s]=e[s];return n}function aS(t){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,t)}const cS="latest";function lS(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.0-beta.2"),globalThis._loadersgl_.version}const uS=lS();function Rn(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const ss=typeof process!="object"||String(process)!=="[object process]"||process.browser,hS=typeof window<"u"&&typeof window.orientation<"u",Jp=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Jp&&parseFloat(Jp[1]);class fS{constructor(e,i){v(this,"name");v(this,"workerThread");v(this,"isRunning",!0);v(this,"result");v(this,"_resolve",()=>{});v(this,"_reject",()=>{});this.name=e,this.workerThread=i,this.result=new Promise((n,s)=>{this._resolve=n,this._reject=s})}postMessage(e,i){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:i})}done(e){Rn(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Rn(this.isRunning),this.isRunning=!1,this._reject(e)}}class gu{terminate(){}}const _u=new Map;function dS(t){Rn(t.source&&!t.url||!t.source&&t.url);let e=_u.get(t.source||t.url);return e||(t.url&&(e=pS(t.url),_u.set(t.url,e)),t.source&&(e=Oy(t.source),_u.set(t.source,e))),Rn(e),e}function pS(t){if(!t.startsWith("http"))return t;const e=gS(t);return Oy(e)}function Oy(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function gS(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function ky(t,e=!0,i){const n=i||new Set;if(t){if(Qp(t))n.add(t);else if(Qp(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const s in t)ky(t[s],e,n)}}return i===void 0?Array.from(n):[]}function Qp(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const mu=()=>{};class Lh{constructor(e){v(this,"name");v(this,"source");v(this,"url");v(this,"terminated",!1);v(this,"worker");v(this,"onMessage");v(this,"onError");v(this,"_loadableURL","");const{name:i,source:n,url:s}=e;Rn(n||s),this.name=i,this.source=n,this.url=s,this.onMessage=mu,this.onError=r=>console.log(r),this.worker=ss?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&ss||typeof gu<"u"&&!ss}destroy(){this.onMessage=mu,this.onError=mu,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,i){i=i||ky(e),this.worker.postMessage(e,i)}_getErrorFromErrorEvent(e){let i="Failed to load ";return i+=`worker ${this.name} from ${this.url}. `,e.message&&(i+=`${e.message} in `),e.lineno&&(i+=`:${e.lineno}:${e.colno}`),new Error(i)}_createBrowserWorker(){this._loadableURL=dS({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},e.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},e.onmessageerror=i=>console.error(i),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new gu(n,{eval:!1})}else if(this.source)e=new gu(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",i=>{this.onMessage(i)}),e.on("error",i=>{this.onError(i)}),e.on("exit",i=>{}),e}}class _S{constructor(e){v(this,"name","unnamed");v(this,"source");v(this,"url");v(this,"maxConcurrency",1);v(this,"maxMobileConcurrency",1);v(this,"onDebug",()=>{});v(this,"reuseWorkers",!0);v(this,"props",{});v(this,"jobQueue",[]);v(this,"idleQueue",[]);v(this,"count",0);v(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Lh.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,i=(s,r,o)=>s.done(o),n=(s,r)=>s.error(r)){const s=new Promise(r=>(this.jobQueue.push({name:e,onMessage:i,onError:n,onStart:r}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:e,backlog:this.jobQueue.length});const n=new fS(i.name,e);e.onMessage=s=>i.onMessage(n,s.type,s.payload),e.onError=s=>i.onError(n,s),i.onStart(n);try{await n.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!ss||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Lh({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return hS?this.maxMobileConcurrency:this.maxConcurrency}}const mS={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},dn=class dn{constructor(e){v(this,"props");v(this,"workerPools",new Map);this.props={...mS},this.setProps(e),this.workerPools=new Map}static isSupported(){return Lh.isSupported()}static getWorkerFarm(e={}){return dn._workerFarm=dn._workerFarm||new dn({}),dn._workerFarm.setProps(e),dn._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:i,source:n,url:s}=e;let r=this.workerPools.get(i);return r||(r=new _S({name:i,source:n,url:s}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};v(dn,"_workerFarm");let Mc=dn;function yS(t,e={}){const i=e[t.id]||{},n=ss?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let s=i.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(ss?s=`modules/${t.module}/dist/${n}`:s=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!s){let r=t.version;r==="latest"&&(r=cS);const o=r?`@${r}`:"";s=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${n}`}return Rn(s),s}function vS(t,e=uS){Rn(t,"no worker provided");const i=t.version;return!(!e||!i)}function bS(t,e){return!Mc.isSupported()||!ss&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function wS(t,e,i,n,s){const r=t.id,o=yS(t,i),c=Mc.getWorkerFarm(i).getWorkerPool({name:r,url:o});i=JSON.parse(JSON.stringify(i)),n=JSON.parse(JSON.stringify(n||{}));const l=await c.startJob("process-on-worker",TS.bind(null,s));return l.postMessage("process",{input:e,options:i,context:n}),await(await l.result).result}async function TS(t,e,i,n){switch(i){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:s,input:r,options:o}=n;try{const a=await t(r,o);e.postMessage("done",{id:s,result:a})}catch(a){const c=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:s,error:c})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function ES(t,e,i){if(i=i||t.byteLength,t.byteLength<i||e.byteLength<i)return!1;const n=new Uint8Array(t),s=new Uint8Array(e);for(let r=0;r<n.length;++r)if(n[r]!==s[r])return!1;return!0}function SS(...t){return AS(t)}function AS(t){const e=t.map(r=>r instanceof ArrayBuffer?new Uint8Array(r):r),i=e.reduce((r,o)=>r+o.byteLength,0),n=new Uint8Array(i);let s=0;for(const r of e)n.set(r,s),s+=r.byteLength;return n.buffer}async function RS(t){const e=[];for await(const i of t)e.push(i);return SS(...e)}function eg(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class tg{constructor(e,i){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=i,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=eg(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(eg()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class ia{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,i="count"){return this._getOrCreate({name:e,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const i of Object.values(this.stats))e(i)}getTable(){const e={};return this.forEach(i=>{e[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(i=>this._getOrCreate(i))}_getOrCreate(e){const{name:i,type:n}=e;let s=this.stats[i];return s||(e instanceof tg?s=e:s=new tg(i,n),this.stats[i]=s),s}}const CS="Queued Requests",xS="Active Requests",PS="Cancelled Requests",MS="Queued Requests Ever",IS="Active Requests Ever",OS={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class kS{constructor(e={}){v(this,"props");v(this,"stats");v(this,"activeRequestCount",0);v(this,"requestQueue",[]);v(this,"requestMap",new Map);v(this,"updateTimer",null);this.props={...OS,...e},this.stats=new ia({id:this.props.id}),this.stats.get(CS),this.stats.get(xS),this.stats.get(PS),this.stats.get(MS),this.stats.get(IS)}scheduleRequest(e,i=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:i},s=new Promise(r=>(n.resolve=r,n));return this.requestQueue.push(n),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){const{handle:i,resolve:n}=e;let s=!1;const r=()=>{s||(s=!0,this.requestMap.delete(i),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let i=0;i<e;++i){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const e=this.requestQueue;for(let i=0;i<e.length;++i){const n=e[i];this._updateRequest(n)||(e.splice(i,1),this.requestMap.delete(n.handle),i--)}e.sort((i,n)=>i.priority-n.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let NS="";const ig={};function DS(t){for(const e in ig)if(t.startsWith(e)){const i=ig[e];t=t.replace(e,i)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${NS}${t}`),t}function FS(t){return t&&typeof t=="object"&&t.isBuffer}function Ny(t){if(FS(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function Dy(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function LS(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const BS=t=>typeof t=="boolean",bo=t=>typeof t=="function",na=t=>t!==null&&typeof t=="object",ng=t=>na(t)&&t.constructor==={}.constructor,US=t=>!!t&&typeof t[Symbol.iterator]=="function",zS=t=>t&&typeof t[Symbol.asyncIterator]=="function",Es=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Ss=t=>typeof Blob<"u"&&t instanceof Blob,VS=t=>t&&typeof t=="object"&&t.isBuffer,jS=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||na(t)&&bo(t.tee)&&bo(t.cancel)&&bo(t.getReader),$S=t=>na(t)&&bo(t.read)&&bo(t.pipe)&&BS(t.readable),Fy=t=>jS(t)||$S(t);class HS extends Error{constructor(i,n){super(i);v(this,"reason");v(this,"url");v(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const WS=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,XS=/^([-\w.]+\/[-\w.+]+)/;function sg(t,e){return t.toLowerCase()===e.toLowerCase()}function qS(t){const e=XS.exec(t);return e?e[1]:t}function rg(t){const e=WS.exec(t);return e?e[1]:""}const Ly=/\?.*/;function YS(t){const e=t.match(Ly);return e&&e[0]}function rd(t){return t.replace(Ly,"")}function KS(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Bl(t){return Es(t)?t.url:Ss(t)?t.name||"":typeof t=="string"?t:""}function od(t){if(Es(t)){const e=t,i=e.headers.get("content-type")||"",n=rd(e.url);return qS(i)||rg(n)}return Ss(t)?t.type||"":typeof t=="string"?rg(t):""}function ZS(t){return Es(t)?t.headers["content-length"]||-1:Ss(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function By(t){if(Es(t))return t;const e={},i=ZS(t);i>=0&&(e["content-length"]=String(i));const n=Bl(t),s=od(t);s&&(e["content-type"]=s);const r=await QS(t);r&&(e["x-first-bytes"]=r),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:n}),o}async function GS(t){if(!t.ok)throw await JS(t)}async function JS(t){const e=KS(t.url);let i=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;i=i.length>100?`${i.slice(0,100)}...`:i;const n={reason:t.statusText,url:t.url,response:t};try{const s=t.headers.get("Content-Type");n.reason=s!=null&&s.includes("application/json")?await t.json():t.text()}catch{}return new HS(i,n)}async function QS(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const i=t.slice(0,5);return await new Promise(n=>{const s=new FileReader;s.onload=r=>{var o;return n((o=r==null?void 0:r.target)==null?void 0:o.result)},s.readAsDataURL(i)})}if(t instanceof ArrayBuffer){const i=t.slice(0,5);return`data:base64,${eA(i)}`}return null}function eA(t){let e="";const i=new Uint8Array(t);for(let n=0;n<i.byteLength;n++)e+=String.fromCharCode(i[n]);return btoa(e)}function tA(t){return!iA(t)&&!nA(t)}function iA(t){return t.startsWith("http:")||t.startsWith("https:")}function nA(t){return t.startsWith("data:")}async function og(t,e){var i,n;if(typeof t=="string"){const s=DS(t);return tA(s)&&(i=globalThis.loaders)!=null&&i.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(s,e):await fetch(s,e)}return await By(t)}const ag=new ta({id:"loaders.gl"});class sA{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class rA{constructor(){v(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const Uy={fetch:null,mimeType:void 0,nothrow:!1,log:new rA,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Cy,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},oA={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function ad(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function cd(){const t=ad();return t.globalOptions=t.globalOptions||{...Uy},t.globalOptions}function aA(t){const e=ad(),i=cd();e.globalOptions=zy(i,t),aS(t.modules)}function cA(t,e,i,n){return i=i||[],i=Array.isArray(i)?i:[i],lA(t,i),zy(e,t,n)}function lA(t,e){cg(t,null,Uy,oA,e);for(const i of e){const n=t&&t[i.id]||{},s=i.options&&i.options[i.id]||{},r=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};cg(n,i.id,s,r,e)}}function cg(t,e,i,n,s){const r=e||"Top level",o=e?`${e}.`:"";for(const a in t){const c=!e&&na(t[a]),l=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in i)&&!l&&!u){if(a in n)ag.warn(`${r} loader option '${o}${a}' no longer supported, use '${n[a]}'`)();else if(!c){const h=uA(a,s);ag.warn(`${r} loader option '${o}${a}' not recognized. ${h}`)()}}}}function uA(t,e){const i=t.toLowerCase();let n="";for(const s of e)for(const r in s.options){if(t===r)return`Did you mean '${s.id}.${r}'?`;const o=r.toLowerCase();(i.startsWith(o)||o.startsWith(i))&&(n=n||`Did you mean '${s.id}.${r}'?`)}return n}function zy(t,e,i){const s={...t.options||{}};return hA(s,i),s.log===null&&(s.log=new sA),lg(s,cd()),lg(s,e),s}function lg(t,e){for(const i in e)if(i in e){const n=e[i];ng(n)&&ng(t[i])?t[i]={...t[i],...e[i]}:t[i]=e[i]}}function hA(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function ld(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function ud(t){Xp(t,"null loader"),Xp(ld(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Vy=()=>{const t=ad();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function jy(t){const e=Vy();t=Array.isArray(t)?t:[t];for(const i of t){const n=ud(i);e.find(s=>n===s)||e.unshift(n)}}function fA(){return Vy()}const dA=new ta({id:"loaders.gl"}),pA=/\.([^.]+)$/;async function gA(t,e=[],i,n){if(!$y(t))return null;let s=ug(t,e,{...i,nothrow:!0},n);if(s)return s;if(Ss(t)&&(t=await t.slice(0,10).arrayBuffer(),s=ug(t,e,i,n)),!s&&!(i!=null&&i.nothrow))throw new Error(Hy(t));return s}function ug(t,e=[],i,n){if(!$y(t))return null;if(e&&!Array.isArray(e))return ud(e);let s=[];e&&(s=s.concat(e)),i!=null&&i.ignoreRegisteredLoaders||s.push(...fA()),mA(s);const r=_A(t,s,i,n);if(!r&&!(i!=null&&i.nothrow))throw new Error(Hy(t));return r}function _A(t,e,i,n){const s=Bl(t),r=od(t),o=rd(s)||(n==null?void 0:n.url);let a=null,c="";return i!=null&&i.mimeType&&(a=yu(e,i==null?void 0:i.mimeType),c=`match forced by supplied MIME type ${i==null?void 0:i.mimeType}`),a=a||yA(e,o),c=c||(a?`matched url ${o}`:""),a=a||yu(e,r),c=c||(a?`matched MIME type ${r}`:""),a=a||bA(e,t),c=c||(a?`matched initial data ${Wy(t)}`:""),i!=null&&i.fallbackMimeType&&(a=a||yu(e,i==null?void 0:i.fallbackMimeType),c=c||(a?`matched fallback MIME type ${r}`:"")),c&&dA.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${c}.`),a}function $y(t){return!(t instanceof Response&&t.status===204)}function Hy(t){const e=Bl(t),i=od(t);let n="No valid loader found (";n+=e?`${Dy(e)}, `:"no url provided, ",n+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const s=t?Wy(t):"";return n+=s?` first bytes: "${s}"`:"first bytes: not available",n+=")",n}function mA(t){for(const e of t)ud(e)}function yA(t,e){const i=e&&pA.exec(e),n=i&&i[1];return n?vA(t,n):null}function vA(t,e){e=e.toLowerCase();for(const i of t)for(const n of i.extensions)if(n.toLowerCase()===e)return i;return null}function yu(t,e){var i;for(const n of t)if((i=n.mimeTypes)!=null&&i.some(s=>sg(e,s))||sg(e,`application/x.${n.id}`))return n;return null}function bA(t,e){if(!e)return null;for(const i of t)if(typeof e=="string"){if(wA(e,i))return i}else if(ArrayBuffer.isView(e)){if(hg(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer&&hg(e,0,i))return i;return null}function wA(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>t.startsWith(n))}function hg(t,e,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(s=>TA(t,e,i,s))}function TA(t,e,i,n){if(n instanceof ArrayBuffer)return ES(n,t,n.byteLength);switch(typeof n){case"function":return n(t);case"string":const s=Bh(t,e,n.length);return n===s;default:return!1}}function Wy(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Bh(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Bh(t,0,e):""}function Bh(t,e,i){if(t.byteLength<e+i)return"";const n=new DataView(t);let s="";for(let r=0;r<i;r++)s+=String.fromCharCode(n.getUint8(e+r));return s}const EA=256*1024;function*SA(t,e){const i=(e==null?void 0:e.chunkSize)||EA;let n=0;const s=new TextEncoder;for(;n<t.length;){const r=Math.min(t.length-n,i),o=t.slice(n,n+r);n+=r,yield s.encode(o)}}const AA=256*1024;function*RA(t,e={}){const{chunkSize:i=AA}=e;let n=0;for(;n<t.byteLength;){const s=Math.min(t.byteLength-n,i),r=new ArrayBuffer(s),o=new Uint8Array(t,n,s);new Uint8Array(r).set(o),n+=s,yield r}}const CA=1024*1024;async function*xA(t,e){const i=(e==null?void 0:e.chunkSize)||CA;let n=0;for(;n<t.size;){const s=n+i,r=await t.slice(n,s).arrayBuffer();n=s,yield r}}function fg(t,e){return Cy?PA(t,e):MA(t)}async function*PA(t,e){const i=t.getReader();let n;try{for(;;){const s=n||i.read();e!=null&&e._streamReadAhead&&(n=i.read());const{done:r,value:o}=await s;if(r)return;yield Ny(o)}}catch{i.releaseLock()}}async function*MA(t,e){for await(const i of t)yield Ny(i)}function IA(t,e){if(typeof t=="string")return SA(t,e);if(t instanceof ArrayBuffer)return RA(t,e);if(Ss(t))return xA(t,e);if(Fy(t))return fg(t,e);if(Es(t))return fg(t.body,e);throw new Error("makeIterator")}const Xy="Cannot convert supplied data type";function OA(t,e,i){if(e.text&&typeof t=="string")return t;if(VS(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+s)),n}throw new Error(Xy)}async function kA(t,e,i){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||n)return OA(t,e);if(Ss(t)&&(t=await By(t)),Es(t)){const s=t;return await GS(s),e.binary?await s.arrayBuffer():await s.text()}if(Fy(t)&&(t=IA(t,i)),US(t)||zS(t))return RS(t);throw new Error(Xy)}function qy(t,e){const i=cd(),n=t||i;return typeof n.fetch=="function"?n.fetch:na(n.fetch)?s=>og(s,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:og}function NA(t,e,i){if(i)return i;const n={fetch:qy(e,t),...t};if(n.url){const s=rd(n.url);n.baseUrl=s,n.queryString=YS(n.url),n.filename=Dy(s),n.baseUrl=LS(s)}return Array.isArray(n.loaders)||(n.loaders=null),n}function DA(t,e){if(t&&!Array.isArray(t))return t;let i;if(t&&(i=Array.isArray(t)?t:[t]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...n]:n}return i&&i.length?i:void 0}async function Ic(t,e,i,n){e&&!Array.isArray(e)&&!ld(e)&&(n=void 0,i=e,e=void 0),t=await t,i=i||{};const s=Bl(t),o=DA(e,n),a=await gA(t,o,i);return a?(i=cA(i,a,o,s),n=NA({url:s,_parse:Ic,loaders:o},i,n||null),await FA(a,t,i,n)):null}async function FA(t,e,i,n){if(vS(t),i=oS(t.options,i),Es(e)){const r=e,{ok:o,redirected:a,status:c,statusText:l,type:u,url:h}=r,f=Object.fromEntries(r.headers.entries());n.response={headers:f,ok:o,redirected:a,status:c,statusText:l,type:u,url:h}}e=await kA(e,t,i);const s=t;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,i,n);if(bS(t,i))return await wS(t,e,i,n,Ic);if(s.parseText&&typeof e=="string")return await s.parseText(e,i,n);if(s.parse)return await s.parse(e,i,n);throw Rn(!s.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function rs(t,e,i,n){let s,r;!Array.isArray(e)&&!ld(e)?(s=[],r=e):(s=e,r=i);const o=qy(r);let a=t;return typeof t=="string"&&(a=await o(t)),Ss(t)&&(a=await o(t)),Array.isArray(s)?await Ic(a,s,r):await Ic(a,s,r)}const LA="4.2.0";function Yy(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const BA=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),dg=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);dg&&parseFloat(dg[1]);var Wm;const UA=(Wm=globalThis.loaders)==null?void 0:Wm.parseImageNode,Uh=typeof Image<"u",zh=typeof ImageBitmap<"u",zA=!!UA,Vh=BA?!0:zA;function VA(t){switch(t){case"auto":return zh||Uh||Vh;case"imagebitmap":return zh;case"image":return Uh;case"data":return Vh;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function jA(){if(zh)return"imagebitmap";if(Uh)return"image";if(Vh)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function $A(t){const e=WA(t);if(!e)throw new Error("Not an image");return e}function HA(t){switch($A(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function WA(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const XA=/^data:image\/svg\+xml/,qA=/\.svg((\?|#).*)?$/;function hd(t){return t&&(XA.test(t)||qA.test(t))}function YA(t,e){if(hd(e)){let n=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(r){throw new Error(r.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return Ky(t,e)}function Ky(t,e){if(hd(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Zy(t,e,i){const n=YA(t,i),s=self.URL||self.webkitURL,r=typeof n!="string"&&s.createObjectURL(n);try{return await KA(r||n,e)}finally{r&&s.revokeObjectURL(r)}}async function KA(t,e){const i=new Image;return i.src=t,e.image&&e.image.decode&&i.decode?(await i.decode(),i):await new Promise((n,s)=>{try{i.onload=()=>n(i),i.onerror=r=>{const o=r instanceof Error?r.message:"error";s(new Error(o))}}catch(r){s(r)}})}const ZA={};let pg=!0;async function GA(t,e,i){let n;hd(i)?n=await Zy(t,e,i):n=Ky(t,i);const s=e&&e.imagebitmap;return await JA(n,s)}async function JA(t,e=null){if((QA(e)||!pg)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(i){console.warn(i),pg=!1}return await createImageBitmap(t)}function QA(t){for(const e in t||ZA)return!1;return!0}function e2(t){return!s2(t,"ftyp",4)||!(t[8]&96)?null:t2(t)}function t2(t){switch(i2(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function i2(t,e,i){return String.fromCharCode(...t.slice(e,i))}function n2(t){return[...t].map(e=>e.charCodeAt(0))}function s2(t,e,i=0){const n=n2(e);for(let s=0;s<n.length;++s)if(n[s]!==t[s+i])return!1;return!0}const Fi=!1,wo=!0;function Gy(t){const e=sa(t);return o2(e)||l2(e)||a2(e)||c2(e)||r2(e)}function r2(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),i=e2(e);return i?{mimeType:i.mimeType,width:0,height:0}:null}function o2(t){const e=sa(t);return e.byteLength>=24&&e.getUint32(0,Fi)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Fi),height:e.getUint32(20,Fi)}:null}function a2(t){const e=sa(t);return e.byteLength>=10&&e.getUint32(0,Fi)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,wo),height:e.getUint16(8,wo)}:null}function c2(t){const e=sa(t);return e.byteLength>=14&&e.getUint16(0,Fi)===16973&&e.getUint32(2,wo)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,wo),height:e.getUint32(22,wo)}:null}function l2(t){const e=sa(t);if(!(e.byteLength>=3&&e.getUint16(0,Fi)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:s}=u2();let r=2;for(;r+9<e.byteLength;){const o=e.getUint16(r,Fi);if(s.has(o))return{mimeType:"image/jpeg",height:e.getUint16(r+5,Fi),width:e.getUint16(r+7,Fi)};if(!n.has(o))return null;r+=2,r+=e.getUint16(r,Fi)}return null}function u2(){const t=new Set([65499,65476,65484,65501,65534]);for(let i=65504;i<65520;++i)t.add(i);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function sa(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function h2(t,e){var s;const{mimeType:i}=Gy(t)||{},n=(s=globalThis.loaders)==null?void 0:s.parseImageNode;return Yy(n),await n(t,i)}async function f2(t,e,i){e=e||{};const s=(e.image||{}).type||"auto",{url:r}=i||{},o=d2(s);let a;switch(o){case"imagebitmap":a=await GA(t,e,r);break;case"image":a=await Zy(t,e,r);break;case"data":a=await h2(t);break;default:Yy(!1)}return s==="data"&&(a=HA(a)),a}function d2(t){switch(t){case"auto":case"data":return jA();default:return VA(t),t}}const p2=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],g2=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],_2={image:{type:"auto",decode:!0}},m2={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:LA,mimeTypes:g2,extensions:p2,parse:f2,tests:[t=>!!Gy(new DataView(t))],options:_2},ve=new ta({id:"deck"});let jh={};function y2(t){jh=t}function Ot(t,e,i,n){ve.level>0&&jh[t]&&jh[t].call(null,e,i,n)}function v2(t){const e=t[0],i=t[t.length-1];return e==="{"&&i==="}"||e==="["&&i==="]"}const b2={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:v2,parseTextSync:JSON.parse};function w2(){const t="9.0.9",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(ve.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:ve,_registerLoggers:y2},jy([b2,[m2,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const T2=w2();function es(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const vu={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function E2(t){const e={};for(const[i,n]of Object.entries(t))e[i]=A2(n);return e}function S2(t,e,i){const n={};for(const[s,r]of Object.entries(e))t&&s in t&&!r.private?(r.validate&&es(r.validate(t[s],r),`${i}: invalid ${s}`),n[s]=t[s]):n[s]=r.value;return n}function A2(t){let e=gg(t);if(e!=="object")return{value:t,...vu[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...vu[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=gg(t.value),{...t,...vu[e],type:e}):{type:"object",value:null};throw new Error("props")}function gg(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const R2=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,C2=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,x2={vertex:R2,fragment:C2},_g=/void\s+main\s*\([^)]*\)\s*\{\n?/,mg=/}\n?[^{}]*$/,bu=[],oc="__LUMA_INJECT_DECLARATIONS__";function P2(t){const e={vertex:{},fragment:{}};for(const i in t){let n=t[i];const s=M2(i);typeof n=="string"&&(n={order:0,injection:n}),e[s][i]=n}return e}function M2(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Oc(t,e,i,n=!1){const s=e==="vertex";for(const r in i){const o=i[r];o.sort((c,l)=>c.order-l.order),bu.length=o.length;for(let c=0,l=o.length;c<l;++c)bu[c]=o[c].injection;const a=`${bu.join(`
`)}
`;switch(r){case"vs:#decl":s&&(t=t.replace(oc,a));break;case"vs:#main-start":s&&(t=t.replace(_g,c=>c+a));break;case"vs:#main-end":s&&(t=t.replace(mg,c=>a+c));break;case"fs:#decl":s||(t=t.replace(oc,a));break;case"fs:#main-start":s||(t=t.replace(_g,c=>c+a));break;case"fs:#main-end":s||(t=t.replace(mg,c=>a+c));break;default:t=t.replace(r,c=>c+a)}}return t=t.replace(oc,""),n&&(t=t.replace(/\}\s*$/,r=>r+x2[e])),t}let I2=1;class ts{constructor(e){v(this,"name");v(this,"vs");v(this,"fs");v(this,"getModuleUniforms");v(this,"dependencies");v(this,"deprecations");v(this,"defines");v(this,"injections");v(this,"uniforms",{});v(this,"uniformTypes",{});const{name:i,vs:n,fs:s,dependencies:r=[],uniformPropTypes:o={},getUniforms:a,deprecations:c=[],defines:l={},inject:u={}}=e;es(typeof i=="string"),this.name=i,this.vs=n,this.fs=s,this.getModuleUniforms=a,this.dependencies=ts.instantiateModules(r),this.deprecations=this._parseDeprecationDefinitions(c),this.defines=l,this.injections=P2(u),o&&(this.uniforms=E2(o))}static instantiateModules(e){return e.map(i=>{if(i instanceof ts)return i;es(typeof i!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(i)}' and use it directly.`),i.name||(console.warn("shader module has no name"),i.name=`shader-module-${I2++}`);const n=new ts(i);return n.dependencies=ts.instantiateModules(i.dependencies||[]),n})}getModuleSource(e){let i;switch(e){case"vertex":i=this.vs||"";break;case"fragment":i=this.fs||"";break;default:es(!1)}const n=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${n}
${i}

`}getUniforms(e,i){return this.getModuleUniforms?this.getModuleUniforms(e,i):S2(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,i){this.deprecations.forEach(n=>{var s;(s=n.regex)!=null&&s.test(e)&&(n.deprecated?i.deprecated(n.old,n.new)():i.removed(n.old,n.new)())})}_parseDeprecationDefinitions(e){return e.forEach(i=>{switch(i.type){case"function":i.regex=new RegExp(`\\b${i.old}\\(`);break;default:i.regex=new RegExp(`${i.type} ${i.old};`)}}),e}_defaultGetUniforms(e={}){const i={},n=this.uniforms;for(const s in n){const r=n[s];s in e&&!r.private?(r.validate&&es(r.validate(e[s],r),`${this.name}: invalid ${s}`),i[s]=e[s]):i[s]=r.value}return i}}function yg(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=vg(t.platformInfo,t.vs);let i;return t.fs&&(i=vg(t.platformInfo,t.fs)),{...t,vs:e,fs:i}}function vg(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function Ul(t){const e=ts.instantiateModules(t);return O2(e)}function O2(t){const e={},i={};return Jy({modules:t,level:0,moduleMap:e,moduleDepth:i}),Object.keys(i).sort((n,s)=>i[s]-i[n]).map(n=>e[n])}function Jy(t){const{modules:e,level:i,moduleMap:n,moduleDepth:s}=t;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const r of e)n[r.name]=r,(s[r.name]===void 0||s[r.name]<i)&&(s[r.name]=i);for(const r of e)r.dependencies&&Jy({modules:r.dependencies,level:i+1,moduleMap:n,moduleDepth:s})}function k2(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function N2(t,e){var n;if(Number(((n=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:n[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=bg(t,D2),t;case"fragment":return t=bg(t,F2),t;default:throw new Error(e)}}const Qy=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],D2=[...Qy,[$h("attribute"),"in $1"],[$h("varying"),"out $1"]],F2=[...Qy,[$h("varying"),"in $1"]];function bg(t,e){for(const[i,n]of e)t=t.replace(i,n);return t}function $h(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function e1(t,e){let i="";for(const n in t){const s=t[n];if(i+=`void ${s.signature} {
`,s.header&&(i+=`  ${s.header}`),e[n]){const r=e[n];r.sort((o,a)=>o.order-a.order);for(const o of r)i+=`  ${o.injection}
`}s.footer&&(i+=`  ${s.footer}`),i+=`}
`}return i}function t1(t){const e={vertex:{},fragment:{}};for(const i of t){let n,s;typeof i!="string"?(n=i,s=n.hook):(n={},s=i),s=s.trim();const[r,o]=s.split(":"),a=s.replace(/\(.+/,""),c=Object.assign(n,{signature:o});switch(r){case"vs":e.vertex[a]=c;break;case"fs":e.fragment[a]=c;break;default:throw new Error(r)}}return e}function L2(t,e){return{name:B2(t,e),language:"glsl",version:U2(t)}}function B2(t,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return n?n[1]:e}function U2(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const n=parseInt(i[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const i1=`

${oc}
`,z2=`precision highp float;
`;function V2(t){const e=Ul(t.modules||[]);return{source:Hh(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:fd(e)}}function j2(t){const e=Ul(t.modules||[]);return{vs:Hh(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:Hh(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:fd(e)}}function $2(t){const{vs:e,fs:i}=t,n=Ul(t.modules||[]);return{vs:wg(t.platformInfo,{...t,source:e,stage:"vertex",modules:n}),fs:wg(t.platformInfo,{...t,source:i,stage:"fragment",modules:n}),getUniforms:fd(n)}}function Hh(t,e){const{source:i,stage:n,modules:s,hookFunctions:r=[],inject:o={},log:a}=e;es(typeof i=="string","shader source must be a string");const c=i;let l="";const u=t1(r),h={},f={},d={};for(const g in o){const _=typeof o[g]=="string"?{injection:o[g],order:0}:o[g],m=/^(v|f)s:(#)?([\w-]+)$/.exec(g);if(m){const b=m[2],w=m[3];b?w==="decl"?f[g]=[_]:d[g]=[_]:h[g]=[_]}else d[g]=[_]}const p=t.type!=="webgpu"?s:[];for(const g of p){a&&g.checkDeprecations(c,a);const _=g.getModuleSource(n,"wgsl");l+=_;const m=g.injections[n];for(const b in m){const w=/^(v|f)s:#([\w-]+)$/.exec(b);if(w){const R=w[2]==="decl"?f:d;R[b]=R[b]||[],R[b].push(m[b])}else h[b]=h[b]||[],h[b].push(m[b])}}return l+=i1,l=Oc(l,n,f),l+=e1(u[n],h),l+=c,l=Oc(l,n,d),l}function wg(t,e){const{id:i,source:n,stage:s,language:r="glsl",modules:o,defines:a={},hookFunctions:c=[],inject:l={},prologue:u=!0,log:h}=e;es(typeof n=="string","shader source must be a string");const f=r==="glsl"?L2(n).version:-1,d=t.shaderLanguageVersion,p=f===100?"#version 100":"#version 300 es",_=n.split(`
`).slice(1).join(`
`),m={};o.forEach(k=>{Object.assign(m,k.getDefines())}),Object.assign(m,a);let b="";switch(r){case"wgsl":break;case"glsl":b=u?`${p}

// ----- PROLOGUE -------------------------
${H2({id:i,source:n,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}
${k2(t)}
${s==="fragment"?z2:""}

// ----- APPLICATION DEFINES -------------------------

${W2(m)}

`:`${p}
`;break}const w=t1(c),S={},R={},M={};for(const k in l){const F=typeof l[k]=="string"?{injection:l[k],order:0}:l[k],I=/^(v|f)s:(#)?([\w-]+)$/.exec(k);if(I){const N=I[2],C=I[3];N?C==="decl"?R[k]=[F]:M[k]=[F]:S[k]=[F]}else M[k]=[F]}for(const k of o){h&&k.checkDeprecations(_,h);const F=k.getModuleSource(s);b+=F;const I=k.injections[s];for(const N in I){const C=/^(v|f)s:#([\w-]+)$/.exec(N);if(C){const X=C[2]==="decl"?R:M;X[N]=X[N]||[],X[N].push(I[N])}else S[N]=S[N]||[],S[N].push(I[N])}}return b+="// ----- MAIN SHADER SOURCE -------------------------",b+=i1,b=Oc(b,s,R),b+=e1(w[s],S),b+=_,b=Oc(b,s,M),r==="glsl"&&f!==d&&(b=N2(b,s)),b.trim()}function fd(t){return function(i){const n={};for(const s of t){const r=s.getUniforms(i,n);Object.assign(n,r)}return n}}function H2(t){const{id:e,source:i,stage:n}=t;return e&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}

`:""}function W2(t={}){let e="";for(const i in t){const n=t[i];(n||Number.isFinite(n))&&(e+=`#define ${i.toUpperCase()} ${t[i]}
`)}return e}const Gn=class Gn{constructor(){v(this,"_hookFunctions",[]);v(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Gn.defaultShaderAssembler=Gn.defaultShaderAssembler||new Gn,Gn.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(i=>i.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const i=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==i)}addShaderHook(e,i){i&&(e=Object.assign(i,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const i=this._getModuleList(e.modules),n=this._hookFunctions,s=yg(e);return{...V2({platformInfo:e.platformInfo,...s,modules:i,hookFunctions:n}),modules:i}}assembleShaderPair(e){const i=yg(e),n=this._getModuleList(e.modules),s=this._hookFunctions,{platformInfo:r}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?j2({platformInfo:r,...i,modules:n,hookFunctions:s}):$2({platformInfo:r,...i,modules:n,hookFunctions:s}),modules:n}}_getModuleList(e=[]){const i=new Array(this._defaultModules.length+e.length),n={};let s=0;for(let r=0,o=this._defaultModules.length;r<o;++r){const a=this._defaultModules[r],c=a.name;i[s++]=a,n[c]=!0}for(let r=0,o=e.length;r<o;++r){const a=e[r],c=a.name;n[c]||(i[s++]=a,n[c]=!0)}return i.length=s,ts.instantiateModules(i)}};v(Gn,"defaultShaderAssembler");let kc=Gn;const X2=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,q2=`#version 300 es
${X2}`;function Y2(t){const{input:e,inputChannels:i,output:n}=t||{};if(!e)return q2;if(!i)throw new Error("inputChannels");const s=K2(i),r=Z2(e,i);return`#version 300 es
in ${s} ${e};
out vec4 ${n};
void main() {
  ${n} = ${r};
}`}function K2(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function Z2(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const Y=new ta({id:"luma.gl"});class G2{constructor(){v(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new ia({id:e})),this.stats.get(e)}}const dd=new G2;function J2(){const t="9.0.11",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(Dn()&&Y.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:Y,stats:dd}),t}const Q2=J2();function e3(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function $o(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:e3(t)}const wu={};function As(t="id"){wu[t]=wu[t]||1;const e=wu[t]++;return`${t}-${e}`}function Nc(t){let e=!0;for(const i in t){e=!1;break}return e}var hh;let De=(hh=class{constructor(e,i,n){v(this,"id");v(this,"props");v(this,"userData",{});v(this,"_device");v(this,"destroyed",!1);v(this,"allocatedBytes",0);v(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=t3(i,n);const s=this.props.id!=="undefined"?this.props.id:As(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get(`${i}s Active`).decrementCount()}trackAllocatedMemory(e,i=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${i} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").subtractCount(this.allocatedBytes),i.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${i}s Created`).incrementCount(),e.get(`${i}s Active`).incrementCount()}},v(hh,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),hh);function t3(t,e){const i={...e};for(const n in t)t[n]!==void 0&&(i[n]=t[n]);return i}const Et=class Et extends De{constructor(i,n){const s={...n};(n.usage||0)&Et.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?s.indexType="uint32":n.data instanceof Uint16Array&&(s.indexType="uint16"));super(i,s,Et.defaultProps);v(this,"usage");v(this,"indexType");v(this,"updateTimestamp");v(this,"debugData",new ArrayBuffer(0));this.usage=n.usage||0,this.indexType=s.indexType,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(i,n){throw new Error("not implemented")}_setDebugData(i,n,s){const r=ArrayBuffer.isView(i)?i.buffer:i,o=Math.min(i?i.byteLength:s,Et.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(o):n===0&&s===i.byteLength?this.debugData=r.slice(0,o):this.debugData=r.slice(n,n+o)}};v(Et,"defaultProps",{...De.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),v(Et,"MAP_READ",1),v(Et,"MAP_WRITE",2),v(Et,"COPY_SRC",4),v(Et,"COPY_DST",8),v(Et,"INDEX",16),v(Et,"VERTEX",32),v(Et,"UNIFORM",64),v(Et,"STORAGE",128),v(Et,"INDIRECT",256),v(Et,"QUERY_RESOLVE",512),v(Et,"DEBUG_DATA_MAX_LENGTH",32);let et=Et;function n1(t){const e=Tg[t],i=i3(e),n=t.includes("norm"),s=!n&&!t.startsWith("float"),r=t.startsWith("s");return{dataType:Tg[t],byteLength:i,integer:s,signed:r,normalized:n}}function i3(t){return n3[t]}const Tg={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},n3={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},s3=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],r3=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function o3(t){return s3.some(e=>t.startsWith(e))}function s1(t){const e=r3.exec(t);if(e){const[,i,n,s,r,o]=e;if(i){const a=`${s}${n}`,c=n1(a);return{format:i,components:i.length,srgb:r==="-srgb",unsized:o==="-unsized",webgl:o==="-webgl",...c}}}return c3(t)}const a3={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function c3(t){var i;const e=a3[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((i=e.format)==null?void 0:i.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class l3{}class u3{constructor(e=[],i){v(this,"features");v(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=i||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const Io=class Io{constructor(e){v(this,"id");v(this,"props");v(this,"userData",{});v(this,"statsManager",dd);v(this,"_lumaData",{});v(this,"timestamp",0);this.props={...Io.defaultProps,...e},this.id=this.props.id||As(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return o3(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,i){throw new Error("not implemented")}readPixelsToBufferWebGL(e,i){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,i){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const i={...e};return(e.usage||0)&et.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?i.indexType="uint32":e.data instanceof Uint16Array?i.indexType="uint16":Y.warn("indices buffer content must be of integer type")()),i}};v(Io,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Y.get("debug"),spector:!!Y.get("spector"),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>Y.error(e.message)}),v(Io,"VERSION",Q2);let os=Io;function Xe(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const Kr=new Map;class as{static registerDevices(e){for(const i of e)Xe(i.type&&i.isSupported&&i.create),Kr.set(i.type,i)}static getAvailableDevices(){return Array.from(Kr).map(e=>e.type)}static getSupportedDevices(){return Array.from(Kr).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(os.defaultProps,e)}static async attachDevice(e){const i=Eg(e.devices)||Kr;if(e.handle instanceof WebGL2RenderingContext){const n=i.get("webgl");if(n)return await n.attach(e.handle)}if(e.handle===null){const n=i.get("unknown");if(n)return await n.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var n,s;e={...os.defaultProps,...e},e.gl&&(e.type="webgl");const i=Eg(e.devices)||Kr;switch(e.type){case"webgpu":let r=i.get("webgpu");if(r)return await r.create(e);break;case"webgl":let o=i.get("webgl");if(o)return await o.create(e);break;case"unknown":const a=i.get("unknown");if(a)return await a.create(e);break;case"best-available":if(r=i.get("webgpu"),(n=r==null?void 0:r.isSupported)!=null&&n.call(r))return await r.create(e);if(o=i.get("webgl"),(s=o==null?void 0:o.isSupported)!=null&&s.call(o))return await o.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const i=HTMLCanvasElement.prototype;if(!e&&i.originalGetContext){i.getContext=i.originalGetContext,i.originalGetContext=void 0;return}i.originalGetContext=i.getContext,i.getContext=function(n,s){return n==="webgl"||n==="experimental-webgl"?this.originalGetContext("webgl2",s):this.originalGetContext(n,s)}}}v(as,"defaultProps",{...os.defaultProps,type:"best-available",devices:void 0}),v(as,"stats",dd),v(as,"log",Y);function Eg(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const i of t)e.set(i.type,i);return e}const h3=Dn()&&typeof document<"u",zl=()=>h3&&document.readyState==="complete",f3={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class pd{constructor(e){v(this,"id");v(this,"props");v(this,"canvas");v(this,"htmlCanvas");v(this,"offscreenCanvas");v(this,"type");v(this,"width",1);v(this,"height",1);v(this,"resizeObserver");v(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...f3,...e},e=this.props,!Dn()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=g3(e.canvas):this.canvas=e.canvas;else{const i=_3(e),n=p3((e==null?void 0:e.container)||null);n.insertBefore(i,n.firstChild),this.canvas=i,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(i=>{for(const n of i)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return zl()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),i=this.canvas;return i.parentElement?[i.clientWidth*e,i.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,i]=this.getPixelSize();return e/i}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:i}=this._canvasSizeInfo;return i?e/i:1}catch{return 1}}cssToDevicePixels(e,i=!0){const n=this.cssToDeviceRatio(),[s,r]=this.getDrawingBufferSize();return m3(e,n,s,r,i)}setDevicePixelRatio(e,i={}){if(!this.htmlCanvas)return;let n="width"in i?i.width:this.htmlCanvas.clientWidth,s="height"in i?i.height:this.htmlCanvas.clientHeight;(!n||!s)&&(Y.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const r=this._canvasSizeInfo;if(r.clientWidth!==n||r.clientHeight!==s||r.devicePixelRatio!==e){let o=e;const a=Math.floor(n*o),c=Math.floor(s*o);this.htmlCanvas.width=a,this.htmlCanvas.height=c;const[l,u]=this.getDrawingBufferSize();(l!==a||u!==c)&&(o=Math.min(l/n,u/s),this.htmlCanvas.width=Math.floor(n*o),this.htmlCanvas.height=Math.floor(s*o),Y.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var i;((i=this.htmlCanvas)==null?void 0:i.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}v(pd,"pageLoaded",d3());function d3(){return zl()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function p3(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!zl())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function g3(t){const e=document.getElementById(t);if(!e&&!zl())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function _3(t){const{width:e,height:i}=t,n=document.createElement("canvas");return n.id="lumagl-auto-created-canvas",n.width=e||1,n.height=i||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(i)?`${i}px`:"100%",n}function m3(t,e,i,n,s){const r=t,o=Sg(r[0],e,i);let a=Ag(r[1],e,n,s),c=Sg(r[0]+1,e,i);const l=c===i-1?c:c-1;c=Ag(r[1]+1,e,n,s);let u;return s?(c=c===0?c:c+1,u=a,a=c):u=c===n-1?c:c-1,{x:o,y:a,width:Math.max(l-o+1,1),height:Math.max(u-a+1,1)}}function Sg(t,e,i){return Math.min(Math.round(t*e),i-1)}function Ag(t,e,i,n){return n?Math.max(0,i-1-Math.round(t*e)):Math.min(Math.round(t*e),i-1)}const Xi=class Xi extends De{constructor(i,n,s=Xi.defaultProps){super(i,n,s);v(this,"dimension");v(this,"format");v(this,"width");v(this,"height");v(this,"depth");v(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};v(Xi,"defaultProps",{...De.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),v(Xi,"COPY_SRC",1),v(Xi,"COPY_DST",2),v(Xi,"TEXTURE_BINDING",4),v(Xi,"STORAGE_BINDING",8),v(Xi,"RENDER_ATTACHMENT",16);let ci=Xi;const sl=class sl extends De{get[Symbol.toStringTag](){return"TextureView"}constructor(e,i){super(e,i,sl.defaultProps)}};v(sl,"defaultProps",{...De.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Dc=sl;function y3(t,e,i){let n="";const s=e.split(/\r?\n/),r=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((i==null?void 0:i.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=s.length;a++)for(n+=r1(s[a-1],a,i);r.length>o&&r[o].lineNum===a;){const c=r[o++];n+=Rg(c,s,c.lineNum,{...i,inlineSource:!1})}return n;case"issues":case"no":for(const a of t)n+=Rg(a,s,a.lineNum,{inlineSource:(i==null?void 0:i.showSourceCode)!=="no"});return n}}function Rg(t,e,i,n){if(n!=null&&n.inlineSource){const s=v3(e,i),r=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${r}${t.type.toUpperCase()}: ${t.message}

`}return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function v3(t,e,i){let n="";for(let s=e-2;s<=e;s++){const r=t[s-1];r!==void 0&&(n+=r1(r,e,i))}return n}function r1(t,e,i){const n=i!=null&&i.html?w3(t):t;return`${b3(String(e),4)}: ${n}${i!=null&&i.html?"<br/>":`
`}`}function b3(t,e){let i="";for(let n=t.length;n<e;++n)i+=" ";return i+t}function w3(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function o1(t,e){return{name:T3(t,e),language:"glsl",version:E3(t)}}function T3(t,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return n?n[1]:e}function E3(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const n=parseInt(i[1],10);Number.isFinite(n)&&(e=n)}return e}const rl=class rl extends De{constructor(i,n){super(i,{id:S3(n),...n},rl.defaultProps);v(this,"stage");v(this,"source");v(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(i=this.props.debug){switch(i){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();this.props.debug==="warnings"&&(n==null?void 0:n.length)===0||this._displayShaderLog(n)}_displayShaderLog(i){var l;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=o1(this.source).name,s=`${this.stage} ${n}`;let r=y3(i,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(r+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${r}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const c=document.getElementsByClassName("luma-compiler-log-error");(l=c[0])!=null&&l.scrollIntoView&&c[0].scrollIntoView(),a.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}};v(rl,"defaultProps",{...De.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let Fc=rl;function S3(t){return o1(t.source).name||t.id||As(`unnamed ${t.stage}-shader`)}const ol=class ol extends De{get[Symbol.toStringTag](){return"Sampler"}constructor(e,i){super(e,i,ol.defaultProps)}};v(ol,"defaultProps",{...De.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Lc=ol;const al=class al extends De{constructor(i,n={}){super(i,n,al.defaultProps);v(this,"width");v(this,"height");v(this,"colorAttachments",[]);v(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(i){let n=!i;if(i){const[s,r]=Array.isArray(i)?i:[i.width,i.height];n=n||r!==this.height||s!==this.width,this.width=s,this.height=r}n&&(Y.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(n=>{if(typeof n=="string"){const s=this.createColorTexture(n);return this.attachResource(s),s.view}return n instanceof ci?n.view:n});const i=this.props.depthStencilAttachment;if(i)if(typeof i=="string"){const n=this.createDepthStencilTexture(i);this.attachResource(n),this.depthStencilAttachment=n.view}else i instanceof ci?this.depthStencilAttachment=i.view:this.depthStencilAttachment=i}createColorTexture(i){return this.device.createTexture({id:"color-attachment",usage:ci.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}createDepthStencilTexture(i){return this.device.createTexture({id:"depth-stencil-attachment",usage:ci.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}resizeAttachments(i,n){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const r=this.device._createTexture({...this.colorAttachments[s].props,width:i,height:n});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=r.view,this.attachResource(r.view)}if(this.depthStencilAttachment){const s=this.device._createTexture({...this.depthStencilAttachment.props,width:i,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}}};v(al,"defaultProps",{...De.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Bc=al;const cl=class cl extends De{constructor(i,n){super(i,n,cl.defaultProps);v(this,"shaderLayout");v(this,"bufferLayout");v(this,"linkStatus","pending");v(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(i){throw new Error("Use uniform blocks")}};v(cl,"defaultProps",{...De.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Er=cl;const ll=class ll extends De{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,i){super(e,i,ll.defaultProps)}};v(ll,"defaultProps",{...De.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Wh=ll;const ul=class ul extends De{constructor(i,n){super(i,n,ul.defaultProps);v(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};v(ul,"defaultProps",{...De.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Uc=ul;const hl=class hl extends De{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,i){super(e,i,hl.defaultProps)}};v(hl,"defaultProps",{...De.defaultProps,measureExecutionTime:void 0});let Xh=hl;const fl=class fl extends De{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,i){super(e,i,fl.defaultProps)}};v(fl,"defaultProps",{...De.defaultProps});let qh=fl;function A3(t){const[e,i]=C3[t],n=e==="i32"||e==="u32",s=e!=="u32",r=x3[e]*i,o=R3(e,i);return{dataType:e,components:i,defaultVertexFormat:o,byteLength:r,integer:n,signed:s}}function R3(t,e){let i;switch(t){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?i:`${i}x${e}`}const C3={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},x3={f32:4,f16:2,i32:4,u32:4};function a1(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[i,n]=t.split("x"),s=i,r=n?parseInt(n):1,o=n1(s),a={type:s,components:r,byteLength:o.byteLength*r,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function c1(t,e){const i={};for(const n of t.attributes)i[n.name]=M3(t,e,n.name);return i}function P3(t,e,i=16){const n=c1(t,e),s=new Array(i).fill(null);for(const r of Object.values(n))s[r.location]=r;return s}function M3(t,e,i){const n=I3(t,i),s=O3(e,i);if(!n)return null;const r=A3(n.type),o=(s==null?void 0:s.vertexFormat)||r.defaultVertexFormat,a=a1(o);return{attributeName:(s==null?void 0:s.attributeName)||n.name,bufferName:(s==null?void 0:s.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:r.dataType,shaderComponents:r.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:r.integer,stepMode:(s==null?void 0:s.stepMode)||n.stepMode,byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function I3(t,e){const i=t.attributes.find(n=>n.name===e);return i||Y.warn(`shader layout attribute "${e}" not present in shader`),i||null}function O3(t,e){k3(t);let i=N3(t,e);return i||(i=D3(t,e),i)?i:(Y.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function k3(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Y.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function N3(t,e){for(const i of t)if(i.format&&i.name===e)return{attributeName:i.name,bufferName:e,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}function D3(t,e){var i;for(const n of t){let s=n.byteStride;if(typeof n.byteStride!="number")for(const o of n.attributes||[]){const a=a1(o.format);s+=a.byteLength}const r=(i=n.attributes)==null?void 0:i.find(o=>o.attribute===e);if(r)return{attributeName:r.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:s}}return null}function F3(t,e){const i={...t,attributes:t.attributes.map(n=>({...n}))};for(const n of(e==null?void 0:e.attributes)||[]){const s=i.attributes.find(r=>r.name===n.name);s?(s.type=n.type||s.type,s.stepMode=n.stepMode||s.stepMode):Y.warn(`shader layout attribute ${n.name} not present in shader`)}return i}const dl=class dl extends De{constructor(i,n){super(i,n,dl.defaultProps);v(this,"maxVertexAttributes");v(this,"attributeInfos");v(this,"indexBuffer",null);v(this,"attributes");this.maxVertexAttributes=i.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=P3(n.renderPipeline.shaderLayout,n.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(i,n){throw new Error("constant attributes not supported")}};v(dl,"defaultProps",{...De.defaultProps,renderPipeline:null});let Yh=dl;const pl=class pl extends De{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,i){super(e,i,pl.defaultProps)}};v(pl,"defaultProps",{...De.defaultProps,layout:void 0,buffers:{}});let Kh=pl;const gl=class gl extends De{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,i){super(e,i,gl.defaultProps)}};v(gl,"defaultProps",{...De.defaultProps,type:void 0,count:void 0});let Zh=gl;const L3={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function B3(t){const e=L3[t];return Xe(t),e}function U3(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let Ca;function l1(t){return(!Ca||Ca.byteLength<t)&&(Ca=new ArrayBuffer(t)),Ca}function z3(t,e){const i=l1(t.BYTES_PER_ELEMENT*e);return new t(i,0,e)}function V3(t){const{target:e,source:i,start:n=0,count:s=1}=t,r=i.length,o=s*r;let a=0;for(let c=n;a<r;a++)e[c++]=i[a];for(;a<o;)a<o-a?(e.copyWithin(n+a,n,n+a),a*=2):(e.copyWithin(n+a,n,n+o-a),a=o);return t.target}const Cg=1024;class j3{constructor(e){v(this,"layout",{});v(this,"byteLength");let i=0;for(const[s,r]of Object.entries(e)){const o=B3(r),{type:a,components:c}=o;i=U3(i,c);const l=i;i+=c,this.layout[s]={type:a,size:c,offset:l}}i+=(4-i%4)%4;const n=i*4;this.byteLength=Math.max(n,Cg)}getData(e){const i=Math.max(this.byteLength,Cg),n=l1(i),s={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[r,o]of Object.entries(e)){const a=this.layout[r];if(!a){Y.warn(`Supplied uniform value ${r} not present in uniform block layout`)();continue}const{type:c,size:l,offset:u}=a,h=s[c];if(l===1){if(typeof o!="number"&&typeof o!="boolean"){Y.warn(`Supplied value for single component uniform ${r} is not a number: ${o}`)();continue}h[u]=Number(o)}else{const f=$o(o);if(!f){Y.warn(`Supplied value for multi component / array uniform ${r} is not a numeric array: ${o}`)();continue}h.set(f,u)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function $3(t,e,i=16){if(t!==e)return!1;const n=$o(t);if(!n)return!1;const s=$o(e);if(s&&n.length===s.length){for(let r=0;r<n.length;++r)if(s[r]!==n[r])return!1}return!0}function H3(t){const e=$o(t);return e?e.slice():t}class W3{constructor(e){v(this,"name");v(this,"uniforms",{});v(this,"modifiedUniforms",{});v(this,"modified",!0);v(this,"bindingLayout",{});v(this,"needsRedraw","initialized");var i;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const n=(i=e==null?void 0:e.shaderLayout.bindings)==null?void 0:i.find(r=>r.type==="uniform"&&r.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const s=n;for(const r of s.uniforms||[])this.bindingLayout[r.name]=r}}setUniforms(e){for(const[i,n]of Object.entries(e))this._setUniform(i,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${i}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,i){$3(this.uniforms[e],i)||(this.uniforms[e]=H3(i),this.modifiedUniforms[e]=!0,this.modified=!0)}}class X3{constructor(e){v(this,"uniformBlocks",new Map);v(this,"uniformBufferLayouts",new Map);v(this,"uniformBuffers",new Map);for(const[i,n]of Object.entries(e)){const s=i,r=new j3(n.uniformTypes||{});this.uniformBufferLayouts.set(s,r);const o=new W3({name:i});o.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(s,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[i,n]of Object.entries(e))this.uniformBlocks.get(i).setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const i=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(i)}createUniformBuffer(e,i,n){n&&this.setUniforms(n);const s=this.getUniformBufferByteLength(i),r=e.createBuffer({usage:et.UNIFORM|et.COPY_DST,byteLength:s}),o=this.getUniformBufferData(i);return r.write(o),r}getManagedUniformBuffer(e,i){if(!this.uniformBuffers.get(i)){const n=this.getUniformBufferByteLength(i),s=e.createBuffer({usage:et.UNIFORM|et.COPY_DST,byteLength:n});this.uniformBuffers.set(i,s)}return this.uniformBuffers.get(i)}updateUniformBuffers(){let e=!1;for(const i of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(i);e||(e=n)}return e&&Y.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const i=this.uniformBlocks.get(e),n=this.uniformBuffers.get(e);let s=!1;if(n&&i.needsRedraw){s||(s=i.needsRedraw);const r=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(r);const a=this.uniformBlocks.get(e).getAllUniforms();Y.log(4,`Writing to uniform buffer ${String(e)}`,r,a)()}return s}}function u1(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function h1(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function q3(t,e,i){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let s=u1(t);if(s==="uint8"||s==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return i&&(s=s.replace("int","norm")),`${s}x${n}`}if(s==="uint16"||s==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return i&&(s=s.replace("int","norm")),`${s}x${n}`}return n===1?s:`${s}x${n}`}function Y3(t){return $o(t)!==null||typeof t=="number"||typeof t=="boolean"}function f1(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(i=>{const n=t[i];Y3(n)?e.uniforms[i]=n:e.bindings[i]=n}),e}function K3(t,e,i){const{removedProps:n={},deprecatedProps:s={},replacedProps:r={}}=i;for(const a in n)if(a in e){const l=n[a]?`${t}.${n[a]}`:"N/A";Y.removed(`${t}.${a}`,l)()}for(const a in s)if(a in e){const c=s[a];Y.deprecated(`${t}.${a}`,`${t}.${c}`)()}let o=null;for(const[a,c]of Object.entries(r))a in e&&(Y.deprecated(`${t}.${a}`,`${t}.${c}`)(),o=o||Object.assign({},e),o[c]=e[a],delete o[a]);return o||e}let Z3="";async function G3(t,e){return await new Promise((i,n)=>{try{const s=new Image;s.onload=()=>i(s),s.onerror=()=>n(new Error(`Could not load image ${t}.`)),s.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",s.src=t.startsWith("http")?t:Z3+t}catch(s){n(s)}})}async function d1(t,e){const i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",t),e&&(n.id=e),new Promise((s,r)=>{n.onload=s,n.onerror=o=>r(new Error(`Unable to load script '${t}': ${o}`)),i.appendChild(n)})}function Gh(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Gh(t[n],e[n],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!Gh(t[r],e[r],i-1))return!1;return!0}return!1}function J3(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function Q3(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class eR{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Rs{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}}class at extends Rs{constructor(){super()}}let p1=class extends at{constructor(e,i,n,s){super(),this.name=e,this.args=i,this.returnType=n,this.body=s}get astNodeType(){return"function"}};class tR extends at{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}}class iR extends at{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"while"}}class nR extends at{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}}class sR extends at{constructor(e,i,n,s){super(),this.init=e,this.condition=i,this.increment=n,this.body=s}get astNodeType(){return"for"}}class Qs extends at{constructor(e,i,n,s,r){super(),this.name=e,this.type=i,this.storage=n,this.access=s,this.value=r}get astNodeType(){return"var"}}class g1 extends at{constructor(e,i,n){super(),this.name=e,this.type=i,this.value=n}get astNodeType(){return"override"}}class xg extends at{constructor(e,i,n,s,r){super(),this.name=e,this.type=i,this.storage=n,this.access=s,this.value=r}get astNodeType(){return"let"}}class Pg extends at{constructor(e,i,n,s,r){super(),this.name=e,this.type=i,this.storage=n,this.access=s,this.value=r}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}}var Sr;(function(t){t.increment="++",t.decrement="--"})(Sr||(Sr={}));(function(t){function e(i){const n=i;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}t.parse=e})(Sr||(Sr={}));class rR extends at{constructor(e,i){super(),this.operator=e,this.variable=i}get astNodeType(){return"increment"}}var Ho;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Ho||(Ho={}));(function(t){function e(i){const n=i;if(n=="parse")throw new Error("Invalid value for AssignOperator");return t[n]}t.parse=e})(Ho||(Ho={}));class oR extends at{constructor(e,i,n){super(),this.operator=e,this.variable=i,this.value=n}get astNodeType(){return"assign"}}class aR extends at{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"call"}}class cR extends at{constructor(e,i){super(),this.body=e,this.continuing=i}get astNodeType(){return"loop"}}class lR extends at{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"body"}}class uR extends at{constructor(e,i,n,s){super(),this.condition=e,this.body=i,this.elseif=n,this.else=s}get astNodeType(){return"if"}}class hR extends at{constructor(e){super(),this.value=e}get astNodeType(){return"return"}}class fR extends at{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class _1 extends at{constructor(e,i){super(),this.name=e,this.type=i}get astNodeType(){return"alias"}}class dR extends at{constructor(){super()}get astNodeType(){return"discard"}}class pR extends at{constructor(){super()}get astNodeType(){return"break"}}class gR extends at{constructor(){super()}get astNodeType(){return"continue"}}class Cs extends at{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Xn extends Cs{constructor(e,i){super(e),this.members=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let i=0;i<this.members.length;i++)if(this.members[i].name==e)return i;return-1}}class m1 extends Cs{constructor(e,i,n){super(e),this.format=i,this.access=n}get astNodeType(){return"template"}}class _R extends Cs{constructor(e,i,n,s){super(e),this.storage=i,this.type=n,this.access=s}get astNodeType(){return"pointer"}}class y1 extends Cs{constructor(e,i,n,s){super(e),this.attributes=i,this.format=n,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class uo extends Cs{constructor(e,i,n){super(e),this.format=i,this.access=n}get astNodeType(){return"sampler"}}class Vi extends Rs{constructor(){super()}}class Mg extends Vi{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class ho extends Vi{constructor(e,i){super(),this.type=e,this.args=i}get astNodeType(){return"createExpr"}}class mR extends Vi{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}}class yR extends Vi{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}}class Ig extends Vi{constructor(e,i){super(),this.name=e,this.initializer=i}get astNodeType(){return"constExpr"}evaluate(e){var i,n;if(this.initializer instanceof ho){const s=(i=this.postfix)===null||i===void 0?void 0:i.evaluateString(e),r=(n=this.initializer.type)===null||n===void 0?void 0:n.name,o=e.structs.get(r),a=o==null?void 0:o.getMemberIndex(s);if(a!=-1)return this.initializer.args[a].evaluate(e);console.log(a)}return this.initializer.evaluate(e)}}class Og extends Vi{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class vR extends Vi{constructor(e,i){super(),this.type=e,this.value=i}get astNodeType(){return"bitcastExpr"}}class bR extends Vi{constructor(e,i){super(),this.type=e,this.args=i}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}}class kg extends Vi{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}}class v1 extends Vi{constructor(){super()}}class wR extends v1{constructor(e,i){super(),this.operator=e,this.right=i}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}}class xi extends v1{constructor(e,i,n){super(),this.operator=e,this.left=i,this.right=n}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}}class b1 extends Rs{constructor(){super()}}class TR extends b1{constructor(e,i){super(),this.selector=e,this.body=i}get astNodeType(){return"case"}}class ER extends b1{constructor(e){super(),this.body=e}get astNodeType(){return"default"}}class SR extends Rs{constructor(e,i,n){super(),this.name=e,this.type=i,this.attributes=n}get astNodeType(){return"argument"}}class AR extends Rs{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"elseif"}}class RR extends Rs{constructor(e,i,n){super(),this.name=e,this.type=i,this.attributes=n}get astNodeType(){return"member"}}let Ng=class extends Rs{constructor(e,i){super(),this.name=e,this.value=i}get astNodeType(){return"attribute"}};var j,x;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(x||(x={}));class P{constructor(e,i,n){this.name=e,this.type=i,this.rule=n}toString(){return this.name}}class E{}j=E;E.none=new P("",x.reserved,"");E.eof=new P("EOF",x.token,"");E.reserved={asm:new P("asm",x.reserved,"asm"),bf16:new P("bf16",x.reserved,"bf16"),do:new P("do",x.reserved,"do"),enum:new P("enum",x.reserved,"enum"),f16:new P("f16",x.reserved,"f16"),f64:new P("f64",x.reserved,"f64"),handle:new P("handle",x.reserved,"handle"),i8:new P("i8",x.reserved,"i8"),i16:new P("i16",x.reserved,"i16"),i64:new P("i64",x.reserved,"i64"),mat:new P("mat",x.reserved,"mat"),premerge:new P("premerge",x.reserved,"premerge"),regardless:new P("regardless",x.reserved,"regardless"),typedef:new P("typedef",x.reserved,"typedef"),u8:new P("u8",x.reserved,"u8"),u16:new P("u16",x.reserved,"u16"),u64:new P("u64",x.reserved,"u64"),unless:new P("unless",x.reserved,"unless"),using:new P("using",x.reserved,"using"),vec:new P("vec",x.reserved,"vec"),void:new P("void",x.reserved,"void")};E.keywords={array:new P("array",x.keyword,"array"),atomic:new P("atomic",x.keyword,"atomic"),bool:new P("bool",x.keyword,"bool"),f32:new P("f32",x.keyword,"f32"),i32:new P("i32",x.keyword,"i32"),mat2x2:new P("mat2x2",x.keyword,"mat2x2"),mat2x3:new P("mat2x3",x.keyword,"mat2x3"),mat2x4:new P("mat2x4",x.keyword,"mat2x4"),mat3x2:new P("mat3x2",x.keyword,"mat3x2"),mat3x3:new P("mat3x3",x.keyword,"mat3x3"),mat3x4:new P("mat3x4",x.keyword,"mat3x4"),mat4x2:new P("mat4x2",x.keyword,"mat4x2"),mat4x3:new P("mat4x3",x.keyword,"mat4x3"),mat4x4:new P("mat4x4",x.keyword,"mat4x4"),ptr:new P("ptr",x.keyword,"ptr"),sampler:new P("sampler",x.keyword,"sampler"),sampler_comparison:new P("sampler_comparison",x.keyword,"sampler_comparison"),struct:new P("struct",x.keyword,"struct"),texture_1d:new P("texture_1d",x.keyword,"texture_1d"),texture_2d:new P("texture_2d",x.keyword,"texture_2d"),texture_2d_array:new P("texture_2d_array",x.keyword,"texture_2d_array"),texture_3d:new P("texture_3d",x.keyword,"texture_3d"),texture_cube:new P("texture_cube",x.keyword,"texture_cube"),texture_cube_array:new P("texture_cube_array",x.keyword,"texture_cube_array"),texture_multisampled_2d:new P("texture_multisampled_2d",x.keyword,"texture_multisampled_2d"),texture_storage_1d:new P("texture_storage_1d",x.keyword,"texture_storage_1d"),texture_storage_2d:new P("texture_storage_2d",x.keyword,"texture_storage_2d"),texture_storage_2d_array:new P("texture_storage_2d_array",x.keyword,"texture_storage_2d_array"),texture_storage_3d:new P("texture_storage_3d",x.keyword,"texture_storage_3d"),texture_depth_2d:new P("texture_depth_2d",x.keyword,"texture_depth_2d"),texture_depth_2d_array:new P("texture_depth_2d_array",x.keyword,"texture_depth_2d_array"),texture_depth_cube:new P("texture_depth_cube",x.keyword,"texture_depth_cube"),texture_depth_cube_array:new P("texture_depth_cube_array",x.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new P("texture_depth_multisampled_2d",x.keyword,"texture_depth_multisampled_2d"),texture_external:new P("texture_external",x.keyword,"texture_external"),u32:new P("u32",x.keyword,"u32"),vec2:new P("vec2",x.keyword,"vec2"),vec3:new P("vec3",x.keyword,"vec3"),vec4:new P("vec4",x.keyword,"vec4"),bitcast:new P("bitcast",x.keyword,"bitcast"),block:new P("block",x.keyword,"block"),break:new P("break",x.keyword,"break"),case:new P("case",x.keyword,"case"),continue:new P("continue",x.keyword,"continue"),continuing:new P("continuing",x.keyword,"continuing"),default:new P("default",x.keyword,"default"),discard:new P("discard",x.keyword,"discard"),else:new P("else",x.keyword,"else"),enable:new P("enable",x.keyword,"enable"),fallthrough:new P("fallthrough",x.keyword,"fallthrough"),false:new P("false",x.keyword,"false"),fn:new P("fn",x.keyword,"fn"),for:new P("for",x.keyword,"for"),function:new P("function",x.keyword,"function"),if:new P("if",x.keyword,"if"),let:new P("let",x.keyword,"let"),const:new P("const",x.keyword,"const"),loop:new P("loop",x.keyword,"loop"),while:new P("while",x.keyword,"while"),private:new P("private",x.keyword,"private"),read:new P("read",x.keyword,"read"),read_write:new P("read_write",x.keyword,"read_write"),return:new P("return",x.keyword,"return"),storage:new P("storage",x.keyword,"storage"),switch:new P("switch",x.keyword,"switch"),true:new P("true",x.keyword,"true"),alias:new P("alias",x.keyword,"alias"),type:new P("type",x.keyword,"type"),uniform:new P("uniform",x.keyword,"uniform"),var:new P("var",x.keyword,"var"),override:new P("override",x.keyword,"override"),workgroup:new P("workgroup",x.keyword,"workgroup"),write:new P("write",x.keyword,"write"),r8unorm:new P("r8unorm",x.keyword,"r8unorm"),r8snorm:new P("r8snorm",x.keyword,"r8snorm"),r8uint:new P("r8uint",x.keyword,"r8uint"),r8sint:new P("r8sint",x.keyword,"r8sint"),r16uint:new P("r16uint",x.keyword,"r16uint"),r16sint:new P("r16sint",x.keyword,"r16sint"),r16float:new P("r16float",x.keyword,"r16float"),rg8unorm:new P("rg8unorm",x.keyword,"rg8unorm"),rg8snorm:new P("rg8snorm",x.keyword,"rg8snorm"),rg8uint:new P("rg8uint",x.keyword,"rg8uint"),rg8sint:new P("rg8sint",x.keyword,"rg8sint"),r32uint:new P("r32uint",x.keyword,"r32uint"),r32sint:new P("r32sint",x.keyword,"r32sint"),r32float:new P("r32float",x.keyword,"r32float"),rg16uint:new P("rg16uint",x.keyword,"rg16uint"),rg16sint:new P("rg16sint",x.keyword,"rg16sint"),rg16float:new P("rg16float",x.keyword,"rg16float"),rgba8unorm:new P("rgba8unorm",x.keyword,"rgba8unorm"),rgba8unorm_srgb:new P("rgba8unorm_srgb",x.keyword,"rgba8unorm_srgb"),rgba8snorm:new P("rgba8snorm",x.keyword,"rgba8snorm"),rgba8uint:new P("rgba8uint",x.keyword,"rgba8uint"),rgba8sint:new P("rgba8sint",x.keyword,"rgba8sint"),bgra8unorm:new P("bgra8unorm",x.keyword,"bgra8unorm"),bgra8unorm_srgb:new P("bgra8unorm_srgb",x.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new P("rgb10a2unorm",x.keyword,"rgb10a2unorm"),rg11b10float:new P("rg11b10float",x.keyword,"rg11b10float"),rg32uint:new P("rg32uint",x.keyword,"rg32uint"),rg32sint:new P("rg32sint",x.keyword,"rg32sint"),rg32float:new P("rg32float",x.keyword,"rg32float"),rgba16uint:new P("rgba16uint",x.keyword,"rgba16uint"),rgba16sint:new P("rgba16sint",x.keyword,"rgba16sint"),rgba16float:new P("rgba16float",x.keyword,"rgba16float"),rgba32uint:new P("rgba32uint",x.keyword,"rgba32uint"),rgba32sint:new P("rgba32sint",x.keyword,"rgba32sint"),rgba32float:new P("rgba32float",x.keyword,"rgba32float"),static_assert:new P("static_assert",x.keyword,"static_assert")};E.tokens={decimal_float_literal:new P("decimal_float_literal",x.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new P("hex_float_literal",x.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new P("int_literal",x.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new P("uint_literal",x.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new P("ident",x.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new P("and",x.token,"&"),and_and:new P("and_and",x.token,"&&"),arrow:new P("arrow ",x.token,"->"),attr:new P("attr",x.token,"@"),attr_left:new P("attr_left",x.token,"[["),attr_right:new P("attr_right",x.token,"]]"),forward_slash:new P("forward_slash",x.token,"/"),bang:new P("bang",x.token,"!"),bracket_left:new P("bracket_left",x.token,"["),bracket_right:new P("bracket_right",x.token,"]"),brace_left:new P("brace_left",x.token,"{"),brace_right:new P("brace_right",x.token,"}"),colon:new P("colon",x.token,":"),comma:new P("comma",x.token,","),equal:new P("equal",x.token,"="),equal_equal:new P("equal_equal",x.token,"=="),not_equal:new P("not_equal",x.token,"!="),greater_than:new P("greater_than",x.token,">"),greater_than_equal:new P("greater_than_equal",x.token,">="),shift_right:new P("shift_right",x.token,">>"),less_than:new P("less_than",x.token,"<"),less_than_equal:new P("less_than_equal",x.token,"<="),shift_left:new P("shift_left",x.token,"<<"),modulo:new P("modulo",x.token,"%"),minus:new P("minus",x.token,"-"),minus_minus:new P("minus_minus",x.token,"--"),period:new P("period",x.token,"."),plus:new P("plus",x.token,"+"),plus_plus:new P("plus_plus",x.token,"++"),or:new P("or",x.token,"|"),or_or:new P("or_or",x.token,"||"),paren_left:new P("paren_left",x.token,"("),paren_right:new P("paren_right",x.token,")"),semicolon:new P("semicolon",x.token,";"),star:new P("star",x.token,"*"),tilde:new P("tilde",x.token,"~"),underscore:new P("underscore",x.token,"_"),xor:new P("xor",x.token,"^"),plus_equal:new P("plus_equal",x.token,"+="),minus_equal:new P("minus_equal",x.token,"-="),times_equal:new P("times_equal",x.token,"*="),division_equal:new P("division_equal",x.token,"/="),modulo_equal:new P("modulo_equal",x.token,"%="),and_equal:new P("and_equal",x.token,"&="),or_equal:new P("or_equal",x.token,"|="),xor_equal:new P("xor_equal",x.token,"^="),shift_right_equal:new P("shift_right_equal",x.token,">>="),shift_left_equal:new P("shift_left_equal",x.token,"<<=")};E.storage_class=[j.keywords.function,j.keywords.private,j.keywords.workgroup,j.keywords.uniform,j.keywords.storage];E.access_mode=[j.keywords.read,j.keywords.write,j.keywords.read_write];E.sampler_type=[j.keywords.sampler,j.keywords.sampler_comparison];E.sampled_texture_type=[j.keywords.texture_1d,j.keywords.texture_2d,j.keywords.texture_2d_array,j.keywords.texture_3d,j.keywords.texture_cube,j.keywords.texture_cube_array];E.multisampled_texture_type=[j.keywords.texture_multisampled_2d];E.storage_texture_type=[j.keywords.texture_storage_1d,j.keywords.texture_storage_2d,j.keywords.texture_storage_2d_array,j.keywords.texture_storage_3d];E.depth_texture_type=[j.keywords.texture_depth_2d,j.keywords.texture_depth_2d_array,j.keywords.texture_depth_cube,j.keywords.texture_depth_cube_array,j.keywords.texture_depth_multisampled_2d];E.texture_external_type=[j.keywords.texture_external];E.any_texture_type=[...j.sampled_texture_type,...j.multisampled_texture_type,...j.storage_texture_type,...j.depth_texture_type,...j.texture_external_type];E.texel_format=[j.keywords.r8unorm,j.keywords.r8snorm,j.keywords.r8uint,j.keywords.r8sint,j.keywords.r16uint,j.keywords.r16sint,j.keywords.r16float,j.keywords.rg8unorm,j.keywords.rg8snorm,j.keywords.rg8uint,j.keywords.rg8sint,j.keywords.r32uint,j.keywords.r32sint,j.keywords.r32float,j.keywords.rg16uint,j.keywords.rg16sint,j.keywords.rg16float,j.keywords.rgba8unorm,j.keywords.rgba8unorm_srgb,j.keywords.rgba8snorm,j.keywords.rgba8uint,j.keywords.rgba8sint,j.keywords.bgra8unorm,j.keywords.bgra8unorm_srgb,j.keywords.rgb10a2unorm,j.keywords.rg11b10float,j.keywords.rg32uint,j.keywords.rg32sint,j.keywords.rg32float,j.keywords.rgba16uint,j.keywords.rgba16sint,j.keywords.rgba16float,j.keywords.rgba32uint,j.keywords.rgba32sint,j.keywords.rgba32float];E.const_literal=[j.tokens.int_literal,j.tokens.uint_literal,j.tokens.decimal_float_literal,j.tokens.hex_float_literal,j.keywords.true,j.keywords.false];E.literal_or_ident=[j.tokens.ident,j.tokens.int_literal,j.tokens.uint_literal,j.tokens.decimal_float_literal,j.tokens.hex_float_literal];E.element_count_expression=[j.tokens.int_literal,j.tokens.uint_literal,j.tokens.ident];E.template_types=[j.keywords.vec2,j.keywords.vec3,j.keywords.vec4,j.keywords.mat2x2,j.keywords.mat2x3,j.keywords.mat2x4,j.keywords.mat3x2,j.keywords.mat3x3,j.keywords.mat3x4,j.keywords.mat4x2,j.keywords.mat4x3,j.keywords.mat4x4,j.keywords.atomic,j.keywords.bitcast,...j.any_texture_type];E.attribute_name=[j.tokens.ident,j.keywords.block];E.assignment_operators=[j.tokens.equal,j.tokens.plus_equal,j.tokens.minus_equal,j.tokens.times_equal,j.tokens.division_equal,j.tokens.modulo_equal,j.tokens.and_equal,j.tokens.or_equal,j.tokens.xor_equal,j.tokens.shift_right_equal,j.tokens.shift_left_equal];E.increment_operators=[j.tokens.plus_plus,j.tokens.minus_minus];class Dg{constructor(e,i,n){this.type=e,this.lexeme=i,this.line=n}toString(){return this.lexeme}isTemplateType(){return E.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==E.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class CR{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Dg(E.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let n=1;for(;n>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),n--,n==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),n++)}return!0}}let i=E.none;for(;;){let n=this._findType(e);const s=this._peekAhead();if(e==">"&&(s==">"||s=="=")){let r=!1,o=this._tokens.length-1;for(let a=0;a<5&&o>=0;++a,--o)if(this._tokens[o].type===E.tokens.less_than){o>0&&this._tokens[o-1].isArrayOrTemplateType()&&(r=!0);break}if(r)return this._addToken(n),!0}if(n===E.none){let r=e,o=0;const a=2;for(let c=0;c<a;++c)if(r+=this._peekAhead(c),n=this._findType(r),n!==E.none){o=c;break}if(n===E.none)return i===E.none?!1:(this._current--,this._addToken(i),!0);e=r,this._current+=o+1}if(i=n,this._isAtEnd())break;e+=this._advance()}return i===E.none?!1:(this._addToken(i),!0)}_findType(e){for(const i in E.keywords){const n=E.keywords[i];if(this._match(e,n.rule))return n}for(const i in E.tokens){const n=E.tokens[i];if(this._match(e,n.rule))return n}return E.none}_match(e,i){if(typeof i=="string"){if(i==e)return!0}else{const n=i.exec(e);if(n&&n.index==0&&n[0]==e)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let i=this._source[this._current];return e=e||0,e++,this._current+=e,i}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const i=this._source.substring(this._start,this._current);this._tokens.push(new Dg(e,i,this._line))}}class xR{constructor(){this._tokens=[],this._current=0,this._context=new eR}parse(e){this._initialize(e);let i=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;i.push(n)}return i}_initialize(e){if(e)if(typeof e=="string"){const i=new CR(e);this._tokens=i.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,i){return console.error(e,i),{token:e,message:i,toString:function(){return`${i}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==E.eof}_match(e){if(e instanceof P)return this._check(e)?(this._advance(),!0):!1;for(let i=0,n=e.length;i<n;++i){const s=e[i];if(this._check(s))return this._advance(),!0}return!1}_consume(e,i){if(this._check(e))return this._advance();throw this._error(this._peek(),i)}_check(e){if(this._isAtEnd())return!1;const i=this._peek();if(e instanceof Array){let n=i.type;return e.indexOf(n)!=-1}return i.type==e}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(E.tokens.semicolon)&&!this._isAtEnd(););if(this._match(E.keywords.alias)){const i=this._type_alias();return this._consume(E.tokens.semicolon,"Expected ';'"),i}if(this._match(E.keywords.enable)){const i=this._enable_directive();return this._consume(E.tokens.semicolon,"Expected ';'"),i}const e=this._attribute();if(this._check(E.keywords.var)){const i=this._global_variable_decl();return i!=null&&(i.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),i}if(this._check(E.keywords.override)){const i=this._override_variable_decl();return i!=null&&(i.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),i}if(this._check(E.keywords.let)){const i=this._global_let_decl();return i!=null&&(i.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),i}if(this._check(E.keywords.const)){const i=this._global_const_decl();return i!=null&&(i.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),i}if(this._check(E.keywords.struct)){const i=this._struct_decl();return i!=null&&(i.attributes=e),i}if(this._check(E.keywords.fn)){const i=this._function_decl();return i!=null&&(i.attributes=e),i}return null}_function_decl(){if(!this._match(E.keywords.fn))return null;const e=this._consume(E.tokens.ident,"Expected function name.").toString();this._consume(E.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(E.tokens.paren_right))do{if(this._check(E.tokens.paren_right))break;const r=this._attribute(),o=this._consume(E.tokens.ident,"Expected argument name.").toString();this._consume(E.tokens.colon,"Expected ':' for argument type.");const a=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=a,i.push(new SR(o,c,r)))}while(this._match(E.tokens.comma));this._consume(E.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(E.tokens.arrow)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}const s=this._compound_statement();return new p1(e,i,n,s)}_compound_statement(){const e=[];for(this._consume(E.tokens.brace_left,"Expected '{' for block.");!this._check(E.tokens.brace_right);){const i=this._statement();i!==null&&e.push(i)}return this._consume(E.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(E.tokens.semicolon)&&!this._isAtEnd(););if(this._check(E.keywords.if))return this._if_statement();if(this._check(E.keywords.switch))return this._switch_statement();if(this._check(E.keywords.loop))return this._loop_statement();if(this._check(E.keywords.for))return this._for_statement();if(this._check(E.keywords.while))return this._while_statement();if(this._check(E.keywords.continuing))return this._continuing_statement();if(this._check(E.keywords.static_assert))return this._static_assert_statement();if(this._check(E.tokens.brace_left))return this._compound_statement();let e=null;return this._check(E.keywords.return)?e=this._return_statement():this._check([E.keywords.var,E.keywords.let,E.keywords.const])?e=this._variable_statement():this._match(E.keywords.discard)?e=new dR:this._match(E.keywords.break)?e=new pR:this._match(E.keywords.continue)?e=new gR:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(E.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(E.keywords.static_assert))return null;let e=this._optional_paren_expression();return new tR(e)}_while_statement(){if(!this._match(E.keywords.while))return null;let e=this._optional_paren_expression();const i=this._compound_statement();return new iR(e,i)}_continuing_statement(){if(!this._match(E.keywords.continuing))return null;const e=this._compound_statement();return new nR(e)}_for_statement(){if(!this._match(E.keywords.for))return null;this._consume(E.tokens.paren_left,"Expected '('.");const e=this._check(E.tokens.semicolon)?null:this._for_init();this._consume(E.tokens.semicolon,"Expected ';'.");const i=this._check(E.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(E.tokens.semicolon,"Expected ';'.");const n=this._check(E.tokens.paren_right)?null:this._for_increment();this._consume(E.tokens.paren_right,"Expected ')'.");const s=this._compound_statement();return new sR(e,i,n,s)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(E.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let i=null;return this._match(E.tokens.equal)&&(i=this._short_circuit_or_expression()),new Qs(e.name,e.type,e.storage,e.access,i)}if(this._match(E.keywords.let)){const e=this._consume(E.tokens.ident,"Expected name for let.").toString();let i=null;if(this._match(E.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}this._consume(E.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new xg(e,i,null,null,n)}if(this._match(E.keywords.const)){const e=this._consume(E.tokens.ident,"Expected name for const.").toString();let i=null;if(this._match(E.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}this._consume(E.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new Pg(e,i,null,null,n)}return null}_increment_decrement_statement(){const e=this._current,i=this._unary_expression();if(i==null)return null;if(!this._check(E.increment_operators))return this._current=e,null;const n=this._consume(E.increment_operators,"Expected increment operator");return new rR(n.type===E.tokens.plus_plus?Sr.increment:Sr.decrement,i)}_assignment_statement(){let e=null;if(this._check(E.tokens.brace_right))return null;let i=this._match(E.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const n=this._consume(E.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return new oR(Ho.parse(n.lexeme),e,s)}_func_call_statement(){if(!this._check(E.tokens.ident))return null;const e=this._current,i=this._consume(E.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=e,null):new aR(i.lexeme,n)}_loop_statement(){if(!this._match(E.keywords.loop))return null;this._consume(E.tokens.brace_left,"Expected '{' for loop.");const e=[];let i=this._statement();for(;i!==null;){if(Array.isArray(i))for(let s of i)e.push(s);else e.push(i);i=this._statement()}let n=null;return this._match(E.keywords.continuing)&&(n=this._compound_statement()),this._consume(E.tokens.brace_right,"Expected '}' for loop."),new cR(e,n)}_switch_statement(){if(!this._match(E.keywords.switch))return null;const e=this._optional_paren_expression();this._consume(E.tokens.brace_left,"Expected '{' for switch.");const i=this._switch_body();if(i==null||i.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(E.tokens.brace_right,"Expected '}' for switch."),new lR(e,i)}_switch_body(){const e=[];if(this._match(E.keywords.case)){const i=this._case_selectors();this._match(E.tokens.colon),this._consume(E.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(E.tokens.brace_right,"Exected '}' for switch case."),e.push(new TR(i,n))}if(this._match(E.keywords.default)){this._match(E.tokens.colon),this._consume(E.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(E.tokens.brace_right,"Exected '}' for switch default."),e.push(new ER(i))}if(this._check([E.keywords.default,E.keywords.case])){const i=this._switch_body();e.push(i[0])}return e}_case_selectors(){var e,i,n,s;const r=[(i=(e=this._shift_expression())===null||e===void 0?void 0:e.evaluate(this._context).toString())!==null&&i!==void 0?i:""];for(;this._match(E.tokens.comma);)r.push((s=(n=this._shift_expression())===null||n===void 0?void 0:n.evaluate(this._context).toString())!==null&&s!==void 0?s:"");return r}_case_body(){if(this._match(E.keywords.fallthrough))return this._consume(E.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const i=this._case_body();return i.length==0?e:[...e,i[0]]}_if_statement(){if(!this._match(E.keywords.if))return null;const e=this._optional_paren_expression(),i=this._compound_statement();let n=[];this._match_elseif()&&(n=this._elseif_statement(n));let s=null;return this._match(E.keywords.else)&&(s=this._compound_statement()),new uR(e,i,n,s)}_match_elseif(){return this._tokens[this._current].type===E.keywords.else&&this._tokens[this._current+1].type===E.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const i=this._optional_paren_expression(),n=this._compound_statement();return e.push(new AR(i,n)),this._match_elseif()&&this._elseif_statement(e),e}_return_statement(){if(!this._match(E.keywords.return))return null;const e=this._short_circuit_or_expression();return new hR(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(E.tokens.or_or);)e=new xi(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(E.tokens.and_and);)e=new xi(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(E.tokens.or);)e=new xi(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(E.tokens.xor);)e=new xi(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(E.tokens.and);)e=new xi(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([E.tokens.equal_equal,E.tokens.not_equal])?new xi(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([E.tokens.less_than,E.tokens.greater_than,E.tokens.less_than_equal,E.tokens.greater_than_equal]);)e=new xi(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([E.tokens.shift_left,E.tokens.shift_right]);)e=new xi(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([E.tokens.plus,E.tokens.minus]);)e=new xi(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([E.tokens.star,E.tokens.forward_slash,E.tokens.modulo]);)e=new xi(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([E.tokens.minus,E.tokens.bang,E.tokens.tilde,E.tokens.star,E.tokens.and])?new wR(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),i=this._postfix_expression();return i&&(e.postfix=i),e}_postfix_expression(){if(this._match(E.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(E.tokens.bracket_right,"Expected ']'.");const i=this._postfix_expression();return i&&(e.postfix=i),e}if(this._match(E.tokens.period)){const e=this._consume(E.tokens.ident,"Expected member name."),i=this._postfix_expression(),n=new Mg(e.lexeme);return i&&(n.postfix=i),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(E.tokens.ident)){const n=this._previous().toString();if(this._check(E.tokens.paren_left)){const s=this._argument_expression_list(),r=this._getStruct(n);return r!=null?new ho(r,s):new mR(n,s)}if(this._context.constants.has(n)){const s=this._context.constants.get(n);return new Ig(n,s.value)}return new yR(n)}if(this._match(E.const_literal))return new Og(parseFloat(this._previous().toString()));if(this._check(E.tokens.paren_left))return this._paren_expression();if(this._match(E.keywords.bitcast)){this._consume(E.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(E.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return new vR(n,s)}const e=this._type_decl(),i=this._argument_expression_list();return new bR(e,i)}_argument_expression_list(){if(!this._match(E.tokens.paren_left))return null;const e=[];do{if(this._check(E.tokens.paren_right))break;const i=this._short_circuit_or_expression();e.push(i)}while(this._match(E.tokens.comma));return this._consume(E.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(E.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(E.tokens.paren_right),new kg([e])}_paren_expression(){this._consume(E.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(E.tokens.paren_right,"Expected ')'."),new kg([e])}_struct_decl(){if(!this._match(E.keywords.struct))return null;const e=this._consume(E.tokens.ident,"Expected name for struct.").toString();this._consume(E.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(E.tokens.brace_right);){const s=this._attribute(),r=this._consume(E.tokens.ident,"Expected variable name.").toString();this._consume(E.tokens.colon,"Expected ':' for struct member type.");const o=this._attribute(),a=this._type_decl();a!=null&&(a.attributes=o),this._check(E.tokens.brace_right)?this._match(E.tokens.comma):this._consume(E.tokens.comma,"Expected ',' for struct member."),i.push(new RR(r,a,s))}this._consume(E.tokens.brace_right,"Expected '}' after struct body.");const n=new Xn(e,i);return this._context.structs.set(e,n),n}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(E.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(E.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(E.keywords.const))return null;const e=this._consume(E.tokens.ident,"Expected variable name");let i=null;if(this._match(E.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}let n=null;if(this._match(E.tokens.equal)){const r=this._short_circuit_or_expression();if(r instanceof ho)n=r;else if(r instanceof Ig&&r.initializer instanceof ho)n=r.initializer;else try{const o=r.evaluate(this._context);n=new Og(o)}catch{n=r}}const s=new Pg(e.toString(),i,"","",n);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(E.keywords.let))return null;const e=this._consume(E.tokens.ident,"Expected variable name");let i=null;if(this._match(E.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}let n=null;return this._match(E.tokens.equal)&&(n=this._const_expression()),new xg(e.toString(),i,"","",n)}_const_expression(){if(this._match(E.const_literal))return new Mg(this._previous().toString());const e=this._type_decl();this._consume(E.tokens.paren_left,"Expected '('.");let i=[];for(;!this._check(E.tokens.paren_right)&&(i.push(this._const_expression()),!!this._check(E.tokens.comma));)this._advance();return this._consume(E.tokens.paren_right,"Expected ')'."),new ho(e,i)}_variable_decl(){if(!this._match(E.keywords.var))return null;let e="",i="";this._match(E.tokens.less_than)&&(e=this._consume(E.storage_class,"Expected storage_class.").toString(),this._match(E.tokens.comma)&&(i=this._consume(E.access_mode,"Expected access_mode.").toString()),this._consume(E.tokens.greater_than,"Expected '>'."));const n=this._consume(E.tokens.ident,"Expected variable name");let s=null;if(this._match(E.tokens.colon)){const r=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=r)}return new Qs(n.toString(),s,e,i,null)}_override_decl(){if(!this._match(E.keywords.override))return null;const e=this._consume(E.tokens.ident,"Expected variable name");let i=null;if(this._match(E.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}return new g1(e.toString(),i,null)}_enable_directive(){const e=this._consume(E.tokens.ident,"identity expected.");return new fR(e.toString())}_type_alias(){const e=this._consume(E.tokens.ident,"identity expected.");this._consume(E.tokens.equal,"Expected '=' for type alias.");let i=this._type_decl();if(i===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);const n=new _1(e.toString(),i);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([E.tokens.ident,...E.texel_format,E.keywords.bool,E.keywords.f32,E.keywords.i32,E.keywords.u32])){const n=this._advance(),s=n.toString();return this._context.structs.has(s)?this._context.structs.get(s):this._context.aliases.has(s)?this._context.aliases.get(s).type:new Cs(n.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(E.template_types)){let n=this._advance().toString(),s=null,r=null;return this._match(E.tokens.less_than)&&(s=this._type_decl(),r=null,this._match(E.tokens.comma)&&(r=this._consume(E.access_mode,"Expected access_mode for pointer").toString()),this._consume(E.tokens.greater_than,"Expected '>' for type.")),new m1(n,s,r)}if(this._match(E.keywords.ptr)){let n=this._previous().toString();this._consume(E.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(E.storage_class,"Expected storage_class for pointer");this._consume(E.tokens.comma,"Expected ',' for pointer.");const r=this._type_decl();let o=null;return this._match(E.tokens.comma)&&(o=this._consume(E.access_mode,"Expected access_mode for pointer").toString()),this._consume(E.tokens.greater_than,"Expected '>' for pointer."),new _R(n,s.toString(),r,o)}const i=this._attribute();if(this._match(E.keywords.array)){let n=null,s=-1;const r=this._previous();if(this._match(E.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let o="";this._match(E.tokens.comma)&&(o=this._shift_expression().evaluate(this._context).toString()),this._consume(E.tokens.greater_than,"Expected '>' for array."),s=o?parseInt(o):0}return new y1(r.toString(),i,n,s)}return null}_texture_sampler_types(){if(this._match(E.sampler_type))return new uo(this._previous().toString(),null,null);if(this._match(E.depth_texture_type))return new uo(this._previous().toString(),null,null);if(this._match(E.sampled_texture_type)||this._match(E.multisampled_texture_type)){const e=this._previous();this._consume(E.tokens.less_than,"Expected '<' for sampler type.");const i=this._type_decl();return this._consume(E.tokens.greater_than,"Expected '>' for sampler type."),new uo(e.toString(),i,null)}if(this._match(E.storage_texture_type)){const e=this._previous();this._consume(E.tokens.less_than,"Expected '<' for sampler type.");const i=this._consume(E.texel_format,"Invalid texel format.").toString();this._consume(E.tokens.comma,"Expected ',' after texel format.");const n=this._consume(E.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(E.tokens.greater_than,"Expected '>' for sampler type."),new uo(e.toString(),i,n)}return null}_attribute(){let e=[];for(;this._match(E.tokens.attr);){const i=this._consume(E.attribute_name,"Expected attribute name"),n=new Ng(i.toString(),null);if(this._match(E.tokens.paren_left)){if(n.value=this._consume(E.literal_or_ident,"Expected attribute value").toString(),this._check(E.tokens.comma)){this._advance();do{const s=this._consume(E.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(s)}while(this._match(E.tokens.comma))}this._consume(E.tokens.paren_right,"Expected ')'")}e.push(n)}for(;this._match(E.tokens.attr_left);){if(!this._check(E.tokens.attr_right))do{const i=this._consume(E.attribute_name,"Expected attribute name"),n=new Ng(i.toString(),null);if(this._match(E.tokens.paren_left)){if(n.value=[this._consume(E.literal_or_ident,"Expected attribute value").toString()],this._check(E.tokens.comma)){this._advance();do{const s=this._consume(E.literal_or_ident,"Expected attribute value").toString();n.value.push(s)}while(this._match(E.tokens.comma))}this._consume(E.tokens.paren_right,"Expected ')'")}e.push(n)}while(this._match(E.tokens.comma));this._consume(E.tokens.attr_right,"Expected ']]' after attribute declarations")}return e.length==0?null:e}}class ur{constructor(e,i){this.name=e,this.attributes=i,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Fg{constructor(e,i,n){this.name=e,this.type=i,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class xa extends ur{constructor(e,i){super(e,i),this.members=[],this.align=0}get isStruct(){return!0}}class Tu extends ur{constructor(e,i){super(e,i),this.count=0,this.stride=0}get isArray(){return!0}}class Lg extends ur{constructor(e,i,n,s){super(e,n),this.format=i,this.access=s}get isTemplate(){return!0}}var hn;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(hn||(hn={}));class Pa{constructor(e,i,n,s,r,o,a){this.name=e,this.type=i,this.group=n,this.binding=s,this.attributes=r,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class PR{constructor(e,i){this.name=e,this.type=i}}class Ma{constructor(e,i){this.align=e,this.size=i}}class MR{constructor(e,i,n,s){this.name=e,this.type=i,this.locationType=n,this.location=s,this.interpolation=null}}class Bg{constructor(e,i,n,s){this.name=e,this.type=i,this.locationType=n,this.location=s}}class IR{constructor(e,i=null){this.stage=null,this.inputs=[],this.outputs=[],this.name=e,this.stage=i}}class OR{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class kR{constructor(e,i,n,s){this.name=e,this.type=i,this.attributes=n,this.id=s}}class Yi{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new OR,this._types=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const n=new xR().parse(e);for(const s of n){if(s instanceof Xn){const r=this._getTypeInfo(s,null);r instanceof xa&&this.structs.push(r);continue}if(s instanceof _1){this.aliases.push(this._getAliasInfo(s));continue}if(s instanceof g1){const r=s,o=this._getAttributeNum(r.attributes,"id",0),a=r.type!=null?this._getTypeInfo(r.type,r.attributes):null;this.overrides.push(new kR(r.name,a,r.attributes,o));continue}if(this._isUniformVar(s)){const r=s,o=this._getAttributeNum(r.attributes,"group",0),a=this._getAttributeNum(r.attributes,"binding",0),c=this._getTypeInfo(r.type,r.attributes),l=new Pa(r.name,c,o,a,r.attributes,hn.Uniform,r.access);this.uniforms.push(l);continue}if(this._isStorageVar(s)){const r=s,o=this._getAttributeNum(r.attributes,"group",0),a=this._getAttributeNum(r.attributes,"binding",0),c=this._getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(c),u=new Pa(r.name,c,o,a,r.attributes,l?hn.StorageTexture:hn.Storage,r.access);this.storage.push(u);continue}if(this._isTextureVar(s)){const r=s,o=this._getAttributeNum(r.attributes,"group",0),a=this._getAttributeNum(r.attributes,"binding",0),c=this._getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(c),u=new Pa(r.name,c,o,a,r.attributes,l?hn.StorageTexture:hn.Texture,r.access);l?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(s)){const r=s,o=this._getAttributeNum(r.attributes,"group",0),a=this._getAttributeNum(r.attributes,"binding",0),c=this._getTypeInfo(r.type,r.attributes),l=new Pa(r.name,c,o,a,r.attributes,hn.Sampler,r.access);this.samplers.push(l);continue}if(s instanceof p1){const r=this._getAttribute(s,"vertex"),o=this._getAttribute(s,"fragment"),a=this._getAttribute(s,"compute"),c=r||o||a;if(c){const l=new IR(s.name,c.name);l.inputs=this._getInputs(s.args),l.outputs=this._getOutputs(s.returnType),this.entry[c.name].push(l)}continue}}}getBindGroups(){const e=[];function i(n,s){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),s>=e[n].length&&(e[n].length=s+1)}for(const n of this.uniforms){i(n.group,n.binding);const s=e[n.group];s[n.binding]=n}for(const n of this.storage){i(n.group,n.binding);const s=e[n.group];s[n.binding]=n}for(const n of this.textures){i(n.group,n.binding);const s=e[n.group];s[n.binding]=n}for(const n of this.samplers){i(n.group,n.binding);const s=e[n.group];s[n.binding]=n}return e}_getOutputs(e,i=void 0){if(i===void 0&&(i=[]),e instanceof Xn)this._getStructOutputs(e,i);else{const n=this._getOutputInfo(e);n!==null&&i.push(n)}return i}_getStructOutputs(e,i){for(const n of e.members)if(n.type instanceof Xn)this._getStructOutputs(n.type,i);else{const s=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(s!==null){const r=this._getTypeInfo(n.type,n.type.attributes),o=this._parseInt(s.value),a=new Bg(n.name,r,s.name,o);i.push(a)}}}_getOutputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const n=this._getTypeInfo(e,e.attributes),s=this._parseInt(i.value);return new Bg("",n,i.name,s)}return null}_getInputs(e,i=void 0){i===void 0&&(i=[]);for(const n of e)if(n.type instanceof Xn)this._getStructInputs(n.type,i);else{const s=this._getInputInfo(n);s!==null&&i.push(s)}return i}_getStructInputs(e,i){for(const n of e.members)if(n.type instanceof Xn)this._getStructInputs(n.type,i);else{const s=this._getInputInfo(n);s!==null&&i.push(s)}}_getInputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const n=this._getAttribute(e,"interpolation"),s=this._getTypeInfo(e.type,e.attributes),r=this._parseInt(i.value),o=new MR(e.name,s,i.name,r);return n!==null&&(o.interpolation=this._parseString(n.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const i=parseInt(e);return isNaN(i)?e:i}_getAlias(e){for(const i of this.aliases)if(i.name==e)return i.type;return null}_getAliasInfo(e){return new PR(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,i){if(this._types.has(e))return this._types.get(e);if(e instanceof y1){const s=e,r=this._getTypeInfo(s.format,s.attributes),o=new Tu(s.name,i);return o.format=r,o.count=s.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Xn){const s=e,r=new xa(s.name,i);for(const o of s.members){const a=this._getTypeInfo(o.type,o.attributes);r.members.push(new Fg(o.name,a,o.attributes))}return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof uo){const s=e,r=s.format instanceof Cs,o=s.format?r?this._getTypeInfo(s.format,null):new ur(s.format,null):null,a=new Lg(s.name,o,i,s.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof m1){const s=e,r=s.format?this._getTypeInfo(s.format,null):null,o=new Lg(s.name,r,i,s.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const n=new ur(e.name,i);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var i,n;const s=this._getTypeSize(e);if(e.size=(i=s==null?void 0:s.size)!==null&&i!==void 0?i:0,e instanceof Tu){const r=this._getTypeSize(e.format);e.stride=(n=r==null?void 0:r.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(e.format)}e instanceof xa&&this._updateStructInfo(e)}_updateStructInfo(e){var i;let n=0,s=0,r=0,o=0;for(let a=0,c=e.members.length;a<c;++a){const l=e.members[a],u=this._getTypeSize(l);if(!u)continue;(i=this._getAlias(l.type.name))!==null&&i!==void 0||l.type;const h=u.align,f=u.size;n=this._roundUp(h,n+s),s=f,r=n,o=Math.max(o,h),l.offset=n,l.size=f,this._updateTypeInfo(l.type)}e.size=this._roundUp(o,r+s),e.align=o}_getTypeSize(e){var i;if(e==null)return null;const n=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Fg&&(e=e.type),e instanceof ur){const r=this._getAlias(e.name);r!==null&&(e=r)}{const r=Yi._typeInfo[e.name];if(r!==void 0){const o=e.format==="f16"?2:1;return new Ma(Math.max(s,r.align/o),Math.max(n,r.size/o))}}{const r=Yi._typeInfo[e.name.substring(0,e.name.length-1)];if(r){const o=e.name[e.name.length-1]==="h"?2:1;return new Ma(Math.max(s,r.align/o),Math.max(n,r.size/o))}}if(e instanceof Tu){let r=e,o=8,a=8;const c=this._getTypeSize(r.format);c!==null&&(a=c.size,o=c.align);const l=r.count,u=this._getAttributeNum((i=e==null?void 0:e.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(o,a));return a=l*u,n&&(a=n),new Ma(Math.max(s,o),Math.max(n,a))}if(e instanceof xa){let r=0,o=0,a=0,c=0,l=0;for(const u of e.members){const h=this._getTypeSize(u.type);h!==null&&(r=Math.max(h.align,r),a=this._roundUp(h.align,a+c),c=h.size,l=a)}return o=this._roundUp(r,l+c),new Ma(Math.max(s,r),Math.max(n,o))}return null}_isUniformVar(e){return e instanceof Qs&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Qs&&e.storage=="storage"}_isTextureVar(e){return e instanceof Qs&&e.type!==null&&Yi._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Qs&&e.type!==null&&Yi._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,i){const n=e;if(!n||!n.attributes)return null;const s=n.attributes;for(let r of s)if(r.name==i)return r;return null}_getAttributeNum(e,i,n){if(e===null)return n;for(let s of e)if(s.name==i){let r=s!==null&&s.value!==null?s.value:n;return r instanceof Array&&(r=r[0]),typeof r=="number"?r:typeof r=="string"?parseInt(r):n}return n}_roundUp(e,i){return Math.ceil(i/e)*e}}Yi._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};Yi._textureTypes=E.any_texture_type.map(t=>t.name);Yi._samplerTypes=E.sampler_type.map(t=>t.name);function NR(t){const e={attributes:[],bindings:[]};let i;try{i=DR(t)}catch(r){return Y.error(r.message)(),e}for(const r of i.uniforms){const o=[];for(const a of r.type.members)o.push({name:a.name,type:Ug(a.type)});e.bindings.push({type:"uniform",name:r.name,location:r.binding,group:r.group,members:o})}const n=i.entry.vertex[0],s=(n==null?void 0:n.inputs.length)||0;for(let r=0;r<s;r++){const o=n.inputs[r];if(o.locationType==="location"){const a=Ug(o.type);e.attributes.push({name:o.name,location:o.location,type:a})}}return e}function Ug(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function DR(t){try{return new Yi(t)}catch(e){if(e instanceof Error)throw e;let i="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(i+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(i+=e.token.line||""),new Error(i,{cause:e})}}const FR=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,LR={name:"fp32",vs:FR},BR=new Float32Array([0,1,1,1]),UR=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,zR=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,zg={name:"picking",vs:UR,fs:zR,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:new Float32Array([0,0,0]),highlightColor:BR},getUniforms:VR};function VR(t={},e){const i={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)i.isHighlightActive=!1;else{i.isHighlightActive=!0;const n=t.highlightedObjectColor.slice(0,3);i.highlightedObjectColor=n}if(t.highlightColor){const n=Array.from(t.highlightColor,s=>s/255);Number.isFinite(n[3])||(n[3]=1),i.highlightColor=n}return t.isActive!==void 0&&(i.isActive=!!t.isActive,i.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(i.useFloatColors=!!t.useFloatColors),i}const jR={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...jR}};const Vt=globalThis.mathgl.config;function $R(t,{precision:e=Vt.precision}={}){return t=HR(t),`${parseFloat(t.toPrecision(e))}`}function vs(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function vt(t,e,i){return XR(t,n=>Math.max(e,Math.min(i,n)))}function cs(t,e,i){return vs(t)?t.map((n,s)=>cs(n,e[s],i)):i*e+(1-i)*t}function Zi(t,e,i){const n=Vt.EPSILON;i&&(Vt.EPSILON=i);try{if(t===e)return!0;if(vs(t)&&vs(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!Zi(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Vt.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Vt.EPSILON=n}}function HR(t){return Math.round(t/Vt.EPSILON)*Vt.EPSILON}function WR(t){return t.clone?t.clone():new Array(t.length)}function XR(t,e,i){if(vs(t)){const n=t;i=i||WR(n);for(let s=0;s<i.length&&s<n.length;++s){const r=typeof t=="number"?t:t[s];i[s]=e(r,s,i)}return i}return e(t)}class gd extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,i=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+i];return this.check()}toArray(e=[],i=0){for(let n=0;n<this.ELEMENTS;++n)e[i+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:vs(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Vt)}formatString(e){let i="";for(let n=0;n<this.ELEMENTS;++n)i+=(n>0?", ":"")+$R(this[n],e);return`${e.printTypes?this.constructor.name:""}[${i}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!Zi(this[i],e[i]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==e[i])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,i,n){if(n===void 0)return this.lerp(this,e,i);for(let s=0;s<this.ELEMENTS;++s){const r=e[s],o=typeof i=="number"?i:i[s];this[s]=r+n*(o-r)}return this.check()}min(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(e[i],this[i]);return this.check()}max(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(e[i],this[i]);return this.check()}clamp(e,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),i[n]);return this.check()}add(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=i[n];return this.check()}subtract(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=i[n];return this.check()}scale(e){if(typeof e=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;else for(let i=0;i<this.ELEMENTS&&i<e.length;++i)this[i]*=e[i];return this.check()}multiplyByScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}check(){if(Vt.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)e=e&&Number.isFinite(this[i]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=e;return this.check()}addScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),i);return this.check()}get elements(){return this}}function qR(t,e){if(t.length!==e)return!1;for(let i=0;i<t.length;++i)if(!Number.isFinite(t[i]))return!1;return!0}function Ve(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function To(t,e,i=""){if(Vt.debug&&!qR(t,e))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return t}function Wo(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class w1 extends gd{get x(){return this[0]}set x(e){this[0]=Ve(e)}get y(){return this[1]}set y(e){this[1]=Ve(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*this[i];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let i=0;for(let n=0;n<this.ELEMENTS;++n){const s=this[n]-e[n];i+=s*s}return Ve(i)}dot(e){let i=0;for(let n=0;n<this.ELEMENTS;++n)i+=this[n]*e[n];return Ve(i)}normalize(){const e=this.magnitude();if(e!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e;return this.check()}multiply(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=i[n];return this.check()}divide(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=i[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Wo(e>=0&&e<this.ELEMENTS,"index is out of range"),Ve(this[e])}setComponent(e,i){return Wo(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=i,this.check()}addVectors(e,i){return this.copy(e).add(i)}subVectors(e,i){return this.copy(e).subtract(i)}multiplyVectors(e,i){return this.copy(e).multiply(i)}addScaledVector(e,i){return this.add(new this.constructor(e).multiplyScalar(i))}}const Eo=1e-6;let Ei=typeof Float32Array<"u"?Float32Array:Array;function YR(){const t=new Ei(2);return Ei!=Float32Array&&(t[0]=0,t[1]=0),t}function zc(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function T1(t,e){return t[0]=-e[0],t[1]=-e[1],t}function E1(t,e,i,n){const s=e[0],r=e[1];return t[0]=s+n*(i[0]-s),t[1]=r+n*(i[1]-r),t}function KR(t,e,i){const n=e[0],s=e[1];return t[0]=i[0]*n+i[3]*s+i[6],t[1]=i[1]*n+i[4]*s+i[7],t}function ZR(t,e,i){const n=e[0],s=e[1];return t[0]=i[0]*n+i[4]*s+i[12],t[1]=i[1]*n+i[5]*s+i[13],t}(function(){const t=YR();return function(e,i,n,s,r,o){let a,c;for(i||(i=2),n||(n=0),s?c=Math.min(s*i+n,e.length):c=e.length,a=n;a<c;a+=i)t[0]=e[a],t[1]=e[a+1],r(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function GR(t,e,i){const n=e[0],s=e[1],r=i[3]*n+i[7]*s||1;return t[0]=(i[0]*n+i[4]*s)/r,t[1]=(i[1]*n+i[5]*s)/r,t}function S1(t,e,i){const n=e[0],s=e[1],r=e[2],o=i[3]*n+i[7]*s+i[11]*r||1;return t[0]=(i[0]*n+i[4]*s+i[8]*r)/o,t[1]=(i[1]*n+i[5]*s+i[9]*r)/o,t[2]=(i[2]*n+i[6]*s+i[10]*r)/o,t}function JR(t,e,i){const n=e[0],s=e[1];return t[0]=i[0]*n+i[2]*s,t[1]=i[1]*n+i[3]*s,t[2]=e[2],t}function QR(t,e,i){const n=e[0],s=e[1];return t[0]=i[0]*n+i[2]*s,t[1]=i[1]*n+i[3]*s,t[2]=e[2],t[3]=e[3],t}function A1(t,e,i){const n=e[0],s=e[1],r=e[2];return t[0]=i[0]*n+i[3]*s+i[6]*r,t[1]=i[1]*n+i[4]*s+i[7]*r,t[2]=i[2]*n+i[5]*s+i[8]*r,t[3]=e[3],t}function R1(){const t=new Ei(3);return Ei!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function eC(t){const e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)}function Vg(t,e,i){const n=new Ei(3);return n[0]=t,n[1]=e,n[2]=i,n}function tC(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function iC(t){const e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n}function nC(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function sC(t,e){const i=e[0],n=e[1],s=e[2];let r=i*i+n*n+s*s;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function C1(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ac(t,e,i){const n=e[0],s=e[1],r=e[2],o=i[0],a=i[1],c=i[2];return t[0]=s*c-r*a,t[1]=r*o-n*c,t[2]=n*a-s*o,t}function rC(t,e,i,n){const s=e[0],r=e[1],o=e[2];return t[0]=s+n*(i[0]-s),t[1]=r+n*(i[1]-r),t[2]=o+n*(i[2]-o),t}function _d(t,e,i){const n=e[0],s=e[1],r=e[2];let o=i[3]*n+i[7]*s+i[11]*r+i[15];return o=o||1,t[0]=(i[0]*n+i[4]*s+i[8]*r+i[12])/o,t[1]=(i[1]*n+i[5]*s+i[9]*r+i[13])/o,t[2]=(i[2]*n+i[6]*s+i[10]*r+i[14])/o,t}function x1(t,e,i){const n=e[0],s=e[1],r=e[2];return t[0]=n*i[0]+s*i[3]+r*i[6],t[1]=n*i[1]+s*i[4]+r*i[7],t[2]=n*i[2]+s*i[5]+r*i[8],t}function P1(t,e,i){const n=i[0],s=i[1],r=i[2],o=i[3],a=e[0],c=e[1],l=e[2];let u=s*l-r*c,h=r*a-n*l,f=n*c-s*a,d=s*f-r*h,p=r*u-n*f,g=n*h-s*u;const _=o*2;return u*=_,h*=_,f*=_,d*=2,p*=2,g*=2,t[0]=a+u+d,t[1]=c+h+p,t[2]=l+f+g,t}function oC(t,e,i,n){const s=[],r=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],r[0]=s[0],r[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),r[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t}function aC(t,e,i,n){const s=[],r=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],r[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),r[1]=s[1],r[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t}function cC(t,e,i,n){const s=[],r=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],r[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),r[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),r[2]=s[2],t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t}function lC(t,e){const i=t[0],n=t[1],s=t[2],r=e[0],o=e[1],a=e[2],c=Math.sqrt((i*i+n*n+s*s)*(r*r+o*o+a*a)),l=c&&C1(t,e)/c;return Math.acos(Math.min(Math.max(l,-1),1))}const M1=tC,I1=eC,Eu=iC;(function(){const t=R1();return function(e,i,n,s,r,o){let a,c;for(i||(i=3),n||(n=0),s?c=Math.min(s*i+n,e.length):c=e.length,a=n;a<c;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],r(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Su=[0,0,0];let Ia;class ee extends w1{static get ZERO(){return Ia||(Ia=new ee(0,0,0),Object.freeze(Ia)),Ia}constructor(e=0,i=0,n=0){super(-0,-0,-0),arguments.length===1&&vs(e)?this.copy(e):(Vt.debug&&(Ve(e),Ve(i),Ve(n)),this[0]=e,this[1]=i,this[2]=n)}set(e,i,n){return this[0]=e,this[1]=i,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Vt.debug&&(Ve(e.x),Ve(e.y),Ve(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ve(e)}angle(e){return lC(this,e)}cross(e){return ac(this,this,e),this.check()}rotateX({radians:e,origin:i=Su}){return oC(this,this,i,e),this.check()}rotateY({radians:e,origin:i=Su}){return aC(this,this,i,e),this.check()}rotateZ({radians:e,origin:i=Su}){return cC(this,this,i,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return _d(this,this,e),this.check()}transformAsVector(e){return S1(this,this,e),this.check()}transformByMatrix3(e){return x1(this,this,e),this.check()}transformByMatrix2(e){return JR(this,this,e),this.check()}transformByQuaternion(e){return P1(this,this,e),this.check()}}let Oa;class md extends w1{static get ZERO(){return Oa||(Oa=new md(0,0,0,0),Object.freeze(Oa)),Oa}constructor(e=0,i=0,n=0,s=0){super(-0,-0,-0,-0),vs(e)&&arguments.length===1?this.copy(e):(Vt.debug&&(Ve(e),Ve(i),Ve(n),Ve(s)),this[0]=e,this[1]=i,this[2]=n,this[3]=s)}set(e,i,n,s){return this[0]=e,this[1]=i,this[2]=n,this[3]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Vt.debug&&(Ve(e.x),Ve(e.y),Ve(e.z),Ve(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Ve(e)}get w(){return this[3]}set w(e){this[3]=Ve(e)}transform(e){return _d(this,this,e),this.check()}transformByMatrix3(e){return A1(this,this,e),this.check()}transformByMatrix2(e){return QR(this,this,e),this.check()}transformByQuaternion(e){return P1(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class O1 extends gd{toString(){let e="[";if(Vt.printRowMajor){e+="row-major:";for(let i=0;i<this.RANK;++i)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+i]}`}else{e+="column-major:";for(let i=0;i<this.ELEMENTS;++i)e+=` ${this[i]}`}return e+="]",e}getElementIndex(e,i){return i*this.RANK+e}getElement(e,i){return this[i*this.RANK+e]}setElement(e,i,n){return this[i*this.RANK+e]=Ve(n),this}getColumn(e,i=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let s=0;s<this.RANK;++s)i[s]=this[n+s];return i}setColumn(e,i){const n=e*this.RANK;for(let s=0;s<this.RANK;++s)this[n+s]=i[s];return this}}function uC(){const t=new Ei(9);return Ei!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function hC(t,e){if(t===e){const i=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function fC(t,e){const i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,f=-u*r+a*c,d=l*r-o*c;let p=i*h+n*f+s*d;return p?(p=1/p,t[0]=h*p,t[1]=(-u*n+s*l)*p,t[2]=(a*n-s*o)*p,t[3]=f*p,t[4]=(u*i-s*c)*p,t[5]=(-a*i+s*r)*p,t[6]=d*p,t[7]=(-l*i+n*c)*p,t[8]=(o*i-n*r)*p,t):null}function dC(t){const e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],c=t[7],l=t[8];return e*(l*r-o*c)+i*(-l*s+o*a)+n*(c*s-r*a)}function jg(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=i[0],d=i[1],p=i[2],g=i[3],_=i[4],m=i[5],b=i[6],w=i[7],S=i[8];return t[0]=f*n+d*o+p*l,t[1]=f*s+d*a+p*u,t[2]=f*r+d*c+p*h,t[3]=g*n+_*o+m*l,t[4]=g*s+_*a+m*u,t[5]=g*r+_*c+m*h,t[6]=b*n+w*o+S*l,t[7]=b*s+w*a+S*u,t[8]=b*r+w*c+S*h,t}function pC(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=i[0],d=i[1];return t[0]=n,t[1]=s,t[2]=r,t[3]=o,t[4]=a,t[5]=c,t[6]=f*n+d*o+l,t[7]=f*s+d*a+u,t[8]=f*r+d*c+h,t}function gC(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=Math.sin(i),d=Math.cos(i);return t[0]=d*n+f*o,t[1]=d*s+f*a,t[2]=d*r+f*c,t[3]=d*o-f*n,t[4]=d*a-f*s,t[5]=d*c-f*r,t[6]=l,t[7]=u,t[8]=h,t}function $g(t,e,i){const n=i[0],s=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function _C(t,e){const i=e[0],n=e[1],s=e[2],r=e[3],o=i+i,a=n+n,c=s+s,l=i*o,u=n*o,h=n*a,f=s*o,d=s*a,p=s*c,g=r*o,_=r*a,m=r*c;return t[0]=1-h-p,t[3]=u-m,t[6]=f+_,t[1]=u+m,t[4]=1-l-p,t[7]=d-g,t[2]=f-_,t[5]=d+g,t[8]=1-l-h,t}var Jh;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(Jh||(Jh={}));const mC=Object.freeze([1,0,0,0,1,0,0,0,1]);class At extends O1{static get IDENTITY(){return vC()}static get ZERO(){return yC()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Jh}constructor(e,...i){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):i.length>0?this.copy([e,...i]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(mC)}fromObject(e){return this.check()}fromQuaternion(e){return _C(this,e),this.check()}set(e,i,n,s,r,o,a,c,l){return this[0]=e,this[1]=i,this[2]=n,this[3]=s,this[4]=r,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(e,i,n,s,r,o,a,c,l){return this[0]=e,this[1]=s,this[2]=a,this[3]=i,this[4]=r,this[5]=c,this[6]=n,this[7]=o,this[8]=l,this.check()}determinant(){return dC(this)}transpose(){return hC(this,this),this.check()}invert(){return fC(this,this),this.check()}multiplyLeft(e){return jg(this,e,this),this.check()}multiplyRight(e){return jg(this,this,e),this.check()}rotate(e){return gC(this,this,e),this.check()}scale(e){return Array.isArray(e)?$g(this,this,e):$g(this,this,[e,e]),this.check()}translate(e){return pC(this,this,e),this.check()}transform(e,i){let n;switch(e.length){case 2:n=KR(i||[-0,-0],e,this);break;case 3:n=x1(i||[-0,-0,-0],e,this);break;case 4:n=A1(i||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return To(n,e.length),n}transformVector(e,i){return this.transform(e,i)}transformVector2(e,i){return this.transform(e,i)}transformVector3(e,i){return this.transform(e,i)}}let ka,Na=null;function yC(){return ka||(ka=new At([0,0,0,0,0,0,0,0,0]),Object.freeze(ka)),ka}function vC(){return Na||(Na=new At,Object.freeze(Na)),Na}function bC(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wC(t,e){if(t===e){const i=e[1],n=e[2],s=e[3],r=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=r,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Qh(t,e){const i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],f=e[10],d=e[11],p=e[12],g=e[13],_=e[14],m=e[15],b=i*a-n*o,w=i*c-s*o,S=i*l-r*o,R=n*c-s*a,M=n*l-r*a,k=s*l-r*c,F=u*g-h*p,I=u*_-f*p,N=u*m-d*p,C=h*_-f*g,V=h*m-d*g,X=f*m-d*_;let K=b*X-w*V+S*C+R*N-M*I+k*F;return K?(K=1/K,t[0]=(a*X-c*V+l*C)*K,t[1]=(s*V-n*X-r*C)*K,t[2]=(g*k-_*M+m*R)*K,t[3]=(f*M-h*k-d*R)*K,t[4]=(c*N-o*X-l*I)*K,t[5]=(i*X-s*N+r*I)*K,t[6]=(_*S-p*k-m*w)*K,t[7]=(u*k-f*S+d*w)*K,t[8]=(o*V-a*N+l*F)*K,t[9]=(n*N-i*V-r*F)*K,t[10]=(p*M-g*S+m*b)*K,t[11]=(h*S-u*M-d*b)*K,t[12]=(a*I-o*C-c*F)*K,t[13]=(i*C-n*I+s*F)*K,t[14]=(g*w-p*R-_*b)*K,t[15]=(u*R-h*w+f*b)*K,t):null}function TC(t){const e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],c=t[7],l=t[8],u=t[9],h=t[10],f=t[11],d=t[12],p=t[13],g=t[14],_=t[15],m=e*o-i*r,b=e*a-n*r,w=i*a-n*o,S=l*p-u*d,R=l*g-h*d,M=u*g-h*p,k=e*M-i*R+n*S,F=r*M-o*R+a*S,I=l*w-u*b+h*m,N=d*w-p*b+g*m;return c*k-s*F+_*I-f*N}function ls(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=e[9],d=e[10],p=e[11],g=e[12],_=e[13],m=e[14],b=e[15];let w=i[0],S=i[1],R=i[2],M=i[3];return t[0]=w*n+S*a+R*h+M*g,t[1]=w*s+S*c+R*f+M*_,t[2]=w*r+S*l+R*d+M*m,t[3]=w*o+S*u+R*p+M*b,w=i[4],S=i[5],R=i[6],M=i[7],t[4]=w*n+S*a+R*h+M*g,t[5]=w*s+S*c+R*f+M*_,t[6]=w*r+S*l+R*d+M*m,t[7]=w*o+S*u+R*p+M*b,w=i[8],S=i[9],R=i[10],M=i[11],t[8]=w*n+S*a+R*h+M*g,t[9]=w*s+S*c+R*f+M*_,t[10]=w*r+S*l+R*d+M*m,t[11]=w*o+S*u+R*p+M*b,w=i[12],S=i[13],R=i[14],M=i[15],t[12]=w*n+S*a+R*h+M*g,t[13]=w*s+S*c+R*f+M*_,t[14]=w*r+S*l+R*d+M*m,t[15]=w*o+S*u+R*p+M*b,t}function Vc(t,e,i){const n=i[0],s=i[1],r=i[2];let o,a,c,l,u,h,f,d,p,g,_,m;return e===t?(t[12]=e[0]*n+e[4]*s+e[8]*r+e[12],t[13]=e[1]*n+e[5]*s+e[9]*r+e[13],t[14]=e[2]*n+e[6]*s+e[10]*r+e[14],t[15]=e[3]*n+e[7]*s+e[11]*r+e[15]):(o=e[0],a=e[1],c=e[2],l=e[3],u=e[4],h=e[5],f=e[6],d=e[7],p=e[8],g=e[9],_=e[10],m=e[11],t[0]=o,t[1]=a,t[2]=c,t[3]=l,t[4]=u,t[5]=h,t[6]=f,t[7]=d,t[8]=p,t[9]=g,t[10]=_,t[11]=m,t[12]=o*n+u*s+p*r+e[12],t[13]=a*n+h*s+g*r+e[13],t[14]=c*n+f*s+_*r+e[14],t[15]=l*n+d*s+m*r+e[15]),t}function yd(t,e,i){const n=i[0],s=i[1],r=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function EC(t,e,i,n){let s=n[0],r=n[1],o=n[2],a=Math.sqrt(s*s+r*r+o*o),c,l,u,h,f,d,p,g,_,m,b,w,S,R,M,k,F,I,N,C,V,X,K,B;return a<Eo?null:(a=1/a,s*=a,r*=a,o*=a,l=Math.sin(i),c=Math.cos(i),u=1-c,h=e[0],f=e[1],d=e[2],p=e[3],g=e[4],_=e[5],m=e[6],b=e[7],w=e[8],S=e[9],R=e[10],M=e[11],k=s*s*u+c,F=r*s*u+o*l,I=o*s*u-r*l,N=s*r*u-o*l,C=r*r*u+c,V=o*r*u+s*l,X=s*o*u+r*l,K=r*o*u-s*l,B=o*o*u+c,t[0]=h*k+g*F+w*I,t[1]=f*k+_*F+S*I,t[2]=d*k+m*F+R*I,t[3]=p*k+b*F+M*I,t[4]=h*N+g*C+w*V,t[5]=f*N+_*C+S*V,t[6]=d*N+m*C+R*V,t[7]=p*N+b*C+M*V,t[8]=h*X+g*K+w*B,t[9]=f*X+_*K+S*B,t[10]=d*X+m*K+R*B,t[11]=p*X+b*K+M*B,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function k1(t,e,i){const n=Math.sin(i),s=Math.cos(i),r=e[4],o=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*s+l*n,t[5]=o*s+u*n,t[6]=a*s+h*n,t[7]=c*s+f*n,t[8]=l*s-r*n,t[9]=u*s-o*n,t[10]=h*s-a*n,t[11]=f*s-c*n,t}function SC(t,e,i){const n=Math.sin(i),s=Math.cos(i),r=e[0],o=e[1],a=e[2],c=e[3],l=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*s-l*n,t[1]=o*s-u*n,t[2]=a*s-h*n,t[3]=c*s-f*n,t[8]=r*n+l*s,t[9]=o*n+u*s,t[10]=a*n+h*s,t[11]=c*n+f*s,t}function N1(t,e,i){const n=Math.sin(i),s=Math.cos(i),r=e[0],o=e[1],a=e[2],c=e[3],l=e[4],u=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*s+l*n,t[1]=o*s+u*n,t[2]=a*s+h*n,t[3]=c*s+f*n,t[4]=l*s-r*n,t[5]=u*s-o*n,t[6]=h*s-a*n,t[7]=f*s-c*n,t}function AC(t,e){const i=e[0],n=e[1],s=e[2],r=e[4],o=e[5],a=e[6],c=e[8],l=e[9],u=e[10];return t[0]=Math.sqrt(i*i+n*n+s*s),t[1]=Math.sqrt(r*r+o*o+a*a),t[2]=Math.sqrt(c*c+l*l+u*u),t}function RC(t,e){const i=e[0],n=e[1],s=e[2],r=e[3],o=i+i,a=n+n,c=s+s,l=i*o,u=n*o,h=n*a,f=s*o,d=s*a,p=s*c,g=r*o,_=r*a,m=r*c;return t[0]=1-h-p,t[1]=u+m,t[2]=f-_,t[3]=0,t[4]=u-m,t[5]=1-l-p,t[6]=d+g,t[7]=0,t[8]=f+_,t[9]=d-g,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function CC(t,e,i,n,s,r,o){const a=1/(i-e),c=1/(s-n),l=1/(r-o);return t[0]=r*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r*2*c,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+n)*c,t[10]=(o+r)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*r*2*l,t[15]=0,t}function xC(t,e,i,n,s){const r=1/Math.tan(e/2);if(t[0]=r/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0){const o=1/(n-s);t[10]=(s+n)*o,t[14]=2*s*n*o}else t[10]=-1,t[14]=-2*n;return t}const PC=xC;function MC(t,e,i,n,s,r,o){const a=1/(e-i),c=1/(n-s),l=1/(r-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+i)*a,t[13]=(s+n)*c,t[14]=(o+r)*l,t[15]=1,t}const IC=MC;function OC(t,e,i,n){let s,r,o,a,c,l,u,h,f,d;const p=e[0],g=e[1],_=e[2],m=n[0],b=n[1],w=n[2],S=i[0],R=i[1],M=i[2];return Math.abs(p-S)<Eo&&Math.abs(g-R)<Eo&&Math.abs(_-M)<Eo?bC(t):(h=p-S,f=g-R,d=_-M,s=1/Math.sqrt(h*h+f*f+d*d),h*=s,f*=s,d*=s,r=b*d-w*f,o=w*h-m*d,a=m*f-b*h,s=Math.sqrt(r*r+o*o+a*a),s?(s=1/s,r*=s,o*=s,a*=s):(r=0,o=0,a=0),c=f*a-d*o,l=d*r-h*a,u=h*o-f*r,s=Math.sqrt(c*c+l*l+u*u),s?(s=1/s,c*=s,l*=s,u*=s):(c=0,l=0,u=0),t[0]=r,t[1]=c,t[2]=h,t[3]=0,t[4]=o,t[5]=l,t[6]=f,t[7]=0,t[8]=a,t[9]=u,t[10]=d,t[11]=0,t[12]=-(r*p+o*g+a*_),t[13]=-(c*p+l*g+u*_),t[14]=-(h*p+f*g+d*_),t[15]=1,t)}function kC(){const t=new Ei(4);return Ei!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function NC(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function vd(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function DC(t){const e=t[0],i=t[1],n=t[2],s=t[3];return Math.sqrt(e*e+i*i+n*n+s*s)}function FC(t){const e=t[0],i=t[1],n=t[2],s=t[3];return e*e+i*i+n*n+s*s}function LC(t,e){const i=e[0],n=e[1],s=e[2],r=e[3];let o=i*i+n*n+s*s+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=i*o,t[1]=n*o,t[2]=s*o,t[3]=r*o,t}function BC(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function UC(t,e,i,n){const s=e[0],r=e[1],o=e[2],a=e[3];return t[0]=s+n*(i[0]-s),t[1]=r+n*(i[1]-r),t[2]=o+n*(i[2]-o),t[3]=a+n*(i[3]-a),t}function Nr(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3];return t[0]=i[0]*n+i[4]*s+i[8]*r+i[12]*o,t[1]=i[1]*n+i[5]*s+i[9]*r+i[13]*o,t[2]=i[2]*n+i[6]*s+i[10]*r+i[14]*o,t[3]=i[3]*n+i[7]*s+i[11]*r+i[15]*o,t}function zC(t,e,i){const n=e[0],s=e[1],r=e[2],o=i[0],a=i[1],c=i[2],l=i[3],u=l*n+a*r-c*s,h=l*s+c*n-o*r,f=l*r+o*s-a*n,d=-o*n-a*s-c*r;return t[0]=u*l+d*-o+h*-c-f*-a,t[1]=h*l+d*-a+f*-o-u*-c,t[2]=f*l+d*-c+u*-a-h*-o,t[3]=e[3],t}(function(){const t=kC();return function(e,i,n,s,r,o){let a,c;for(i||(i=4),n||(n=0),s?c=Math.min(s*i+n,e.length):c=e.length,a=n;a<c;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],r(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var ef;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(ef||(ef={}));const VC=45*Math.PI/180,jC=1,Au=.1,Ru=500,$C=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Rt extends O1{static get IDENTITY(){return WC()}static get ZERO(){return HC()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return ef}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,i,n,s,r,o,a,c,l,u,h,f,d,p,g,_){return this[0]=e,this[1]=i,this[2]=n,this[3]=s,this[4]=r,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=u,this[10]=h,this[11]=f,this[12]=d,this[13]=p,this[14]=g,this[15]=_,this.check()}setRowMajor(e,i,n,s,r,o,a,c,l,u,h,f,d,p,g,_){return this[0]=e,this[1]=r,this[2]=l,this[3]=d,this[4]=i,this[5]=o,this[6]=u,this[7]=p,this[8]=n,this[9]=a,this[10]=h,this[11]=g,this[12]=s,this[13]=c,this[14]=f,this[15]=_,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy($C)}fromObject(e){return this.check()}fromQuaternion(e){return RC(this,e),this.check()}frustum(e){const{left:i,right:n,bottom:s,top:r,near:o=Au,far:a=Ru}=e;return a===1/0?XC(this,i,n,s,r,o):CC(this,i,n,s,r,o,a),this.check()}lookAt(e){const{eye:i,center:n=[0,0,0],up:s=[0,1,0]}=e;return OC(this,i,n,s),this.check()}ortho(e){const{left:i,right:n,bottom:s,top:r,near:o=Au,far:a=Ru}=e;return IC(this,i,n,s,r,o,a),this.check()}orthographic(e){const{fovy:i=VC,aspect:n=jC,focalDistance:s=1,near:r=Au,far:o=Ru}=e;Hg(i);const a=i/2,c=s*Math.tan(a),l=c*n;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:r,far:o})}perspective(e){const{fovy:i=45*Math.PI/180,aspect:n=1,near:s=.1,far:r=500}=e;return Hg(i),PC(this,i,n,s,r),this.check()}determinant(){return TC(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),s=1/n[0],r=1/n[1],o=1/n[2];return e[0]=this[0]*s,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*r,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*r,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),s=1/n[0],r=1/n[1],o=1/n[2];return e[0]=this[0]*s,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=this[4]*s,e[4]=this[5]*r,e[5]=this[6]*o,e[6]=this[8]*s,e[7]=this[9]*r,e[8]=this[10]*o,e}transpose(){return wC(this,this),this.check()}invert(){return Qh(this,this),this.check()}multiplyLeft(e){return ls(this,e,this),this.check()}multiplyRight(e){return ls(this,this,e),this.check()}rotateX(e){return k1(this,this,e),this.check()}rotateY(e){return SC(this,this,e),this.check()}rotateZ(e){return N1(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,i){return EC(this,this,e,i),this.check()}scale(e){return yd(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Vc(this,this,e),this.check()}transform(e,i){return e.length===4?(i=Nr(i||[-0,-0,-0,-0],e,this),To(i,4),i):this.transformAsPoint(e,i)}transformAsPoint(e,i){const{length:n}=e;let s;switch(n){case 2:s=ZR(i||[-0,-0],e,this);break;case 3:s=_d(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return To(s,e.length),s}transformAsVector(e,i){let n;switch(e.length){case 2:n=GR(i||[-0,-0],e,this);break;case 3:n=S1(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return To(n,e.length),n}transformPoint(e,i){return this.transformAsPoint(e,i)}transformVector(e,i){return this.transformAsPoint(e,i)}transformDirection(e,i){return this.transformAsVector(e,i)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,i,n){return this.identity().translate([e,i,n])}}let Da,Fa;function HC(){return Da||(Da=new Rt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Da)),Da}function WC(){return Fa||(Fa=new Rt,Object.freeze(Fa)),Fa}function Hg(t){if(t>Math.PI*2)throw Error("expected radians")}function XC(t,e,i,n,s,r){const o=2*r/(i-e),a=2*r/(s-n),c=(i+e)/(i-e),l=(s+n)/(s-n),u=-1,h=-1,f=-2*r;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=c,t[9]=l,t[10]=u,t[11]=h,t[12]=0,t[13]=0,t[14]=f,t[15]=0,t}function Wg(){const t=new Ei(4);return Ei!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function qC(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function D1(t,e,i){i=i*.5;const n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function Xg(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3],a=i[0],c=i[1],l=i[2],u=i[3];return t[0]=n*u+o*a+s*l-r*c,t[1]=s*u+o*c+r*a-n*l,t[2]=r*u+o*l+n*c-s*a,t[3]=o*u-n*a-s*c-r*l,t}function YC(t,e,i){i*=.5;const n=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(i),c=Math.cos(i);return t[0]=n*c+o*a,t[1]=s*c+r*a,t[2]=r*c-s*a,t[3]=o*c-n*a,t}function KC(t,e,i){i*=.5;const n=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(i),c=Math.cos(i);return t[0]=n*c-r*a,t[1]=s*c+o*a,t[2]=r*c+n*a,t[3]=o*c-s*a,t}function ZC(t,e,i){i*=.5;const n=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(i),c=Math.cos(i);return t[0]=n*c+s*a,t[1]=s*c-n*a,t[2]=r*c+o*a,t[3]=o*c-r*a,t}function GC(t,e){const i=e[0],n=e[1],s=e[2];return t[0]=i,t[1]=n,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-s*s)),t}function cc(t,e,i,n){const s=e[0],r=e[1],o=e[2],a=e[3];let c=i[0],l=i[1],u=i[2],h=i[3],f,d,p,g,_;return f=s*c+r*l+o*u+a*h,f<0&&(f=-f,c=-c,l=-l,u=-u,h=-h),1-f>Eo?(d=Math.acos(f),_=Math.sin(d),p=Math.sin((1-n)*d)/_,g=Math.sin(n*d)/_):(p=1-n,g=n),t[0]=p*s+g*c,t[1]=p*r+g*l,t[2]=p*o+g*u,t[3]=p*a+g*h,t}function JC(t,e){const i=e[0],n=e[1],s=e[2],r=e[3],o=i*i+n*n+s*s+r*r,a=o?1/o:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-s*a,t[3]=r*a,t}function QC(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function F1(t,e){const i=e[0]+e[4]+e[8];let n;if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);const r=(s+1)%3,o=(s+2)%3;n=Math.sqrt(e[s*3+s]-e[r*3+r]-e[o*3+o]+1),t[s]=.5*n,n=.5/n,t[3]=(e[r*3+o]-e[o*3+r])*n,t[r]=(e[r*3+s]+e[s*3+r])*n,t[o]=(e[o*3+s]+e[s*3+o])*n}return t}const ex=NC,tx=vd,ix=BC,nx=UC,sx=DC,rx=FC,L1=LC,ox=function(){const t=R1(),e=Vg(1,0,0),i=Vg(0,1,0);return function(n,s,r){const o=C1(s,r);return o<-.999999?(ac(t,e,s),I1(t)<1e-6&&ac(t,i,s),sC(t,t),D1(n,t,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(ac(t,s,r),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+o,L1(n,n))}}();(function(){const t=Wg(),e=Wg();return function(i,n,s,r,o,a){return cc(t,n,o,a),cc(e,s,r,a),cc(i,t,e,2*a*(1-a)),i}})();(function(){const t=uC();return function(e,i,n,s){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],L1(e,F1(e,t))}})();const ax=[0,0,0,1];class qg extends gd{constructor(e=0,i=0,n=0,s=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,i,n,s)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,i,n,s){return this[0]=e,this[1]=i,this[2]=n,this[3]=s,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return F1(this,e),this.check()}fromAxisRotation(e,i){return D1(this,e,i),this.check()}identity(){return qC(this),this.check()}setAxisAngle(e,i){return this.fromAxisRotation(e,i)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Ve(e)}get y(){return this[1]}set y(e){this[1]=Ve(e)}get z(){return this[2]}set z(e){this[2]=Ve(e)}get w(){return this[3]}set w(e){this[3]=Ve(e)}len(){return sx(this)}lengthSquared(){return rx(this)}dot(e){return ix(this,e)}rotationTo(e,i){return ox(this,e,i),this.check()}add(e){return ex(this,this,e),this.check()}calculateW(){return GC(this,this),this.check()}conjugate(){return QC(this,this),this.check()}invert(){return JC(this,this),this.check()}lerp(e,i,n){return n===void 0?this.lerp(this,e,i):(nx(this,e,i,n),this.check())}multiplyRight(e){return Xg(this,this,e),this.check()}multiplyLeft(e){return Xg(this,e,this),this.check()}normalize(){const e=this.len(),i=e>0?1/e:0;return this[0]=this[0]*i,this[1]=this[1]*i,this[2]=this[2]*i,this[3]=this[3]*i,e===0&&(this[3]=1),this.check()}rotateX(e){return YC(this,this,e),this.check()}rotateY(e){return KC(this,this,e),this.check()}rotateZ(e){return ZC(this,this,e),this.check()}scale(e){return tx(this,this,e),this.check()}slerp(e,i,n){let s,r,o;switch(arguments.length){case 1:({start:s=ax,target:r,ratio:o}=e);break;case 2:s=this,r=e,o=i;break;default:s=e,r=i,o=n}return cc(this,s,r,o),this.check()}transformVector4(e,i=new md){return zC(i,e,this),To(i,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,i){return this.setAxisAngle(e,i)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const cx=1e-15,lx=1e-20,Yg=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,ux={lightSources:{}};function Cu(t={}){const{color:e=[0,0,0],intensity:i=1}=t;return e.map(n=>n*i/255)}function hx({ambientLight:t,pointLights:e=[],directionalLights:i=[]}){const n={};return t?n["lighting_uAmbientLight.color"]=Cu(t):n["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((s,r)=>{n[`lighting_uPointLight[${r}].color`]=Cu(s),n[`lighting_uPointLight[${r}].position`]=s.position,n[`lighting_uPointLight[${r}].attenuation`]=s.attenuation||[1,0,0]}),n.lighting_uPointLightCount=e.length,i.forEach((s,r)=>{n[`lighting_uDirectionalLight[${r}].color`]=Cu(s),n[`lighting_uDirectionalLight[${r}].direction`]=s.direction}),n.lighting_uDirectionalLightCount=i.length,n}function B1(t=ux){var e,i;if("lightSources"in t){const{ambientLight:n,pointLights:s,directionalLights:r}=t.lightSources||{};return n||s&&s.length>0||r&&r.length>0?Object.assign({},hx({ambientLight:n,pointLights:s,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const n={pointLights:[],directionalLights:[]};for(const s of t.lights||[])switch(s.type){case"ambient":n.ambientLight=s;break;case"directional":(e=n.directionalLights)==null||e.push(s);break;case"point":(i=n.pointLights)==null||i.push(s);break}return B1({lightSources:n})}return{}}const fx={name:"lights",vs:Yg,fs:Yg,getUniforms:B1,defines:{MAX_LIGHTS:3}},dx=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,px={};function gx(t){const{ambient:e=.35,diffuse:i=.6,shininess:n=32,specularColor:s=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:n,lighting_uSpecularColor:s.map(r=>r/255)}}function _x(t=px){if(!("material"in t))return{};const{material:e}=t;return e?gx(e):{lighting_uEnabled:!1}}const mx={name:"gouraud-lighting",dependencies:[fx],vs:dx,defines:{LIGHTING_VERTEX:1},getUniforms:_x},U1="#define SMOOTH_EDGE_RADIUS 0.5",yx=`
${U1}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,vx=`
${U1}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,bx={name:"geometry",vs:yx,fs:vx},Ee={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ee,"IDENTITY",{get:()=>(ve.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const vi={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},bs={common:0,meters:1,pixels:2},tf={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},wx=Object.keys(Ee).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Ee[t]};`).join(""),Tx=Object.keys(vi).map(t=>`const int PROJECTION_MODE_${t} = ${vi[t]};`).join(""),Ex=Object.keys(bs).map(t=>`const int UNIT_${t.toUpperCase()} = ${bs[t]};`).join(""),Sx=`${wx}
${Tx}
${Ex}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function Ax(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}return!1}function ra(t){let e={},i;return n=>{for(const s in n)if(!Ax(n[s],e[s])){i=t(n),e=n;break}return i}}const Kg=[0,0,0,0],Rx=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],z1=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Cx=[0,0,0],V1=[0,0,0],xx=ra(Ix);function j1(t,e,i=V1){i.length<3&&(i=[i[0],i[1],0]);let n=i,s,r=!0;switch(e===Ee.LNGLAT_OFFSETS||e===Ee.METER_OFFSETS?s=i:s=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case vi.WEB_MERCATOR:(e===Ee.LNGLAT||e===Ee.CARTESIAN)&&(s=[0,0,0],r=!1);break;case vi.WEB_MERCATOR_AUTO_OFFSET:e===Ee.LNGLAT?n=s:e===Ee.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],s=t.unprojectPosition(n),n[0]-=i[0],n[1]-=i[1],n[2]-=i[2]);break;case vi.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case vi.GLOBE:r=!1,s=null;break;default:r=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:n,offsetMode:r}}function Px(t,e,i){const{viewMatrixUncentered:n,projectionMatrix:s}=t;let{viewMatrix:r,viewProjectionMatrix:o}=t,a=Kg,c=Kg,l=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:f}=j1(t,e,i);return f&&(c=t.projectPosition(u||h),l=[l[0]-c[0],l[1]-c[1],l[2]-c[2]],c[3]=1,a=Nr([],c,o),r=n||r,o=ls([],s,r),o=ls([],o,Rx)),{viewMatrix:r,viewProjectionMatrix:o,projectionCenter:a,originCommon:c,cameraPosCommon:l,shaderCoordinateOrigin:h,geospatialOrigin:u}}function Mx({viewport:t,devicePixelRatio:e=1,modelMatrix:i=null,coordinateSystem:n=Ee.DEFAULT,coordinateOrigin:s=V1,autoWrapLongitude:r=!1}){n===Ee.DEFAULT&&(n=t.isGeospatial?Ee.LNGLAT:Ee.CARTESIAN);const o=xx({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:s});return o.project_uWrapLongitude=r,o.project_uModelMatrix=i||z1,o}function Ix({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:n}){const{projectionCenter:s,viewProjectionMatrix:r,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:c,geospatialOrigin:l}=Px(t,i,n),u=t.getDistanceScales(),h=[t.width*e,t.height*e],f=Nr([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,d={project_uCoordinateSystem:i,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:c,project_uCommonOrigin:o.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:h,project_uDevicePixelRatio:e,project_uFocalDistance:f,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:Cx,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:r,project_uModelMatrix:z1,project_uCameraPosition:a};if(l){const p=t.getDistanceScales(l);switch(i){case Ee.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=p.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case Ee.LNGLAT:case Ee.LNGLAT_OFFSETS:t._pseudoMeters||(d.project_uCommonUnitsPerMeter=p.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=p.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case Ee.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break}}return d}const Ox={};function kx(t=Ox){return"viewport"in t?Mx(t):{}}const bd={name:"project",dependencies:[LR,bx],vs:Sx,getUniforms:kx},Nx=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Dr={name:"project32",dependencies:[bd],vs:Nx};function Dx(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function hr(t,e){const i=Nr([],e,t);return vd(i,i,1/i[3]),i}function Zg(t,e){const i=t%e;return i<0?e+i:i}function nf(t,e,i){return t<e?e:t>i?i:t}function Fx(t){return Math.log(t)*Math.LOG2E}const wd=Math.log2||Fx;function Gi(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const bi=Math.PI,$1=bi/4,li=bi/180,sf=180/bi,Ar=512,jc=4003e4,La=85.051129,Lx=1.5;function Bx(t){return wd(t)}function Cn(t){const[e,i]=t;Gi(Number.isFinite(e)),Gi(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const n=e*li,s=i*li,r=Ar*(n+bi)/(2*bi),o=Ar*(bi+Math.log(Math.tan($1+s*.5)))/(2*bi);return[r,o]}function Rr(t){const[e,i]=t,n=e/Ar*(2*bi)-bi,s=2*(Math.atan(Math.exp(i/Ar*(2*bi)-bi))-$1);return[n*sf,s*sf]}function Ux(t){const{latitude:e}=t;Gi(Number.isFinite(e));const i=Math.cos(e*li);return Bx(jc*i)-9}function xu(t){const e=Math.cos(t*li);return Ar/jc/e}function rf(t){const{latitude:e,longitude:i,highPrecision:n=!1}=t;Gi(Number.isFinite(e)&&Number.isFinite(i));const s=Ar,r=Math.cos(e*li),o=s/360,a=o/r,c=s/jc/r,l={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[o,a,c],degreesPerUnit:[1/o,1/a,1/c]};if(n){const u=li*Math.tan(e*li)/r,h=o*u/2,f=s/jc*u,d=f/a*c;l.unitsPerDegree2=[0,h,f],l.unitsPerMeter2=[d,0,d]}return l}function H1(t,e){const[i,n,s]=t,[r,o,a]=e,{unitsPerMeter:c,unitsPerMeter2:l}=rf({longitude:i,latitude:n,highPrecision:!0}),u=Cn(t);u[0]+=r*(c[0]+l[0]*o),u[1]+=o*(c[1]+l[1]*o);const h=Rr(u),f=(s||0)+(a||0);return Number.isFinite(s)||Number.isFinite(a)?[h[0],h[1],f]:h}function zx(t){const{height:e,pitch:i,bearing:n,altitude:s,scale:r,center:o}=t,a=Dx();Vc(a,a,[0,0,-s]),k1(a,a,-i*li),N1(a,a,n*li);const c=r/e;return yd(a,a,[c,c,c]),o&&Vc(a,a,nC([],o)),a}function Vx(t){const{width:e,height:i,altitude:n,pitch:s=0,offset:r,center:o,scale:a,nearZMultiplier:c=1,farZMultiplier:l=1}=t;let{fovy:u=$c(Lx)}=t;n!==void 0&&(u=$c(n));const h=u*li,f=s*li,d=W1(u);let p=d;o&&(p+=o[2]*a/Math.cos(f)/i);const g=h*(.5+(r?r[1]:0)/i),_=Math.sin(g)*p/Math.sin(nf(Math.PI/2-f-g,.01,Math.PI-.01)),m=Math.sin(f)*_+p,b=p*10,w=Math.min(m*l,b);return{fov:h,aspect:e/i,focalDistance:d,near:c,far:w}}function $c(t){return 2*Math.atan(.5/t)*sf}function W1(t){return .5/Math.tan(.5*t*li)}function X1(t,e){const[i,n,s=0]=t;return Gi(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(s)),hr(e,[i,n,s,1])}function Vl(t,e,i=0){const[n,s,r]=t;if(Gi(Number.isFinite(n)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(r))return hr(e,[n,s,r,1]);const o=hr(e,[n,s,0,1]),a=hr(e,[n,s,1,1]),c=o[2],l=a[2],u=c===l?0:((i||0)-c)/(l-c);return E1([],o,a,u)}function jx(t){const{width:e,height:i,bounds:n,minExtent:s=0,maxZoom:r=24,offset:o=[0,0]}=t,[[a,c],[l,u]]=n,h=$x(t.padding),f=Cn([a,nf(u,-La,La)]),d=Cn([l,nf(c,-La,La)]),p=[Math.max(Math.abs(d[0]-f[0]),s),Math.max(Math.abs(d[1]-f[1]),s)],g=[e-h.left-h.right-Math.abs(o[0])*2,i-h.top-h.bottom-Math.abs(o[1])*2];Gi(g[0]>0&&g[1]>0);const _=g[0]/p[0],m=g[1]/p[1],b=(h.right-h.left)/2/_,w=(h.top-h.bottom)/2/m,S=[(d[0]+f[0])/2+b,(d[1]+f[1])/2+w],R=Rr(S),M=Math.min(r,wd(Math.abs(Math.min(_,m))));return Gi(Number.isFinite(M)),{longitude:R[0],latitude:R[1],zoom:M}}function $x(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Gi(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const Gg=Math.PI/180;function Hx(t,e=0){const{width:i,height:n,unproject:s}=t,r={targetZ:e},o=s([0,n],r),a=s([i,n],r);let c,l;const u=t.fovy?.5*t.fovy*Gg:Math.atan(.5/t.altitude),h=(90-t.pitch)*Gg;return u>h-.01?(c=Jg(t,0,e),l=Jg(t,i,e)):(c=s([0,0],r),l=s([i,0],r)),[o,a,l,c]}function Jg(t,e,i){const{pixelUnprojectionMatrix:n}=t,s=hr(n,[e,0,1,1]),r=hr(n,[e,t.height,1,1]),a=(i*t.distanceScales.unitsPerMeter[2]-s[2])/(r[2]-s[2]),c=E1([],s,r,a),l=Rr(c);return l.push(i),l}const Qg=512;function Wx(t){const{width:e,height:i,pitch:n=0}=t;let{longitude:s,latitude:r,zoom:o,bearing:a=0}=t;(s<-180||s>180)&&(s=Zg(s+180,360)-180),(a<-180||a>180)&&(a=Zg(a+180,360)-180);const c=wd(i/Qg);if(o<=c)o=c,r=0;else{const l=i/2/Math.pow(2,o),u=Rr([0,l])[1];if(r<u)r=u;else{const h=Rr([0,Qg-l])[1];r>h&&(r=h)}}return{width:e,height:i,longitude:s,latitude:r,zoom:o,pitch:n,bearing:a}}const Xx=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,qx=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Yx=ra(Qx),Kx=ra(eP),Zx=[0,0,0,1],Gx=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Jx(t,e){const[i,n,s]=t,r=Vl([i,n,s],e);return Number.isFinite(s)?r:[r[0],r[1],0]}function Qx({viewport:t,center:e}){return new Rt(t.viewProjectionMatrix).invert().transform(e)}function eP({viewport:t,shadowMatrices:e}){const i=[],n=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,r=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>Jx(o,n));for(const o of e){const a=o.clone().translate(new ee(t.center).negate()),c=r.map(u=>a.transform(u)),l=new Rt().ortho({left:Math.min(...c.map(u=>u[0])),right:Math.max(...c.map(u=>u[0])),bottom:Math.min(...c.map(u=>u[1])),top:Math.max(...c.map(u=>u[1])),near:Math.min(...c.map(u=>-u[2])),far:Math.max(...c.map(u=>-u[2]))});i.push(l.multiplyRight(o))}return i}function tP(t,e){const{shadowEnabled:i=!0}=t;if(!i||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const n={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||Zx,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},s=Yx({viewport:t.viewport,center:e.project_uCenter}),r=[],o=Kx({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const c=o[a],l=c.clone().translate(new ee(t.viewport.center).negate());e.project_uCoordinateSystem===Ee.LNGLAT&&e.project_uProjectionMode===vi.WEB_MERCATOR?(o[a]=l,r[a]=s):(o[a]=c.clone().multiplyRight(Gx),r[a]=l.transform(s))}for(let a=0;a<o.length;a++)n[`shadow_uViewProjectionMatrices[${a}]`]=o[a],n[`shadow_uProjectCenters[${a}]`]=r[a];for(let a=0;a<2;a++)n[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return n}const e_={name:"shadow",dependencies:[bd],vs:Xx,fs:qx,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?tP(t,e):{}},Fr={...zg,defaultUniforms:{...zg.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},iP=[bd],nP=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function sP(){const t=kc.getDefaultShaderAssembler();for(const e of iP)t.addDefaultModule(e);for(const e of nP)t.addShaderHook(e);return t}const rP=[255,255,255],oP=1;let aP=0;class cP{constructor(e={}){this.type="ambient";const{color:i=rP}=e,{intensity:n=oP}=e;this.id=e.id||`ambient-${aP++}`,this.color=i,this.intensity=n}}const lP=[255,255,255],uP=1,hP=[0,0,-1];let fP=0;class t_{constructor(e={}){this.type="directional";const{color:i=lP}=e,{intensity:n=uP}=e,{direction:s=hP}=e,{_shadow:r=!1}=e;this.id=e.id||`directional-${fP++}`,this.color=i,this.intensity=n,this.type="directional",this.direction=new ee(s).normalize().toArray(),this.shadow=r}getProjectedLight(e){return this}}class dP{constructor(e,i={id:"pass"}){const{id:n}=i;this.id=n,this.device=e,this.props={...i}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Td extends dP{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[i,n]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,r=e.clearColor??(s?[0,0,0,0]:!1),o=s?1:!1,a=e.colorMask??15,c={viewport:[0,0,i,n]};e.colorMask&&(c.colorMask=a),e.scissorRect&&(c.scissorRect=e.scissorRect);const l=this.device.beginRenderPass({framebuffer:e.target,parameters:c,clearColor:r,clearDepth:o});try{return this._drawLayers(l,e)}finally{l.end()}}_drawLayers(e,i){const{target:n,moduleParameters:s,viewports:r,views:o,onViewportActive:a,clearStack:c=!0}=i;i.pass=i.pass||"unknown",c&&(this._lastRenderIndex=-1);const l=[];for(const u of r){const h=o&&o[u.id];a==null||a(u);const f=this._getDrawLayerParams(u,i),d=u.subViewports||[u];for(const p of d){const g=this._drawLayersInViewport(e,{target:n,moduleParameters:s,viewport:p,view:h,pass:i.pass,layers:i.layers},f);l.push(g)}}return l}_getDrawLayerParams(e,{layers:i,pass:n,isPicking:s=!1,layerFilter:r,cullRect:o,effects:a,moduleParameters:c},l=!1){var p;const u=[],h=q1(this._lastRenderIndex+1),f={layer:i[0],viewport:e,isPicking:s,renderPass:n,cullRect:o},d={};for(let g=0;g<i.length;g++){const _=i[g],m=this._shouldDrawLayer(_,f,r,d),b={shouldDrawLayer:m};m&&!l&&(b.layerRenderIndex=h(_,m),b.moduleParameters=this._getModuleParameters(_,a,n,c),b.layerParameters={...(p=_.context.deck)==null?void 0:p.props.parameters,...this.getLayerParameters(_,g,e)}),u[g]=b}return u}_drawLayersInViewport(e,{layers:i,moduleParameters:n,pass:s,target:r,viewport:o,view:a},c){const l=pP(this.device,{moduleParameters:n,target:r,viewport:o});if(a&&a.props.clear){const h=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:l},()=>this.device.clearWebGL(h))}const u={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let h=0;h<i.length;h++){const f=i[h],{shouldDrawLayer:d,layerRenderIndex:p,moduleParameters:g,layerParameters:_}=c[h];if(d&&f.props.pickable&&u.pickableCount++,f.isComposite)u.compositeCount++;else if(d){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,p),g.viewport=o,f.context.renderPass=e;try{f._drawLayer({renderPass:e,moduleParameters:g,uniforms:{layerIndex:p},parameters:_})}catch(m){f.raiseError(m,`drawing ${f} to ${s}`)}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,i){return null}getLayerParameters(e,i,n){return e.props.parameters}_shouldDrawLayer(e,i,n,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;i.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(i))return!1;i.layer=o,o=o.parent}if(n){const a=i.layer.id;if(a in s||(s[a]=n(i)),!s[a])return!1}return e.activateViewport(i.viewport),!0}_getModuleParameters(e,i,n,s){var a,c;const r=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:r});if(i)for(const l of i)Object.assign(o,(c=l.getModuleParameters)==null?void 0:c.call(l,e));return Object.assign(o,this.getModuleParameters(e,i),s)}}function q1(t=0,e={}){const i={},n=(s,r)=>{const o=s.props._offset,a=s.id,c=s.parent&&s.parent.id;let l;if(c&&!(c in e)&&n(s.parent,!1),c in i){const u=i[c]=i[c]||q1(e[c],e);l=u(s,r),i[a]=u}else Number.isFinite(o)?(l=o+(e[c]||0),i[a]=null):l=t;return r&&l>=t&&(t=l+1),e[a]=l,l};return n}function pP(t,{moduleParameters:e,target:i,viewport:n}){const s=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,r]=t.canvasContext.getDrawingBufferSize(),o=i?i.height:r,a=n;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}class gP extends Td{constructor(e,i){super(e,i),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const i=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],r=s.width*n,o=s.height*n,a=[1,1,1,1];(r!==i.width||o!==i.height)&&i.resize({width:r,height:o}),super.render({...e,clearColor:a,target:i,pass:"shadow"})}getLayerParameters(e,i,n){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const _P={color:[255,255,255],intensity:1},i_=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],mP=[0,0,0,200/255];class Y1{constructor(e={}){this.id="lighting-effect",this.shadowColor=mP,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:i,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(i),n._addDefaultShaderModule(e_),this.dummyShadowMap=i.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const i in e){const n=e[i];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:i,viewports:n,onViewportActive:s,views:r}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:i,viewports:n,onViewportActive:s,views:r,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const i=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return i.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(n=>n.getProjectedLight({layer:e})),pointLights:this.pointLights.map(n=>n.getProjectedLight({layer:e}))},i}cleanup(e){for(const i of this.shadowPasses)i.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(e_))}_calculateMatrices(){const e=[];for(const i of this.directionalLights){const n=new Rt().lookAt({eye:new ee(i.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let i=0;i<this.directionalLights.length;i++){const n=new gP(e);this.shadowPasses[i]=n,this.shadowMaps[i]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:i,directionalLights:n}=this;!e&&i.length===0&&n.length===0&&(this.ambientLight=new cP(_P),this.directionalLights.push(new t_(i_[0]),new t_(i_[1])))}}class yP{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,i,{size:n=1,type:s,padding:r=0,copy:o=!1,initialize:a=!1,maxCount:c}){const l=s||e&&e.constructor||Float32Array,u=i*n+r;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,u)}let h=1/0;c&&(h=c*n+r);const f=this._allocate(l,u,a,h);return e&&o?f.set(e):a||f.fill(0,0,4),this._release(e),f}release(e){this._release(e)}_allocate(e,i,n,s){let r=Math.max(Math.ceil(i*this.opts.overAlloc),1);r>s&&(r=s);const o=this._pool,a=e.BYTES_PER_ELEMENT*r,c=o.findIndex(l=>l.byteLength>=a);if(c>=0){const l=new e(o.splice(c,1)[0],0,r);return n&&l.fill(0),l}return new e(r)}_release(e){if(!ArrayBuffer.isView(e))return;const i=this._pool,{buffer:n}=e,{byteLength:s}=n,r=i.findIndex(o=>o.byteLength>=s);r<0?i.push(n):(r>0||i.length<this.opts.poolSize)&&i.splice(r,0,n),i.length>this.opts.poolSize&&i.shift()}}const Cr=new yP;function fo(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function vP(t,e){const i=t%e;return i<0?e+i:i}function bP(t){return[t[12],t[13],t[14]]}function wP(t){return{left:Vs(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Vs(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Vs(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Vs(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Vs(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Vs(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const n_=new ee;function Vs(t,e,i,n){n_.set(t,e,i);const s=n_.len();return{distance:n/s,normal:new ee(-t/s,-e/s,-i/s)}}function TP(t){return t-Math.fround(t)}let Zr;function Pu(t,e){const{size:i=1,startIndex:n=0}=e,s=e.endIndex!==void 0?e.endIndex:t.length,r=(s-n)/i;Zr=Cr.allocate(Zr,r,{type:Float32Array,size:i*2});let o=n,a=0;for(;o<s;){for(let c=0;c<i;c++){const l=t[o++];Zr[a+c]=l,Zr[a+c+i]=TP(l)}a+=i*2}return Zr.subarray(0,r*i*2)}function EP(t){let e=null,i=!1;for(const n of t)n&&(e?(i||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],i=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const SP=Math.PI/180,AP=fo(),s_=[0,0,0],RP={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function CP({width:t,height:e,orthographic:i,fovyRadians:n,focalDistance:s,padding:r,near:o,far:a}){const c=t/e,l=i?new Rt().orthographic({fovy:n,aspect:c,focalDistance:s,near:o,far:a}):new Rt().perspective({fovy:n,aspect:c,near:o,far:a});if(r){const{left:u=0,right:h=0,top:f=0,bottom:d=0}=r,p=vt((u+t-h)/2,0,t)-t/2,g=vt((f+e-d)/2,0,e)-e/2;l[8]-=p*2/t,l[9]+=g*2/e}return l}const _l=class _l{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||RP,this.focalDistance=e.focalDistance||1,this.position=e.position||s_,this.modelMatrix=e.modelMatrix||null;const{longitude:i,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(i),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?vi.WEB_MERCATOR:vi.WEB_MERCATOR_AUTO_OFFSET:vi.IDENTITY}equals(e){return e instanceof _l?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Zi(e.projectionMatrix,this.projectionMatrix)&&Zi(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:i=!0}={}){const n=this.projectPosition(e),s=X1(n,this.pixelProjectionMatrix),[r,o]=s,a=i?o:this.height-o;return e.length===2?[r,a]:[r,a,s[2]]}unproject(e,{topLeft:i=!0,targetZ:n}={}){const[s,r,o]=e,a=i?r:this.height-r,c=n&&n*this.distanceScales.unitsPerMeter[2],l=Vl([s,a,o],this.pixelUnprojectionMatrix,c),[u,h,f]=this.unprojectPosition(l);return Number.isFinite(o)?[u,h,f]:Number.isFinite(n)?[u,h,n]:[u,h]}projectPosition(e){const[i,n]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,n,s]}unprojectPosition(e){const[i,n]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[i,n,s]}projectFlat(e){if(this.isGeospatial){const i=Cn(e);return i[1]=vt(i[1],-318,830),i}return e}unprojectFlat(e){return this.isGeospatial?Rr(e):e}getBounds(e={}){const i={targetZ:e.z||0},n=this.unproject([0,0],i),s=this.unproject([this.width,0],i),r=this.unproject([0,this.height],i),o=this.unproject([this.width,this.height],i);return[Math.min(n[0],s[0],r[0],o[0]),Math.min(n[1],s[1],r[1],o[1]),Math.max(n[0],s[0],r[0],o[0]),Math.max(n[1],s[1],r[1],o[1])]}getDistanceScales(e){return e?rf({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:i,width:n=1,height:s=1}){return e<this.x+this.width&&this.x<e+n&&i<this.y+this.height&&this.y<i+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,wP(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,i){return null}_initProps(e){const i=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=Ux({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||rf({latitude:n,longitude:i}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:r,modelMatrix:o}=e;let a=s_;if(r&&(a=o?new Rt(o).transformAsVector(r,[]):r),this.isGeospatial){const c=this.projectPosition([i,n,0]);this.center=new ee(a).scale(this.distanceScales.unitsPerMeter).add(c)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:i=AP,projectionMatrix:n=null,orthographic:s=!1,fovyRadians:r,fovy:o=75,near:a=.1,far:c=1e3,padding:l=null,focalDistance:u=1}=e;this.viewMatrixUncentered=i,this.viewMatrix=new Rt().multiplyRight(i).translate(new ee(this.center).negate()),this.projectionMatrix=n||CP({width:this.width,height:this.height,orthographic:s,fovyRadians:r||o*SP,focalDistance:u,padding:l,near:a,far:c});const h=fo();ls(h,h,this.projectionMatrix),ls(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=Qh([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=bP(this.viewMatrixInverse);const f=fo(),d=fo();yd(f,f,[this.width/2,-this.height/2,1]),Vc(f,f,[1,-1,0]),ls(d,f,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=Qh(fo(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ve.warn("Pixel project matrix not invertible")()}};_l.displayName="Viewport";let xr=_l;const Oo=class Oo extends xr{constructor(e={}){const{latitude:i=0,longitude:n=0,zoom:s=0,pitch:r=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:c=1.01,nearZ:l,farZ:u,orthographic:h=!1,projectionMatrix:f,repeat:d=!1,worldOffset:p=0,position:g,padding:_,legacyMeterSizes:m=!1}=e;let{width:b,height:w,altitude:S=1.5}=e;const R=Math.pow(2,s);b=b||1,w=w||1;let M,k=null;if(f)S=f[5]/2,M=$c(S);else{e.fovy?(M=e.fovy,S=W1(M)):M=$c(S);let I;if(_){const{top:N=0,bottom:C=0}=_;I=[0,vt((N+w-C)/2,0,w)-w/2]}k=Vx({width:b,height:w,scale:R,center:g&&[0,0,g[2]*xu(i)],offset:I,pitch:r,fovy:M,nearZMultiplier:a,farZMultiplier:c}),Number.isFinite(l)&&(k.near=l),Number.isFinite(u)&&(k.far=u)}let F=zx({height:w,pitch:r,bearing:o,scale:R,altitude:S});p&&(F=new Rt().translate([512*p,0,0]).multiplyLeft(F)),super({...e,width:b,height:w,viewMatrix:F,longitude:n,latitude:i,zoom:s,...k,fovy:M,focalDistance:S}),this.latitude=i,this.longitude=n,this.zoom=s,this.pitch=r,this.bearing=o,this.altitude=S,this.fovy=M,this.orthographic=h,this._subViewports=d?[]:null,this._pseudoMeters=m,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),i=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let s=i;s<=n;s++){const r=s?new Oo({...this,worldOffset:s}):this;this._subViewports.push(r)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[i,n]=this.projectFlat(e),s=(e[2]||0)*xu(e[1]);return[i,n,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[i,n]=this.unprojectFlat(e),s=(e[2]||0)/xu(n);return[i,n,s]}addMetersToLngLat(e,i){return H1(e,i)}panByPosition(e,i){const n=Vl(i,this.pixelUnprojectionMatrix),s=this.projectFlat(e),r=zc([],s,T1([],n)),o=zc([],this.center,r),[a,c]=this.unprojectFlat(o);return{longitude:a,latitude:c}}getBounds(e={}){const i=Hx(this,e.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(e,i={}){const{width:n,height:s}=this,{longitude:r,latitude:o,zoom:a}=jx({width:n,height:s,bounds:e,...i});return new Oo({width:n,height:s,longitude:r,latitude:o,zoom:a})}};Oo.displayName="WebMercatorViewport";let Pr=Oo;const r_=[0,0,0];function Mu(t,e,i=!1){const n=e.projectPosition(t);if(i&&e instanceof Pr){const[s,r,o=0]=t,a=e.getDistanceScales([s,r]);n[2]=o*a.unitsPerMeter[2]}return n}function xP(t){const{viewport:e,modelMatrix:i,coordinateOrigin:n}=t;let{coordinateSystem:s,fromCoordinateSystem:r,fromCoordinateOrigin:o}=t;return s===Ee.DEFAULT&&(s=e.isGeospatial?Ee.LNGLAT:Ee.CARTESIAN),r===void 0&&(r=s),o===void 0&&(o=n),{viewport:e,coordinateSystem:s,coordinateOrigin:n,modelMatrix:i,fromCoordinateSystem:r,fromCoordinateOrigin:o}}function K1(t,{viewport:e,modelMatrix:i,coordinateSystem:n,coordinateOrigin:s,offsetMode:r}){let[o,a,c=0]=t;switch(i&&([o,a,c]=Nr([],[o,a,c,1],i)),n){case Ee.LNGLAT:return Mu([o,a,c],e,r);case Ee.LNGLAT_OFFSETS:return Mu([o+s[0],a+s[1],c+(s[2]||0)],e,r);case Ee.METER_OFFSETS:return Mu(H1(s,[o,a,c]),e,r);case Ee.CARTESIAN:default:return e.isGeospatial?[o+s[0],a+s[1],c+s[2]]:e.projectPosition([o,a,c])}}function PP(t,e){const{viewport:i,coordinateSystem:n,coordinateOrigin:s,modelMatrix:r,fromCoordinateSystem:o,fromCoordinateOrigin:a}=xP(e),{autoOffset:c=!0}=e,{geospatialOrigin:l=r_,shaderCoordinateOrigin:u=r_,offsetMode:h=!1}=c?j1(i,n,s):{},f=K1(t,{viewport:i,modelMatrix:r,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});if(h){const d=i.projectPosition(l||u);M1(f,f,d)}return f}let MP=1,IP=1;class Z1{constructor(){v(this,"time",0);v(this,"channels",new Map);v(this,"animations",new Map);v(this,"playing",!1);v(this,"lastEngineTime",-1)}addChannel(e){const{delay:i=0,duration:n=Number.POSITIVE_INFINITY,rate:s=1,repeat:r=1}=e,o=MP++,a={time:0,delay:i,duration:n,rate:s,repeat:r};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[i,n]of this.animations)n.channel===e&&this.detachAnimation(i)}isFinished(e){const i=this.channels.get(e);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(e){if(e===void 0)return this.time;const i=this.channels.get(e);return i===void 0?-1:i.time}setTime(e){this.time=Math.max(0,e);const i=this.channels.values();for(const s of i)this._setChannelTime(s,this.time);const n=this.animations.values();for(const s of n){const{animation:r,channel:o}=s;r.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,i){const n=IP++;return this.animations.set(n,{animation:e,channel:i}),e.setTime(this.getTime(i)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,i){const n=i-e.delay,s=e.duration*e.repeat;n>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}let OP=0;const kP={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:as.stats.get(`animation-loop-${OP++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class NP{constructor(e){v(this,"device",null);v(this,"canvas",null);v(this,"props");v(this,"animationProps",null);v(this,"timeline",null);v(this,"stats");v(this,"cpuTime");v(this,"gpuTime");v(this,"frameRate");v(this,"display");v(this,"needsRedraw","initialized");v(this,"_initialized",!1);v(this,"_running",!1);v(this,"_animationFrameId",null);v(this,"_nextFramePromise",null);v(this,"_resolveNextFrame",null);v(this,"_cpuStartTime",0);if(this.props={...kP,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:i=!0}=this.props;this.stats=e.stats||new ia({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:i}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const i=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(i),i}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=J3(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(Q3(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,i;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(i=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:i.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:i,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=i,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(i);const n=this.props.onAddHTML(i);n&&(i.innerHTML=n)}}_getSizeAndAspect(){var r,o,a,c;if(!this.device)return{width:1,height:1,aspect:1};const[e,i]=((o=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let n=1;const s=(c=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:c.canvas;return s&&s.clientHeight?n=s.clientWidth/s.clientHeight:e>0&&i>0&&(n=e/i),{width:e,height:i,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,i;this.props.autoResizeDrawingBuffer&&((i=(e=this.device)==null?void 0:e.canvasContext)==null||i.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class o_{constructor(e){v(this,"id");v(this,"userData",{});v(this,"topology");v(this,"bufferLayout",[]);v(this,"vertexCount");v(this,"indices");v(this,"attributes");this.id=e.id||As("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&Xe(this.indices.usage===et.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const i of Object.values(this.attributes))i.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function DP(t,e){if(e instanceof o_)return e;const i=FP(t,e),{attributes:n,bufferLayout:s}=LP(t,e);return new o_({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:i,attributes:n})}function FP(t,e){if(!e.indices)return;const i=e.indices.value;return t.createBuffer({usage:et.INDEX,data:i})}function LP(t,e){const i=[],n={};for(const[r,o]of Object.entries(e.attributes)){let a=r;switch(r){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}n[a]=t.createBuffer({data:o.value,id:`${r}-buffer`});const{value:c,size:l,normalized:u}=o;i.push({name:a,format:q3(c,l,u)})}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:i,vertexCount:s}}class BP{constructor(e){v(this,"modules");v(this,"moduleUniforms");v(this,"moduleBindings");v(this,"moduleUniformsChanged");const i=Ul(Object.values(e));Y.log(1,"Creating ShaderInputs with modules",i.map(n=>n.name))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[n,s]of Object.entries(e)){const r=n;this.moduleUniforms[r]=s.defaultUniforms||{},this.moduleBindings[r]={}}}destroy(){}setProps(e){var i;for(const n of Object.keys(e)){const s=n,r=e[s],o=this.modules[s];if(!o){Y.warn(`Module ${n} not found`)();continue}const a=this.moduleUniforms[s],c=((i=o.getUniforms)==null?void 0:i.call(o,r,this.moduleUniforms[s]))||r;this.moduleUniforms[s]={...a,...c}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const i of Object.values(this.moduleBindings))Object.assign(e,i);return e}getDebugTable(){var i;const e={};for(const[n,s]of Object.entries(this.moduleUniforms))for(const[r,o]of Object.entries(s))e[`${n}.${r}`]={type:(i=this.modules[n].uniformTypes)==null?void 0:i[r],value:String(o)};return e}}const ml=class ml{constructor(e){v(this,"device");v(this,"_hashCounter",0);v(this,"_hashes",{});v(this,"_renderPipelineCache",{});v(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new ml(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const i={...Er.defaultProps,...e},n=this._hashRenderPipeline(i);if(!this._renderPipelineCache[n]){const s=this.device.createRenderPipeline({...i,id:i.id?`${i.id}-cached`:void 0});s.hash=n,this._renderPipelineCache[n]={pipeline:s,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const i={...Uc.defaultProps,...e},n=this._hashComputePipeline(i);if(!this._computePipelineCache[n]){const s=this.device.createComputePipeline({...i,id:i.id?`${i.id}-cached`:void 0});s.hash=n,this._computePipelineCache[n]={pipeline:s,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const i=e.hash,n=e instanceof Uc?this._computePipelineCache:this._renderPipelineCache;n[i].useCount--,n[i].useCount===0&&(n[i].pipeline.destroy(),delete n[i])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const i=this._getHash(e.vs.source),n=e.fs?this._getHash(e.fs.source):0,s="-",r=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${i}/${n}V${s}BL${r}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${i}/${n}V${s}T${e.topology}P${o}BL${r}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};v(ml,"defaultProps",{...Er.defaultProps});let of=ml;const yl=class yl{constructor(e){v(this,"device");v(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var i;return(i=e._lumaData).defaultShaderFactory||(i.defaultShaderFactory=new yl(e)),e._lumaData.defaultShaderFactory}createShader(e){const i=this._hashShader(e);let n=this._cache[i];if(!n){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[i]=n={shader:s,useCount:0}}return n.useCount++,n.shader}release(e){const i=this._hashShader(e),n=this._cache[i];n&&(n.useCount--,n.useCount===0&&(delete this._cache[i],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};v(yl,"defaultProps",{...Fc.defaultProps});let af=yl;function UP(t,e){var s;const i={},n="Values";if(t.attributes.length===0&&!((s=t.varyings)!=null&&s.length))return{"No attributes or varyings":{[n]:"N/A"}};for(const r of t.attributes)if(r){const o=`${r.location} ${r.name}: ${r.type}`;i[`in ${o}`]={[n]:r.stepMode||"vertex"}}for(const r of t.varyings||[]){const o=`${r.location} ${r.name}`;i[`out ${o}`]={[n]:JSON.stringify(r.accessor)}}return i}let yt=null,Iu=null;function zP(t,{id:e,minimap:i,opaque:n,top:s="0",left:r="0",rgbaScale:o=1}){yt||(yt=document.createElement("canvas"),yt.id=e,yt.title=e,yt.style.zIndex="100",yt.style.position="absolute",yt.style.top=s,yt.style.left=r,yt.style.border="blue 1px solid",yt.style.transform="scaleY(-1)",document.body.appendChild(yt),Iu=yt.getContext("2d")),(yt.width!==t.width||yt.height!==t.height)&&(yt.width=t.width/2,yt.height=t.height/2,yt.style.width="400px",yt.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),c=Iu.createImageData(t.width,t.height),l=0;for(let u=0;u<a.length;u+=4)c.data[l+u+0]=a[u+0]*o,c.data[l+u+1]=a[u+1]*o,c.data[l+u+2]=a[u+2]*o,c.data[l+u+3]=n?255:a[u+3]*o;Iu.putImageData(c,0,0)}const js=2,VP=1e4,vl=class vl{constructor(e,i){v(this,"device");v(this,"id");v(this,"source");v(this,"vs");v(this,"fs");v(this,"pipelineFactory");v(this,"shaderFactory");v(this,"userData",{});v(this,"parameters");v(this,"topology");v(this,"bufferLayout");v(this,"isInstanced");v(this,"instanceCount",0);v(this,"vertexCount");v(this,"indexBuffer",null);v(this,"bufferAttributes",{});v(this,"constantAttributes",{});v(this,"bindings",{});v(this,"uniforms",{});v(this,"vertexArray");v(this,"transformFeedback",null);v(this,"pipeline");v(this,"shaderInputs");v(this,"_uniformStore");v(this,"_attributeInfos",{});v(this,"_gpuGeometry",null);v(this,"_getModuleUniforms");v(this,"props");v(this,"_pipelineNeedsUpdate","newly created");v(this,"_needsRedraw","initializing");v(this,"_destroyed",!1);v(this,"_lastDrawTimestamp",-1);v(this,"_lastLogTime",0);v(this,"_logOpen",!1);v(this,"_drawCount",0);var a,c,l,u;this.props={...vl.defaultProps,...i},i=this.props,this.id=i.id||As("model"),this.device=e,Object.assign(this.userData,i.userData);const n=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(h=>[h.name,h]))||[]);this.setShaderInputs(i.shaderInputs||new BP(n));const s=jP(e),r=(((c=this.props.modules)==null?void 0:c.length)>0?this.props.modules:(l=this.shaderInputs)==null?void 0:l.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(u=this.props).shaderLayout||(u.shaderLayout=NR(this.props.source));const{source:h,getUniforms:f}=this.props.shaderAssembler.assembleShader({platformInfo:s,...this.props,modules:r});this.source=h,this._getModuleUniforms=f}else{const{vs:h,fs:f,getUniforms:d}=this.props.shaderAssembler.assembleShaderPair({platformInfo:s,...this.props,modules:r});this.vs=h,this.fs=f,this._getModuleUniforms=d}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,i.geometry&&this.setGeometry(i.geometry),this.pipelineFactory=i.pipelineFactory||of.getDefaultPipelineFactory(this.device),this.shaderFactory=i.shaderFactory||af.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in i&&(this.isInstanced=i.isInstanced),i.instanceCount&&this.setInstanceCount(i.instanceCount),i.vertexCount&&this.setVertexCount(i.vertexCount),i.indexBuffer&&this.setIndexBuffer(i.indexBuffer),i.attributes&&this.setAttributes(i.attributes),i.constantAttributes&&this.setConstantAttributes(i.constantAttributes),i.bindings&&this.setBindings(i.bindings),i.uniforms&&this.setUniforms(i.uniforms),i.moduleSettings&&this.updateModuleSettings(i.moduleSettings),i.transformFeedback&&(this.transformFeedback=i.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let i;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),Nc(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:n}=this.vertexArray,s=n?n.byteLength/(n.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){var n;(n=this._gpuGeometry)==null||n.destroy();const i=e&&DP(this.device,e);i&&(this.setTopology(i.topology||"triangle-list"),this.bufferLayout=a_(i.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(i)),this._gpuGeometry=i}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?a_(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Gh(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new X3(this.shaderInputs.modules);for(const i of Object.keys(this.shaderInputs.modules)){const n=this._uniformStore.getManagedUniformBuffer(this.device,i);this.bindings[`${i}Uniforms`]=n}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,i){e.indices&&Y.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[n,s]of Object.entries(e)){const r=this.bufferLayout.find(c=>c_(c).includes(n));if(!r){Y.warn(`Model(${this.id}): Missing layout for buffer "${n}".`)();continue}const o=c_(r);let a=!1;for(const c of o){const l=this._attributeInfos[c];l&&(this.vertexArray.setBuffer(l.location,s),a=!0)}!a&&!((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)&&Y.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${n}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,i){for(const[n,s]of Object.entries(e)){const r=this._attributeInfos[n];r?this.vertexArray.setConstantWebGL(r.location,s):((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)||Y.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){Nc(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:i,uniforms:n}=f1(this._getModuleUniforms(e));Object.assign(this.bindings,i),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const i of Object.values(this.bindings))i instanceof Dc?e=Math.max(e,i.texture.updateTimestamp):i instanceof et||i instanceof ci?e=Math.max(e,i.updateTimestamp):i instanceof Lc||(e=Math.max(e,i.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const i={...e.attributes};for(const[n]of Object.entries(i))!this.pipeline.shaderLayout.attributes.find(s=>s.name===n)&&n!=="positions"&&delete i[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(i,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,i=null;this.pipeline&&(Y.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,i=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let s=null;this.source?s=n:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:n,fs:s}),this._attributeInfos=c1(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),i&&this.shaderFactory.release(i)}return this.pipeline}_logDrawCallStart(){const e=Y.level>3?0:VP;Y.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Y.group(js,`>>> DRAWING MODEL ${this.id}`,{collapsed:Y.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=UP(this.pipeline.shaderLayout,this.id);Y.table(js,e)();const i=this.shaderInputs.getDebugTable();for(const[s,r]of Object.entries(this.uniforms))i[s]={value:r};Y.table(js,i)();const n=this._getAttributeDebugTable();Y.table(js,this._attributeInfos)(),Y.table(js,n)(),Y.groupEnd(js)(),this._logOpen=!1}}_logFramebuffer(e){const i=Y.get("framebuffer");if(this._drawCount++,!i||this._drawCount++>3&&this._drawCount%60)return;const n=e.props.framebuffer;n&&zP(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[i,n]of Object.entries(this._attributeInfos))e[n.location]={name:i,type:n.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[n.location],n.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:i}=this.vertexArray,n=i.indexType==="uint32"?new Uint32Array(i.debugData):new Uint16Array(i.debugData);e.indices={name:"indices",type:i.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,i){const n=h1(i);return(e instanceof et?new n(e.debugData):e).toString()}};v(vl,"defaultProps",{...Er.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:kc.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let ui=vl;function a_(t,e){const i=[...t];for(const n of e){const s=i.findIndex(r=>r.name===n.name);s<0?i.push(n):i[s]=n}return i}function jP(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function c_(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(i=>i.attribute):[t.name]}class jl{constructor(e,i=ui.defaultProps){v(this,"device");v(this,"model");v(this,"transformFeedback");Xe(jl.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new ui(this.device,{id:i.id||"buffer-transform-model",fs:i.fs||Y2(),topology:i.topology||"point-list",...i}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:i.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var i;return((i=e==null?void 0:e.info)==null?void 0:i.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const i=this.device.beginRenderPass(e);this.model.draw(i),i.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const i=this.getBuffer(e);if(i instanceof et)return i.readAsync();const{buffer:n,byteOffset:s=0,byteLength:r=n.byteLength}=i;return n.readAsync(s,r)}}class Mr{constructor(e){v(this,"id");v(this,"topology");v(this,"vertexCount");v(this,"indices");v(this,"attributes");v(this,"userData",{});const{attributes:i={},indices:n=null,vertexCount:s=null}=e;this.id=e.id||As("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[r,o]of Object.entries(i)){const a=ArrayBuffer.isView(o)?{value:o}:o;Xe(ArrayBuffer.isView(a.value),`${this._print(r)}: must be typed array or object with value as typed array`),(r==="POSITION"||r==="positions")&&!a.size&&(a.size=3),r==="indices"?(Xe(!this.indices),this.indices=a):this.attributes[r]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,i){return this}_calculateVertexCount(e,i){if(i)return i.value.length;let n=1/0;for(const s of Object.values(e)){const{value:r,size:o,constant:a}=s;!a&&r&&o>=1&&(n=Math.min(n,r.length/o))}return Xe(Number.isFinite(n)),n}}const $P={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class G1 extends Td{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:i,views:n,viewports:s,onViewportActive:r,pickingFBO:o,deviceRect:{x:a,y:c,width:l,height:u},cullRect:h,effects:f,pass:d="picking",pickZ:p,moduleParameters:g}){this.pickZ=p;const _=this._resetColorEncoder(p),m=[a,c,l,u],b=super.render({target:o,layers:e,layerFilter:i,views:n,viewports:s,onViewportActive:r,cullRect:h,effects:f==null?void 0:f.filter(S=>S.useInPicking),pass:d,isPicking:!0,moduleParameters:g,clearColor:[0,0,0,0],colorMask:15,scissorRect:m});return this._colorEncoderState=null,{decodePickingColor:_&&WP.bind(null,_),stats:b}}shouldDrawLayer(e){const{pickable:i,operation:n}=e.props;return i&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,i,n){const s={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:r,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?s.blend=!1:r&&o.includes("draw")&&(Object.assign(s,$P),s.blend=!0,s.blendColor=HP(this._colorEncoderState,e,n)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function HP(t,e,i){const{byLayer:n,byAlpha:s}=t;let r,o=n.get(e);return o?(o.viewports.push(i),r=o.a):(r=n.size+1,r<=255?(o={a:r,layer:e,viewports:[i]},n.set(e,o),s[r]=o):(ve.warn("Too many pickable layers, only picking the first 255")(),r=0)),[0,0,0,r/255]}function WP(t,e){const i=t.byAlpha[e[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(e)}}const Ks={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Hc=Symbol.for("component"),Tn=Symbol.for("propTypes"),Ou=Symbol.for("deprecatedProps"),fr=Symbol.for("asyncPropDefaults"),ws=Symbol.for("asyncPropOriginal"),yn=Symbol.for("asyncPropResolved");function $l(t,e=()=>!0){return Array.isArray(t)?J1(t,e,[]):e(t)?[t]:[]}function J1(t,e,i){let n=-1;for(;++n<t.length;){const s=t[n];Array.isArray(s)?J1(s,e,i):e(s)&&i.push(s)}return i}function XP({target:t,source:e,start:i=0,count:n=1}){const s=e.length,r=n*s;let o=0;for(let a=i;o<s;o++)t[a++]=e[o];for(;o<r;)o<r-o?(t.copyWithin(i+o,i,i+o),o*=2):(t.copyWithin(i+o,i,i+r-o),o=r);return t}class qP{constructor(e,i,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(i)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,i){if(e===this._data&&!i)return;this._data=e;const n=++this._loadCount;let s=e;typeof e=="string"&&(s=rs(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(r=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=r)}).catch(r=>{this._loadCount===n&&(this.isLoaded=!0,this._error=r||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const r of this._subscribers)r.onChange(this.getData())}}class YP{constructor(e){var i;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(i=e.device)==null?void 0:i.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:i,forceUpdate:n=!1,persistent:s=!0}){let r=this._resources[e];r?r.setData(i,n):(r=new qP(e,i,this._context),this._resources[e]=r),r.persistent=s}remove(e){const i=this._resources[e];i&&(i.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const i=this._consumers[e];if(i){for(const n in i){const s=i[n],r=this._resources[s.resourceId];r&&r.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:i,consumerId:n,requestId:s="default"}){const{_resources:r,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),r[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=r[e];if(this._track(n,s,a,i),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,i,n,s){const r=this._consumers,o=r[e]=r[e]||{};let a=o[i];const c=a&&a.resourceId&&this._resources[a.resourceId];c&&(c.unsubscribe(a),this.prune()),n&&(a?(a.onChange=s,a.resourceId=n.id):a={onChange:s,resourceId:n.id},o[i]=a,n.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const i=this._resources[e];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[e])}}}const KP="layerManager.setLayers",ZP="layerManager.activateViewport";class GP{constructor(e,i){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Ot(ZP,this,a),a&&(this.context.viewport=a)};const{deck:n,stats:s,viewport:r,timeline:o}=i||{};this.layers=[],this.resourceManager=new YP({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:n,shaderAssembler:sP(),defaultShaderModules:[],renderPass:void 0,stats:s||new ia({id:"deck.gl"}),viewport:r||new xr({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Z1,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const s=n.getNeedsRedraw(e);i=i||s}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(i=>e.find(n=>i.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,i){Ot(KP,this,i,e),this._lastRenderedLayers=e;const n=$l(e,Boolean);for(const s of n)s.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:i}=this.context;i.find(n=>n.name===e.name)||(i.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:i}=this.context,n=i.findIndex(s=>s.name===e.name);n>=0&&(i.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,i,n){n.raiseError(i,`${e} of ${n}`)}_updateLayers(e,i){const n={};for(const o of e)n[o.id]?ve.warn(`Multiple old layers with same id ${o.id}`)():n[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(i,n,s),this._finalizeOldLayers(n);let r=!1;for(const o of s)if(o.hasUniformTransition()){r=`Uniform transition in ${o}`;break}this._needsUpdate=r,this.layers=s}_updateSublayersRecursively(e,i,n){for(const s of e){s.context=this.context;const r=i[s.id];r===null&&ve.warn(`Multiple new layers with same id ${s.id}`)(),i[s.id]=null;let o=null;try{this._debug&&r!==s&&s.validateProps(),r?(this._transferLayerState(r,s),this._updateLayer(s)):this._initializeLayer(s),n.push(s),o=s.isComposite?s.getSubLayers():null}catch(a){this._handleError("matching",a,s)}o&&this._updateSublayersRecursively(o,i,n)}}_finalizeOldLayers(e){for(const i in e){const n=e[i];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Ks.INITIALIZED}catch(i){this._handleError("initialization",i,e)}}_transferLayerState(e,i){i._transferState(e),i.lifecycle=Ks.MATCHED,i!==e&&(e.lifecycle=Ks.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(i){this._handleError("update",i,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Ks.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Ks.FINALIZED}catch(i){this._handleError("finalization",i,e)}}}function wi(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!wi(t[n],e[n],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!wi(t[r],e[r],i-1))return!1;return!0}return!1}class JP{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const i=this.controllers[e];i&&i.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const i=this.controllers[e];i&&i.updateTransition()}}getViewports(e){return e?this._viewports.filter(i=>i.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(i=>{e[i.id]=i}),e}getView(e){return this.views.find(i=>i.id===e)}getViewState(e){const i=typeof e=="string"?this.getView(e):e,n=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,i){const n=this.getViewports(),s={x:e[0],y:e[1]};for(let r=n.length-1;r>=0;--r){const o=n[r];if(o.containsPixel(s)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,i)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,i){(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(e){e=$l(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!wi(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ve.warn("missing `viewState` or `initialViewState`")()}_createController(e,i){const n=i.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:r=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:r,width:this.width,height:this.height})}})}_updateController(e,i,n,s){const r=e.controller;if(r&&n){const o={...i,...r,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!s||s.constructor!==r.type)&&(s=this._createController(e,o)),s&&s.setProps(o),s}return null}_rebuildViewports(){const{views:e}=this,i=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let s=e.length;s--;){const r=e[s],o=this.getViewState(r),a=r.makeViewport({viewState:o,width:this.width,height:this.height});let c=i[r.id];const l=!!r.controller;l&&!c&&(n=!0),(n||!l)&&c&&(c.finalize(),c=null),this.controllers[r.id]=this._updateController(r,o,a,c),a&&this._viewports.unshift(a)}for(const s in i){const r=i[s];r&&!this.controllers[s]&&r.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,i){return e.length!==i.length?!0:e.some((n,s)=>!e[s].equals(i[s]))}}const QP=/([0-9]+\.?[0-9]*)(%|px)/;function sn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=QP.exec(t);if(e&&e.length>=3){const i=e[2]==="%",n=parseFloat(e[1]);return{position:i?n/100:n,relative:i}}default:throw new Error(`Could not parse position string ${t}`)}}function rn(t,e){return t.relative?Math.round(t.position*e):t.position}class Q1{constructor(e){const{id:i,x:n=0,y:s=0,width:r="100%",height:o="100%",padding:a=null}=e;this.id=i||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=sn(n),this._y=sn(s),this._width=sn(r),this._height=sn(o),this._padding=a&&{left:sn(a.left||0),right:sn(a.right||0),top:sn(a.top||0),bottom:sn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&wi(this.props,e.props,2)}makeViewport({width:e,height:i,viewState:n}){n=this.filterViewState(n);const s=this.getDimensions({width:e,height:i});return!s.height||!s.width?null:new this.ViewportType({...n,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...e};for(const n in this.props.viewState)n!=="id"&&(i[n]=this.props.viewState[n]);return i}return e}getDimensions({width:e,height:i}){const n={x:rn(this._x,e),y:rn(this._y,i),width:rn(this._width,e),height:rn(this._height,i)};return this._padding&&(n.padding={left:rn(this._padding.left,e),top:rn(this._padding.top,i),right:rn(this._padding.right,e),bottom:rn(this._padding.bottom,i)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Hl{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var i,n;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)==null||n.call(i,this)}end(){var e,i;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(i=(e=this.settings).onEnd)==null||i.call(e,this))}cancel(){var e,i;this._inProgress&&((i=(e=this.settings).onInterrupt)==null||i.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:s}=this;this._handle=n.addChannel({delay:n.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(i=(e=this.settings).onUpdate)==null||i.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const l_=()=>{},cf={BREAK:1,SNAP_TO_END:2,IGNORE:3},eM=t=>t,tM=cf.BREAK;class iM{constructor(e){this._onTransitionUpdate=i=>{const{time:n,settings:{interpolator:s,startProps:r,endProps:o,duration:a,easing:c}}=i,l=c(n/a),u=s.interpolateProps(r,o,l);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Hl(e.timeline),this.onViewStateChange=e.onViewStateChange||l_,this.onStateChange=e.onStateChange||l_}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let i=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let s=n;if(this.transition.inProgress){const{interruption:r,endProps:o}=this.transition.settings;s={...n,...r===cf.SNAP_TO_END?o:this.propsInTransition||n}}this._triggerTransition(s,e),i=!0}else this.transition.cancel();return i}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:i,transitionInterpolator:n}=e;return(i>0||i==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,i){return this.transition.inProgress?this.transition.settings.interruption===cf.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(e,i):!0}_triggerTransition(e,i){const n=this.getControllerState(e),s=this.getControllerState(i).shortestPathFrom(n),r=i.transitionInterpolator,o=r.getDuration?r.getDuration(e,i):i.transitionDuration;if(o===0)return;const a=r.initializeProps(e,s);this.propsInTransition={};const c={duration:o,easing:i.transitionEasing||eM,interpolator:r,interruption:i.transitionInterruption||tM,startProps:a.start,endProps:a.end,onStart:i.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(i.onTransitionInterrupt),onEnd:this._onTransitionEnd(i.onTransitionEnd)};this.transition.start(c),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return i=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(i)}}}function St(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class nM{constructor(e){const{compare:i,extract:n,required:s}=e;this._propsToCompare=i,this._propsToExtract=n||i,this._requiredProps=s}arePropsEqual(e,i){for(const n of this._propsToCompare)if(!(n in e)||!(n in i)||!Zi(e[n],i[n]))return!1;return!0}initializeProps(e,i){const n={},s={};for(const r of this._propsToExtract)(r in e||r in i)&&(n[r]=e[r],s[r]=i[r]);return this._checkRequiredProps(n),this._checkRequiredProps(s),{start:n,end:s}}getDuration(e,i){return i.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(i=>{const n=e[i];St(Number.isFinite(n)||Array.isArray(n),`${i} is required for transition`)})}}const sM=["longitude","latitude","zoom","bearing","pitch"],rM=["longitude","latitude","zoom"];class Xo extends nM{constructor(e={}){const i=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(i)?{compare:i,required:i}:i||{compare:sM,required:rM},super(n.transitionProps),this.opts=n}initializeProps(e,i){const n=super.initializeProps(e,i),{makeViewport:s,around:r}=this.opts;if(s&&r){const o=s(e),a=s(i),c=o.unproject(r);n.start.around=r,Object.assign(n.end,{around:a.project(c),aroundPosition:c,width:i.width,height:i.height})}return n}interpolateProps(e,i,n){const s={};for(const r of this._propsToExtract)s[r]=cs(e[r]||0,i[r]||0,n);if(i.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...i,...s});Object.assign(s,r.panByPosition(i.aroundPosition,cs(e.around,i.around,n)))}return s}}const on={transitionDuration:0},oM=300,Ba=t=>1-(1-t)*(1-t),$s={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},jn={};class ev{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new iM({...e,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const i in this._events)this._events[i]&&((e=this.eventManager)==null||e.off(i,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return i?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:i,y:n}=this.props,{offsetCenter:s}=e;return[s.x-i,s.y-n]}isPointInBounds(e,i){const{width:n,height:s}=this.props;if(i&&i.handled)return!1;const r=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=s;return r&&i&&i.stopPropagation(),r}isFunctionKeyPressed(e){const{srcEvent:i}=e;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=i}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:i}=e;this.inertia=Number.isFinite(i)?i:i===!0?oM:0;const{scrollZoom:n=!0,dragPan:s=!0,dragRotate:r=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:c=!1,keyboard:l=!0}=e,u=!!this.onViewStateChange;this.toggleEvents($s.WHEEL,u&&n),this.toggleEvents($s.PAN,u),this.toggleEvents($s.PINCH,u&&(a||c)),this.toggleEvents($s.TRIPLE_PAN,u&&c),this.toggleEvents($s.DOUBLE_TAP,u&&o),this.toggleEvents($s.KEYBOARD,u&&l),this.scrollZoom=n,this.dragPan=s,this.dragRotate=r,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=c,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,i){this.eventManager&&e.forEach(n=>{this._events[n]!==i&&(this._events[n]=i,i?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,i=null,n={}){const s={...e.getViewportProps(),...i},r=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),r){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const s=this.controllerState[n?"panStart":"rotateStart"]({pos:i});return this._panMove=n,this.updateViewport(s,on,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const i=this.getCenter(e),n=this.controllerState.pan({pos:i});return this.updateViewport(n,on,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:i}=this;if(this.dragPan&&i&&e.velocity){const n=this.getCenter(e),s=[n[0]+e.velocityX*i/2,n[1]+e.velocityY*i/2],r=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:Ba},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const i=this.getCenter(e),n=this.controllerState.rotate({pos:i});return this.updateViewport(n,on,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:i}=this;if(this.dragRotate&&i&&e.velocity){const n=this.getCenter(e),s=[n[0]+e.velocityX*i/2,n[1]+e.velocityY*i/2],r=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:Ba},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:r}=e;let o=2/(1+Math.exp(-Math.abs(r*n)));r<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:i,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:i}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.controllerState.rotateStart({pos:i});return this.updateViewport(n,on,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(e);i[0]-=e.deltaX;const n=this.controllerState.rotate({pos:i});return this.updateViewport(n,on,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&e.velocityY){const n=this.getCenter(e),s=[n[0],n[1]+=e.velocityY*i/2],r=this.controllerState.rotate({pos:s});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:Ba},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return jn._startPinchRotation=e.rotation,jn._lastPinchEvent=e,this.updateViewport(n,on,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:n}=e,s=this.getCenter(e);i=i.zoom({pos:s,scale:n})}if(this.touchRotate){const{rotation:n}=e;i=i.rotate({deltaAngleX:jn._startPinchRotation-n})}return this.updateViewport(i,on,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),jn._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:n}=jn;if(this.touchZoom&&i&&n&&e.scale!==n.scale){const s=this.getCenter(e);let r=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),c=Math.pow(2,o+a*i/2);r=r.zoom({pos:s,scale:c}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:s}),transitionDuration:i,transitionEasing:Ba},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return jn._startPinchRotation=null,jn._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:i,scale:n?.5:2});return this.updateViewport(s,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:s,rotateSpeedX:r,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let c;const l={};switch(e.srcEvent.code){case"Minus":c=i?a.zoomOut(n).zoomOut(n):a.zoomOut(n),l.isZooming=!0;break;case"Equal":c=i?a.zoomIn(n).zoomIn(n):a.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":i?(c=a.rotateLeft(r),l.isRotating=!0):(c=a.moveLeft(s),l.isPanning=!0);break;case"ArrowRight":i?(c=a.rotateRight(r),l.isRotating=!0):(c=a.moveRight(s),l.isPanning=!0);break;case"ArrowUp":i?(c=a.rotateUp(o),l.isRotating=!0):(c=a.moveUp(s),l.isPanning=!0);break;case"ArrowDown":i?(c=a.rotateDown(o),l.isRotating=!0):(c=a.moveDown(s),l.isPanning=!0);break;default:return!1}return this.updateViewport(c,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:i}=this;return!i||!i.transitionInterpolator?on:e?{...i,transitionInterpolator:new Xo({...e,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class tv{constructor(e,i){this._viewportProps=this.applyConstraints(e),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const u_=5,aM=1.2;class cM extends tv{constructor(e){const{width:i,height:n,latitude:s,longitude:r,zoom:o,bearing:a=0,pitch:c=0,altitude:l=1.5,position:u=[0,0,0],maxZoom:h=20,minZoom:f=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:g,startZoomLngLat:_,startRotatePos:m,startBearing:b,startPitch:w,startZoom:S,normalize:R=!0}=e;St(Number.isFinite(r)),St(Number.isFinite(s)),St(Number.isFinite(o)),super({width:i,height:n,latitude:s,longitude:r,zoom:o,bearing:a,pitch:c,altitude:l,maxZoom:h,minZoom:f,maxPitch:d,minPitch:p,normalize:R,position:u},{startPanLngLat:g,startZoomLngLat:_,startRotatePos:m,startBearing:b,startPitch:w,startZoom:S}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:i}){const n=this.getState().startPanLngLat||this._unproject(i);if(!n)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:n=0}){const{startRotatePos:s,startBearing:r,startPitch:o}=this.getState();if(!s||r===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,s,o,r):a={bearing:r+i,pitch:o+n},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:n}){let{startZoom:s,startZoomLngLat:r}=this.getState();if(r||(s=this.getViewportProps().zoom,r=this._unproject(i)||this._unproject(e)),!r)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let c=s+Math.log2(n);c=vt(c,a,o);const l=this.makeViewport({...this.getViewportProps(),zoom:c});return this._getUpdatedState({zoom:c,...l.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const i=e.getViewportProps(),n={...this.getViewportProps()},{bearing:s,longitude:r}=n;return Math.abs(s-i.bearing)>180&&(n.bearing=s<0?s+360:s-360),Math.abs(r-i.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}applyConstraints(e){const{maxZoom:i,minZoom:n,zoom:s}=e;e.zoom=vt(s,n,i);const{maxPitch:r,minPitch:o,pitch:a}=e;e.pitch=vt(a,o,r);const{normalize:c=!0}=e;return c&&Object.assign(e,Wx(e)),e}_zoomFromCenter(e){const{width:i,height:n}=this.getViewportProps();return this.zoom({pos:[i/2,n/2],scale:e})}_panFromCenter(e){const{width:i,height:n}=this.getViewportProps();return this.pan({startPos:[i/2,n/2],pos:[i/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_getNewRotation(e,i,n,s){const r=e[0]-i[0],o=e[1]-i[1],a=e[1],c=i[1],{width:l,height:u}=this.getViewportProps(),h=r/l;let f=0;o>0?Math.abs(u-c)>u_&&(f=o/(c-u)*aM):o<0&&c>u_&&(f=1-a/c),f=vt(f,-1,1);const{minPitch:d,maxPitch:p}=this.getViewportProps(),g=s+180*h;let _=n;return f>0?_=n+f*(p-n):f<0&&(_=n-f*(d-n)),{pitch:_,bearing:g}}}class lM extends ev{constructor(){super(...arguments),this.ControllerState=cM,this.transition={transitionDuration:300,transitionInterpolator:new Xo({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const i=this.props;super.setProps(e),(!i||i.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}const qd=class qd extends Q1{constructor(e={}){super(e)}get ViewportType(){return Pr}get ControllerType(){return lM}};qd.displayName="MapView";let lf=qd;const uM=new Y1;function hM(t,e){const i=t.order??1/0,n=e.order??1/0;return i-n}class fM{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const i=this._defaultEffects;if(!i.find(n=>n.id===e.id)){const n=i.findIndex(s=>hM(s,e)>0);n<0?i.push(e):i.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(wi(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(e){const i={};for(const s of this.effects)i[s.id]=s;const n=[];for(const s of e){const r=i[s.id];let o=s;r&&r!==s?r.setProps?(r.setProps(s.props),o=r):r.cleanup(this._context):r||s.setup(this._context),n.push(o),delete i[s.id]}for(const s in i)i[s].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(s=>s instanceof Y1)||this._resolvedEffects.push(uM),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class dM extends Td{shouldDrawLayer(e){const{operation:i}=e.props;return i.includes("draw")||i.includes("terrain")}}const pM="deckRenderer.renderLayers";class gM{constructor(e){this.device=e,this.gl=e.gl,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new dM(e),this.pickLayersPass=new G1(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const s=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const r=i.render({...n,target:s});n.effects&&this._postRender(n.effects,n),this.renderCount++,Ot(pM,this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:e}=this;for(const i of e)i.delete();e.length=0}_preRender(e,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const n of e)i.preRenderStats[n.id]=n.preRender(i),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,i=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[s]}))});for(const n of e)n.resize(i)}_postRender(e,i){const{renderBuffers:n}=this,s={...i,inputBuffer:n[0],swapBuffer:n[1]};for(const r of e)if(r.postRender){s.target=r.id===this.lastPostProcessEffect?i.target:void 0;const o=r.postRender(s);s.inputBuffer=o,s.swapBuffer=o===n[0]?n[1]:n[0]}}}const _M={pickedColor:null,pickedObjectIndex:-1};function mM({pickedColors:t,decodePickingColor:e,deviceX:i,deviceY:n,deviceRadius:s,deviceRect:r}){const{x:o,y:a,width:c,height:l}=r;let u=s*s,h=-1,f=0;for(let d=0;d<l;d++){const p=d+a-n,g=p*p;if(g>u)f+=4*c;else for(let _=0;_<c;_++){if(t[f+3]-1>=0){const b=_+o-i,w=b*b+g;w<=u&&(u=w,h=f)}f+=4}}if(h>=0){const d=t.slice(h,h+4),p=e(d);if(p){const g=Math.floor(h/4/c),_=h/4-g*c;return{...p,pickedColor:d,pickedX:o+_,pickedY:a+g}}ve.error("Picked non-existent layer. Is picking buffer corrupt?")()}return _M}function yM({pickedColors:t,decodePickingColor:e}){const i=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const r=t.slice(n,n+4),o=r.join(",");if(!i.has(o)){const a=e(r);a?i.set(o,{...a,color:r}):ve.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function iv({pickInfo:t,viewports:e,pixelRatio:i,x:n,y:s,z:r}){let o=e[0];e.length>1&&(o=bM((t==null?void 0:t.pickedViewports)||e,{x:n,y:s}));let a;if(o){const c=[n-o.x,s-o.y];r!==void 0&&(c[2]=r),a=o.unproject(c)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:n,y:s,pixel:[n,s],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:i}}function vM(t){const{pickInfo:e,lastPickedInfo:i,mode:n,layers:s}=t,{pickedColor:r,pickedLayer:o,pickedObjectIndex:a}=e,c=o?[o]:[];if(n==="hover"){const h=i.index,f=i.layerId,d=o?o.props.id:null;if(d!==f||a!==h){if(d!==f){const p=s.find(g=>g.props.id===f);p&&c.unshift(p)}i.layerId=d,i.index=a,i.info=null}}const l=iv(t),u=new Map;return u.set(null,l),c.forEach(h=>{let f={...l};h===o&&(f.color=r,f.index=a,f.picked=!0),f=nv({layer:h,info:f,mode:n});const d=f.layer;h===o&&n==="hover"&&(i.info=f),u.set(d.id,f),n==="hover"&&d.updateAutoHighlight(f)}),u}function nv({layer:t,info:e,mode:i}){for(;t&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=t,e=t.getPickingInfo({info:e,mode:i,sourceLayer:n}),t=t.parent}return e}function bM(t,e){for(let i=t.length-1;i>=0;i--){const n=t[i];if(n.containsPixel(e))return n}return t[0]}class wM{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new G1(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:i,layers:n,viewports:s},r=this.lastPickedInfo.info){const o=r&&r.layer&&r.layer.id,a=r&&r.viewport&&r.viewport.id,c=o?n.find(f=>f.id===o):null,l=a&&s.find(f=>f.id===a)||s[0],u=l&&l.unproject([e-l.x,i-l.y]);return{...r,...{x:e,y:i,viewport:l,coordinate:u,layer:c}}}_resizeBuffer(){var i,n;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const e=this.device.gl;(i=this.pickingFBO)==null||i.resize({width:e.canvas.width,height:e.canvas.height}),(n=this.depthFBO)==null||n.resize({width:e.canvas.width,height:e.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const i=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return i.length?i:null}_pickClosestObject({layers:e,views:i,viewports:n,x:s,y:r,radius:o=0,depth:a=1,mode:c="query",unproject3D:l,onViewportActive:u,effects:h}){const f=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||n.length===0)return{result:[],emptyInfo:iv({viewports:n,x:s,y:r,pixelRatio:f})};this._resizeBuffer();const p=this.device.canvasContext.cssToDevicePixels([s,r],!0),g=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],_=Math.round(o*f),{width:m,height:b}=this.pickingFBO,w=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:_,deviceWidth:m,deviceHeight:b}),S={x:s-o,y:r-o,width:o*2+1,height:o*2+1};let R;const M=[],k=new Set;for(let F=0;F<a;F++){let I;if(w){const C=this._drawAndSample({layers:d,views:i,viewports:n,onViewportActive:u,deviceRect:w,cullRect:S,effects:h,pass:`picking:${c}`});I=mM({...C,deviceX:g[0],deviceY:g[1],deviceRadius:_,deviceRect:w})}else I={pickedColor:null,pickedObjectIndex:-1};let N;if(I.pickedLayer&&l&&this.depthFBO){const{pickedColors:C}=this._drawAndSample({layers:[I.pickedLayer],views:i,viewports:n,onViewportActive:u,deviceRect:{x:I.pickedX,y:I.pickedY,width:1,height:1},cullRect:S,effects:h,pass:`picking:${c}:z`},!0);C[3]&&(N=C[0])}I.pickedLayer&&F+1<a&&(k.add(I.pickedLayer),I.pickedLayer.disablePickingIndex(I.pickedObjectIndex)),R=vM({pickInfo:I,lastPickedInfo:this.lastPickedInfo,mode:c,layers:d,viewports:n,x:s,y:r,z:N,pixelRatio:f});for(const C of R.values())C.layer&&M.push(C);if(!I.pickedColor)break}for(const F of k)F.restorePickingColors();return{result:M,emptyInfo:R.get(null)}}_pickVisibleObjects({layers:e,views:i,viewports:n,x:s,y:r,width:o=1,height:a=1,mode:c="query",maxObjects:l=null,onViewportActive:u,effects:h}){const f=this._getPickable(e);if(!f||n.length===0)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),p=this.device.canvasContext.cssToDevicePixels([s,r],!0),g=p.x,_=p.y+p.height,m=this.device.canvasContext.cssToDevicePixels([s+o,r+a],!0),b=m.x+m.width,w=m.y,S={x:g,y:w,width:b-g,height:_-w},R=this._drawAndSample({layers:f,views:i,viewports:n,onViewportActive:u,deviceRect:S,cullRect:{x:s,y:r,width:o,height:a},effects:h,pass:`picking:${c}`}),M=yM(R),k=new Map,F=[],I=Number.isFinite(l);for(let N=0;N<M.length&&!(I&&F.length>=l);N++){const C=M[N];let V={color:C.pickedColor,layer:null,index:C.pickedObjectIndex,picked:!0,x:s,y:r,pixelRatio:d};V=nv({layer:C.pickedLayer,info:V,mode:c});const X=V.layer.id;k.has(X)||k.set(X,new Set);const K=k.get(X),B=V.object??V.index;K.has(B)||(K.add(B),F.push(V))}return F}_drawAndSample({layers:e,views:i,viewports:n,onViewportActive:s,deviceRect:r,cullRect:o,effects:a,pass:c},l=!1){const u=l?this.depthFBO:this.pickingFBO,h={layers:e,layerFilter:this.layerFilter,views:i,viewports:n,onViewportActive:s,pickingFBO:u,deviceRect:r,cullRect:o,effects:a,pass:c,pickZ:l,preRenderStats:{}};for(const b of a)b.useInPicking&&(h.preRenderStats[b.id]=b.preRender(h));const{decodePickingColor:f}=this.pickLayersPass.render(h),{x:d,y:p,width:g,height:_}=r,m=new(l?Float32Array:Uint8Array)(g*_*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:p,sourceWidth:g,sourceHeight:_,target:m}),{pickedColors:m,decodePickingColor:f}}_getPickingRect({deviceX:e,deviceY:i,deviceRadius:n,deviceWidth:s,deviceHeight:r}){const o=Math.max(0,e-n),a=Math.max(0,i-n),c=Math.min(s,e+n+1)-o,l=Math.min(r,i+n+1)-a;return c<=0||l<=0?null:{x:o,y:a,width:c,height:l}}}const TM={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},EM="top-left",h_="__root";class SM{constructor({deck:e,parentElement:i}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!wi(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(i=>i.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const i={};for(const n of this.resolvedWidgets)i[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)i[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const s=i[n.id];s?s.viewId!==n.viewId||s.placement!==n.placement?(this._remove(s),this._add(n)):n!==s&&(s.setProps(n.props),n=s):this._add(n),i[n.id]=null,this.resolvedWidgets.push(n)}for(const n in i){const s=i[n];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:i=null,placement:n=EM}=e,s=e.onAdd({deck:this.deck,viewId:i});s&&this._getContainer(i,n).append(s),e._element=s}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,i){var o;const n=e||h_;let s=this.containers[n];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(o=this.parentElement)==null||o.append(s),this.containers[n]=s);let r=s.querySelector(`.${i}`);return r||(r=document.createElement("div"),r.className=i,r.style.position="absolute",Object.assign(r.style,TM[i]),s.append(r)),r}_updateContainers(){const e=this.deck.width,i=this.deck.height;for(const n in this.containers){const s=this.lastViewports[n]||null,r=n===h_||s,o=this.containers[n];r?(o.style.display="block",o.style.left=`${s?s.x:0}px`,o.style.top=`${s?s.y:0}px`,o.style.width=`${s?s.width:e}px`,o.style.height=`${s?s.height:i}px`):o.style.display="none"}}onRedraw({viewports:e,layers:i}){var r,o;const n=e.reduce((a,c)=>(a[c.id]=c,a),{}),{lastViewports:s}=this;for(const a of this.getWidgets()){const{viewId:c}=a;if(c){const l=n[c];l&&(a.onViewportChange&&!l.equals(s[c])&&a.onViewportChange(l),(r=a.onRedraw)==null||r.call(a,{viewports:[l],layers:i}))}else{if(a.onViewportChange)for(const l of e)l.equals(s[l.id])||a.onViewportChange(l);(o=a.onRedraw)==null||o.call(a,{viewports:e,layers:i})}}this.lastViewports=n,this._updateContainers()}onHover(e,i){var n,s;for(const r of this.getWidgets()){const{viewId:o}=r;(!o||o===((n=e.viewport)==null?void 0:n.id))&&((s=r.onHover)==null||s.call(r,e,i))}}onEvent(e,i){var s,r;const n=tf[i.type];if(n)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((s=e.viewport)==null?void 0:s.id))&&((r=o[n.handler])==null||r.call(o,e,i))}}}const AM={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class RM{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,AM),this.deck=e,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var i;this.isVisible&&e.id===((i=this.lastViewport)==null?void 0:i.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:i}=this,n=i&&i.props.getTooltip;if(!n)return;const s=n(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,i,n){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${i}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var er;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(er||(er={}));const Ed={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},dt=(t,e,i)=>e?t.enable(i):t.disable(i),f_=(t,e,i)=>t.hint(i,e),Zt=(t,e,i)=>t.pixelStorei(i,e),d_=(t,e,i)=>{const n=i===36006?36009:36008;return t.bindFramebuffer(n,e)},Gr=(t,e,i)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];t.bindBuffer(s,e)};function ku(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const CM={3042:dt,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:dt,2885:(t,e)=>t.cullFace(e),2929:dt,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:dt,35723:f_,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var i;return(i=t.bindTransformFeedback)==null?void 0:i.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:d_,36010:d_,34964:Gr,36662:Gr,36663:Gr,35053:Gr,35055:Gr,2886:(t,e)=>t.frontFace(e),33170:f_,2849:(t,e)=>t.lineWidth(e),32823:dt,32824:"polygonOffset",10752:"polygonOffset",35977:dt,32926:dt,32928:dt,32938:"sampleCoverage",32939:"sampleCoverage",3089:dt,3088:(t,e)=>t.scissor(...e),2960:dt,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:dt,10754:dt,12288:dt,12289:dt,12290:dt,12291:dt,12292:dt,12293:dt,12294:dt,12295:dt,3333:Zt,3317:Zt,37440:Zt,37441:Zt,37443:Zt,3330:Zt,3332:Zt,3331:Zt,3314:Zt,32878:Zt,3316:Zt,3315:Zt,32877:Zt,framebuffer:(t,e)=>{const i=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,i)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const i=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...i)},blendFunc:(t,e)=>{const i=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...i)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=ku(e)?e:[e,e];const[i,n]=e;t.stencilMaskSeparate(1028,i),t.stencilMaskSeparate(1029,n)},stencilFunc:(t,e)=>{e=ku(e)&&e.length===3?[...e,...e]:e;const[i,n,s,r,o,a]=e;t.stencilFuncSeparate(1028,i,n,s),t.stencilFuncSeparate(1029,r,o,a)},stencilOp:(t,e)=>{e=ku(e)&&e.length===3?[...e,...e]:e;const[i,n,s,r,o,a]=e;t.stencilOpSeparate(1028,i,n,s),t.stencilOpSeparate(1029,r,o,a)},viewport:(t,e)=>t.viewport(...e)};function ot(t,e,i){return e[t]!==void 0?e[t]:i[t]}const xM={blendEquation:(t,e,i)=>t.blendEquationSeparate(ot(32777,e,i),ot(34877,e,i)),blendFunc:(t,e,i)=>t.blendFuncSeparate(ot(32969,e,i),ot(32968,e,i),ot(32971,e,i),ot(32970,e,i)),polygonOffset:(t,e,i)=>t.polygonOffset(ot(32824,e,i),ot(10752,e,i)),sampleCoverage:(t,e,i)=>t.sampleCoverage(ot(32938,e,i),ot(32939,e,i)),stencilFuncFront:(t,e,i)=>t.stencilFuncSeparate(1028,ot(2962,e,i),ot(2967,e,i),ot(2963,e,i)),stencilFuncBack:(t,e,i)=>t.stencilFuncSeparate(1029,ot(34816,e,i),ot(36003,e,i),ot(36004,e,i)),stencilOpFront:(t,e,i)=>t.stencilOpSeparate(1028,ot(2964,e,i),ot(2965,e,i),ot(2966,e,i)),stencilOpBack:(t,e,i)=>t.stencilOpSeparate(1029,ot(34817,e,i),ot(34818,e,i),ot(34819,e,i))},p_={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,i)=>t({[e]:i}),hint:(t,e,i)=>t({[e]:i}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,i)=>t({36007:i}),bindTransformFeedback:(t,e,i)=>t({36389:i}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,i)=>{switch(e){case 36160:return t({36006:i,36010:i});case 36009:return t({36006:i});case 36008:return t({36010:i});default:return null}},bindBuffer:(t,e,i)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?t({[n]:i}):{valueChanged:!0}},blendColor:(t,e,i,n,s)=>t({32773:new Float32Array([e,i,n,s])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,i)=>t({32777:e,34877:i}),blendFunc:(t,e,i)=>t({32969:e,32968:i,32971:e,32970:i}),blendFuncSeparate:(t,e,i,n,s)=>t({32969:e,32968:i,32971:n,32970:s}),clearColor:(t,e,i,n,s)=>t({3106:new Float32Array([e,i,n,s])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,i,n,s)=>t({3107:[e,i,n,s]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,i)=>t({2928:new Float32Array([e,i])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,i)=>t({32824:e,10752:i}),sampleCoverage:(t,e,i)=>t({32938:e,32939:i}),scissor:(t,e,i,n,s)=>t({3088:new Int32Array([e,i,n,s])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,i)=>t({[e===1028?2968:36005]:i}),stencilFunc:(t,e,i,n)=>t({2962:e,2967:i,2963:n,34816:e,36003:i,36004:n}),stencilFuncSeparate:(t,e,i,n,s)=>t({[e===1028?2962:34816]:i,[e===1028?2967:36003]:n,[e===1028?2963:36004]:s}),stencilOp:(t,e,i,n)=>t({2964:e,2965:i,2966:n,34817:e,34818:i,34819:n}),stencilOpSeparate:(t,e,i,n,s)=>t({[e===1028?2964:34817]:i,[e===1028?2965:34818]:n,[e===1028?2966:34819]:s}),viewport:(t,e,i,n,s)=>t({2978:[e,i,n,s]})},Pi=(t,e)=>t.isEnabled(e),g_={3042:Pi,2884:Pi,2929:Pi,3024:Pi,32823:Pi,32926:Pi,32928:Pi,3089:Pi,2960:Pi,35977:Pi},PM=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Lr(t,e){if(IM(e))return;const i={};for(const s in e){const r=Number(s),o=CM[s];o&&(typeof o=="string"?i[o]=!0:o(t,e[s],r))}const n=t.state&&t.state.cache;if(n)for(const s in i){const r=xM[s];r(t,e,n)}}function sv(t,e=Ed){if(typeof e=="number"){const s=e,r=g_[s];return r?r(t,s):t.getParameter(s)}const i=Array.isArray(e)?e:Object.keys(e),n={};for(const s of i){const r=g_[s];n[s]=r?r(t,Number(s)):t.getParameter(Number(s))}return n}function MM(t){Lr(t,Ed)}function IM(t){for(const e in t)return!1;return!0}function OM(t,e){if(t===e)return!0;const i=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(e)||ArrayBuffer.isView(e);if(i&&n&&t.length===e.length){for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}return!1}class kM{constructor(e,{copyState:i=!1,log:n=()=>{}}={}){v(this,"gl");v(this,"program",null);v(this,"stateStack",[]);v(this,"enable",!0);v(this,"cache");v(this,"log");this.gl=e,this.cache=i?sv(e):Object.assign({},Ed),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){Xe(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Lr(this.gl,e),this.stateStack.pop()}_updateCache(e){let i=!1,n;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in e){Xe(r!==void 0);const o=e[r],a=this.cache[r];OM(o,a)||(i=!0,n=a,s&&!(r in s)&&(s[r]=a),this.cache[r]=o)}return{valueChanged:i,oldValue:n}}}function Ts(t){return t.state}function rv(t,e){const{enable:i=!0,copyState:n}=e;if(Xe(n!==void 0),!t.state){t.state=new kM(t,{copyState:n}),DM(t);for(const r in p_){const o=p_[r];NM(t,r,o)}__(t,"getParameter"),__(t,"isEnabled")}const s=Ts(t);return s.enable=i,t}function Wl(t){let e=Ts(t);e||(rv(t,{copyState:!1}),e=Ts(t)),e.push()}function qo(t){const e=Ts(t);Xe(e),e.pop()}function __(t,e){const i=t[e].bind(t);t[e]=function(s){if(s===void 0||PM.has(s))return i(s);const r=Ts(t);return s in r.cache||(r.cache[s]=i(s)),r.enable?r.cache[s]:i(s)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function NM(t,e,i){if(!t[e])return;const n=t[e].bind(t);t[e]=function(...r){const o=Ts(t),{valueChanged:a,oldValue:c}=i(o._updateCache,...r);return a&&n(...r),c},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function DM(t){const e=t.useProgram.bind(t);t.useProgram=function(n){const s=Ts(t);s.program!==n&&(e(n),s.program=n)}}const FM={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function LM(t,e){e={...FM,...e};let i=null;const n=r=>i=r.statusMessage||i;t.addEventListener("webglcontextcreationerror",n,!1);let s=null;if(s||(s=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",n,!1),!s)throw new Error(`Failed to create WebGL context: ${i||"Unknown error"}`);if(e.onContextLost){const{onContextLost:r}=e;t.addEventListener("webglcontextlost",o=>r(o),!1)}if(e.onContextRestored){const{onContextRestored:r}=e;t.addEventListener("webglcontextrestored",o=>r(o),!1)}return s}function xn(t,e,i){return i[e]===void 0&&(i[e]=t.getExtension(e)||null),i[e]}function BM(t,e){const i=t.getParameter(7936),n=t.getParameter(7937);xn(t,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,r=t.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),a=r||i,c=o||n,l=t.getParameter(7938),u=ov(a,c),h=UM(a,c),f=zM(a,c);return{type:"webgl",gpu:u,gpuType:f,gpuBackend:h,vendor:a,renderer:c,version:l,shadingLanguage:"glsl",shadingLanguageVersion:300}}function ov(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function UM(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function zM(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(ov(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function av(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Mt="texture-compression-bc",Oe="texture-compression-astc",Mi="texture-compression-etc2",VM="texture-compression-etc1-webgl",Ua="texture-compression-pvrtc-webgl",Nu="texture-compression-atc-webgl",Jr="float32-renderable-webgl",Du="float16-renderable-webgl",jM="rgb9e5ufloat_renderable-webgl",Fu="snorm8-renderable-webgl",Qr="norm16-renderable-webgl",Lu="snorm16-renderable-webgl",za="float32-filterable",m_="float16-filterable-webgl",po="WEBGL_compressed_texture_s3tc",go="WEBGL_compressed_texture_s3tc_srgb",tr="EXT_texture_compression_rgtc",ir="EXT_texture_compression_bptc",$M="WEBGL_compressed_texture_etc",HM="WEBGL_compressed_texture_astc",WM="WEBGL_compressed_texture_etc1",XM="WEBGL_compressed_texture_pvrtc",qM="WEBGL_compressed_texture_atc",y_="EXT_texture_norm16",v_="EXT_render_snorm",YM="EXT_color_buffer_float",Sd={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[v_],"norm16-renderable-webgl":[y_],"snorm16-renderable-webgl":[y_,v_],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[po,go,tr,ir],"texture-compression-bc5-webgl":[tr],"texture-compression-bc7-webgl":[ir],"texture-compression-etc2":[$M],"texture-compression-astc":[HM],"texture-compression-etc1-webgl":[WM],"texture-compression-pvrtc-webgl":[XM],"texture-compression-atc-webgl":[qM]};function KM(t){return t in Sd}function ZM(t,e,i){return(Sd[e]||[]).every(s=>xn(t,s,i))}const Xl={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:Fu},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:Fu},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:Du,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:Qr,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:Lu},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:Fu},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:Du,filter:m_,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:Qr},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:Lu},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:Jr,filter:za},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:jM},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:Jr,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:Qr},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:Qr},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:Jr,filter:za,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:Du,filter:m_},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:Qr,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:Lu},"rgb32float-webgl":{gl:34837,render:Jr,filter:za,gl2ext:YM,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:Jr,filter:za,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:po,f:Mt},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:go,f:Mt},"bc1-rgba-unorm":{gl:33777,x:po,f:Mt},"bc1-rgba-unorm-srgb":{gl:35916,x:go,f:Mt},"bc2-rgba-unorm":{gl:33778,x:po,f:Mt},"bc2-rgba-unorm-srgb":{gl:35918,x:go,f:Mt},"bc3-rgba-unorm":{gl:33779,x:po,f:Mt},"bc3-rgba-unorm-srgb":{gl:35919,x:go,f:Mt},"bc4-r-unorm":{gl:36283,x:tr,f:Mt},"bc4-r-snorm":{gl:36284,x:tr,f:Mt},"bc5-rg-unorm":{gl:36285,x:tr,f:Mt},"bc5-rg-snorm":{gl:36286,x:tr,f:Mt},"bc6h-rgb-ufloat":{gl:36495,x:ir,f:Mt},"bc6h-rgb-float":{gl:36494,x:ir,f:Mt},"bc7-rgba-unorm":{gl:36492,x:ir,f:Mt},"bc7-rgba-unorm-srgb":{gl:36493,x:ir,f:Mt},"etc2-rgb8unorm":{gl:37492,f:Mi},"etc2-rgb8unorm-srgb":{gl:37494,f:Mi},"etc2-rgb8a1unorm":{gl:37496,f:Mi},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Mi},"etc2-rgba8unorm":{gl:37493,f:Mi},"etc2-rgba8unorm-srgb":{gl:37495,f:Mi},"eac-r11unorm":{gl:37488,f:Mi},"eac-r11snorm":{gl:37489,f:Mi},"eac-rg11unorm":{gl:37490,f:Mi},"eac-rg11snorm":{gl:37491,f:Mi},"astc-4x4-unorm":{gl:37808,f:Oe},"astc-4x4-unorm-srgb":{gl:37840,f:Oe},"astc-5x4-unorm":{gl:37809,f:Oe},"astc-5x4-unorm-srgb":{gl:37841,f:Oe},"astc-5x5-unorm":{gl:37810,f:Oe},"astc-5x5-unorm-srgb":{gl:37842,f:Oe},"astc-6x5-unorm":{gl:37811,f:Oe},"astc-6x5-unorm-srgb":{gl:37843,f:Oe},"astc-6x6-unorm":{gl:37812,f:Oe},"astc-6x6-unorm-srgb":{gl:37844,f:Oe},"astc-8x5-unorm":{gl:37813,f:Oe},"astc-8x5-unorm-srgb":{gl:37845,f:Oe},"astc-8x6-unorm":{gl:37814,f:Oe},"astc-8x6-unorm-srgb":{gl:37846,f:Oe},"astc-8x8-unorm":{gl:37815,f:Oe},"astc-8x8-unorm-srgb":{gl:37847,f:Oe},"astc-10x5-unorm":{gl:37819,f:Oe},"astc-10x5-unorm-srgb":{gl:37851,f:Oe},"astc-10x6-unorm":{gl:37817,f:Oe},"astc-10x6-unorm-srgb":{gl:37849,f:Oe},"astc-10x8-unorm":{gl:37818,f:Oe},"astc-10x8-unorm-srgb":{gl:37850,f:Oe},"astc-10x10-unorm":{gl:37819,f:Oe},"astc-10x10-unorm-srgb":{gl:37851,f:Oe},"astc-12x10-unorm":{gl:37820,f:Oe},"astc-12x10-unorm-srgb":{gl:37852,f:Oe},"astc-12x12-unorm":{gl:37821,f:Oe},"astc-12x12-unorm-srgb":{gl:37853,f:Oe},"pvrtc-rgb4unorm-webgl":{gl:35840,f:Ua},"pvrtc-rgba4unorm-webgl":{gl:35842,f:Ua},"pvrtc-rbg2unorm-webgl":{gl:35841,f:Ua},"pvrtc-rgba2unorm-webgl":{gl:35843,f:Ua},"etc1-rbg-unorm-webgl":{gl:36196,f:VM},"atc-rgb-unorm-webgl":{gl:35986,f:Nu},"atc-rgba-unorm-webgl":{gl:35986,f:Nu},"atc-rgbai-unorm-webgl":{gl:34798,f:Nu}},GM={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},JM={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Ad(t,e,i){const n=Xl[e];if(!n||n.gl===void 0)return!1;const s=n.x||n.gl2ext;return s?!!xn(t,s,i):!0}function cv(t){const e=Xl[t],i=e==null?void 0:e.gl;if(i===void 0)throw new Error(`Unsupported texture format ${t}`);return i}function QM(t,e,i){if(!Ad(t,e,i)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(s1(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!xn(t,"OES_texture_float_linear, extensions",i):e.endsWith("16float")?!!xn(t,"OES_texture_half_float_linear, extensions",i):!0}function eI(t,e,i){return!(!Ad(t,e,i)||typeof e=="number")}function Wc(t){var s;const e=Xl[t],i=cv(t),n=s1(t);return{format:i,dataFormat:(e==null?void 0:e.dataFormat)||iI(n.format,n.integer,n.normalized,i),type:n.dataType?av(n.dataType):((s=e==null?void 0:e.types)==null?void 0:s[0])||5121,compressed:n.compressed}}function tI(t){const e=Xl[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function b_(t){const e=Wc(t),i=GM[e.dataFormat]||4,n=JM[e.type]||1;return i*n}function iI(t,e,i,n){if(n===6408||n===6407)return n;switch(t){case"r":return e&&!i?36244:6403;case"rg":return e&&!i?33320:33319;case"rgb":return e&&!i?36248:6407;case"rgba":return e&&!i?36249:6408;default:return 6408}}const w_={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class nI extends u3{constructor(i,n,s){super([],s);v(this,"gl");v(this,"extensions");v(this,"testedFeatures",new Set);this.gl=i,this.extensions=n,xn(i,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const i=this.getFeatures();for(const n of i)this.has(n)&&(yield n);return[]}has(i){return this.disabledFeatures[i]?!1:(this.testedFeatures.has(i)||(this.testedFeatures.add(i),KM(i)&&ZM(this.gl,i,this.extensions)&&this.features.add(i),this.getWebGLFeature(i)&&this.features.add(i)),this.features.has(i))}initializeFeatures(){const i=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of i)this.has(n)}getFeatures(){return[...Object.keys(w_),...Object.keys(Sd)]}getWebGLFeature(i){const n=w_[i];return typeof n=="string"?!!xn(this.gl,n,this.extensions):!!n}}class sI extends l3{constructor(i){super();v(this,"gl");v(this,"limits",{});this.gl=i}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(i){return this.limits[i]===void 0&&(this.limits[i]=this.gl.getParameter(i)),this.limits[i]}}function vn(t,e,i){if(rI(e))return i(t);const{nocatch:n=!0}=e;Wl(t),Lr(t,e);let s;if(n)s=i(t),qo(t);else try{s=i(t)}finally{qo(t)}return s}function rI(t){for(const e in t)return!1;return!0}function oI(t,e,i,n){if(Nc(e))return n(t);const s=t;Wl(s.gl);try{return aI(t,e),Lr(s.gl,i),n(t)}finally{qo(s.gl)}}function aI(t,e){const i=t,{gl:n}=i;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(us("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const r=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=us("provokingVertex",e.provokingVertex,{first:36429,last:36430});r==null||r.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const r=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=us("polygonMode",e.polygonMode,{fill:6914,line:6913});r==null||r.polygonModeWEBGL(1028,o),r==null||r.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&n.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(lI("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(uf("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;n.stencilMaskSeparate(1028,s),n.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&Y.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,r=uf("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,r,0,s),n.stencilFuncSeparate(1029,r,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=Bu("stencilPassOperation",e.stencilPassOperation),r=Bu("stencilFailOperation",e.stencilFailOperation),o=Bu("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,r,o,s),n.stencilOpSeparate(1029,r,o,s)}if(e.blendColorOperation||e.blendAlphaOperation){n.enable(3042);const s=T_("blendColorOperation",e.blendColorOperation||"add"),r=T_("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(s,r);const o=Va("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=Va("blendColorDstFactor",e.blendColorDstFactor||"zero"),c=Va("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),l=Va("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(o,a,c,l)}}function uf(t,e){return us(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Bu(t,e){return us(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function T_(t,e){return us(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Va(t,e){return us(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function cI(t,e){return`Illegal parameter ${e} for ${t}`}function us(t,e,i){if(!(e in i))throw new Error(cI(t,e));return i[e]}function lI(t,e){return e}function lv(t){const e={};return t.addressModeU&&(e[10242]=Uu(t.addressModeU)),t.addressModeV&&(e[10243]=Uu(t.addressModeV)),t.addressModeW&&(e[32882]=Uu(t.addressModeW)),t.magFilter&&(e[10240]=uv(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=uI(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=uf("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function Uu(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function uv(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function uI(t,e){if(!e)return uv(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class En extends et{constructor(i,n={}){super(i,n);v(this,"device");v(this,"gl");v(this,"handle");v(this,"glTarget");v(this,"glUsage");v(this,"glIndexType",5123);v(this,"byteLength");v(this,"bytesUsed");this.device=i,this.gl=this.device.gl;const s=typeof n=="object"?n.handle:void 0;this.handle=s||this.gl.createBuffer(),i.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=hI(this.props.usage),this.glUsage=fI(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(i,n=0,s=i.byteLength+n){const r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,s,this.glUsage),this.gl.bufferSubData(r,n,i),this.gl.bindBuffer(r,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(i,n,s),this.trackAllocatedMemory(s)}_initWithByteLength(i){Xe(i>=0);let n=i;i===0&&(n=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,n,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(null,0,i),this.trackAllocatedMemory(i),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(i,n=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,n,i),this.gl.bindBuffer(36663,null),this._setDebugData(i,n,i.byteLength)}async readAsync(i=0,n){return this.readSyncWebGL(i,n)}readSyncWebGL(i=0,n){n=n??this.byteLength-i;const s=new Uint8Array(n),r=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,s,r,n),this.gl.bindBuffer(36662,null),this._setDebugData(s,i,n),s}}function hI(t){return t&et.INDEX?34963:t&et.VERTEX?34962:t&et.UNIFORM?35345:34962}function fI(t){return t&et.INDEX||t&et.VERTEX?35044:t&et.UNIFORM?35048:35044}class hf extends Lc{constructor(i,n){super(i,n);v(this,"device");v(this,"handle");v(this,"parameters");this.device=i,this.parameters=lv(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(i){for(const[n,s]of Object.entries(i)){const r=Number(n);switch(r){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,r,s);break;default:this.device.gl.samplerParameteri(this.handle,r,s);break}}}}class nr extends Dc{constructor(i,n){super(i,{...ci.defaultProps,...n});v(this,"device");v(this,"gl");v(this,"handle");v(this,"texture");this.device=i,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const dI={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},ko=class ko extends ci{constructor(i,n){var s;super(i,{...dI,format:"rgba8unorm",...n});v(this,"MAX_ATTRIBUTES");v(this,"device");v(this,"gl");v(this,"handle");v(this,"sampler");v(this,"view");v(this,"glFormat");v(this,"type");v(this,"dataFormat");v(this,"mipmaps");v(this,"target");v(this,"textureUnit");v(this,"loaded",!1);v(this,"_video");this.device=i,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=pI(this.props),this.loaded=!1,typeof((s=this.props)==null?void 0:s.data)=="string"&&Object.assign(this.props,{data:G3(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(i){return new nr(this.device,{...i,texture:this})}initialize(i={}){if(this.props.dimension==="cube")return this.initializeCube(i);let n=i.data;if(n instanceof Promise)return n.then(m=>this.initialize(Object.assign({},i,{pixels:m,data:m}))),this;const s=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(s&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(i)),this;const{parameters:r={}}=i,{pixels:o=null,pixelStore:a={},textureUnit:c=void 0,mipmaps:l=!0}=i;n||(n=o);let{width:u,height:h,dataFormat:f,type:d,compressed:p=!1}=i;const{depth:g=0}=i,_=cv(i.format);return{width:u,height:h,compressed:p,dataFormat:f,type:d}=this._deduceParameters({format:i.format,type:d,dataFormat:f,compressed:p,data:n,width:u,height:h}),this.width=u,this.height=h,this.glFormat=_,this.type=d,this.dataFormat=f,this.textureUnit=c,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=l,this.setImageData({data:n,width:u,height:h,depth:g,format:_,type:d,dataFormat:f,parameters:a,compressed:p}),this.setSampler(i.sampler),this._setSamplerParameters(r),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),l&&this.device.isTextureFormatFilterable(i.format)&&this.generateMipmap(),s&&(this._video={video:n,parameters:r,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}initializeCube(i){const{mipmaps:n=!0,parameters:s={}}=i;return this.setCubeMapImageData(i).then(()=>{this.loaded=!0,n&&this.generateMipmap(i),this.setSampler(i.sampler),this._setSamplerParameters(s)}),this}setSampler(i={}){let n;i instanceof hf?(this.sampler=i,n=i.props):(this.sampler=new hf(this.device,i),n=i);const s=lv(n);return this._setSamplerParameters(s),this}resize(i){const{height:n,width:s,mipmaps:r=!1}=i;return s!==this.width||n!==this.height?this.initialize({width:s,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:r}):this}update(){if(this._video){const{video:i,parameters:n,lastTime:s}=this._video;if(s===i.currentTime||i.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:i,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=i.currentTime}}generateMipmap(i={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),vn(this.gl,i,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(i){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(i);this.trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:s=null,level:r=0,glFormat:o=this.glFormat,offset:a=0,parameters:c={}}=i;let{data:l=null,type:u=this.type,width:h=this.width,height:f=this.height,dataFormat:d=this.dataFormat,compressed:p=!1}=i;l||(l=s),{type:u,dataFormat:d,compressed:p,width:h,height:f}=this._deduceParameters({format:this.props.format,type:u,dataFormat:d,compressed:p,data:l,width:h,height:f});const{gl:g}=this;g.bindTexture(this.target,this.handle);let _=null;if({data:l,dataType:_}=this._getDataType({data:l,compressed:p}),vn(this.gl,c,()=>{switch(_){case"null":g.texImage2D(n,r,o,h,f,0,d,u,l);break;case"typed-array":g.texImage2D(n,r,o,h,f,0,d,u,l,a);break;case"buffer":this.device.gl.bindBuffer(35052,l.handle||l),this.device.gl.texImage2D(n,r,o,h,f,0,d,u,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":g.texImage2D(n,r,o,h,f,0,d,u,l);break;case"compressed":for(const[m,b]of l.entries())g.compressedTexImage2D(n,m,b.format,b.width,b.height,0,b.data);break;default:Xe(!1,"Unknown image data type")}}),l&&l.byteLength)this.trackAllocatedMemory(l.byteLength,"Texture");else{const m=b_(this.props.format);this.trackAllocatedMemory(this.width*this.height*m,"Texture")}return this.loaded=!0,this}setSubImageData({target:i=this.target,pixels:n=null,data:s=null,x:r=0,y:o=0,width:a=this.width,height:c=this.height,level:l=0,glFormat:u=this.glFormat,type:h=this.type,dataFormat:f=this.dataFormat,compressed:d=!1,offset:p=0,parameters:g={}}){if({type:h,dataFormat:f,compressed:d,width:a,height:c}=this._deduceParameters({format:this.props.format,type:h,dataFormat:f,compressed:d,data:s,width:a,height:c}),Xe(this.depth===1,"texSubImage not supported for 3D textures"),s||(s=n),s&&s.data){const _=s;s=_.data,a=_.shape[0],c=_.shape[1]}s instanceof En&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),vn(this.gl,g,()=>{d?this.gl.compressedTexSubImage2D(i,l,r,o,a,c,u,s):s===null?this.gl.texSubImage2D(i,l,r,o,a,c,f,h,null):ArrayBuffer.isView(s)?this.gl.texSubImage2D(i,l,r,o,a,c,f,h,s,p):typeof WebGLBuffer<"u"&&s instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,s),this.device.gl.texSubImage2D(i,l,r,o,a,c,f,h,p),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(i,l,r,o,a,c,f,h,s)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(i={}){return Y.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(i=this.textureUnit){const{gl:n}=this;return i!==void 0&&(this.textureUnit=i,n.activeTexture(33984+i)),n.bindTexture(this.target,this.handle),i}unbind(i=this.textureUnit){const{gl:n}=this;return i!==void 0&&(this.textureUnit=i,n.activeTexture(33984+i)),n.bindTexture(this.target,null),i}_getDataType({data:i,compressed:n=!1}){return n?{data:i,dataType:"compressed"}:i===null?{data:i,dataType:"null"}:ArrayBuffer.isView(i)?{data:i,dataType:"typed-array"}:i instanceof En?{data:i.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?{data:i,dataType:"buffer"}:{data:i,dataType:"browser-object"}}_deduceParameters(i){const{format:n,data:s}=i;let{width:r,height:o,dataFormat:a,type:c,compressed:l}=i;const u=Wc(n);return a=a||u.dataFormat,c=c||u.type,l=l||u.compressed,{width:r,height:o}=this._deduceImageSize(s,r,o),{dataFormat:a,type:c,compressed:l,width:r,height:o,format:n,data:s}}_deduceImageSize(i,n,s){let r;return typeof ImageData<"u"&&i instanceof ImageData?r={width:i.width,height:i.height}:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement?r={width:i.naturalWidth,height:i.naturalHeight}:typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement?r={width:i.width,height:i.height}:typeof ImageBitmap<"u"&&i instanceof ImageBitmap?r={width:i.width,height:i.height}:typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement?r={width:i.videoWidth,height:i.videoHeight}:i?r={width:n,height:s}:r={width:n>=0?n:1,height:s>=0?s:1},Xe(r,"Could not deduced texture size"),Xe(n===void 0||r.width===n,"Deduced texture width does not match supplied width"),Xe(s===void 0||r.height===s,"Deduced texture height does not match supplied height"),r}async setCubeMapImageData(i){const{gl:n}=this,{width:s,height:r,pixels:o,data:a,format:c=6408,type:l=5121}=i,u=o||a,h=await Promise.all(ko.FACES.map(f=>{const d=u[f];return Promise.all(Array.isArray(d)?d:[d])}));this.bind(),ko.FACES.forEach((f,d)=>{h[d].length>1&&this.props.mipmaps!==!1&&Y.warn(`${this.id} has mipmap and multiple LODs.`)(),h[d].forEach((p,g)=>{s&&r?n.texImage2D(f,g,c,s,r,0,c,l,p):n.texImage2D(f,g,c,c,l,p)})}),this.unbind()}setImageDataForFace(i){const{face:n,width:s,height:r,pixels:o,data:a,format:c=6408,type:l=5121}=i,{gl:u}=this,h=o||a;return this.bind(),h instanceof Promise?h.then(f=>this.setImageDataForFace(Object.assign({},i,{face:n,data:f,pixels:f}))):this.width||this.height?u.texImage2D(n,0,c,s,r,0,c,l,h):u.texImage2D(n,0,c,c,l,h),this}setImageData3D(i){const{level:n=0,dataFormat:s,format:r,type:o,width:a,height:c,depth:l=1,offset:u=0,data:h,parameters:f={}}=i;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const d=Wc(r);if(vn(this.gl,f,()=>{ArrayBuffer.isView(h)&&this.gl.texImage3D(this.target,n,d.format,a,c,l,0,d.dataFormat,d.type,h),h instanceof En&&(this.gl.bindBuffer(35052,h.handle),this.gl.texImage3D(this.target,n,s,a,c,l,0,r,o,u))}),h&&h.byteLength)this.trackAllocatedMemory(h.byteLength,"Texture");else{const p=b_(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*p,"Texture")}return this.loaded=!0,this}_setSamplerParameters(i){if(!Nc(i)){gI(i),this.gl.bindTexture(this.target,this.handle);for(const[n,s]of Object.entries(i)){const r=Number(n),o=s;switch(r){case 33082:case 33083:this.gl.texParameterf(this.target,r,o);break;default:this.gl.texParameteri(this.target,r,o);break}}this.gl.bindTexture(this.target,null)}}};v(ko,"FACES",[34069,34070,34071,34072,34073,34074]);let Li=ko;function pI(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function gI(t){Y.log(1,"texture sampler parameters",t)()}class So extends Bc{constructor(i,n){super(i,n);v(this,"device");v(this,"gl");v(this,"handle");const s=n.handle===null;if(this.device=i,this.gl=i.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),!s){i.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const r=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){const a=this.colorAttachments[o],c=36064+o;a&&this._attachOne(c,a)}if(this.depthStencilAttachment&&this._attachOne(tI(this.depthStencilAttachment.props.format),this.depthStencilAttachment),n.check!==!1){const o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${mI(o)}`)}this.gl.bindFramebuffer(36160,r)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(i){return new Li(this.device,{id:`${this.id}-depth-stencil`,format:i,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(i,n){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;i===void 0&&(i=this.gl.drawingBufferWidth),n===void 0&&(n=this.gl.drawingBufferHeight);for(const s of this.colorAttachments)s.texture.resize({width:i,height:n});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:i,height:n}),this}_attachOne(i,n){if(Array.isArray(n)){const[s,r=0,o=0]=n;return this._attachTexture(i,s,r,o),s}if(n instanceof Li)return this._attachTexture(i,n,0,0),n;if(n instanceof nr){const s=n;return this._attachTexture(i,s.texture,s.props.baseMipLevel,s.props.baseArrayLayer),n.texture}throw new Error("attach")}_attachTexture(i,n,s,r){const{gl:o}=this.device;switch(o.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:o.framebufferTextureLayer(36160,i,n.target,r,s);break;case 34067:const a=_I(s);o.framebufferTexture2D(36160,i,a,n.handle,r);break;case 3553:o.framebufferTexture2D(36160,i,3553,n.handle,r);break;default:Xe(!1,"Illegal texture type")}o.bindTexture(n.target,null)}}function _I(t){return t<34069?t+34069:t}function mI(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class yI extends pd{constructor(i,n){super(n);v(this,"device");v(this,"presentationSize");v(this,"_framebuffer",null);this.device=i,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new So(this.device,{handle:null}),this._framebuffer}update(){const i=this.getPixelSize();(i[0]!==this.presentationSize[0]||i[1]!==this.presentationSize[1])&&(this.presentationSize=i,this.resize())}resize(i){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(i==null?void 0:i.useDevicePixels);this.setDevicePixelRatio(n,i);return}}commit(){}}const vI={spector:Y.get("spector")||Y.get("inspect")},bI="https://spectorcdn.babylonjs.com/spector.bundle.js",wI=1;let ke=null,E_=!1;async function TI(t){if(!globalThis.SPECTOR)try{await d1(bI)}catch(e){Y.warn(String(e))}}function EI(t){if(t={...vI,...t},!(t!=null&&t.spector)||(!ke&&globalThis.SPECTOR&&(Y.probe(wI,"SPECTOR found and initialized")(),ke=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=ke)),!ke))return null;if(E_||(E_=!0,ke.spyCanvases(),ke==null||ke.onCaptureStarted.add(e=>Y.info("Spector capture started:",e)()),ke==null||ke.onCapture.add(e=>{Y.info("Spector capture complete:",e)(),ke==null||ke.getResultUI(),ke==null||ke.resultView.display(),ke==null||ke.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return ke;ke==null||ke.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{Y.info("Spector capture stopped after 2 seconds")(),ke==null||ke.stopCapture()})}return ke}const SI="https://unpkg.com/webgl-debug@2.0.1/index.js";function hv(t){return t.luma=t.luma||{},t.luma}async function AI(){Dn()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await d1(SI))}function RI(t,e={}){return t?e.debug?xI(t,e):CI(t):null}function CI(t){const e=hv(t);return e.realContext?e.realContext:t}function xI(t,e){if(!globalThis.WebGLDebugUtils)return Y.warn("webgl-debug not loaded")(),t;const i=hv(t);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...er,...t});const n=globalThis.WebGLDebugUtils.makeDebugContext(t,PI.bind(null,e),MI.bind(null,e));for(const o in er)!(o in n)&&typeof er[o]=="number"&&(n[o]=er[o]);class s{}Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.setPrototypeOf(s,n);const r=Object.create(s);return i.realContext=t,i.debugContext=r,r.debug=!0,r}function zu(t,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${t}(${i})`}function PI(t,e,i,n){n=Array.from(n).map(a=>a===void 0?"undefined":a);const s=globalThis.WebGLDebugUtils.glEnumToString(e),r=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,n),o=`${s} in gl.${i}(${r})`;Y.error(o)();debugger;if(t.throwOnError)throw new Error(o)}function MI(t,e,i){let n="";if(Y.level>=1&&(n=zu(e,i),Y.log(1,n)()),t.break&&t.break.length>0&&(n=n||zu(e,i),t.break.every(r=>n.indexOf(r)!==-1)))debugger;for(const s of i)if(s===void 0){if(n=n||zu(e,i),t.throwOnError)throw new Error(`Undefined argument: ${n}`);Y.error(`Undefined argument: ${n}`)();debugger}}function II(t){const e=t.split(/\r?\n/),i=[];for(const n of e){if(n.length<=1)continue;const s=n.split(":");if(s.length===2){const[h,f]=s;i.push({message:f.trim(),type:S_(h),lineNum:0,linePos:0});continue}const[r,o,a,...c]=s;let l=parseInt(a,10);isNaN(l)&&(l=0);let u=parseInt(o,10);isNaN(u)&&(u=0),i.push({message:c.join(":").trim(),type:S_(r),lineNum:l,linePos:u})}return i}function S_(t){const e=["warning","error","info"],i=t.toLowerCase();return e.includes(i)?i:"info"}class OI extends Fc{constructor(i,n){super(i,n);v(this,"device");v(this,"handle");switch(this.device=i,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const i=this.device.gl.getShaderInfoLog(this.handle);return II(i)}getTranslatedSource(){const n=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return n==null?void 0:n.getTranslatedShaderSource(this.handle)}async _compile(i){i=(r=>r.startsWith("#version ")?r:`#version 100
${r}`)(i);const{gl:s}=this.device;if(s.shaderSource(this.handle,i),s.compileShader(this.handle),Y.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Y.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Y.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const i=async r=>await new Promise(o=>setTimeout(o,r));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await i(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const kI=256,NI=1024,DI=16384,Vu=6144,FI=[1,2,4,8];class LI extends Wh{constructor(i,n){super(i,n);v(this,"device");v(this,"glParameters");this.device=i,Wl(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){qo(this.device.gl)}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}setParameters(i={}){const n={...this.glParameters};this.props.framebuffer&&(n.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,i.viewport&&(i.viewport.length>=6?(n.viewport=i.viewport.slice(0,4),n.depthRange=[i.viewport[4],i.viewport[5]]):n.viewport=i.viewport),i.scissorRect&&(n.scissorTest=!0,n.scissor=i.scissorRect),i.blendConstant&&(n.blendColor=i.blendConstant),i.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),i[2967]=i.stencilReference),i.colorMask&&(n.colorMask=FI.map(s=>!!(s&i.colorMask))),this.glParameters=n,Lr(this.device.gl,n)}beginOcclusionQuery(i){const n=this.props.occlusionQuerySet;n==null||n.beginOcclusionQuery()}endOcclusionQuery(){const i=this.props.occlusionQuerySet;i==null||i.endOcclusionQuery()}clear(){const i={...this.glParameters};let n=0;this.props.clearColor!==!1&&(n|=DI,i.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=kI,i.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=NI,i.clearStencil=this.props.clearStencil),n!==0&&vn(this.device.gl,i,()=>{this.device.gl.clear(n)})}clearColorBuffer(i=0,n=[0,0,0,0]){vn(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int32Array:this.device.gl.clearBufferiv(Vu,i,n);break;case Uint32Array:this.device.gl.clearBufferuiv(Vu,i,n);break;case Float32Array:default:this.device.gl.clearBufferfv(Vu,i,n);break}})}}const BI="Failed to deduce GL constant from typed array";function UI(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(BI)}}function ff(t,e){const{clamped:i=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const zI={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},VI={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Ao{constructor(...e){v(this,"offset");v(this,"stride");v(this,"type");v(this,"size");v(this,"divisor");v(this,"normalized");v(this,"integer");v(this,"buffer");v(this,"index");e.forEach(i=>this._assign(i)),Object.freeze(this)}static getBytesPerElement(e){return ff(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Xe(e.size),ff(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Ao(zI,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Ao.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Ao.getBytesPerVertex(this)}_assign(e={}){return e=K3("Accessor",e,VI),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function jI(t){return $I.includes(t)}const $I=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],fv={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function dv(t){const e=fv[t];if(!e)throw new Error("uniform");const[i,n,,s]=e;return{format:s,components:n,glType:i}}function HI(t){const e=fv[t];if(!e)throw new Error("attribute");const[,i,,n,s]=e;return{attributeType:n,vertexFormat:s,components:i}}function WI(t,e){const i={attributes:[],bindings:[]};i.attributes=XI(t,e);const n=KI(t,e);for(const a of n){const c=a.uniforms.map(l=>({name:l.name,format:l.format,byteOffset:l.byteOffset,byteStride:l.byteStride,arrayLength:l.arrayLength}));i.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:c})}const s=YI(t,e);let r=0;for(const a of s)if(jI(a.type)){const{viewDimension:c,sampleType:l}=GI(a.type);i.bindings.push({type:"texture",name:a.name,location:r,viewDimension:c,sampleType:l}),a.textureUnit=r,r+=1}s.length&&(i.uniforms=s);const o=qI(t,e);return o!=null&&o.length&&(i.varyings=o),i}function XI(t,e){const i=[],n=t.getProgramParameter(e,35721);for(let s=0;s<n;s++){const r=t.getActiveAttrib(e,s);if(!r)throw new Error("activeInfo");const{name:o,type:a}=r,c=t.getAttribLocation(e,o);if(c>=0){const{attributeType:l}=HI(a),u=/instance/i.test(o)?"instance":"vertex";i.push({name:o,location:c,stepMode:u,type:l})}}return i.sort((s,r)=>s.location-r.location),i}function qI(t,e){const i=[],n=t.getProgramParameter(e,35971);for(let s=0;s<n;s++){const r=t.getTransformFeedbackVarying(e,s);if(!r)throw new Error("activeInfo");const{name:o,type:a,size:c}=r,{glType:l,components:u}=dv(a),h=new Ao({type:l,size:c*u}),f={location:s,name:o,accessor:h};i.push(f)}return i.sort((s,r)=>s.location-r.location),i}function YI(t,e){const i=[],n=t.getProgramParameter(e,35718);for(let s=0;s<n;s++){const r=t.getActiveUniform(e,s);if(!r)throw new Error("activeInfo");const{name:o,size:a,type:c}=r,{name:l,isArray:u}=JI(o);let h=t.getUniformLocation(e,l);const f={location:h,name:l,size:a,type:c,isArray:u};if(i.push(f),f.size>1)for(let d=0;d<f.size;d++){const p=`${l}[${d}]`;h=t.getUniformLocation(e,p);const g={...f,name:p,location:h};i.push(g)}}return i}function KI(t,e){const i=(r,o)=>t.getActiveUniformBlockParameter(e,r,o),n=[],s=t.getProgramParameter(e,35382);for(let r=0;r<s;r++){const o={name:t.getActiveUniformBlockName(e,r)||"",location:i(r,35391),byteLength:i(r,35392),vertex:i(r,35396),fragment:i(r,35398),uniformCount:i(r,35394),uniforms:[]},a=i(r,35395)||[],c=t.getActiveUniforms(e,a,35383),l=t.getActiveUniforms(e,a,35384),u=t.getActiveUniforms(e,a,35387),h=t.getActiveUniforms(e,a,35388);for(let f=0;f<o.uniformCount;++f){const d=t.getActiveUniform(e,a[f]);if(!d)throw new Error("activeInfo");o.uniforms.push({name:d.name,format:dv(c[f]).format,type:c[f],arrayLength:l[f],byteOffset:u[f],byteStride:h[f]})}n.push(o)}return n.sort((r,o)=>r.location-o.location),n}const ZI={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function GI(t){const e=ZI[t];if(!e)throw new Error("sampler");const[i,n]=e;return{viewDimension:i,sampleType:n}}function JI(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const i=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!i||i.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:i[1],length:i[2]?1:0,isArray:!!i[2]}}function QI(t,e,i,n){const s=t;let r=n;r===!0&&(r=1),r===!1&&(r=0);const o=typeof r=="number"?[r]:r;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,n);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return s.uniform1uiv(e,o,1);case 36294:return s.uniform2uiv(e,o,2);case 36295:return s.uniform3uiv(e,o,3);case 36296:return s.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return s.uniformMatrix2x3fv(e,!1,o);case 35686:return s.uniformMatrix2x4fv(e,!1,o);case 35687:return s.uniformMatrix3x2fv(e,!1,o);case 35688:return s.uniformMatrix3x4fv(e,!1,o);case 35689:return s.uniformMatrix4x2fv(e,!1,o);case 35690:return s.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function eO(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function tO(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const A_=4;class iO extends Er{constructor(i,n){super(i,n);v(this,"device");v(this,"handle");v(this,"vs");v(this,"fs");v(this,"introspectedLayout");v(this,"uniforms",{});v(this,"bindings",{});v(this,"varyings",null);v(this,"_uniformCount",0);v(this,"_uniformSetters",{});this.device=i,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:s,bufferMode:r=35981}=n;switch(s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,r)),this._linkShaders(),Y.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=WI(this.device.gl,this.handle),Y.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=F3(this.introspectedLayout,n.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Y.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(i,n){for(const[s,r]of Object.entries(i)){const o=this.shaderLayout.bindings.find(a=>a.name===s)||this.shaderLayout.bindings.find(a=>a.name===`${s}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(c=>`"${c.name}"`).join(", ");n!=null&&n.disableWarnings||Y.warn(`Unknown binding "${s}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(r||Y.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(r instanceof En)&&!(r.buffer instanceof En))throw new Error("buffer value");break;case"texture":if(!(r instanceof nr||r instanceof Li||r instanceof So))throw new Error("texture value");break;case"sampler":Y.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(o.type)}this.bindings[s]=r}}draw(i){var _;const{renderPass:n,parameters:s=this.props.parameters,topology:r=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:c,isInstanced:l=!1,firstVertex:u=0,transformFeedback:h}=i,f=eO(r),d=!!o.indexBuffer,p=(_=o.indexBuffer)==null?void 0:_.glIndexType;if(this.linkStatus!=="success")return Y.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return Y.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return Y.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(n),h&&h.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const g=n;return oI(this.device,s,g.glParameters,()=>{d&&l?this.device.gl.drawElementsInstanced(f,a||0,p,u,c||0):d?this.device.gl.drawElements(f,a||0,p,u):l?this.device.gl.drawArraysInstanced(f,u,a||0,c||0):this.device.gl.drawArrays(f,u,a||0),h&&h.end()}),o.unbindAfterRender(n),!0}setUniformsWebGL(i){const{bindings:n}=f1(i);Object.keys(n).forEach(s=>{Y.warn(`Unsupported value "${JSON.stringify(n[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,i)}async _linkShaders(){const{gl:i}=this.device;if(i.attachShader(this.handle,this.vs.handle),i.attachShader(this.handle,this.fs.handle),Y.time(A_,`linkProgram for ${this.id}`)(),i.linkProgram(this.handle),Y.timeEnd(A_,`linkProgram for ${this.id}`)(),Y.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}Y.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Y.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}_reportLinkStatus(i){var n;switch(i){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((n=this.fs)==null?void 0:n.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${i}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:i}=this.device;return i.getProgramParameter(this.handle,35714)?(i.validateProgram(this.handle),i.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const i=async r=>await new Promise(o=>setTimeout(o,r));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await i(10)}}_areTexturesRenderable(){let i=!0;for(const[,n]of Object.entries(this.bindings))n instanceof Li&&(n.update(),i=i&&n.loaded);return i}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:i}=this.device;i.useProgram(this.handle);let n=0,s=0;for(const r of this.shaderLayout.bindings){const o=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${r.name} in ${this.id}`);switch(r.type){case"uniform":const{name:a}=r,c=i.getUniformBlockIndex(this.handle,a);if(c===4294967295)throw new Error(`Invalid uniform block name ${a}`);i.uniformBlockBinding(this.handle,s,c),o instanceof En?i.bindBufferBase(35345,s,o.handle):i.bindBufferRange(35345,s,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),s+=1;break;case"texture":if(!(o instanceof nr||o instanceof Li||o instanceof So))throw new Error("texture");let l;if(o instanceof nr)l=o.texture;else if(o instanceof Li)l=o;else if(o instanceof So&&o.colorAttachments[0]instanceof nr)Y.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),l=o.colorAttachments[0].texture;else throw new Error("No texture");i.activeTexture(33984+n),i.bindTexture(l.target,l.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${r.type}' not supported in WebGL`)}}}_applyUniforms(){for(const i of this.shaderLayout.uniforms||[]){const{name:n,location:s,type:r,textureUnit:o}=i,a=this.uniforms[n]??o;a!==void 0&&QI(this.device.gl,s,r,a)}}}class nO extends qh{constructor(i){super(i,{});v(this,"device");v(this,"commands",[]);this.device=i}submitCommands(i=this.commands){for(const n of i)switch(n.name){case"copy-buffer-to-buffer":sO(this.device,n.options);break;case"copy-buffer-to-texture":rO(this.device,n.options);break;case"copy-texture-to-buffer":oO(this.device,n.options);break;case"copy-texture-to-texture":aO(this.device,n.options);break}}}function sO(t,e){const i=e.source,n=e.destination;t.gl.bindBuffer(36662,i.handle),t.gl.bindBuffer(36663,n.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function rO(t,e){throw new Error("Not implemented")}function oO(t,e){const{source:i,mipLevel:n=0,aspect:s="all",width:r=e.source.width,height:o=e.source.height,depthOrArrayLayers:a=0,origin:c=[0,0],destination:l,byteOffset:u=0,bytesPerRow:h,rowsPerImage:f}=e;if(s!=="all")throw new Error("not supported");if(n!==0||a!==0||h||f)throw new Error("not implemented");const{framebuffer:d,destroyFramebuffer:p}=pv(i);let g;try{const _=l,m=r||d.width,b=o||d.height,w=Wc(d.texture.props.format),S=w.dataFormat,R=w.type;t.gl.bindBuffer(35051,_.handle),g=t.gl.bindFramebuffer(36160,d.handle),t.gl.readPixels(c[0],c[1],m,b,S,R,u)}finally{t.gl.bindBuffer(35051,null),g!==void 0&&t.gl.bindFramebuffer(36160,g),p&&d.destroy()}}function aO(t,e){const{source:i,destinationMipLevel:n=0,origin:s=[0,0],destinationOrigin:r=[0,0],destination:o}=e;let{width:a=e.destination.width,height:c=e.destination.height}=e;const{framebuffer:l,destroyFramebuffer:u}=pv(i),[h,f]=s,[d,p,g]=r,_=t.gl.bindFramebuffer(36160,l.handle);let m=null,b;if(o instanceof Li)m=o,a=Number.isFinite(a)?a:m.width,c=Number.isFinite(c)?c:m.height,m.bind(0),b=m.target;else throw new Error("invalid destination");switch(b){case 3553:case 34067:t.gl.copyTexSubImage2D(b,n,d,p,h,f,a,c);break;case 35866:case 32879:t.gl.copyTexSubImage3D(b,n,d,p,g,h,f,a,c);break}m&&m.unbind(),t.gl.bindFramebuffer(36160,_),u&&l.destroy()}function pv(t){if(t instanceof ci){const{width:e,height:i,id:n}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:i,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class cO extends Xh{constructor(i,n){super(i,n);v(this,"device");v(this,"commandBuffer");this.device=i,this.commandBuffer=new nO(i)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(i){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:i})}copyBufferToTexture(i){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:i})}copyTextureToBuffer(i){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:i})}copyTextureToTexture(i){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:i})}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}resolveQuerySet(i,n,s){}}class Rd extends Yh{constructor(i,n){super(i,n);v(this,"device");v(this,"handle");v(this,"buffer",null);v(this,"bufferValue",null);this.device=i,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(i){return KE()==="Chrome"}destroy(){var i;super.destroy(),this.buffer&&((i=this.buffer)==null||i.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(i){const n=i;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(i,n){const s=n;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:r,type:o,stride:a,offset:c,normalized:l,integer:u,divisor:h}=this._getAccessor(i);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),u?this.device.gl.vertexAttribIPointer(i,r,o,a,c):this.device.gl.vertexAttribPointer(i,r,o,l,a,c),this.device.gl.enableVertexAttribArray(i),this.device.gl.vertexAttribDivisor(i,h||0),this.attributes[i]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(i,n){this._enable(i,!1),this.attributes[i]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let i=0;i<this.maxVertexAttributes;++i){const n=this.attributes[i];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(i,n)}}_getAccessor(i){const n=this.attributeInfos[i];if(!n)throw new Error(`Unknown attribute location ${i}`);const s=av(n.bufferDataType);return{size:n.bufferComponents,type:s,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(i,n=!0){const r=Rd.isConstantAttributeZeroSupported(this.device)||i!==0;(n||r)&&(i=Number(i),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(i):this.device.gl.disableVertexAttribArray(i),this.device.gl.bindVertexArray(null))}getConstantBuffer(i,n){const s=lO(n),r=s.byteLength*i,o=s.length*i;if(this.buffer&&r!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${r} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),a=a||!uO(s,this.bufferValue),a){const c=z3(n.constructor,o);V3({target:c,source:s,start:0,count:o}),this.buffer.write(c),this.bufferValue=n}return this.buffer}}function lO(t){return Array.isArray(t)?new Float32Array(t):t}function uO(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}class hO extends Kh{constructor(i,n){super(i,n);v(this,"device");v(this,"gl");v(this,"handle");v(this,"layout");v(this,"buffers",{});v(this,"unusedBuffers",{});v(this,"bindOnUse",!0);v(this,"_bound",!1);this.device=i,this.gl=i.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(i="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(tO(i))}end(){this.gl.endTransformFeedback(),this.bindOnUse||this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(i){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in i)this.setBuffer(n,i[n])})}setBuffer(i,n){const s=this._getVaryingIndex(i),{buffer:r,byteLength:o,byteOffset:a}=this._getBufferRange(n);if(s<0){this.unusedBuffers[i]=r,Y.warn(`${this.id} unusedBuffers varying buffer ${i}`)();return}this.buffers[s]={buffer:r,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(s,r,a,o)}getBuffer(i){if(R_(i))return this.buffers[i]||null;const n=this._getVaryingIndex(i);return n>=0?this.buffers[n]:null}bind(i=this.handle){if(typeof i!="function")return this.gl.bindTransformFeedback(36386,i),this;let n;return this._bound?n=i():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=i(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(i){if(i instanceof En)return{buffer:i,byteOffset:0,byteLength:i.byteLength};const{buffer:n,byteOffset:s=0,byteLength:r=i.buffer.byteLength}=i;return{buffer:n,byteOffset:s,byteLength:r}}_getVaryingIndex(i){if(R_(i))return Number(i);for(const n of this.layout.varyings)if(i===n.name)return n.location;return-1}_bindBuffers(){for(const i in this.buffers){const{buffer:n,byteLength:s,byteOffset:r}=this._getBufferRange(this.buffers[i]);this._bindBuffer(Number(i),n,r,s)}}_unbindBuffers(){for(const i in this.buffers)this.gl.bindBufferBase(35982,Number(i),null)}_bindBuffer(i,n,s=0,r){const o=n&&n.handle;!o||r===void 0?this.gl.bindBufferBase(35982,i,o):this.gl.bindBufferRange(35982,i,o,s,r)}}function R_(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class fO extends Zh{constructor(i,n){super(i,n);v(this,"device");v(this,"handle");v(this,"target",null);v(this,"_queryPending",!1);v(this,"_pollingPromise",null);if(this.device=i,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(i){return this._begin(i!=null&&i.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(i){this._queryPending||(this.target=i,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const i=this.device.gl.getQueryParameter(this.handle,34919);return i&&(this._queryPending=!1),i}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(i=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((s,r)=>{const o=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):n++>i?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function gv(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Xe(!1),0}}function dO(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return Xe(!1),0}}function pO(t,e){var _,m;const{sourceX:i=0,sourceY:n=0,sourceFormat:s=6408,sourceAttachment:r=36064}=e||{};let{target:o=null,sourceWidth:a,sourceHeight:c,sourceType:l}=e||{};const{framebuffer:u,deleteFramebuffer:h}=_v(t);Xe(u);const{gl:f,handle:d}=u;a=a||u.width,c=c||u.height;const p=r-36064;l=l||((m=(_=u.colorAttachments[p])==null?void 0:_.texture)==null?void 0:m.type)||5121,o=mO(o,l,s,a,c),l=l||UI(o);const g=f.bindFramebuffer(36160,d);return f.readPixels(i,n,a,c,s,l,o),f.bindFramebuffer(36160,g||null),h&&u.destroy(),o}function gO(t,e){const{target:i,sourceX:n=0,sourceY:s=0,sourceFormat:r=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:c,sourceType:l}=e||{};const{framebuffer:u,deleteFramebuffer:h}=_v(t);Xe(u),a=a||u.width,c=c||u.height;const f=u;l=l||5121;let d=i;if(!d){const g=gv(r),_=dO(l),m=o+a*c*g*_;d=f.device.createBuffer({byteLength:m})}const p=t.device.createCommandEncoder();return p.copyTextureToBuffer({source:t,width:a,height:c,origin:[n,s],destination:d,byteOffset:o}),p.destroy(),h&&u.destroy(),d}function _v(t){return t instanceof Bc?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:_O(t),deleteFramebuffer:!0}}function _O(t,e){const{device:i,width:n,height:s,id:r}=t;return i.createFramebuffer({...e,id:`framebuffer-for-${r}`,width:n,height:s,colorAttachments:[t]})}function mO(t,e,i,n,s){if(t)return t;e=e||5121;const r=ff(e,{clamped:!1}),o=gv(i);return new r(n*s*o)}const yO=256,vO=1024,bO=16384,wO="clear: bad arguments";function TO(t,e){const{framebuffer:i=null,color:n=null,depth:s=null,stencil:r=null}=e||{},o={};i&&(o.framebuffer=i);let a=0;n&&(a|=bO,n!==!0&&(o.clearColor=n)),s&&(a|=yO,s!==!0&&(o.clearDepth=s)),r&&(a|=vO,s!==!0&&(o.clearStencil=s)),Xe(a!==0,wO);const c=t.gl;vn(c,o,()=>{c.clear(a)})}const eo=1,Jn=class Jn extends os{constructor(i){var c,l;super({...i,id:i.id||As("webgl-device")});v(this,"type","webgl");v(this,"handle");v(this,"features");v(this,"limits");v(this,"info");v(this,"canvasContext");v(this,"lost");v(this,"_resolveContextLost");v(this,"renderPass",null);v(this,"gl");v(this,"debug",!1);v(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});v(this,"_extensions",{});v(this,"_polyfilled",!1);v(this,"spectorJS");v(this,"_constants");const n=(c=i.gl)==null?void 0:c.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);const s=((l=i.gl)==null?void 0:l.canvas)||i.canvas;this.canvasContext=new yI(this,{...i,canvas:s}),this.lost=new Promise(u=>{this._resolveContextLost=u});let r=i.gl||null;if(r||(r=LM(this.canvasContext.canvas,{...i,onContextLost:u=>{var h;return(h=this._resolveContextLost)==null?void 0:h.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!r)throw new Error("WebGL context creation failed");this.handle=r,this.gl=r,this.gl.device=this,this.gl._version=2,this.info=BM(this.gl,this._extensions),this.limits=new sI(this.gl),this.features=new nI(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:o=!0,copyState:a=!1}=i;rv(this.gl,{enable:o,copyState:a,log:(...u)=>Y.log(1,...u)()}),i.debug&&(this.gl=RI(this.gl,{...i,throwOnError:!0}),this.debug=!0,Y.level=Math.max(Y.level,1),Y.warn("WebGL debug mode activated. Performance reduced.")()),i.spector&&(this.spectorJS=EI({...this.props,canvas:this.handle.canvas}))}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(i){if(i instanceof Jn)return i;if((i==null?void 0:i.device)instanceof os)return i.device;if(!EO(i))throw new Error("Invalid WebGL2RenderingContext");return new Jn({gl:i})}static async create(i={}){var a;Y.groupCollapsed(eo,"WebGLDevice created")();const n=[];i.debug&&n.push(AI()),i.spector&&n.push(TI()),typeof i.canvas=="string"&&n.push(pd.pageLoaded);const s=await Promise.allSettled(n);for(const c of s)c.status==="rejected"&&Y.error(`Failed to initialize debug libraries ${c.reason}`)();if(Y.probe(eo+1,"DOM is loaded")(),(a=i.gl)!=null&&a.device)return Y.warn("reattaching existing device")(),Jn.attach(i.gl);const r=new Jn(i),o=`Created ${r.type}${r.debug?" debug":""} context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return Y.probe(eo,o)(),Y.table(eo,r.info)(),Y.groupEnd(eo)(),r}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(i){return Ad(this.gl,i,this._extensions)}isTextureFormatFilterable(i){return QM(this.gl,i,this._extensions)}isTextureFormatRenderable(i){return eI(this.gl,i,this._extensions)}createCanvasContext(i){throw new Error("WebGL only supports a single canvas")}createBuffer(i){const n=this._getBufferProps(i);return new En(this,n)}_createTexture(i){return new Li(this,i)}createExternalTexture(i){throw new Error("createExternalTexture() not implemented")}createSampler(i){return new hf(this,i)}createShader(i){return new OI(this,i)}createFramebuffer(i){return new So(this,i)}createVertexArray(i){return new Rd(this,i)}createTransformFeedback(i){return new hO(this,i)}createQuerySet(i){return new fO(this,i)}createRenderPipeline(i){return new iO(this,i)}beginRenderPass(i){return new LI(this,i)}createComputePipeline(i){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(i){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(i){return new cO(this,i)}submit(){var i;(i=this.renderPass)==null||i.end(),this.renderPass=null}readPixelsToArrayWebGL(i,n){return pO(i,n)}readPixelsToBufferWebGL(i,n){return gO(i,n)}setParametersWebGL(i){Lr(this.gl,i)}getParametersWebGL(i){return sv(this.gl,i)}withParametersWebGL(i,n){return vn(this.gl,i,n)}clearWebGL(i){TO(this,i)}resetWebGL(){Y.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),MM(this.gl)}loseDevice(){var r;let i=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(i=!0,s.loseContext()),(r=this._resolveContextLost)==null||r.call(this,{reason:"destroyed",message:"Application triggered context loss"}),i}pushState(){Wl(this.gl)}popState(){qo(this.gl)}setSpectorMetadata(i,n){i.__SPECTOR_Metadata=n}getGLKey(i,n){n=n||this.gl2||this.gl;const s=Number(i);for(const r in n)if(n[r]===s)return`GL.${r}`;return String(i)}setConstantAttributeWebGL(i,n){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const r=this._constants[i];switch(r&&CO(r,n)&&Y.info(1,`setConstantAttributeWebGL(${i}) could have been skipped, value unchanged`)(),this._constants[i]=n,n.constructor){case Float32Array:SO(this,i,n);break;case Int32Array:AO(this,i,n);break;case Uint32Array:RO(this,i,n);break;default:Xe(!1)}}getExtension(i){return xn(this.gl,i,this._extensions),this._extensions}};v(Jn,"type","webgl");let Ro=Jn;function EO(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function SO(t,e,i){switch(i.length){case 1:t.gl.vertexAttrib1fv(e,i);break;case 2:t.gl.vertexAttrib2fv(e,i);break;case 3:t.gl.vertexAttrib3fv(e,i);break;case 4:t.gl.vertexAttrib4fv(e,i);break;default:Xe(!1)}}function AO(t,e,i){t.gl.vertexAttribI4iv(e,i)}function RO(t,e,i){t.gl.vertexAttribI4uiv(e,i)}function CO(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}var mv={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,i,n,s){var r=["","webkit","Moz","MS","ms","o"],o=i.createElement("div"),a="function",c=Math.round,l=Math.abs,u=Date.now;function h(y,T,A){return setTimeout(w(y,A),T)}function f(y,T,A){return Array.isArray(y)?(d(y,A[T],A),!0):!1}function d(y,T,A){var D;if(y)if(y.forEach)y.forEach(T,A);else if(y.length!==s)for(D=0;D<y.length;)T.call(A,y[D],D,y),D++;else for(D in y)y.hasOwnProperty(D)&&T.call(A,y[D],D,y)}function p(y,T,A){var D="DEPRECATED METHOD: "+T+`
`+A+` AT 
`;return function(){var q=new Error("get-stack-trace"),Q=q&&q.stack?q.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",me=e.console&&(e.console.warn||e.console.log);return me&&me.call(e.console,D,Q),y.apply(this,arguments)}}var g;typeof Object.assign!="function"?g=function(T){if(T===s||T===null)throw new TypeError("Cannot convert undefined or null to object");for(var A=Object(T),D=1;D<arguments.length;D++){var q=arguments[D];if(q!==s&&q!==null)for(var Q in q)q.hasOwnProperty(Q)&&(A[Q]=q[Q])}return A}:g=Object.assign;var _=p(function(T,A,D){for(var q=Object.keys(A),Q=0;Q<q.length;)(!D||D&&T[q[Q]]===s)&&(T[q[Q]]=A[q[Q]]),Q++;return T},"extend","Use `assign`."),m=p(function(T,A){return _(T,A,!0)},"merge","Use `assign`.");function b(y,T,A){var D=T.prototype,q;q=y.prototype=Object.create(D),q.constructor=y,q._super=D,A&&g(q,A)}function w(y,T){return function(){return y.apply(T,arguments)}}function S(y,T){return typeof y==a?y.apply(T&&T[0]||s,T):y}function R(y,T){return y===s?T:y}function M(y,T,A){d(N(T),function(D){y.addEventListener(D,A,!1)})}function k(y,T,A){d(N(T),function(D){y.removeEventListener(D,A,!1)})}function F(y,T){for(;y;){if(y==T)return!0;y=y.parentNode}return!1}function I(y,T){return y.indexOf(T)>-1}function N(y){return y.trim().split(/\s+/g)}function C(y,T,A){if(y.indexOf&&!A)return y.indexOf(T);for(var D=0;D<y.length;){if(A&&y[D][A]==T||!A&&y[D]===T)return D;D++}return-1}function V(y){return Array.prototype.slice.call(y,0)}function X(y,T,A){for(var D=[],q=[],Q=0;Q<y.length;){var me=T?y[Q][T]:y[Q];C(q,me)<0&&D.push(y[Q]),q[Q]=me,Q++}return A&&(T?D=D.sort(function(Tt,Bt){return Tt[T]>Bt[T]}):D=D.sort()),D}function K(y,T){for(var A,D,q=T[0].toUpperCase()+T.slice(1),Q=0;Q<r.length;){if(A=r[Q],D=A?A+q:T,D in y)return D;Q++}return s}var B=1;function re(){return B++}function be(y){var T=y.ownerDocument||y;return T.defaultView||T.parentWindow||e}var Ce=/mobile|tablet|ip(ad|hone|od)|android/i,fe="ontouchstart"in e,Ze=K(e,"PointerEvent")!==s,_t=fe&&Ce.test(navigator.userAgent),xe="touch",Le="pen",Ct="mouse",le="kinect",Ye=25,st=1,Ge=2,Ie=4,Je=8,Dt=1,xt=2,bt=4,Pt=8,jt=16,ge=xt|bt,pe=Pt|jt,Be=ge|pe,$e=["x","y"],Pe=["clientX","clientY"];function _e(y,T){var A=this;this.manager=y,this.callback=T,this.element=y.element,this.target=y.options.inputTarget,this.domHandler=function(D){S(y.options.enable,[y])&&A.handler(D)},this.init()}_e.prototype={handler:function(){},init:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M(be(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&k(this.element,this.evEl,this.domHandler),this.evTarget&&k(this.target,this.evTarget,this.domHandler),this.evWin&&k(be(this.element),this.evWin,this.domHandler)}};function de(y){var T,A=y.options.inputClass;return A?T=A:Ze?T=Ai:_t?T=Ln:fe?T=Ft:T=$t,new T(y,ut)}function ut(y,T,A){var D=A.pointers.length,q=A.changedPointers.length,Q=T&st&&D-q===0,me=T&(Ie|Je)&&D-q===0;A.isFirst=!!Q,A.isFinal=!!me,Q&&(y.session={}),A.eventType=T,Yt(y,A),y.emit("hammer.input",A),y.recognize(A),y.session.prevInput=A}function Yt(y,T){var A=y.session,D=T.pointers,q=D.length;A.firstInput||(A.firstInput=wt(T)),q>1&&!A.firstMultiple?A.firstMultiple=wt(T):q===1&&(A.firstMultiple=!1);var Q=A.firstInput,me=A.firstMultiple,mt=me?me.center:Q.center,Tt=T.center=He(D);T.timeStamp=u(),T.deltaTime=T.timeStamp-Q.timeStamp,T.angle=te(mt,Tt),T.distance=z(mt,Tt),ct(A,T),T.offsetDirection=Ue(T.deltaX,T.deltaY);var Bt=lt(T.deltaTime,T.deltaX,T.deltaY);T.overallVelocityX=Bt.x,T.overallVelocityY=Bt.y,T.overallVelocity=l(Bt.x)>l(Bt.y)?Bt.x:Bt.y,T.scale=me?Kt(me.pointers,D):1,T.rotation=me?Me(me.pointers,D):0,T.maxPointers=A.prevInput?T.pointers.length>A.prevInput.maxPointers?T.pointers.length:A.prevInput.maxPointers:T.pointers.length,ht(A,T);var Ci=y.element;F(T.srcEvent.target,Ci)&&(Ci=T.srcEvent.target),T.target=Ci}function ct(y,T){var A=T.center,D=y.offsetDelta||{},q=y.prevDelta||{},Q=y.prevInput||{};(T.eventType===st||Q.eventType===Ie)&&(q=y.prevDelta={x:Q.deltaX||0,y:Q.deltaY||0},D=y.offsetDelta={x:A.x,y:A.y}),T.deltaX=q.x+(A.x-D.x),T.deltaY=q.y+(A.y-D.y)}function ht(y,T){var A=y.lastInterval||T,D=T.timeStamp-A.timeStamp,q,Q,me,mt;if(T.eventType!=Je&&(D>Ye||A.velocity===s)){var Tt=T.deltaX-A.deltaX,Bt=T.deltaY-A.deltaY,Ci=lt(D,Tt,Bt);Q=Ci.x,me=Ci.y,q=l(Ci.x)>l(Ci.y)?Ci.x:Ci.y,mt=Ue(Tt,Bt),y.lastInterval=T}else q=A.velocity,Q=A.velocityX,me=A.velocityY,mt=A.direction;T.velocity=q,T.velocityX=Q,T.velocityY=me,T.direction=mt}function wt(y){for(var T=[],A=0;A<y.pointers.length;)T[A]={clientX:c(y.pointers[A].clientX),clientY:c(y.pointers[A].clientY)},A++;return{timeStamp:u(),pointers:T,center:He(T),deltaX:y.deltaX,deltaY:y.deltaY}}function He(y){var T=y.length;if(T===1)return{x:c(y[0].clientX),y:c(y[0].clientY)};for(var A=0,D=0,q=0;q<T;)A+=y[q].clientX,D+=y[q].clientY,q++;return{x:c(A/T),y:c(D/T)}}function lt(y,T,A){return{x:T/y||0,y:A/y||0}}function Ue(y,T){return y===T?Dt:l(y)>=l(T)?y<0?xt:bt:T<0?Pt:jt}function z(y,T,A){A||(A=$e);var D=T[A[0]]-y[A[0]],q=T[A[1]]-y[A[1]];return Math.sqrt(D*D+q*q)}function te(y,T,A){A||(A=$e);var D=T[A[0]]-y[A[0]],q=T[A[1]]-y[A[1]];return Math.atan2(q,D)*180/Math.PI}function Me(y,T){return te(T[1],T[0],Pe)+te(y[1],y[0],Pe)}function Kt(y,T){return z(T[0],T[1],Pe)/z(y[0],y[1],Pe)}var fi={mousedown:st,mousemove:Ge,mouseup:Ie},Si="mousedown",Fn="mousemove mouseup";function $t(){this.evEl=Si,this.evWin=Fn,this.pressed=!1,_e.apply(this,arguments)}b($t,_e,{handler:function(T){var A=fi[T.type];A&st&&T.button===0&&(this.pressed=!0),A&Ge&&T.which!==1&&(A=Ie),this.pressed&&(A&Ie&&(this.pressed=!1),this.callback(this.manager,A,{pointers:[T],changedPointers:[T],pointerType:Ct,srcEvent:T}))}});var ii={pointerdown:st,pointermove:Ge,pointerup:Ie,pointercancel:Je,pointerout:Je},Ps={2:xe,3:Le,4:Ct,5:le},ji="pointerdown",di="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(ji="MSPointerDown",di="MSPointerMove MSPointerUp MSPointerCancel");function Ai(){this.evEl=ji,this.evWin=di,_e.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}b(Ai,_e,{handler:function(T){var A=this.store,D=!1,q=T.type.toLowerCase().replace("ms",""),Q=ii[q],me=Ps[T.pointerType]||T.pointerType,mt=me==xe,Tt=C(A,T.pointerId,"pointerId");Q&st&&(T.button===0||mt)?Tt<0&&(A.push(T),Tt=A.length-1):Q&(Ie|Je)&&(D=!0),!(Tt<0)&&(A[Tt]=T,this.callback(this.manager,Q,{pointers:A,changedPointers:[T],pointerType:me,srcEvent:T}),D&&A.splice(Tt,1))}});var tn={touchstart:st,touchmove:Ge,touchend:Ie,touchcancel:Je},Ms="touchstart",zr="touchstart touchmove touchend touchcancel";function Vr(){this.evTarget=Ms,this.evWin=zr,this.started=!1,_e.apply(this,arguments)}b(Vr,_e,{handler:function(T){var A=tn[T.type];if(A===st&&(this.started=!0),!!this.started){var D=tu.call(this,T,A);A&(Ie|Je)&&D[0].length-D[1].length===0&&(this.started=!1),this.callback(this.manager,A,{pointers:D[0],changedPointers:D[1],pointerType:xe,srcEvent:T})}}});function tu(y,T){var A=V(y.touches),D=V(y.changedTouches);return T&(Ie|Je)&&(A=X(A.concat(D),"identifier",!0)),[A,D]}var Is={touchstart:st,touchmove:Ge,touchend:Ie,touchcancel:Je},la="touchstart touchmove touchend touchcancel";function Ln(){this.evTarget=la,this.targetIds={},_e.apply(this,arguments)}b(Ln,_e,{handler:function(T){var A=Is[T.type],D=ua.call(this,T,A);D&&this.callback(this.manager,A,{pointers:D[0],changedPointers:D[1],pointerType:xe,srcEvent:T})}});function ua(y,T){var A=V(y.touches),D=this.targetIds;if(T&(st|Ge)&&A.length===1)return D[A[0].identifier]=!0,[A,A];var q,Q,me=V(y.changedTouches),mt=[],Tt=this.target;if(Q=A.filter(function(Bt){return F(Bt.target,Tt)}),T===st)for(q=0;q<Q.length;)D[Q[q].identifier]=!0,q++;for(q=0;q<me.length;)D[me[q].identifier]&&mt.push(me[q]),T&(Ie|Je)&&delete D[me[q].identifier],q++;if(mt.length)return[X(Q.concat(mt),"identifier",!0),mt]}var iu=2500,Os=25;function Ft(){_e.apply(this,arguments);var y=w(this.handler,this);this.touch=new Ln(this.manager,y),this.mouse=new $t(this.manager,y),this.primaryTouch=null,this.lastTouches=[]}b(Ft,_e,{handler:function(T,A,D){var q=D.pointerType==xe,Q=D.pointerType==Ct;if(!(Q&&D.sourceCapabilities&&D.sourceCapabilities.firesTouchEvents)){if(q)jr.call(this,A,D);else if(Q&&ha.call(this,D))return;this.callback(T,A,D)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function jr(y,T){y&st?(this.primaryTouch=T.changedPointers[0].identifier,Bn.call(this,T)):y&(Ie|Je)&&Bn.call(this,T)}function Bn(y){var T=y.changedPointers[0];if(T.identifier===this.primaryTouch){var A={x:T.clientX,y:T.clientY};this.lastTouches.push(A);var D=this.lastTouches,q=function(){var Q=D.indexOf(A);Q>-1&&D.splice(Q,1)};setTimeout(q,iu)}}function ha(y){for(var T=y.srcEvent.clientX,A=y.srcEvent.clientY,D=0;D<this.lastTouches.length;D++){var q=this.lastTouches[D],Q=Math.abs(T-q.x),me=Math.abs(A-q.y);if(Q<=Os&&me<=Os)return!0}return!1}var ks=K(o.style,"touchAction"),$r=ks!==s,Hr="compute",fa="auto",Wr="manipulation",$i="none",Un="pan-x",zn="pan-y",Ns=su();function Xr(y,T){this.manager=y,this.set(T)}Xr.prototype={set:function(y){y==Hr&&(y=this.compute()),$r&&this.manager.element.style&&Ns[y]&&(this.manager.element.style[ks]=y),this.actions=y.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var y=[];return d(this.manager.recognizers,function(T){S(T.options.enable,[T])&&(y=y.concat(T.getTouchAction()))}),nu(y.join(" "))},preventDefaults:function(y){var T=y.srcEvent,A=y.offsetDirection;if(this.manager.session.prevented){T.preventDefault();return}var D=this.actions,q=I(D,$i)&&!Ns[$i],Q=I(D,zn)&&!Ns[zn],me=I(D,Un)&&!Ns[Un];if(q){var mt=y.pointers.length===1,Tt=y.distance<2,Bt=y.deltaTime<250;if(mt&&Tt&&Bt)return}if(!(me&&Q)&&(q||Q&&A&ge||me&&A&pe))return this.preventSrc(T)},preventSrc:function(y){this.manager.session.prevented=!0,y.preventDefault()}};function nu(y){if(I(y,$i))return $i;var T=I(y,Un),A=I(y,zn);return T&&A?$i:T||A?T?Un:zn:I(y,Wr)?Wr:fa}function su(){if(!$r)return!1;var y={},T=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(A){y[A]=T?e.CSS.supports("touch-action",A):!0}),y}var Ds=1,Ht=2,nn=4,Ri=8,pi=Ri,Vn=16,ni=32;function gi(y){this.options=g({},this.defaults,y||{}),this.id=re(),this.manager=null,this.options.enable=R(this.options.enable,!0),this.state=Ds,this.simultaneous={},this.requireFail=[]}gi.prototype={defaults:{},set:function(y){return g(this.options,y),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(y){if(f(y,"recognizeWith",this))return this;var T=this.simultaneous;return y=ie(y,this),T[y.id]||(T[y.id]=y,y.recognizeWith(this)),this},dropRecognizeWith:function(y){return f(y,"dropRecognizeWith",this)?this:(y=ie(y,this),delete this.simultaneous[y.id],this)},requireFailure:function(y){if(f(y,"requireFailure",this))return this;var T=this.requireFail;return y=ie(y,this),C(T,y)===-1&&(T.push(y),y.requireFailure(this)),this},dropRequireFailure:function(y){if(f(y,"dropRequireFailure",this))return this;y=ie(y,this);var T=C(this.requireFail,y);return T>-1&&this.requireFail.splice(T,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(y){return!!this.simultaneous[y.id]},emit:function(y){var T=this,A=this.state;function D(q){T.manager.emit(q,y)}A<Ri&&D(T.options.event+$(A)),D(T.options.event),y.additionalEvent&&D(y.additionalEvent),A>=Ri&&D(T.options.event+$(A))},tryEmit:function(y){if(this.canEmit())return this.emit(y);this.state=ni},canEmit:function(){for(var y=0;y<this.requireFail.length;){if(!(this.requireFail[y].state&(ni|Ds)))return!1;y++}return!0},recognize:function(y){var T=g({},y);if(!S(this.options.enable,[this,T])){this.reset(),this.state=ni;return}this.state&(pi|Vn|ni)&&(this.state=Ds),this.state=this.process(T),this.state&(Ht|nn|Ri|Vn)&&this.tryEmit(T)},process:function(y){},getTouchAction:function(){},reset:function(){}};function $(y){return y&Vn?"cancel":y&Ri?"end":y&nn?"move":y&Ht?"start":""}function Z(y){return y==jt?"down":y==Pt?"up":y==xt?"left":y==bt?"right":""}function ie(y,T){var A=T.manager;return A?A.get(y):y}function J(){gi.apply(this,arguments)}b(J,gi,{defaults:{pointers:1},attrTest:function(y){var T=this.options.pointers;return T===0||y.pointers.length===T},process:function(y){var T=this.state,A=y.eventType,D=T&(Ht|nn),q=this.attrTest(y);return D&&(A&Je||!q)?T|Vn:D||q?A&Ie?T|Ri:T&Ht?T|nn:Ht:ni}});function G(){J.apply(this,arguments),this.pX=null,this.pY=null}b(G,J,{defaults:{event:"pan",threshold:10,pointers:1,direction:Be},getTouchAction:function(){var y=this.options.direction,T=[];return y&ge&&T.push(zn),y&pe&&T.push(Un),T},directionTest:function(y){var T=this.options,A=!0,D=y.distance,q=y.direction,Q=y.deltaX,me=y.deltaY;return q&T.direction||(T.direction&ge?(q=Q===0?Dt:Q<0?xt:bt,A=Q!=this.pX,D=Math.abs(y.deltaX)):(q=me===0?Dt:me<0?Pt:jt,A=me!=this.pY,D=Math.abs(y.deltaY))),y.direction=q,A&&D>T.threshold&&q&T.direction},attrTest:function(y){return J.prototype.attrTest.call(this,y)&&(this.state&Ht||!(this.state&Ht)&&this.directionTest(y))},emit:function(y){this.pX=y.deltaX,this.pY=y.deltaY;var T=Z(y.direction);T&&(y.additionalEvent=this.options.event+T),this._super.emit.call(this,y)}});function ne(){J.apply(this,arguments)}b(ne,J,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[$i]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.scale-1)>this.options.threshold||this.state&Ht)},emit:function(y){if(y.scale!==1){var T=y.scale<1?"in":"out";y.additionalEvent=this.options.event+T}this._super.emit.call(this,y)}});function he(){gi.apply(this,arguments),this._timer=null,this._input=null}b(he,gi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[fa]},process:function(y){var T=this.options,A=y.pointers.length===T.pointers,D=y.distance<T.threshold,q=y.deltaTime>T.time;if(this._input=y,!D||!A||y.eventType&(Ie|Je)&&!q)this.reset();else if(y.eventType&st)this.reset(),this._timer=h(function(){this.state=pi,this.tryEmit()},T.time,this);else if(y.eventType&Ie)return pi;return ni},reset:function(){clearTimeout(this._timer)},emit:function(y){this.state===pi&&(y&&y.eventType&Ie?this.manager.emit(this.options.event+"up",y):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function ze(){J.apply(this,arguments)}b(ze,J,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[$i]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.rotation)>this.options.threshold||this.state&Ht)}});function ft(){J.apply(this,arguments)}b(ft,J,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ge|pe,pointers:1},getTouchAction:function(){return G.prototype.getTouchAction.call(this)},attrTest:function(y){var T=this.options.direction,A;return T&(ge|pe)?A=y.overallVelocity:T&ge?A=y.overallVelocityX:T&pe&&(A=y.overallVelocityY),this._super.attrTest.call(this,y)&&T&y.offsetDirection&&y.distance>this.options.threshold&&y.maxPointers==this.options.pointers&&l(A)>this.options.velocity&&y.eventType&Ie},emit:function(y){var T=Z(y.offsetDirection);T&&this.manager.emit(this.options.event+T,y),this.manager.emit(this.options.event,y)}});function rt(){gi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}b(rt,gi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Wr]},process:function(y){var T=this.options,A=y.pointers.length===T.pointers,D=y.distance<T.threshold,q=y.deltaTime<T.time;if(this.reset(),y.eventType&st&&this.count===0)return this.failTimeout();if(D&&q&&A){if(y.eventType!=Ie)return this.failTimeout();var Q=this.pTime?y.timeStamp-this.pTime<T.interval:!0,me=!this.pCenter||z(this.pCenter,y.center)<T.posThreshold;this.pTime=y.timeStamp,this.pCenter=y.center,!me||!Q?this.count=1:this.count+=1,this._input=y;var mt=this.count%T.taps;if(mt===0)return this.hasRequireFailures()?(this._timer=h(function(){this.state=pi,this.tryEmit()},T.interval,this),Ht):pi}return ni},failTimeout:function(){return this._timer=h(function(){this.state=ni},this.options.interval,this),ni},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==pi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ke(y,T){return T=T||{},T.recognizers=R(T.recognizers,Ke.defaults.preset),new qr(y,T)}Ke.VERSION="2.0.7",Ke.defaults={domEvents:!1,touchAction:Hr,enable:!0,inputTarget:null,inputClass:null,preset:[[ze,{enable:!1}],[ne,{enable:!1},["rotate"]],[ft,{direction:ge}],[G,{direction:ge},["swipe"]],[rt],[rt,{event:"doubletap",taps:2},["tap"]],[he]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Lt=1,Fs=2;function qr(y,T){this.options=g({},Ke.defaults,T||{}),this.options.inputTarget=this.options.inputTarget||y,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=y,this.input=de(this),this.touchAction=new Xr(this,this.options.touchAction),da(this,!0),d(this.options.recognizers,function(A){var D=this.add(new A[0](A[1]));A[2]&&D.recognizeWith(A[2]),A[3]&&D.requireFailure(A[3])},this)}qr.prototype={set:function(y){return g(this.options,y),y.touchAction&&this.touchAction.update(),y.inputTarget&&(this.input.destroy(),this.input.target=y.inputTarget,this.input.init()),this},stop:function(y){this.session.stopped=y?Fs:Lt},recognize:function(y){var T=this.session;if(!T.stopped){this.touchAction.preventDefaults(y);var A,D=this.recognizers,q=T.curRecognizer;(!q||q&&q.state&pi)&&(q=T.curRecognizer=null);for(var Q=0;Q<D.length;)A=D[Q],T.stopped!==Fs&&(!q||A==q||A.canRecognizeWith(q))?A.recognize(y):A.reset(),!q&&A.state&(Ht|nn|Ri)&&(q=T.curRecognizer=A),Q++}},get:function(y){if(y instanceof gi)return y;for(var T=this.recognizers,A=0;A<T.length;A++)if(T[A].options.event==y)return T[A];return null},add:function(y){if(f(y,"add",this))return this;var T=this.get(y.options.event);return T&&this.remove(T),this.recognizers.push(y),y.manager=this,this.touchAction.update(),y},remove:function(y){if(f(y,"remove",this))return this;if(y=this.get(y),y){var T=this.recognizers,A=C(T,y);A!==-1&&(T.splice(A,1),this.touchAction.update())}return this},on:function(y,T){if(y!==s&&T!==s){var A=this.handlers;return d(N(y),function(D){A[D]=A[D]||[],A[D].push(T)}),this}},off:function(y,T){if(y!==s){var A=this.handlers;return d(N(y),function(D){T?A[D]&&A[D].splice(C(A[D],T),1):delete A[D]}),this}},emit:function(y,T){this.options.domEvents&&Gb(y,T);var A=this.handlers[y]&&this.handlers[y].slice();if(!(!A||!A.length)){T.type=y,T.preventDefault=function(){T.srcEvent.preventDefault()};for(var D=0;D<A.length;)A[D](T),D++}},destroy:function(){this.element&&da(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function da(y,T){var A=y.element;if(A.style){var D;d(y.options.cssProps,function(q,Q){D=K(A.style,Q),T?(y.oldCssProps[D]=A.style[D],A.style[D]=q):A.style[D]=y.oldCssProps[D]||""}),T||(y.oldCssProps={})}}function Gb(y,T){var A=i.createEvent("Event");A.initEvent(y,!0,!0),A.gesture=T,T.target.dispatchEvent(A)}g(Ke,{INPUT_START:st,INPUT_MOVE:Ge,INPUT_END:Ie,INPUT_CANCEL:Je,STATE_POSSIBLE:Ds,STATE_BEGAN:Ht,STATE_CHANGED:nn,STATE_ENDED:Ri,STATE_RECOGNIZED:pi,STATE_CANCELLED:Vn,STATE_FAILED:ni,DIRECTION_NONE:Dt,DIRECTION_LEFT:xt,DIRECTION_RIGHT:bt,DIRECTION_UP:Pt,DIRECTION_DOWN:jt,DIRECTION_HORIZONTAL:ge,DIRECTION_VERTICAL:pe,DIRECTION_ALL:Be,Manager:qr,Input:_e,TouchAction:Xr,TouchInput:Ln,MouseInput:$t,PointerEventInput:Ai,TouchMouseInput:Ft,SingleTouchInput:Vr,Recognizer:gi,AttrRecognizer:J,Tap:rt,Pan:G,Swipe:ft,Pinch:ne,Rotate:ze,Press:he,on:M,off:k,each:d,merge:m,extend:_,assign:g,inherit:b,bindFn:w,prefixed:K});var Jb=typeof e<"u"?e:typeof self<"u"?self:{};Jb.Hammer=Ke,typeof s=="function"&&s.amd?s(function(){return Ke}):t.exports?t.exports=Ke:e[n]=Ke})(window,document,"Hammer")})(mv);var oa=mv.exports;const xO=Yf(oa),Ii=fw({__proto__:null,default:xO},[oa]),yv=1,vv=2,df=4,PO={mousedown:yv,mousemove:vv,mouseup:df};function MO(t,e){for(let i=0;i<t.length;i++)if(e(t[i]))return!0;return!1}function IO(t){const e=t.prototype.handler;t.prototype.handler=function(n){const s=this.store;n.button>0&&n.type==="pointerdown"&&(MO(s,r=>r.pointerId===n.pointerId)||s.push(n)),e.call(this,n)}}function OO(t){t.prototype.handler=function(i){let n=PO[i.type];n&yv&&i.button>=0&&(this.pressed=!0),n&vv&&i.which===0&&(n=df),this.pressed&&(n&df&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[i],changedPointers:[i],pointerType:"mouse",srcEvent:i}))}}IO(oa.PointerEventInput);OO(oa.MouseInput);const kO=oa.Manager;class ql{constructor(e,i,n){this.element=e,this.callback=i,this.options={enable:!0,...n}}}const NO=Ii?[[Ii.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Ii.Rotate,{enable:!1}],[Ii.Pinch,{enable:!1}],[Ii.Swipe,{enable:!1}],[Ii.Pan,{threshold:0,enable:!1}],[Ii.Press,{enable:!1}],[Ii.Tap,{event:"doubletap",taps:2,enable:!1}],[Ii.Tap,{event:"anytap",enable:!1}],[Ii.Tap,{enable:!1}]]:null,C_={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},DO={doubletap:["tap"]},FO={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Cd={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},LO={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},x_={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},BO=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",sr=typeof window<"u"?window:global;let pf=!1;try{const t={get passive(){return pf=!0,!0}};sr.addEventListener("test",null,t),sr.removeEventListener("test",null)}catch{pf=!1}const UO=BO.indexOf("firefox")!==-1,{WHEEL_EVENTS:zO}=Cd,P_="wheel",M_=4.000244140625,VO=40,jO=.25;class $O extends ql{constructor(e,i,n){super(e,i,n),this.handleEvent=s=>{if(!this.options.enable)return;let r=s.deltaY;sr.WheelEvent&&(UO&&s.deltaMode===sr.WheelEvent.DOM_DELTA_PIXEL&&(r/=sr.devicePixelRatio),s.deltaMode===sr.WheelEvent.DOM_DELTA_LINE&&(r*=VO)),r!==0&&r%M_===0&&(r=Math.floor(r/M_)),s.shiftKey&&r&&(r=r*jO),this.callback({type:P_,center:{x:s.clientX,y:s.clientY},delta:-r,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat(zO),this.events.forEach(s=>e.addEventListener(s,this.handleEvent,pf?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===P_&&(this.options.enable=i)}}const{MOUSE_EVENTS:HO}=Cd,I_="pointermove",O_="pointerover",k_="pointerout",N_="pointerenter",D_="pointerleave";class WO extends ql{constructor(e,i,n){super(e,i,n),this.handleEvent=r=>{this.handleOverEvent(r),this.handleOutEvent(r),this.handleEnterEvent(r),this.handleLeaveEvent(r),this.handleMoveEvent(r)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(HO),this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===I_&&(this.enableMoveEvent=i),e===O_&&(this.enableOverEvent=i),e===k_&&(this.enableOutEvent=i),e===N_&&(this.enableEnterEvent=i),e===D_&&(this.enableLeaveEvent=i)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(O_,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(k_,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(N_,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(D_,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(I_,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,i){this.callback({type:e,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const{KEY_EVENTS:XO}=Cd,F_="keydown",L_="keyup";class qO extends ql{constructor(e,i,n){super(e,i,n),this.handleEvent=s=>{const r=s.target||s.srcElement;r.tagName==="INPUT"&&r.type==="text"||r.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:F_,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:L_,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(XO),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===F_&&(this.enableDownEvent=i),e===L_&&(this.enableUpEvent=i)}}const B_="contextmenu";class YO extends ql{constructor(e,i,n){super(e,i,n),this.handleEvent=s=>{this.options.enable&&this.callback({type:B_,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,i){e===B_&&(this.options.enable=i)}}const gf=1,Xc=2,_f=4,KO={pointerdown:gf,pointermove:Xc,pointerup:_f,mousedown:gf,mousemove:Xc,mouseup:_f},ZO=1,GO=2,JO=3,QO=0,ek=1,tk=2,ik=1,nk=2,sk=4;function rk(t){const e=KO[t.srcEvent.type];if(!e)return null;const{buttons:i,button:n,which:s}=t.srcEvent;let r=!1,o=!1,a=!1;return e===_f||e===Xc&&!Number.isFinite(i)?(r=s===ZO,o=s===GO,a=s===JO):e===Xc?(r=!!(i&ik),o=!!(i&sk),a=!!(i&nk)):e===gf&&(r=n===QO,o=n===ek,a=n===tk),{leftButton:r,middleButton:o,rightButton:a}}function ok(t,e){const i=t.center;if(!i)return null;const n=e.getBoundingClientRect(),s=n.width/e.offsetWidth||1,r=n.height/e.offsetHeight||1,o={x:(i.x-n.left-e.clientLeft)/s,y:(i.y-n.top-e.clientTop)/r};return{center:i,offsetCenter:o}}const ju={srcElement:"root",priority:0};class ak{constructor(e){this.handleEvent=i=>{if(this.isEmpty())return;const n=this._normalizeEvent(i);let s=i.srcEvent.target;for(;s&&s!==n.rootElement;){if(this._emit(n,s),n.handled)return;s=s.parentNode}this._emit(n,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,i,n,s=!1,r=!1){const{handlers:o,handlersByElement:a}=this;let c=ju;typeof n=="string"||n&&n.addEventListener?c={...ju,srcElement:n}:n&&(c={...ju,...n});let l=a.get(c.srcElement);l||(l=[],a.set(c.srcElement,l));const u={type:e,handler:i,srcElement:c.srcElement,priority:c.priority};s&&(u.once=!0),r&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let h=l.length-1;for(;h>=0&&!(l[h].priority>=u.priority);)h--;l.splice(h+1,0,u)}remove(e,i){const{handlers:n,handlersByElement:s}=this;for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.type===e&&o.handler===i){n.splice(r,1);const a=s.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&s.delete(o.srcElement)}}this._active=n.some(r=>!r.passive)}_emit(e,i){const n=this.handlersByElement.get(i);if(n){let s=!1;const r=()=>{e.handled=!0},o=()=>{e.handled=!0,s=!0},a=[];for(let c=0;c<n.length;c++){const{type:l,handler:u,once:h}=n[c];if(u({...e,type:l,stopPropagation:r,stopImmediatePropagation:o}),h&&a.push(n[c]),s)break}for(let c=0;c<a.length;c++){const{type:l,handler:u}=a[c];this.remove(l,u)}}}_normalizeEvent(e){const i=this.eventManager.getElement();return{...e,...rk(e),...ok(e,i),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}const ck={events:null,recognizers:null,recognizerOptions:{},Manager:kO,touchAction:"none",tabIndex:0};class lk{constructor(e=null,i){this._onBasicInput=s=>{const{srcEvent:r}=s,o=FO[r.type];o&&this.manager.emit(o,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...ck,...i},this.events=new Map,this.setElement(e);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:i}=this,n=i.Manager;this.manager=new n(e,{touchAction:i.touchAction,recognizers:i.recognizers||NO}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(C_).forEach(s=>{const r=this.manager.get(s);r&&C_[s].forEach(o=>{r.recognizeWith(o)})});for(const s in i.recognizerOptions){const r=this.manager.get(s);if(r){const o=i.recognizerOptions[s];delete o.enable,r.set(o)}}this.wheelInput=new $O(e,this._onOtherEvent,{enable:!1}),this.moveInput=new WO(e,this._onOtherEvent,{enable:!1}),this.keyInput=new qO(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new YO(e,this._onOtherEvent,{enable:!1});for(const[s,r]of this.events)r.isEmpty()||(this._toggleRecognizer(r.recognizerName,!0),this.manager.on(s,r.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,i,n){this._addEventHandler(e,i,n,!1)}once(e,i,n){this._addEventHandler(e,i,n,!0)}watch(e,i,n){this._addEventHandler(e,i,n,!1,!0)}off(e,i){this._removeEventHandler(e,i)}_toggleRecognizer(e,i){const{manager:n}=this;if(!n)return;const s=n.get(e);if(s&&s.options.enable!==i){s.set({enable:i});const r=DO[e];r&&!this.options.recognizers&&r.forEach(o=>{const a=n.get(o);i?(a.requireFailure(e),s.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,i),this.moveInput.enableEventType(e,i),this.keyInput.enableEventType(e,i),this.contextmenuInput.enableEventType(e,i)}_addEventHandler(e,i,n,s,r){if(typeof e!="string"){n=i;for(const u in e)this._addEventHandler(u,e[u],n,s,r);return}const{manager:o,events:a}=this,c=x_[e]||e;let l=a.get(c);l||(l=new ak(this),a.set(c,l),l.recognizerName=LO[c]||c,o&&o.on(c,l.handleEvent)),l.add(e,i,n,s,r),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(e,i){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:n}=this,s=x_[e]||e,r=n.get(s);if(r&&(r.remove(e,i),r.isEmpty())){const{recognizerName:o}=r;let a=!1;for(const c of n.values())if(c.recognizerName===o&&!c.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function an(){}const uk=({isDragging:t})=>t?"grabbing":"grab",U_={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:an,onWebGLInitialized:an,onResize:an,onViewStateChange:an,onInteractionStateChange:an,onBeforeRender:an,onAfterRender:an,onLoad:an,onError:t=>ve.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:uk,getTooltip:null,debug:!1,drawPickingColors:!1},bl=class bl{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new ia({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:s}=this;if(n.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(n.leftButton||n.rightButton)return;{const r=n.offsetCenter;if(!r)return;s.x=r.x,s.y=r.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=n},this._onEvent=n=>{const s=tf[n.type],r=n.offsetCenter;if(!s||!r||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:o,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:c}=a,l=c&&(c[s.handler]||c.props[s.handler]),u=this.props[s.handler];let h=!1;l&&(h=l.call(c,a,n)),h||(u==null||u(a,n),this.widgetManager.onEvent(a,n))},this._onPointerDown=n=>{const s=n.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo},this.props={...U_,...e},e=this.props,e.viewState&&e.initialViewState&&ve.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&ve.error("WebGL1 context not supported.")(),this.device=Ro.attach(e.gl));let i=this.device;i||(as.registerDevices([Ro]),i=as.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(i,e),this.setProps(e),e._typedArrayManagerProps&&Cr.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,i,n,s,r,o,a,c,l,u;(e=this.animationLoop)==null||e.stop(),(i=this.animationLoop)==null||i.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(r=this.effectManager)==null||r.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(c=this.eventManager)==null||c.destroy(),this.eventManager=null,(l=this.widgetManager)==null||l.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((u=this.canvas.parentElement)==null||u.removeChild(this.canvas),this.canvas=null)}setProps(e){var n;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ve.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ve.removed("onLayerClick","onClick")(),e.initialViewState&&!wi(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(n=this.animationLoop)==null||n.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i),this.widgetManager.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),r=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return i=i||n||s||r||o,i}redraw(e){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=e||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return St(this.viewManager),this.viewManager.views}getViewports(e){return St(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const i=this._pick("pickObject","pickObject Time",e).result;return i.length?i[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,i=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:i})}_removeResources(e){for(const i of e)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var i;(i=this.layerManager)==null||i.removeDefaultShaderModule(e)}_pick(e,i,n){St(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(i).timeStart();const r=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return s.get(i).timeEnd(),r}_createCanvas(e){let i=e.canvas;return typeof i=="string"&&(i=document.getElementById(i),St(i)),i||(i=document.createElement("canvas"),i.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(i)),Object.assign(i.style,e.style),i}_setCanvasSize(e){var s;if(!this.canvas)return;const{width:i,height:n}=e;if(i||i===0){const r=Number.isFinite(i)?`${i}px`:i;this.canvas.style.width=r}if(n||n===0){const r=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=((s=e.style)==null?void 0:s.position)||"absolute",this.canvas.style.height=r}}_updateCanvasSize(){var s,r;const{canvas:e}=this;if(!e)return;const i=e.clientWidth??e.width,n=e.clientHeight??e.height;(i!==this.width||n!==this.height)&&(this.width=i,this.height=n,(s=this.viewManager)==null||s.setProps({width:i,height:n}),(r=this.layerManager)==null||r.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:n}))}_createAnimationLoop(e,i){const{gl:n,onError:s,useDevicePixels:r}=i;return new NP({device:e,useDevicePixels:r,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,i=Array.isArray(e)?e:e?[e]:[new lf({id:"default-view"})];return i.length&&this.props.controller&&(i[0].props.controller=this.props.controller),i}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var i,n,s;const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let a=o,c=!1;for(const l of r)a=l,c=((i=l.layer)==null?void 0:i.onHover(l,e.event))||c;c||((s=(n=this.props).onHover)==null||s.call(n,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var s,r;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(s=this.device.canvasContext)==null?void 0:s.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Ro&&this.props.onWebGLInitialized(this.device.gl);const i=new Z1;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new lk(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in tf)this.eventManager.on(o,this._onEvent);this.viewManager=new JP({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new GP(this.device,{deck:this,stats:this.stats,viewport:n,timeline:i}),this.effectManager=new fM({deck:this,device:this.device}),this.deckRenderer=new gM(this.device),this.deckPicker=new wM(this.device),this.widgetManager=new SM({deck:this,parentElement:(r=this.canvas)==null?void 0:r.parentElement}),this.widgetManager.addDefault(new RM),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,i){var o;const{device:n,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:s});const r={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i};(o=this.deckRenderer)==null||o.renderLayers(r),r.pass==="screen"&&this.widgetManager.onRedraw({viewports:r.viewports,layers:r.layers}),this.props.onAfterRender({device:n,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ve.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const i=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const i=this.animationLoop.stats;e.get("GPU Time").addTime(i.get("GPU Time").lastTiming),e.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:i}=this;e.fps=i.get("frameRate").getHz(),e.setPropsTime=i.get("setProps Time").time,e.updateAttributesTime=i.get("Update Attributes").time,e.framesRedrawn=i.get("Redraw Count").count,e.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,e.pickCount=i.get("Pick Count").count,e.gpuTime=i.get("GPU Time").time,e.cpuTime=i.get("CPU Time").time,e.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const n=as.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}};bl.defaultProps=U_,bl.VERSION=T2;let mf=bl;function hk(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return h1(t)}}const fk=u1;function ja(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function is(t){return t.stride||t.size*t.bytesPerElement}function dk(t,e){return t.type===e.type&&t.size===e.size&&is(t)===is(e)&&(t.offset||0)===(e.offset||0)}function yf(t,e){e.offset&&ve.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=is(t),n=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,s=e.elementOffset||0,r=n*i+s*t.bytesPerElement+(t.offset||0);return{...e,offset:r,stride:i}}function pk(t,e){const i=yf(t,e);return{high:i,low:{...i,offset:i.offset+t.size*4}}}class gk{constructor(e,i,n){this._buffer=null,this.device=e,this.id=i.id||"",this.size=i.size||1;const s=i.logicalType||i.type,r=s==="float64";let{defaultValue:o}=i;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;r?a="float32":!s&&i.isIndexed?a="uint32":a=s||"float32";let c=hk(s||a);this.doublePrecision=r,r&&i.fp64===!1&&(c=Float32Array),this.value=null,this.settings={...i,defaultType:c,defaultValue:o,logicalType:s,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:c.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*is(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Cr.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,i=null){const n={};if(this.state.constant){const s=this.value;if(i){const r=yf(this.getAccessor(),i),o=r.offset/s.BYTES_PER_ELEMENT,a=r.size||this.size;n[e]=s.subarray(o,o+a)}else n[e]=s}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}getBufferLayout(e=this.id,i=null){const n=this.getAccessor(),s=[],r={name:this.id,byteStride:is(n),attributes:s};if(this.doublePrecision){const o=pk(n,i||{});s.push(ja(e,{...n,...o.high}),ja(`${e}64Low`,{...n,...o.low}))}else if(i){const o=yf(n,i);s.push(ja(e,{...n,...o}))}else s.push(ja(e,n));return r}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const i=Array.from(this.value);e=[i,i]}else{const{value:i,numInstances:n,size:s}=this,r=n*s;if(i&&r&&i.length>=r){const o=new Array(s).fill(1/0),a=new Array(s).fill(-1/0);for(let c=0;c<r;)for(let l=0;l<s;l++){const u=i[c++];u<o[l]&&(o[l]=u),u>a[l]&&(a[l]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:i}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof et?n={buffer:e}:n=e;const s={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)s.type="float32";else{const o=fk(n.value);s.type=s.normalized?o.replace("int","norm"):o}s.bytesPerElement=n.value.BYTES_PER_ELEMENT,s.stride=is(s)}if(i.bounds=null,n.constant){let r=n.value;if(r=this._normalizeValue(r,[],0),this.settings.normalized&&(r=this.normalizeConstant(r)),!(!i.constant||!this._areValuesEqual(r,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(r)?r:new Float32Array(r)}else if(n.buffer){const r=n.buffer;i.externalBuffer=r,i.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let r=n.value;i.externalBuffer=null,i.constant=!1,this.value=r;let{buffer:o}=this;const a=is(s),c=(s.vertexOffset||0)*a;if(this.doublePrecision&&r instanceof Float64Array&&(r=Pu(r,s)),this.settings.isIndexed){const u=this.settings.defaultType;r.constructor!==u&&(r=new u(r))}const l=r.byteLength+c+a*2;(!o||o.byteLength<l)&&(o=this._createBuffer(l)),o.write(r,c)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const i=this.value,{startOffset:n=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&i instanceof Float64Array?Pu(i,{size:this.size,startIndex:n,endIndex:s}):i.subarray(n,s),n*i.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,i=!1){const{state:n}=this,s=n.allocatedValue,r=Cr.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=r;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<r.byteLength+o)&&(a=this._createBuffer(r.byteLength+o),i&&s&&a.write(s instanceof Float64Array?Pu(s,this):s,o)),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:i}=e;if(!ArrayBuffer.isView(i))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=i.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${i.constructor.name}`);!(i instanceof n)&&this.settings.normalized&&!("normalized"in e)&&ve.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(i=>(i+128)/255*2-1);case"snorm16":return new Float32Array(e).map(i=>(i+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(i=>i/255);case"unorm16":return new Float32Array(e).map(i=>i/65535);default:return e}}_normalizeValue(e,i,n){const{defaultValue:s,size:r}=this.settings;if(Number.isFinite(e))return i[n]=e,i;if(!e){let o=r;for(;--o>=0;)i[n+o]=s[o];return i}switch(r){case 4:i[n+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:i[n+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:i[n+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:i[n+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let o=r;for(;--o>=0;)i[n+o]=Number.isFinite(e[o])?e[o]:s[o]}return i}_areValuesEqual(e,i){if(!e||!i)return!1;const{size:n}=this;for(let s=0;s<n;s++)if(e[s]!==i[s])return!1;return!0}_createBuffer(e){var s;this._buffer&&this._buffer.destroy();const{isIndexed:i,type:n}=this.settings;return this._buffer=this.device.createBuffer({...(s=this._buffer)==null?void 0:s.props,id:this.id,usage:i?et.INDEX:et.VERTEX,indexType:i?n:void 0,byteLength:e}),this._buffer}}const z_=[],V_=[];function Yl(t,e=0,i=1/0){let n=z_;const s={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&(V_.length=t.length,n=V_):n=z_,(e>0||Number.isFinite(i))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,i),s.index=e-1),{iterable:n,objectInfo:s}}function bv(t){return t&&t[Symbol.asyncIterator]}function wv(t,e){const{size:i,stride:n,offset:s,startIndices:r,nested:o}=e,a=t.BYTES_PER_ELEMENT,c=n?n/a:i,l=s?s/a:0,u=Math.floor((t.length-l)/c);return(h,{index:f,target:d})=>{if(!r){const m=f*c+l;for(let b=0;b<i;b++)d[b]=t[m+b];return d}const p=r[f],g=r[f+1]||u;let _;if(o){_=new Array(g-p);for(let m=p;m<g;m++){const b=m*c+l;d=new Array(i);for(let w=0;w<i;w++)d[w]=t[b+w];_[m-p]=d}}else if(c===i)_=t.subarray(p*i+l,g*i+l);else{_=new t.constructor((g-p)*i);let m=0;for(let b=p;b<g;b++){const w=b*c+l;for(let S=0;S<i;S++)_[m++]=t[w+S]}}return _}}const _k=[],lc=[[0,1/0]];function mk(t,e){if(t===lc||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const i=[],n=t.length;let s=0;for(let r=0;r<n;r++){const o=t[r];o[1]<e[0]?(i.push(o),s=r+1):o[0]>e[1]?i.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return i.splice(s,0,e),i}const yk={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function Tv(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const i=t.type||"interpolation";return{...yk[i],...e,...t,type:i}}class Ev extends gk{constructor(e,i){super(e,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:lc}),this.constant=!1,this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!e,i}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var i;(i=this.state).layoutChanged||(i.layoutChanged=!dk(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:i}=this.settings,n=this.settings.transition,s=Array.isArray(i)?e[i.find(r=>e[r])]:e[i];return Tv(s,n)}setNeedsUpdate(e=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),i){const{startRow:n=0,endRow:s=1/0}=i;this.state.updateRanges=mk(this.state.updateRanges,[n,s])}else this.state.updateRanges=lc}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=_k}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:i,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,i.updateRanges!==lc),!0):!1}updateBuffer({numInstances:e,data:i,props:n,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:o,noAlloc:a}}=this;let c=!0;if(o){for(const[l,u]of r)o.call(s,this,{data:i,startRow:l,endRow:u,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[l,u]of r){const h=Number.isFinite(l)?this.getVertexOffset(l):0,f=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:h,endOffset:f})}this._checkAttributeArray()}else c=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),c}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:i}=this;return e?(this.clearNeedsUpdate(),i.lastExternalBuffer===e||(i.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(e,i=null){const{state:n,settings:s}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),s.transform||i!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;St(ArrayBuffer.isView(o.value),`invalid ${s.accessor}`);const a=!!o.size&&o.size!==this.size;return n.binaryAccessor=wv(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:i,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:i}=this;return(i?e<i.length?i[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,i=super.getValue();if(!e)return i;for(const n in e)Object.assign(i,super.getValue(n,e[n]));return i}getBufferLayout(){this.state.layoutChanged=!1;const e=this.settings.shaderAttributes,i=super.getBufferLayout();if(!e)return i;for(const n in e){const s=super.getBufferLayout(n,e[n]);i.attributes.push(...s.attributes)}return i}_autoUpdater(e,{data:i,startRow:n,endRow:s,props:r,numInstances:o}){if(e.constant)return;const{settings:a,state:c,value:l,size:u,startIndices:h}=e,{accessor:f,transform:d}=a,p=c.binaryAccessor||(typeof f=="function"?f:r[f]);St(typeof p=="function",`accessor "${f}" is not a function`);let g=e.getVertexOffset(n);const{iterable:_,objectInfo:m}=Yl(i,n,s);for(const b of _){m.index++;let w=p(b,m);if(d&&(w=d.call(this,w)),h){const S=(m.index<h.length-1?h[m.index+1]:o)-h[m.index];if(w&&Array.isArray(w[0])){let R=g;for(const M of w)e._normalizeValue(M,l,R),R+=u}else w&&w.length>u?l.set(w,g):(e._normalizeValue(w,m.target,0),XP({target:l,source:m.target,start:g,count:S}));g+=S*u}else e._normalizeValue(w,l,g),g+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,i=Math.min(4,this.size);if(e&&e.length>=i){let n=!0;switch(i){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function $u(t){const{source:e,target:i,start:n=0,size:s,getData:r}=t,o=t.end||i.length,a=e.length,c=o-n;if(a>c){i.set(e.subarray(0,c),n);return}if(i.set(e,n),!r)return;let l=a;for(;l<c;){const u=r(l,e);for(let h=0;h<s;h++)i[n+l]=u[h]||0,l++}}function vk({source:t,target:e,size:i,getData:n,sourceStartIndices:s,targetStartIndices:r}){if(!s||!r)return $u({source:t,target:e,size:i,getData:n}),e;let o=0,a=0;const c=n&&((u,h)=>n(u+a,h)),l=Math.min(s.length,r.length);for(let u=1;u<l;u++){const h=s[u]*i,f=r[u]*i;$u({source:t.subarray(o,h),target:e,start:a,end:f,size:i,getData:c}),o=h,a=f}return a<e.length&&$u({source:[],target:e,start:a,size:i,getData:c}),e}function bk(t){const{device:e,settings:i,value:n}=t,s=new Ev(e,i);return s.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),s}function Sv(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function Av(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Rv(t){t.push(t.shift())}function wk(t,e){const{doublePrecision:i,settings:n,value:s,size:r}=t,o=i&&s instanceof Float64Array?2:1;let a=0;const{shaderAttributes:c}=t.settings;if(c)for(const l of Object.values(c))a=Math.max(a,l.vertexOffset??0);return(n.noAlloc?s.length:(e+a)*r)*o}function Cv({device:t,source:e,target:i}){return(!i||i.byteLength<e.byteLength)&&(i==null||i.destroy(),i=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),i}function xv({device:t,buffer:e,attribute:i,fromLength:n,toLength:s,fromStartIndices:r,getData:o=a=>a}){const a=i.doublePrecision&&i.value instanceof Float64Array?2:1,c=i.size*a,l=i.byteOffset,u=i.settings.bytesPerElement<4?l/i.settings.bytesPerElement*4:l,h=i.startIndices,f=r&&h,d=i.isConstant;if(!f&&e&&n>=s)return e;const p=i.value instanceof Float64Array?Float32Array:i.value.constructor,g=d?i.value:new p(i.getBuffer().readSyncWebGL(l,s*p.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!d){const w=o;o=(S,R)=>i.normalizeConstant(w(S,R))}const _=d?(w,S)=>o(g,S):(w,S)=>o(g.subarray(w+l,w+l+c),S),m=e?new Float32Array(e.readSyncWebGL(u,n*4).buffer):new Float32Array(0),b=new Float32Array(s);return vk({source:m,target:b,sourceStartIndices:r,targetStartIndices:h,size:c,getData:_}),(!e||e.byteLength<b.byteLength+u)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:b.byteLength+u,usage:35050})),e.write(b,u),e}class Pv{constructor({device:e,attribute:i,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Hl(n),this.attribute=i,this.attributeInTransition=bk(i),this.currentStartIndices=i.startIndices}get inProgress(){return this.transition.inProgress}start(e,i,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=wk(this.attribute,i),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class Tk extends Pv{constructor({device:e,attribute:i,timeline:n}){super({device:e,attribute:i,timeline:n}),this.type="interpolation",this.transform=Sk(e,i)}start(e,i){const n=this.currentLength,s=this.currentStartIndices;if(super.start(e,i,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:r,attribute:o}=this;Rv(r),r[0]=xv({device:this.device,buffer:r[0],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),r[1]=Cv({device:this.device,source:r[0],target:r[1]}),this.setBuffer(r[1]);const{transform:a}=this,c=a.model;c.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?(c.setAttributes({aFrom:r[0]}),c.setConstantAttributes({aTo:o.value})):c.setAttributes({aFrom:r[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:r[1]})}onUpdate(){const{duration:e,easing:i}=this.settings,{time:n}=this.transition;let s=n/e;i&&(s=i(s));const{model:r}=this.transform;r.setUniforms({time:s}),r.device.gl.bindBuffer(34962,null),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const Ek=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function Sk(t,e){const i=Sv(e.size);return new jl(t,{vs:Ek,bufferLayout:[{name:"aFrom",format:Av(e.size)},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"]})}class Ak extends Pv{constructor({device:e,attribute:i,timeline:n}){super({device:e,attribute:i,timeline:n}),this.type="spring",this.texture=Pk(e),this.framebuffer=Mk(e,this.texture),this.transform=xk(e,i)}start(e,i){const n=this.currentLength,s=this.currentStartIndices;super.start(e,i);const{buffers:r,attribute:o}=this;for(let c=0;c<2;c++)r[c]=xv({device:this.device,buffer:r[c],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});r[2]=Cv({device:this.device,source:r[0],target:r[2]}),this.setBuffer(r[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:i,framebuffer:n,transition:s}=this,r=this.settings;i.model.setAttributes({aPrev:e[0],aCur:e[1]}),i.transformFeedback.setBuffers({vNext:e[2]}),i.model.setUniforms({stiffness:r.stiffness,damping:r.damping}),i.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Rv(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const Rk=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Ck=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function xk(t,e){const i=Sv(e.size),n=Av(e.size);return new jl(t,{vs:Rk,fs:Ck,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Pk(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Mk(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const Ik={interpolation:Tk,spring:Ak};class Ok{constructor(e,{id:i,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=i,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:i,numInstances:n}){this.numInstances=n||1;for(const s in e){const r=e[s],o=r.getTransitionSetting(i);o&&this._updateAttribute(s,r,o)}for(const s in this.transitions){const r=e[s];(!r||!r.getTransitionSetting(i))&&this._removeTransition(s)}}hasAttribute(e){const i=this.transitions[e];return i&&i.inProgress}getAttributes(){const e={};for(const i in this.transitions){const n=this.transitions[i];n.inProgress&&(e[i]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,i,n){const s=this.transitions[e];let r=!s||s.type!==n.type;if(r){s&&this._removeTransition(e);const o=Ik[n.type];o?this.transitions[e]=new o({attribute:i,timeline:this.timeline,device:this.device}):(ve.error(`unsupported transition type '${n.type}'`)(),r=!1)}(r||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const j_="attributeManager.invalidate",kk="attributeManager.updateStart",Nk="attributeManager.updateEnd",Dk="attribute.updateStart",Fk="attribute.allocate",Lk="attribute.updateEnd";class Bk{constructor(e,{id:i="attribute-manager",stats:n,timeline:s}={}){this.mergeBoundsMemoized=ra(EP),this.id=i,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new Ok(e,{id:`${i}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const i of e)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(e,i){const n=this._invalidateTrigger(e,i);Ot(j_,this,e,n)}invalidateAll(e){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,e);Ot(j_,this,"all")}update({data:e,numInstances:i,startIndices:n=null,transitions:s,props:r={},buffers:o={},context:a={}}){let c=!1;Ot(kk,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const l in this.attributes){const u=this.attributes[l],h=u.settings.accessor;u.startIndices=n,u.numInstances=i,r[l]&&ve.removed(`props.${l}`,`data.attributes.${l}`)(),u.setExternalBuffer(o[l])||u.setBinaryValue(typeof h=="string"?o[h]:void 0,e.startIndices)||typeof h=="string"&&!o[h]&&u.setConstantValue(r[h])||u.needsUpdate()&&(c=!0,this._updateAttribute({attribute:u,numInstances:i,data:e,props:r,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}c&&Ot(Nk,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,i=e.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const i=e.map(n=>{var s;return(s=this.attributes[n])==null?void 0:s.getBounds()});return this.mergeBoundsMemoized(i)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:n}=this,s={...n.getAttributes()};for(const r in i){const o=i[r];o.needsRedraw(e)&&!n.hasAttribute(r)&&(s[r]=o)}return s}getBufferLayouts(e,i={}){e||(e=this.getAttributes());const n=[];for(const s in e)i[s]||n.push(e[s].getBufferLayout());return n}_add(e,i={}){for(const n in e){const s=e[n];this.attributes[n]=this._createAttribute(n,s,i)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,i,n){const s={...i,id:e,size:i.isIndexed&&1||i.size||1,divisor:n.instanced?1:i.divisor||0};return new Ev(this.device,s)}_mapUpdateTriggersToAttributes(){const e={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(i)});this.updateTriggers=e}_invalidateTrigger(e,i){const{attributes:n,updateTriggers:s}=this,r=s[e];return r&&r.forEach(o=>{const a=n[o];a&&a.setNeedsUpdate(a.id,i)}),r}_updateAttribute(e){const{attribute:i,numInstances:n}=e;if(Ot(Dk,i),i.constant){i.setConstantValue(i.value);return}i.allocate(n)&&Ot(Fk,i,n),i.updateBuffer(e)&&(this.needsRedraw=!0,Ot(Lk,i,n))}}class Uk extends Hl{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:i,toValue:n,duration:s,easing:r}}=this,o=r(e/s);this._value=cs(i,n,o)}}const $_=1e-5;function H_(t,e,i,n,s){const r=e-t,a=(i-e)*s,c=-r*n;return a+c+r+e}function zk(t,e,i,n,s){if(Array.isArray(i)){const r=[];for(let o=0;o<i.length;o++)r[o]=H_(t[o],e[o],i[o],n,s);return r}return H_(t,e,i,n,s)}function W_(t,e){if(Array.isArray(t)){let i=0;for(let n=0;n<t.length;n++){const s=t[n]-e[n];i+=s*s}return Math.sqrt(i)}return Math.abs(t-e)}class Vk extends Hl{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:i,damping:n,stiffness:s}=this.settings,{_prevValue:r=e,_currValue:o=e}=this;let a=zk(r,o,i,n,s);const c=W_(a,i),l=W_(a,o);c<$_&&l<$_&&(a=i,this.end()),this._prevValue=o,this._currValue=a}}const jk={interpolation:Uk,spring:Vk};class $k{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,i,n,s){const{transitions:r}=this;if(r.has(e)){const c=r.get(e),{value:l=c.settings.fromValue}=c;i=l,this.remove(e)}if(s=Tv(s),!s)return;const o=jk[s.type];if(!o){ve.error(`unsupported transition type '${s.type}'`)();return}const a=new o(this.timeline);a.start({...s,fromValue:i,toValue:n}),r.set(e,a)}remove(e){const{transitions:i}=this;i.has(e)&&(i.get(e).cancel(),i.delete(e))}update(){const e={};for(const[i,n]of this.transitions)n.update(),e[i]=n.value,n.inProgress||this.remove(i);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Hk(t){const e=t[Tn];for(const i in e){const n=e[i],{validate:s}=n;if(s&&!s(t[i],n))throw new Error(`Invalid prop ${i}: ${t[i]}`)}}function Wk(t,e){const i=Mv({newProps:t,oldProps:e,propTypes:t[Tn],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=qk(t,e);let s=!1;return n||(s=Yk(t,e)),{dataChanged:n,propsChanged:i,updateTriggersChanged:s,extensionsChanged:Kk(t,e),transitionsChanged:Xk(t,e)}}function Xk(t,e){if(!t.transitions)return!1;const i={},n=t[Tn];let s=!1;for(const r in t.transitions){const o=n[r],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&vf(t[r],e[r],o)&&(i[r]=!0,s=!0)}return s?i:!1}function Mv({newProps:t,oldProps:e,ignoreProps:i={},propTypes:n={},triggerName:s="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const r of Object.keys(t))if(!(r in i)){if(!(r in e))return`${s}.${r} added`;const o=vf(t[r],e[r],n[r]);if(o)return`${s}.${r} ${o}`}for(const r of Object.keys(e))if(!(r in i)){if(!(r in t))return`${s}.${r} dropped`;if(!Object.hasOwnProperty.call(t,r)){const o=vf(t[r],e[r],n[r]);if(o)return`${s}.${r} ${o}`}}return!1}function vf(t,e,i){let n=i&&i.equal;return n&&!n(t,e,i)||!n&&(n=t&&e&&t.equals,n&&!n.call(t,e))?"changed deeply":!n&&e!==t?"changed shallowly":null}function qk(t,e){if(e===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:n,_dataDiff:s}=t;return n?n(t.data,e.data)||(i="Data comparator detected a change"):t.data!==e.data&&(i="A new data container was supplied"),i&&s&&(i=s(t.data,e.data)||i),i}function Yk(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&X_(t,e,"all"))return{all:!0};const i={};let n=!1;for(const s in t.updateTriggers)s!=="all"&&X_(t,e,s)&&(i[s]=!0,n=!0);return n?i:!1}function Kk(t,e){if(e===null)return!0;const i=e.extensions,{extensions:n}=t;if(n===i)return!1;if(!i||!n||n.length!==i.length)return!0;for(let s=0;s<n.length;s++)if(!n[s].equals(i[s]))return!0;return!1}function X_(t,e,i){let n=t.updateTriggers[i];n=n??{};let s=e.updateTriggers[i];return s=s??{},Mv({oldProps:s,newProps:n,triggerName:i})}const Zk="count(): argument not an object",Gk="count(): argument not a container";function Jk(t){if(!eN(t))throw new Error(Zk);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(Qk(t))return Object.keys(t).length;throw new Error(Gk)}function Qk(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function eN(t){return t!==null&&typeof t=="object"}function q_(t,e){if(!e)return t;const i={...t,...e};if("defines"in e&&(i.defines={...t.defines,...e.defines}),"modules"in e&&(i.modules=(t.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=i.modules.findIndex(s=>s.name==="project32");n>=0&&i.modules.splice(n,1)}if("inject"in e)if(!t.inject)i.inject=e.inject;else{const n={...t.inject};for(const s in e.inject)n[s]=(n[s]||"")+e.inject[s];i.inject=n}return i}const tN={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},bf={};function iN(t,e,i,n){if(i instanceof ci)return i;i.constructor&&i.constructor.name!=="Object"&&(i={data:i});let s=null;i.compressed&&(s={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});const r=e.createTexture({...i,sampler:{...tN,...s,...n}});return bf[r.id]=t,r}function nN(t,e){!e||!(e instanceof ci)||bf[e.id]===t&&(e.delete(),delete bf[e.id])}const sN={boolean:{validate(t,e){return!0},equal(t,e,i){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||wf(t)&&(t.length===3||t.length===4)},equal(t,e,i){return wi(t,e,1)}},accessor:{validate(t,e){const i=qc(t);return i==="function"||i===qc(e.value)},equal(t,e,i){return typeof e=="function"?!0:wi(t,e,1)}},array:{validate(t,e){return e.optional&&!t||wf(t)},equal(t,e,i){const{compare:n}=i,s=Number.isInteger(n)?n:n?1:0;return n?wi(t,e,s):t===e}},object:{equal(t,e,i){if(i.ignore)return!0;const{compare:n}=i,s=Number.isInteger(n)?n:n?1:0;return n?wi(t,e,s):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,i){return!i.compare&&i.ignore!==!1||t===e}},data:{transform:(t,e,i)=>{if(!t)return t;const{dataTransform:n}=i.props;return n?n(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,i)=>{const n=i.context;return!n||!n.device?null:iN(i.id,n.device,t,{...e.parameters,...i.props.textureParameters})},release:(t,e,i)=>{nN(i.id,t)}}};function rN(t){const e={},i={},n={};for(const[s,r]of Object.entries(t)){const o=r==null?void 0:r.deprecatedFor;if(o)n[s]=Array.isArray(o)?o:[o];else{const a=oN(s,r);e[s]=a,i[s]=a.value}}return{propTypes:e,defaultProps:i,deprecatedProps:n}}function oN(t,e){switch(qc(e)){case"object":return to(t,e);case"array":return to(t,{type:"array",value:e,compare:!1});case"boolean":return to(t,{type:"boolean",value:e});case"number":return to(t,{type:"number",value:e});case"function":return to(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function to(t,e){return"type"in e?{name:t,...sN[e.type],...e}:"value"in e?{name:t,type:qc(e.value),...e}:{name:t,type:"object",value:e}}function wf(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function qc(t){return wf(t)?"array":t===null?"null":typeof t}function aN(t,e){let i;for(let r=e.length-1;r>=0;r--){const o=e[r];"extensions"in o&&(i=o.extensions)}const n=Tf(t.constructor,i),s=Object.create(n);s[Hc]=t,s[ws]={},s[yn]={};for(let r=0;r<e.length;++r){const o=e[r];for(const a in o)s[a]=o[a]}return Object.freeze(s),s}const cN="_mergedDefaultProps";function Tf(t,e){let i=cN;if(e)for(const s of e){const r=s.constructor;r&&(i+=`:${r.extensionName||r.name}`)}const n=Iv(t,i);return n||(t[i]=lN(t,e||[]))}function lN(t,e){if(!t.prototype)return null;const n=Object.getPrototypeOf(t),s=Tf(n),r=Iv(t,"defaultProps")||{},o=rN(r),a=Object.assign(Object.create(null),s,o.defaultProps),c=Object.assign(Object.create(null),s==null?void 0:s[Tn],o.propTypes),l=Object.assign(Object.create(null),s==null?void 0:s[Ou],o.deprecatedProps);for(const u of e){const h=Tf(u.constructor);h&&(Object.assign(a,h),Object.assign(c,h[Tn]),Object.assign(l,h[Ou]))}return uN(a,t),fN(a,c),hN(a,l),a[Tn]=c,a[Ou]=l,e.length===0&&!xd(t,"_propTypes")&&(t._propTypes=c),a}function uN(t,e){const i=pN(e);Object.defineProperties(t,{id:{writable:!0,value:i}})}function hN(t,e){for(const i in e)Object.defineProperty(t,i,{enumerable:!1,set(n){const s=`${this.id}: ${i}`;for(const r of e[i])xd(this,r)||(this[r]=n);ve.deprecated(s,e[i].join("/"))()}})}function fN(t,e){const i={},n={};for(const s in e){const r=e[s],{name:o,value:a}=r;r.async&&(i[o]=a,n[o]=dN(o))}t[fr]=i,t[ws]={},Object.defineProperties(t,n)}function dN(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||bv(e)?this[ws][t]=e:this[yn][t]=e},get(){if(this[yn]){if(t in this[yn])return this[yn][t]||this[fr][t];if(t in this[ws]){const e=this[Hc]&&this[Hc].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[fr][t]}}return this[fr][t]}}}function xd(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Iv(t,e){return xd(t,e)&&t[e]}function pN(t){const e=t.componentName;return e||ve.warn(`${t.name}.componentName not specified`)(),e||t.name}let gN=0;const wl=class wl{constructor(...e){this.props=aN(this,e),this.id=this.props.id,this.count=gN++}clone(e){const{props:i}=this,n={};for(const s in i[fr])s in i[yn]?n[s]=i[yn][s]:s in i[ws]&&(n[s]=i[ws][s]);return new this.constructor({...i,...n,...e})}};wl.componentName="Component",wl.defaultProps={};let Ef=wl;const _N=Object.freeze({});class mN{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const i=this.asyncProps[e];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||_N}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const i=this.asyncProps[e];return i&&i.resolvedValue}isAsyncPropLoading(e){if(e){const i=this.asyncProps[e];return!!(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(e,i){this._watchPromise(e,Promise.resolve(i))}setAsyncProps(e){this.component=e[Hc]||this.component;const i=e[yn]||{},n=e[ws]||e,s=e[fr]||{};for(const r in i){const o=i[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,o),i[r]=this.getAsyncProp(r)}for(const r in n){const o=n[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,o)}}_fetch(e,i){return null}_onResolve(e,i){}_onError(e,i){}_updateAsyncProp(e,i){if(this._didAsyncInputValueChange(e,i)){if(typeof i=="string"&&(i=this._fetch(e,i)),i instanceof Promise){this._watchPromise(e,i);return}if(bv(i)){this._resolveAsyncIterable(e,i);return}this._setPropValue(e,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,i){const n=this.asyncProps[e];return i===n.resolvedValue||i===n.lastValue?!1:(n.lastValue=i,!0)}_setPropValue(e,i){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(i=this._postProcessValue(n,i),n.resolvedValue=i,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,i,n){const s=this.asyncProps[e];s&&n>=s.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=i,s.resolvedLoadCount=n,this.onAsyncPropUpdated(e,i))}_watchPromise(e,i){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const s=n.pendingLoadCount;i.then(r=>{this.component&&(r=this._postProcessValue(n,r),this._setAsyncPropValue(e,r,s),this._onResolve(e,r))}).catch(r=>{this._onError(e,r)})}}async _resolveAsyncIterable(e,i){if(e!=="data"){this._setPropValue(e,i);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const s=n.pendingLoadCount;let r=[],o=0;for await(const a of i){if(!this.component)return;const{dataTransform:c}=this.component.props;c?r=c(a,r):r=r.concat(a),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:o,endRow:r.length}]}),o=r.length,this._setAsyncPropValue(e,r,s)}this._onResolve(e,r)}_postProcessValue(e,i){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(i,n,this.component):i}_createAsyncPropData(e,i){if(!this.asyncProps[e]){const s=this.component&&this.component.props[Tn];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class yN extends mN{constructor({attributeManager:e,layer:i}){super(i),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,i){const n=this.layer,s=n==null?void 0:n.props.fetch;return s?s(i,{propName:e,layer:n}):super._fetch(e,i)}_onResolve(e,i){const n=this.layer;if(n){const s=n.props.onDataLoad;e==="data"&&s&&s(i,{propName:e,layer:n})}}_onError(e,i){const n=this.layer;n&&n.raiseError(i,`loading ${e} of ${this.layer}`)}}const vN="layer.changeFlag",bN="layer.initialize",wN="layer.update",TN="layer.finalize",EN="layer.matched",Y_=2**24-1,SN=Object.freeze([]),AN=ra(({oldViewport:t,viewport:e})=>t.equals(e));let Oi=new Uint8ClampedArray(0);const RN={data:{type:"data",value:SN,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:i,loaders:n,loadOptions:s,signal:r})=>{const{resourceManager:o}=i.context;s=s||i.getLoadOptions(),n=n||i.props.loaders,r&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:r}});let a=o.contains(t);return!a&&!s&&(o.add({resourceId:t,data:rs(t,n),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:c=>{var l;return(l=i.internalState)==null?void 0:l.reloadAsyncProp(e,c)},consumerId:i.id,requestId:e}):rs(t,n,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ee.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},Tl=class Tl extends Ef{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Ks.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){St(this.internalState);const i=this.internalState.viewport||this.context.viewport,n=K1(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,r,o]=X1(n,i.pixelProjectionMatrix);return e.length===2?[s,r]:[s,r,o]}unproject(e){return St(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,i){St(this.internalState);const n=this.internalState.viewport||this.context.viewport;return PP(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const i of this.getModels())i.updateModuleSettings(e)}setShaderModuleProps(...e){for(const i of this.getModels())i.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ee.DEFAULT||e===Ee.LNGLAT||e===Ee.CARTESIAN}onHover(e,i){return this.props.onHover&&this.props.onHover(e,i)||!1}onClick(e,i){return this.props.onClick&&this.props.onClick(e,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,i=[]){return i[0]=e+1&255,i[1]=e+1>>8&255,i[2]=e+1>>8>>8&255,i}decodePickingColor(e){St(e instanceof Uint8Array);const[i,n,s]=e;return i+n*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Jk(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=q_(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const i of this.props.extensions)e=q_(e,i.getShaders.call(this,i));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const i=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&i)if(Array.isArray(n))for(const s of n)i.invalidateAll(s);else i.invalidateAll();if(i){const{props:s}=e,r=this.internalState.hasPickingBuffer,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(r!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:c}=i.attributes,l=a||c;l&&(o&&l.constant&&(l.constant=!1,i.invalidate(l.id)),!l.value&&!o&&(l.constant=!0,l.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const i of this.getModels())i.draw(e)}getPickingInfo({info:e,mode:i,sourceLayer:n}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,i){var n,s,r,o;i&&(e=new Error(`${i}: ${e.message}`,{cause:e})),(s=(n=this.props).onError)!=null&&s.call(n,e)||(o=(r=this.context)==null?void 0:r.onError)==null||o.call(r,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=e,(!i||!AN({oldViewport:i,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const i=this.getAttributeManager();i&&(e==="all"?i.invalidateAll():i.invalidate(e))}updateAttributes(e){let i=!1;for(const n in e)e[n].layoutChanged()&&(i=!0);for(const n of this.getModels())this._setModelAttributes(n,e,i)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const i=this.props,n=this.getNumInstances(),s=this.getStartIndices();e.update({data:i.data,numInstances:n,startIndices:s,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const r=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const i=e.update(),n=Object.create(this.props);for(const s in i)Object.defineProperty(n,s,{value:i[s]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:i}){if(e.constant)return;const n=Math.floor(Oi.length/4);if(this.internalState.usesPickingColorCache=!0,n<i){i>Y_&&ve.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Oi=Cr.allocate(Oi,i,{size:4,copy:!0,maxCount:Math.max(i,Y_)});const s=Math.floor(Oi.length/4),r=[];for(let o=n;o<s;o++)this.encodePickingColor(o,r),Oi[o*4+0]=r[0],Oi[o*4+1]=r[1],Oi[o*4+2]=r[2]}e.value=Oi.subarray(0,i*4)}_setModelAttributes(e,i,n=!1){var a;if(!Object.keys(i).length)return;if(n){const c=this.getAttributeManager();e.setBufferLayout(c.getBufferLayouts()),i=c.getAttributes()}const s=((a=e.userData)==null?void 0:a.excludeAttributes)||{},r={},o={};for(const c in i){if(s[c])continue;const l=i[c].getValue();for(const u in l){const h=l[u];h instanceof et?i[c].settings.isIndexed?e.setIndexBuffer(h):r[u]=h:h&&(o[u]=h)}}e.setAttributes(r),e.setConstantAttributes(o)}disablePickingIndex(e){const i=this.props.data;if(!("attributes"in i)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:s}=this.getAttributeManager().attributes,r=n||s,o=r&&i.attributes&&i.attributes[r.id];if(o&&o.value){const a=o.value,c=this.encodePickingColor(e);for(let l=0;l<i.length;l++){const u=r.getVertexOffset(l);a[u]===c[0]&&a[u+1]===c[1]&&a[u+2]===c[2]&&this._disablePickingIndex(l)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,s=i||n;if(!s)return;const r=s.getVertexOffset(e),o=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(o-r),r)}restorePickingColors(){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,n=e||i;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Oi.buffer&&(n.value=Oi.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){St(!this.internalState),St(Number.isFinite(this.props.coordinateSystem)),Ot(bN,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new yN({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ve.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new $k(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ot(EN,this,this===e);const{state:i,internalState:n}=e;this!==e&&(this.internalState=n,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ot(wN,this,e),!e)return;const i=this.props,n=this.context,s=this.internalState,r=n.viewport,o=this._updateUniformTransition();s.propsInTransition=o,n.viewport=s.viewport||r,this.props=o;try{const a=this._getUpdateParams(),c=this.getModels();if(n.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const l=this.getModels()[0]!==c[0];this._postUpdate(a,l)}finally{n.viewport=r,this.props=i,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Ot(TN,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:i=null,uniforms:n={},parameters:s={}}){this._updateAttributeTransition();const r=this.props,o=this.context;this.props=this.internalState.propsInTransition||r;const a=this.props.opacity;n.opacity=Math.pow(a,1/2.2);try{if(i){const{isActive:u,isAttribute:h}=i.picking;this.setModuleParameters(i),this.setShaderModuleProps({picking:{isActive:u,isAttribute:h}})}const{getPolygonOffset:c}=this.props,l=c&&c(n)||[0,0];o.device.setParametersWebGL({polygonOffset:l});for(const u of this.getModels())u.setParameters(s);o.device.withParametersWebGL(s,()=>{const u={renderPass:e,moduleParameters:i,uniforms:n,parameters:s,context:o};for(const h of this.props.extensions)h.draw.call(this,u,h);this.draw(u)})}finally{this.props=r}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const s in e)if(e[s]){let r=!1;switch(s){case"dataChanged":const o=e[s],a=i[s];o&&Array.isArray(a)&&(i.dataChanged=Array.isArray(o)?a.concat(o):o,r=!0);default:i[s]||(i[s]=e[s],r=!0)}r&&Ot(vN,this,s,e)}const n=!!(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=n,i.somethingChanged=n||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,i){var s;const n=Wk(e,i);if(n.updateTriggersChanged)for(const r in n.updateTriggersChanged)n.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(n.transitionsChanged)for(const r in n.transitionsChanged)this.internalState.uniformTransitions.add(r,i[r],e[r],(s=e.transitions)==null?void 0:s[r]);return this.setChangeFlags(n)}validateProps(){Hk(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const i={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(i.highlightColor=n(e)),this.setShaderModuleProps({picking:i}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Bk(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,i){const{props:n,oldProps:s}=e;this.setNeedsRedraw(),this._updateAttributes();const r=this.state.model;r!=null&&r.isInstanced&&r.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:c}=n;if(i||s.autoHighlight!==o||s.highlightedObjectIndex!==a||s.highlightColor!==c){const l={};o||(l.highlightedObjectColor=null),Array.isArray(c)&&(l.highlightColor=c),(i||a!==s.highlightedObjectIndex)&&(l.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:l})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),s=n?n.getNeedsRedraw(e):!1;if(i=i||s,i)for(const r of this.props.extensions)r.onNeedsRedraw.call(this,r);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};Tl.defaultProps=RN,Tl.layerName="Layer";let Ji=Tl;const CN="compositeLayer.renderLayers",Yd=class Yd extends Ji{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:i}=e;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(e.object=i.__source.object,e.index=i.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,i){return i&&i.length}getSubLayerClass(e,i){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||i}getSubLayerRow(e,i,n){return e.__source={parent:this,object:i,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const i={index:-1,data:this.props.data,target:[]};return(n,s)=>n&&n.__source?(i.index=n.__source.index,e(n.__source.object,i)):e(n,s)}return e}getSubLayerProps(e={}){var k;const{opacity:i,pickable:n,visible:s,parameters:r,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:d,modelMatrix:p,extensions:g,fetch:_,operation:m,_subLayerProps:b}=this.props,w={id:"",updateTriggers:{},opacity:i,pickable:n,visible:s,parameters:r,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:d,modelMatrix:p,extensions:g,fetch:_,operation:m},S=b&&e.id&&b[e.id],R=S&&S.updateTriggers,M=e.id||"sublayer";if(S){const F=this.props[Tn],I=e.type?e.type._propTypes:{};for(const N in S){const C=I[N]||F[N];C&&C.type==="accessor"&&(S[N]=this.getSubLayerAccessor(S[N]))}}Object.assign(w,e,S),w.id=`${this.props.id}-${M}`,w.updateTriggers={all:(k=this.props.updateTriggers)==null?void 0:k.all,...e.updateTriggers,...R};for(const F of g){const I=F.getSubLayerProps.call(this,F);I&&Object.assign(w,I,{updateTriggers:Object.assign(w.updateTriggers,I.updateTriggers)})}return w}_updateAutoHighlight(e){for(const i of this.getSubLayers())i.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,i){let n=this.internalState.subLayers;const s=!n||this.needsUpdate();if(s){const r=this.renderLayers();n=$l(r,Boolean),this.internalState.subLayers=n}Ot(CN,this,s,n);for(const r of n)r.parent=this}};Yd.layerName="CompositeLayer";let Yo=Yd;const $a=Math.PI/180,K_=180/Math.PI,uc=6370972,rr=256;function xN(){const t=rr/uc,e=Math.PI/180*rr;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class PN extends xr{constructor(e={}){const{latitude:i=0,longitude:n=0,zoom:s=0,nearZMultiplier:r=.1,farZMultiplier:o=2,resolution:a=10}=e;let{height:c,altitude:l=1.5}=e;c=c||1,l=Math.max(.75,l);const u=new Rt().lookAt({eye:[0,-l,0],up:[0,0,1]}),h=Math.pow(2,s);u.rotateX(i*$a),u.rotateZ(-n*$a),u.scale(h/c);const f=Math.atan(.5/l),d=rr*2*h/c;super({...e,height:c,viewMatrix:u,longitude:n,latitude:i,zoom:s,distanceScales:xN(),fovyRadians:f*2,focalDistance:l,near:r,far:Math.min(2,1/d+1)*l*o}),this.latitude=i,this.longitude=n,this.resolution=a}get projectionMode(){return vi.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const i={targetZ:e.z||0},n=this.unproject([0,this.height/2],i),s=this.unproject([this.width/2,0],i),r=this.unproject([this.width,this.height/2],i),o=this.unproject([this.width/2,this.height],i);return r[0]<this.longitude&&(r[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],r[0],s[0],o[0]),Math.min(n[1],r[1],s[1],o[1]),Math.max(n[0],r[0],s[0],o[0]),Math.max(n[1],r[1],s[1],o[1])]}unproject(e,{topLeft:i=!0,targetZ:n}={}){const[s,r,o]=e,a=i?r:this.height-r,{pixelUnprojectionMatrix:c}=this;let l;if(Number.isFinite(o))l=Hu(c,[s,a,o,1]);else{const d=Hu(c,[s,a,-1,1]),p=Hu(c,[s,a,1,1]),g=((n||0)/uc+1)*rr,_=Eu(M1([],d,p)),m=Eu(d),b=Eu(p),S=4*((4*m*b-(_-m-b)**2)/16)/_,R=Math.sqrt(m-S),M=Math.sqrt(Math.max(0,g*g-S)),k=(R-M)/Math.sqrt(_);l=rC([],d,p,k)}const[u,h,f]=this.unprojectPosition(l);return Number.isFinite(o)?[u,h,f]:Number.isFinite(n)?[u,h,n]:[u,h]}projectPosition(e){const[i,n,s=0]=e,r=i*$a,o=n*$a,a=Math.cos(o),c=(s/uc+1)*rr;return[Math.sin(r)*a*c,-Math.cos(r)*a*c,Math.sin(o)*c]}unprojectPosition(e){const[i,n,s]=e,r=I1(e),o=Math.asin(s/r),c=Math.atan2(i,-n)*K_,l=o*K_,u=(r/rr-1)*uc;return[c,l,u]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,i){const n=this.unproject(i);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function Hu(t,e){const i=Nr([],e,t);return vd(i,i,1/i[3]),i}const MN=new Rt().lookAt({eye:[0,0,1]});function IN({width:t,height:e,near:i,far:n,padding:s}){let r=-t/2,o=t/2,a=-e/2,c=e/2;if(s){const{left:l=0,right:u=0,top:h=0,bottom:f=0}=s,d=vt((l+t-u)/2,0,t)-t/2,p=vt((h+e-f)/2,0,e)-e/2;r-=d,o-=d,a+=p,c+=p}return new Rt().ortho({left:r,right:o,bottom:a,top:c,near:i,far:n})}class Ov extends xr{constructor(e){const{width:i,height:n,near:s=.1,far:r=1e3,zoom:o=0,target:a=[0,0,0],padding:c=null,flipY:l=!0}=e,u=Array.isArray(o)?o[0]:o,h=Array.isArray(o)?o[1]:o,f=Math.min(u,h),d=Math.pow(2,f);let p;if(u!==h){const g=Math.pow(2,u),_=Math.pow(2,h);p={unitsPerMeter:[g/d,_/d,1],metersPerUnit:[d/g,d/_,1]}}super({...e,longitude:void 0,position:a,viewMatrix:MN.clone().scale([d,d*(l?-1:1),d]),projectionMatrix:IN({width:i||1,height:n||1,padding:c,near:s,far:r}),zoom:f,distanceScales:p})}projectFlat([e,i]){const{unitsPerMeter:n}=this.distanceScales;return[e*n[0],i*n[1]]}unprojectFlat([e,i]){const{metersPerUnit:n}=this.distanceScales;return[e*n[0],i*n[1]]}panByPosition(e,i){const n=Vl(i,this.pixelUnprojectionMatrix),s=this.projectFlat(e),r=zc([],s,T1([],n)),o=zc([],this.center,r);return{target:this.unprojectFlat(o)}}}class ON extends tv{constructor(e){const{width:i,height:n,rotationX:s=0,rotationOrbit:r=0,target:o=[0,0,0],zoom:a=0,minRotationX:c=-90,maxRotationX:l=90,minZoom:u=-1/0,maxZoom:h=1/0,startPanPosition:f,startRotatePos:d,startRotationX:p,startRotationOrbit:g,startZoomPosition:_,startZoom:m}=e;super({width:i,height:n,rotationX:s,rotationOrbit:r,target:o,zoom:a,minRotationX:c,maxRotationX:l,minZoom:u,maxZoom:h},{startPanPosition:f,startRotatePos:d,startRotationX:p,startRotationOrbit:g,startZoomPosition:_,startZoom:m}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:i}){const n=this.getState().startPanPosition||i;if(!n)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:n=0}){const{startRotatePos:s,startRotationX:r,startRotationOrbit:o}=this.getState(),{width:a,height:c}=this.getViewportProps();if(!s||r===void 0||o===void 0)return this;let l;if(e){let u=(e[0]-s[0])/a;const h=(e[1]-s[1])/c;(r<-90||r>90)&&(u*=-1),l={rotationX:r+h*180,rotationOrbit:o+u*180}}else l={rotationX:r+n,rotationOrbit:o+i};return this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const i=e.getViewportProps(),n={...this.getViewportProps()},{rotationOrbit:s}=n;return Math.abs(s-i.rotationOrbit)>180&&(n.rotationOrbit=s<0?s+360:s-360),n}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:n}){let{startZoom:s,startZoomPosition:r}=this.getState();if(r||(s=this.getViewportProps().zoom,r=this._unproject(i)||this._unproject(e)),!r)return this;const o=this._calculateNewZoom({scale:n,startZoom:s}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_calculateNewZoom({scale:e,startZoom:i}){const{maxZoom:n,minZoom:s}=this.getViewportProps();i===void 0&&(i=this.getViewportProps().zoom);const r=i+Math.log2(e);return vt(r,s,n)}_panFromCenter(e){const{width:i,height:n,target:s}=this.getViewportProps();return this.pan({startPosition:s,pos:[i/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:i,minZoom:n,zoom:s,maxRotationX:r,minRotationX:o,rotationOrbit:a}=e;return e.zoom=Array.isArray(s)?[vt(s[0],n,i),vt(s[1],n,i)]:vt(s,n,i),e.rotationX=vt(e.rotationX,o,r),(a<-180||a>180)&&(e.rotationOrbit=vP(a+180,360)-180),e}}class kN extends ON{constructor(e){super(e),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:i}){const{maxZoom:n,minZoom:s}=this.getViewportProps();i===void 0&&(i=this.getViewportProps().zoom);let r=Math.log2(e);if(Array.isArray(i)){let[o,a]=i;switch(this.zoomAxis){case"X":o=vt(o+r,s,n);break;case"Y":a=vt(a+r,s,n);break;default:let c=Math.min(o+r,a+r);c<s&&(r+=s-c),c=Math.max(o+r,a+r),c>n&&(r+=n-c),o+=r,a+=r}return[o,a]}return vt(i+r,s,n)}}class NN extends ev{constructor(){super(...arguments),this.ControllerState=kN,this.transition={transitionDuration:300,transitionInterpolator:new Xo(["target","zoom"])},this.dragMode="pan"}_onPanRotate(){return!1}}const Kd=class Kd extends Q1{constructor(e={}){super(e)}get ViewportType(){return Ov}get ControllerType(){return NN}};Kd.displayName="OrthographicView";let Kn=Kd;class kv{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:i={}}=e;this.typedArrayManager=Cr,this.attributes={},this._attributeDefs=i,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:i,buffers:n={},getGeometry:s,geometryBuffer:r,positionFormat:o,dataChanged:a,normalize:c=!0}=this.opts;if(this.data=i,this.getGeometry=s,this.positionSize=r&&r.size||(o==="XY"?2:3),this.buffers=n,this.normalize=c,r&&(St(i.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),c||(n.vertexPositions=r)),this.geometryBuffer=n.vertexPositions,Array.isArray(a))for(const l of a)this._rebuildGeometry(l);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:i}){this._rebuildGeometry({startRow:e,endRow:i})}getGeometryFromBuffer(e){const i=e.value||e;return ArrayBuffer.isView(i)?wv(i,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,i){const{attributes:n,buffers:s,_attributeDefs:r,typedArrayManager:o}=this;for(const a in r)if(a in s)o.release(n[a]),n[a]=null;else{const c=r[a];c.copy=i,n[a]=o.allocate(n[a],e,c)}}_forEachGeometry(e,i,n){const{data:s,getGeometry:r}=this,{iterable:o,objectInfo:a}=Yl(s,i,n);for(const c of o){a.index++;const l=r?r(c,a):null;e(l,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:i,vertexStarts:n,instanceCount:s}=this;const{data:r,geometryBuffer:o}=this,{startRow:a=0,endRow:c=1/0}=e||{},l={};if(e||(i=[0],n=[0]),this.normalize||!o)this._forEachGeometry((h,f)=>{const d=h&&this.normalizeGeometry(h);l[f]=d,n[f+1]=n[f]+(d?this.getGeometrySize(d):0)},a,c),s=n[n.length-1];else if(n=r.startIndices,s=n[r.length]||0,ArrayBuffer.isView(o))s=s||o.length/this.positionSize;else if(o instanceof et){const h=this.positionSize*4;s=s||o.byteLength/h}else if(o.buffer){const h=o.stride||this.positionSize*4;s=s||o.buffer.byteLength/h}else if(o.value){const h=o.value,f=o.stride/h.BYTES_PER_ELEMENT||this.positionSize;s=s||h.length/f}this._allocate(s,!!e),this.indexStarts=i,this.vertexStarts=n,this.instanceCount=s;const u={};this._forEachGeometry((h,f)=>{const d=l[f]||h;u.vertexStart=n[f],u.indexStart=i[f];const p=f<n.length-1?n[f+1]:s;u.geometrySize=p-n[f],u.geometryIndex=f,this.updateGeometryAttributes(d,u)},a,c),this.vertexCount=i[i.length-1]}}const DN=new Uint32Array([0,2,1,0,3,2]),FN=new Float32Array([0,1,0,0,1,0,1,1]);function LN(t,e){if(!e)return BN(t);const i=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),n=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),s=Math.ceil(i/e)+1,r=Math.ceil(n/e)+1,o=(s-1)*(r-1)*6,a=new Uint32Array(o),c=new Float32Array(s*r*2),l=new Float64Array(s*r*3);let u=0,h=0;for(let f=0;f<s;f++){const d=f/(s-1);for(let p=0;p<r;p++){const g=p/(r-1),_=UN(t,d,g);l[u*3+0]=_[0],l[u*3+1]=_[1],l[u*3+2]=_[2]||0,c[u*2+0]=d,c[u*2+1]=1-g,f>0&&p>0&&(a[h++]=u-r,a[h++]=u-r-1,a[h++]=u-1,a[h++]=u-r,a[h++]=u-1,a[h++]=u),u++}}return{vertexCount:o,positions:l,indices:a,texCoords:c}}function BN(t){const e=new Float64Array(12);for(let i=0;i<t.length;i++)e[i*3+0]=t[i][0],e[i*3+1]=t[i][1],e[i*3+2]=t[i][2]||0;return{vertexCount:6,positions:e,indices:DN,texCoords:FN}}function UN(t,e,i){return cs(cs(t[0],t[1],i),cs(t[3],t[2],i),e)}const zN=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,VN=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,jN=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

${VN}

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,$N={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Ee.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}},El=class El extends Ji{getShaders(){return super.getShaders({vs:zN,fs:jN,modules:[Dr,Fr]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const i=!0;e.add({indices:{size:1,isIndexed:!0,update:n=>n.value=this.state.mesh.indices,noAlloc:i},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:n=>n.value=this.state.mesh.positions,noAlloc:i},texCoords:{size:2,update:n=>n.value=this.state.mesh.texCoords,noAlloc:i}})}updateState({props:e,oldProps:i,changeFlags:n}){var r;const s=this.getAttributeManager();if(n.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),s.invalidateAll()),e.bounds!==i.bounds){const o=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(const c in a)o&&o[c]!==a[c]&&s.invalidate(c);this.setState({mesh:a,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==i._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:i}=this.props,n=e.info;if(!n.color||!i)return n.bitmap=null,n;const{width:s,height:r}=i;n.index=0;const o=HN(n.color);return n.bitmap={size:{width:s,height:r},uv:o,pixel:[Math.floor(o[0]*s),Math.floor(o[1]*r)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let i=e;return Z_(e)&&(i=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),LN(i,this.context.viewport.resolution)}_getModel(){return new ui(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{uniforms:i,moduleParameters:n}=e,{model:s,coordinateConversion:r,bounds:o,disablePicking:a}=this.state,{image:c,desaturate:l,transparentColor:u,tintColor:h}=this.props;n.picking.isActive&&a||c&&s&&(s.setUniforms(i),s.setBindings({bitmapTexture:c}),s.setUniforms({desaturate:l,transparentColor:u.map(f=>f/255),tintColor:h.slice(0,3).map(f=>f/255),coordinateConversion:r,bounds:o}),s.draw(this.context.renderPass))}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:i,DEFAULT:n}=Ee;let{_imageCoordinateSystem:s}=this.props;if(s!==n){const{bounds:r}=this.props;if(!Z_(r))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:i;if(s=s===e?e:i,s===e&&o===i)return{coordinateConversion:-1,bounds:r};if(s===i&&o===e){const a=Cn([r[0],r[1]]),c=Cn([r[2],r[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],c[0],c[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}};El.layerName="BitmapLayer",El.defaultProps=$N;let Sf=El;function HN(t){const[e,i,n]=t,s=(n&240)/256,r=(n&15)/16;return[(e+r)/256,(i+s)/256]}function Z_(t){return Number.isFinite(t[0])}const WN=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,XN=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,qN=1024,YN=4,G_=()=>{},J_={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},KN={x:0,y:0,width:0,height:0};function ZN(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function GN(t,e,i,n){const s=Math.min(i/e.width,n/e.height),r=Math.floor(e.width*s),o=Math.floor(e.height*s);return s===1?{data:e,width:r,height:o}:(t.canvas.height=o,t.canvas.width=r,t.clearRect(0,0,r,o),t.drawImage(e,0,0,e.width,e.height,0,0,r,o),{data:t.canvas,width:r,height:o})}function Ko(t){return t&&(t.id||t.url)}function JN(t,e,i,n){const{width:s,height:r,device:o}=t,a=o.createTexture({format:"rgba8unorm",width:e,height:i,sampler:n}),c=o.createCommandEncoder();return c.copyTextureToTexture({source:t,destination:a,width:s,height:r}),c.finish(),t.destroy(),a}function Q_(t,e,i){for(let n=0;n<e.length;n++){const{icon:s,xOffset:r}=e[n],o=Ko(s);t[o]={...s,x:r,y:i}}}function QN({icons:t,buffer:e,mapping:i={},xOffset:n=0,yOffset:s=0,rowHeight:r=0,canvasWidth:o}){let a=[];for(let c=0;c<t.length;c++){const l=t[c],u=Ko(l);if(!i[u]){const{height:h,width:f}=l;n+f+e>o&&(Q_(i,a,s),n=0,s=r+s+e,r=0,a=[]),a.push({icon:l,xOffset:n}),n=n+f+e,r=Math.max(r,h)}}return a.length>0&&Q_(i,a,s),{mapping:i,rowHeight:r,xOffset:n,yOffset:s,canvasWidth:o,canvasHeight:ZN(r+s+e)}}function e4(t,e,i){if(!t||!e)return null;i=i||{};const n={},{iterable:s,objectInfo:r}=Yl(t);for(const o of s){r.index++;const a=e(o,r),c=Ko(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!n[c]&&(!i[c]||a.url!==i[c].url)&&(n[c]={...a,source:o,sourceIndex:r.index})}return n}class t4{constructor(e,{onUpdate:i=G_,onError:n=G_}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=YN,this._canvasWidth=qN,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=i,this.onError=n}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const i=this._autoPacking?Ko(e):e;return this._mapping[i]||KN}setProps({loadOptions:e,autoPacking:i,iconAtlas:n,iconMapping:s,textureParameters:r}){var o;e&&(this._loadOptions=e),i!==void 0&&(this._autoPacking=i),s&&(this._mapping=s),n&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=n),r&&(this._textureParameters=r)}get isLoaded(){return this._pendingCount===0}packIcons(e,i){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(e4(e,i,this._mapping)||{});if(n.length>0){const{mapping:s,xOffset:r,yOffset:o,rowHeight:a,canvasHeight:c}=QN({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=s,this._xOffset=r,this._yOffset=o,this._canvasHeight=c,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||J_})),this._texture.height!==this._canvasHeight&&(this._texture=JN(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||J_)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(e){const i=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,rs(n.url,this._loadOptions).then(s=>{const r=Ko(n),o=this._mapping[r],{x:a,y:c,width:l,height:u}=o,{data:h,width:f,height:d}=GN(i,s,l,u);this._texture.setSubImageData({data:h,x:a+(l-f)/2,y:c+(u-d)/2,width:f,height:d}),o.width=f,o.height=d,this._texture.generateMipmap(),this.onUpdate()}).catch(s=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const Nv=[0,0,0,255],i4={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:Nv},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},Sl=class Sl extends Ji{getShaders(){return super.getShaders({vs:WN,fs:XN,modules:[Dr,Fr]})}initializeState(){this.state={iconManager:new t4(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:Nv},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var d;super.updateState(e);const{props:i,oldProps:n,changeFlags:s}=e,r=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:c,getIcon:l,textureParameters:u}=i,{iconManager:h}=this.state;if(typeof o=="string")return;const f=o||this.internalState.isAsyncPropLoading("iconAtlas");h.setProps({loadOptions:i.loadOptions,autoPacking:!f,iconAtlas:o,iconMapping:f?a:null,textureParameters:u}),f?n.iconMapping!==i.iconMapping&&r.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&h.packIcons(c,l),s.extensionsChanged&&((d=this.state.model)==null||d.destroy(),this.state.model=this._getModel(),r.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:i,sizeMinPixels:n,sizeMaxPixels:s,sizeUnits:r,billboard:o,alphaCutoff:a}=this.props,{iconManager:c}=this.state,l=c.getTexture();if(l){const u=this.state.model;u.setBindings({iconsTexture:l}),u.setUniforms(e),u.setUniforms({iconsTextureDim:[l.width,l.height],sizeUnits:bs[r],sizeScale:i,sizeMinPixels:n,sizeMaxPixels:s,billboard:o,alphaCutoff:a}),u.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new ui(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Mr({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())==null?void 0:n.props.onIconError;i?i(e):ve.error(e.error.message)()}getInstanceOffset(e){const{width:i,height:n,anchorX:s=i/2,anchorY:r=n/2}=this.state.iconManager.getIconMapping(e);return[i/2-s,n/2-r]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:i,y:n,width:s,height:r}=this.state.iconManager.getIconMapping(e);return[i,n,s,r]}};Sl.defaultProps=i4,Sl.layerName="IconLayer";let Ir=Sl;const n4=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,s4=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,e0=[0,0,0,255],r4={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:e0},getLineColor:{type:"accessor",value:e0},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Al=class Al extends Ji{getShaders(){return super.getShaders({vs:n4,fs:s4,modules:[Dr,Fr]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var i;super.updateState(e),e.changeFlags.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:i,radiusScale:n,radiusMinPixels:s,radiusMaxPixels:r,stroked:o,filled:a,billboard:c,antialiasing:l,lineWidthUnits:u,lineWidthScale:h,lineWidthMinPixels:f,lineWidthMaxPixels:d}=this.props,p=this.state.model;p.setUniforms(e),p.setUniforms({stroked:o?1:0,filled:a,billboard:c,antialiasing:l,radiusUnits:bs[i],radiusScale:n,radiusMinPixels:s,radiusMaxPixels:r,lineWidthUnits:bs[u],lineWidthScale:h,lineWidthMinPixels:f,lineWidthMaxPixels:d}),p.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new ui(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Mr({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};Al.defaultProps=r4,Al.layerName="ScatterplotLayer";let Af=Al;const Dv={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Fv(t,e,i={}){return o4(t,i)!==e?(c4(t,i),!0):!1}function o4(t,e={}){return Math.sign(a4(t,e))}const t0={x:0,y:1,z:2};function a4(t,e={}){const{start:i=0,end:n=t.length,plane:s="xy"}=e,r=e.size||2;let o=0;const a=t0[s[0]],c=t0[s[1]];for(let l=i,u=n-r;l<n;l+=r)o+=(t[l+a]-t[u+a])*(t[l+c]+t[u+c]),u=l;return o/2}function c4(t,e){const{start:i=0,end:n=t.length,size:s=2}=e,r=(n-i)/s,o=Math.floor(r/2);for(let a=0;a<o;++a){const c=i+a*s,l=i+(r-1-a)*s;for(let u=0;u<s;++u){const h=t[c+u];t[c+u]=t[l+u],t[l+u]=h}}}function Ti(t,e){const i=e.length,n=t.length;if(n>0){let s=!0;for(let r=0;r<i;r++)if(t[n-i+r]!==e[r]){s=!1;break}if(s)return!1}for(let s=0;s<i;s++)t[n+s]=e[s];return!0}function Rf(t,e){const i=e.length;for(let n=0;n<i;n++)t[n]=e[n]}function Zo(t,e,i,n,s=[]){const r=n+e*i;for(let o=0;o<i;o++)s[o]=t[r+o];return s}function Cf(t,e,i,n,s=[]){let r,o;if(i&8)r=(n[3]-t[1])/(e[1]-t[1]),o=3;else if(i&4)r=(n[1]-t[1])/(e[1]-t[1]),o=1;else if(i&2)r=(n[2]-t[0])/(e[0]-t[0]),o=2;else if(i&1)r=(n[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)s[a]=(o&1)===a?n[o]:r*(e[a]-t[a])+t[a];return s}function hc(t,e){let i=0;return t[0]<e[0]?i|=1:t[0]>e[2]&&(i|=2),t[1]<e[1]?i|=4:t[1]>e[3]&&(i|=8),i}function Lv(t,e){const{size:i=2,broken:n=!1,gridResolution:s=10,gridOffset:r=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},c=(a-o)/i;let l=[];const u=[l],h=Zo(t,0,i,o);let f,d;const p=Uv(h,s,r,[]),g=[];Ti(l,h);for(let _=1;_<c;_++){for(f=Zo(t,_,i,o,f),d=hc(f,p);d;){Cf(h,f,d,p,g);const m=hc(g,p);m&&(Cf(h,g,m,p,g),d=m),Ti(l,g),Rf(h,g),u4(p,s,d),n&&l.length>i&&(l=[],u.push(l),Ti(l,h)),d=hc(f,p)}Ti(l,f),Rf(h,f)}return n?u:u[0]}const i0=0,l4=1;function Bv(t,e=null,i){if(!t.length)return[];const{size:n=2,gridResolution:s=10,gridOffset:r=[0,0],edgeTypes:o=!1}=i||{},a=[],c=[{pos:t,types:o?new Array(t.length/n).fill(l4):null,holes:e||[]}],l=[[],[]];let u=[];for(;c.length;){const{pos:h,types:f,holes:d}=c.shift();h4(h,n,d[0]||h.length,l),u=Uv(l[0],s,r,u);const p=hc(l[1],u);if(p){let g=n0(h,f,n,0,d[0]||h.length,u,p);const _={pos:g[0].pos,types:g[0].types,holes:[]},m={pos:g[1].pos,types:g[1].types,holes:[]};c.push(_,m);for(let b=0;b<d.length;b++)g=n0(h,f,n,d[b],d[b+1]||h.length,u,p),g[0]&&(_.holes.push(_.pos.length),_.pos=Ha(_.pos,g[0].pos),o&&(_.types=Ha(_.types,g[0].types))),g[1]&&(m.holes.push(m.pos.length),m.pos=Ha(m.pos,g[1].pos),o&&(m.types=Ha(m.types,g[1].types)))}else{const g={positions:h};o&&(g.edgeTypes=f),d.length&&(g.holeIndices=d),a.push(g)}}return a}function n0(t,e,i,n,s,r,o){const a=(s-n)/i,c=[],l=[],u=[],h=[],f=[];let d,p,g;const _=Zo(t,a-1,i,n);let m=Math.sign(o&8?_[1]-r[3]:_[0]-r[2]),b=e&&e[a-1],w=0,S=0;for(let R=0;R<a;R++)d=Zo(t,R,i,n,d),p=Math.sign(o&8?d[1]-r[3]:d[0]-r[2]),g=e&&e[n/i+R],p&&m&&m!==p&&(Cf(_,d,o,r,f),Ti(c,f)&&u.push(b),Ti(l,f)&&h.push(b)),p<=0?(Ti(c,d)&&u.push(g),w-=p):u.length&&(u[u.length-1]=i0),p>=0?(Ti(l,d)&&h.push(g),S+=p):h.length&&(h[h.length-1]=i0),Rf(_,d),m=p,b=g;return[w?{pos:c,types:e&&u}:null,S?{pos:l,types:e&&h}:null]}function Uv(t,e,i,n){const s=Math.floor((t[0]-i[0])/e)*e+i[0],r=Math.floor((t[1]-i[1])/e)*e+i[1];return n[0]=s,n[1]=r,n[2]=s+e,n[3]=r+e,n}function u4(t,e,i){i&8?(t[1]+=e,t[3]+=e):i&4?(t[1]-=e,t[3]-=e):i&2?(t[0]+=e,t[2]+=e):i&1&&(t[0]-=e,t[2]-=e)}function h4(t,e,i,n){let s=1/0,r=-1/0,o=1/0,a=-1/0;for(let c=0;c<i;c+=e){const l=t[c],u=t[c+1];s=l<s?l:s,r=l>r?l:r,o=u<o?u:o,a=u>a?u:a}return n[0][0]=s,n[0][1]=o,n[1][0]=r,n[1][1]=a,n}function Ha(t,e){for(let i=0;i<e.length;i++)t.push(e[i]);return t}const f4=85.051129;function d4(t,e){const{size:i=2,startIndex:n=0,endIndex:s=t.length,normalize:r=!0}=e||{},o=t.slice(n,s);zv(o,i,0,s-n);const a=Lv(o,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(r)for(const c of a)Vv(c,i);return a}function p4(t,e=null,i){const{size:n=2,normalize:s=!0,edgeTypes:r=!1}=i||{};e=e||[];const o=[],a=[];let c=0,l=0;for(let h=0;h<=e.length;h++){const f=e[h]||t.length,d=l,p=g4(t,n,c,f);for(let g=p;g<f;g++)o[l++]=t[g];for(let g=c;g<p;g++)o[l++]=t[g];zv(o,n,d,l),_4(o,n,d,l,i==null?void 0:i.maxLatitude),c=f,a[h]=l}a.pop();const u=Bv(o,a,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:r});if(s)for(const h of u)Vv(h.positions,n);return u}function g4(t,e,i,n){let s=-1,r=-1;for(let o=i+1;o<n;o+=e){const a=Math.abs(t[o]);a>s&&(s=a,r=o-1)}return r}function _4(t,e,i,n,s=f4){const r=t[i],o=t[n-e];if(Math.abs(r-o)>180){const a=Zo(t,0,e,i);a[0]+=Math.round((o-r)/360)*360,Ti(t,a),a[1]=Math.sign(a[1])*s,Ti(t,a),a[0]=r,Ti(t,a)}}function zv(t,e,i,n){let s=t[0],r;for(let o=i;o<n;o+=e){r=t[o];const a=r-s;(a>180||a<-180)&&(r-=Math.round(a/360)*360),t[o]=s=r}}function Vv(t,e){let i;const n=t.length/e;for(let r=0;r<n&&(i=t[r*e],(i+180)%360===0);r++);const s=-Math.round(i/360)*360;if(s!==0)for(let r=0;r<n;r++)t[r*e]+=s}function m4(t,e,i,n){let s;if(Array.isArray(t[0])){const r=t.length*e;s=new Array(r);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)s[o*e+a]=t[o][a]||0}else s=t;return i?Lv(s,{size:e,gridResolution:i}):n?d4(s,{size:e}):s}const y4=1,v4=2,Wu=4;class b4 extends kv{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?m4(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(s0(e)){let n=0;for(const s of e)n+=this.getGeometrySize(s);return n}const i=this.getPathLength(e);return i<2?0:this.isClosed(e)?i<3?0:i+2:i}updateGeometryAttributes(e,i){if(i.geometrySize!==0)if(e&&s0(e))for(const n of e){const s=this.getGeometrySize(n);i.geometrySize=s,this.updateGeometryAttributes(n,i),i.vertexStart+=s}else this._updateSegmentTypes(e,i),this._updatePositions(e,i)}_updateSegmentTypes(e,i){const n=this.attributes.segmentTypes,s=e?this.isClosed(e):!1,{vertexStart:r,geometrySize:o}=i;n.fill(0,r,r+o),s?(n[r]=Wu,n[r+o-2]=Wu):(n[r]+=y4,n[r+o-2]+=v4),n[r+o-1]=Wu}_updatePositions(e,i){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:s,geometrySize:r}=i,o=new Array(3);for(let a=s,c=0;c<r;a++,c++)this.getPointOnPath(e,c,o),n[a*3]=o[0],n[a*3+1]=o[1],n[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,i,n=[]){const{positionSize:s}=this;i*s>=e.length&&(i+=1-e.length/s);const r=i*s;return n[0]=e[r],n[1]=e[r+1],n[2]=s===3&&e[r+2]||0,n}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:i}=this,n=e.length-i;return e[0]===e[n]&&e[1]===e[n+1]&&(i===2||e[2]===e[n+2])}}function s0(t){return Array.isArray(t[0])}const w4=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,T4=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,jv=[0,0,0,255],E4={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:jv},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Xu={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},Rl=class Rl extends Ji{getShaders(){return super.getShaders({vs:w4,fs:T4,modules:[Dr,Fr]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Xu,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Xu,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Xu,defaultValue:jv},instancePickingColors:{size:4,type:"uint8",accessor:(n,{index:s,target:r})=>this.encodePickingColor(n&&n.__source?n.__source.index:s,r)}}),this.setState({pathTesselator:new b4({fp64:this.use64bitPositions()})})}updateState(e){var o;super.updateState(e);const{props:i,changeFlags:n}=e,s=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,c=i.data.attributes||{};a.updateGeometry({data:i.data,geometryBuffer:c.getPath,buffers:c,normalize:!i._pathType,loop:i._pathType==="loop",getGeometry:i.getPath,positionFormat:i.positionFormat,wrapLongitude:i.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),n.dataChanged||s.invalidateAll()}n.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),s.invalidateAll())}getPickingInfo(e){const i=super.getPickingInfo(e),{index:n}=i,s=this.props.data;return s[0]&&s[0].__source&&(i.object=s.find(r=>r.__source.index===n)),i}disablePickingIndex(e){const i=this.props.data;if(i[0]&&i[0].__source)for(let n=0;n<i.length;n++)i[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:i,capRounded:n,billboard:s,miterLimit:r,widthUnits:o,widthScale:a,widthMinPixels:c,widthMaxPixels:l}=this.props,u=this.state.model;u.setUniforms(e),u.setUniforms({jointType:Number(i),capType:Number(n),billboard:s,widthUnits:bs[o],widthScale:a,miterLimit:r,widthMinPixels:c,widthMaxPixels:l}),u.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new ui(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Mr({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("positions")}calculateSegmentTypes(e){const{pathTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("segmentTypes")}};Rl.defaultProps=E4,Rl.layerName="PathLayer";let xf=Rl;const Wa=Dv.CLOCKWISE,r0=Dv.COUNTER_CLOCKWISE,bn={isClosed:!0};function S4(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function _o(t){return"positions"in t?t.positions:t}function fc(t){return"holeIndices"in t?t.holeIndices:null}function A4(t){return Array.isArray(t[0])}function R4(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function C4(t){const e=t[0],i=t[t.length-1];return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]}function x4(t,e,i,n){for(let s=0;s<e;s++)if(t[i+s]!==t[n-e+s])return!1;return!0}function o0(t,e,i,n,s){let r=e;const o=i.length;for(let a=0;a<o;a++)for(let c=0;c<n;c++)t[r++]=i[a][c]||0;if(!C4(i))for(let a=0;a<n;a++)t[r++]=i[0][a]||0;return bn.start=e,bn.end=r,bn.size=n,Fv(t,s,bn),r}function a0(t,e,i,n,s=0,r,o){r=r||i.length;const a=r-s;if(a<=0)return e;let c=e;for(let l=0;l<a;l++)t[c++]=i[s+l];if(!x4(i,n,s,r))for(let l=0;l<n;l++)t[c++]=i[s+l];return bn.start=e,bn.end=c,bn.size=n,Fv(t,o,bn),c}function P4(t,e){S4(t);const i=[],n=[];if("positions"in t){const{positions:s,holeIndices:r}=t;if(r){let o=0;for(let a=0;a<=r.length;a++)o=a0(i,o,s,e,r[a-1],r[a],a===0?Wa:r0),n.push(o);return n.pop(),{positions:i,holeIndices:n}}t=s}if(!A4(t))return a0(i,0,t,e,0,i.length,Wa),i;if(!R4(t)){let s=0;for(const[r,o]of t.entries())s=o0(i,s,o,e,r===0?Wa:r0),n.push(s);return n.pop(),{positions:i,holeIndices:n}}return o0(i,0,t,e,Wa),i}function qu(t,e,i){const n=t.length/3;let s=0;for(let r=0;r<n;r++){const o=(r+1)%n;s+=t[r*3+e]*t[o*3+i],s-=t[o*3+e]*t[r*3+i]}return Math.abs(s/2)}function c0(t,e,i,n){const s=t.length/3;for(let r=0;r<s;r++){const o=r*3,a=t[o+0],c=t[o+1],l=t[o+2];t[o+e]=a,t[o+i]=c,t[o+n]=l}}function M4(t,e,i,n){let s=fc(t);s&&(s=s.map(a=>a/e));let r=_o(t);const o=n&&e===3;if(i){const a=r.length;r=r.slice();const c=[];for(let l=0;l<a;l+=e){c[0]=r[l],c[1]=r[l+1],o&&(c[2]=r[l+2]);const u=i(c);r[l]=u[0],r[l+1]=u[1],o&&(r[l+2]=u[2])}}if(o){const a=qu(r,0,1),c=qu(r,0,2),l=qu(r,1,2);if(!a&&!c&&!l)return[];a>c&&a>l||(c>l?(i||(r=r.slice()),c0(r,0,2,1)):(i||(r=r.slice()),c0(r,2,0,1)))}return WE(r,s,e)}class I4 extends kv{constructor(e){const{fp64:i,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:i?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:i}=this;return e==="indices"?i.indices&&i.indices.subarray(0,this.vertexCount):i[e]}updateGeometry(e){super.updateGeometry(e);const i=this.buffers.indices;if(i)this.vertexCount=(i.value||i).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const i=P4(e,this.positionSize);return this.opts.resolution?Bv(_o(i),fc(i),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?p4(_o(i),fc(i),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):i}return e}getGeometrySize(e){if(l0(e)){let i=0;for(const n of e)i+=this.getGeometrySize(n);return i}return _o(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,i){if(e&&l0(e))for(const n of e){const s=this.getGeometrySize(n);i.geometrySize=s,this.updateGeometryAttributes(n,i),i.vertexStart+=s,i.indexStart=this.indexStarts[i.geometryIndex+1]}else{const n=e;this._updateIndices(n,i),this._updatePositions(n,i),this._updateVertexValid(n,i)}}_updateIndices(e,{geometryIndex:i,vertexStart:n,indexStart:s}){const{attributes:r,indexStarts:o,typedArrayManager:a}=this;let c=r.indices;if(!c||!e)return;let l=s;const u=M4(e,this.positionSize,this.opts.preproject,this.opts.full3d);c=a.allocate(c,s+u.length,{copy:!0});for(let h=0;h<u.length;h++)c[l++]=u[h]+n;o[i+1]=s+u.length,r.indices=c}_updatePositions(e,{vertexStart:i,geometrySize:n}){const{attributes:{positions:s},positionSize:r}=this;if(!s||!e)return;const o=_o(e);for(let a=i,c=0;c<n;a++,c++){const l=o[c*r],u=o[c*r+1],h=r>2?o[c*r+2]:0;s[a*3]=l,s[a*3+1]=u,s[a*3+2]=h}}_updateVertexValid(e,{vertexStart:i,geometrySize:n}){const{positionSize:s}=this,r=this.attributes.vertexValid,o=e&&fc(e);if(e&&e.edgeTypes?r.set(e.edgeTypes,i):r.fill(1,i,i+n),o)for(let a=0;a<o.length;a++)r[i+o[a]/s-1]=0;r[i+n-1]=0}}function l0(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const $v=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
out vec4 vColor;
struct PolygonProps {
vec4 fillColors;
vec4 lineColors;
vec3 positions;
vec3 positions64Low;
vec3 pickingColors;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? props.lineColors : props.fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = props.pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,O4=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
${$v}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.fillColors = fillColors;
props.lineColors = lineColors;
props.pickingColors = pickingColors;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,k4=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 instancePositions;
in vec3 instanceNextPositions;
in vec3 instancePositions64Low;
in vec3 instanceNextPositions64Low;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
in float instanceVertexValid;
${$v}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = instancePositions;
pos64Low = instancePositions64Low;
nextPos = instanceNextPositions;
nextPos64Low = instanceNextPositions64Low;
#else
pos = instanceNextPositions;
pos64Low = instanceNextPositions64Low;
nextPos = instancePositions;
nextPos64Low = instancePositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = instanceElevations * positions.y;
props.fillColors = instanceFillColors;
props.lineColors = instanceLineColors;
props.pickingColors = instancePickingColors;
calculatePosition(props);
}
`,N4=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Yc=[0,0,0,255],D4={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Yc},getLineColor:{type:"accessor",value:Yc},material:!0},Xa={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},Cl=class Cl extends Ji{getShaders(e){return super.getShaders({vs:e==="top"?O4:k4,fs:N4,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Dr,mx,Fr]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:n}=this.props;e.isGeospatial&&i===Ee.DEFAULT&&(i=Ee.LNGLAT);let s;i===Ee.LNGLAT&&(n?s=e.projectPosition.bind(e):s=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new I4({preproject:s,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const r=this.getAttributeManager(),o=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:Xa,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{instancePositions:{vertexOffset:0,divisor:1},instanceNextPositions:{vertexOffset:1,divisor:1}}},instanceVertexValid:{size:1,type:"uint16",divisor:1,update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,transition:Xa,accessor:"getElevation",shaderAttributes:{instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:Xa,accessor:"getFillColor",defaultValue:Yc,shaderAttributes:{instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:Xa,accessor:"getLineColor",defaultValue:Yc,shaderAttributes:{instanceLineColors:{divisor:1}}},pickingColors:{size:4,type:"uint8",accessor:(a,{index:c,target:l})=>this.encodePickingColor(a&&a.__source?a.__source.index:c,l),shaderAttributes:{instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const i=super.getPickingInfo(e),{index:n}=i,s=this.props.data;return s[0]&&s[0].__source&&(i.object=s.find(r=>r.__source.index===n)),i}disablePickingIndex(e){const i=this.props.data;if(i[0]&&i[0].__source)for(let n=0;n<i.length;n++)i[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:i,filled:n,wireframe:s,elevationScale:r}=this.props,{topModel:o,sideModel:a,wireframeModel:c,polygonTesselator:l}=this.state,u={...e,extruded:!!i,elevationScale:r};c&&s&&(c.setInstanceCount(l.instanceCount-1),c.setUniforms(u),c.draw(this.context.renderPass)),a&&n&&(a.setInstanceCount(l.instanceCount-1),a.setUniforms(u),a.draw(this.context.renderPass)),o&&n&&(o.setVertexCount(l.vertexCount),o.setUniforms(u),o.draw(this.context.renderPass))}updateState(e){var a;super.updateState(e),this.updateGeometry(e);const{props:i,oldProps:n,changeFlags:s}=e,r=this.getAttributeManager();(s.extensionsChanged||i.filled!==n.filled||i.extruded!==n.extruded)&&((a=this.state.models)==null||a.forEach(c=>c.destroy()),this.setState(this._getModels()),r.invalidateAll())}updateGeometry({props:e,oldProps:i,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:r}=this.state,o=e.data.attributes||{};r.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:r.instanceCount,startIndices:r.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:i,extruded:n}=this.props;let s,r,o;const a=this.getAttributeManager().getBufferLayouts();if(i){const c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1,s=new ui(this.context.device,{...c,id:`${e}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:a,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}return n&&(r=new ui(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,uniforms:{isWireframe:!1},geometry:new Mr({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new ui(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,uniforms:{isWireframe:!0},geometry:new Mr({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})),{models:[r,o,s].filter(Boolean),topModel:s,sideModel:r,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:i}=this.state;e.startIndices=i.indexStarts,e.value=i.get("indices")}calculatePositions(e){const{polygonTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}};Cl.defaultProps=D4,Cl.layerName="SolidPolygonLayer";let Pf=Cl;function F4({data:t,getIndex:e,dataRange:i,replace:n}){const{startRow:s=0,endRow:r=1/0}=i,o=t.length;let a=o,c=o;for(let f=0;f<o;f++){const d=e(t[f]);if(a>f&&d>=s&&(a=f),d>=r){c=f;break}}let l=a;const h=c-a!==n.length?t.slice(c):void 0;for(let f=0;f<n.length;f++)t[l++]=n[f];if(h){for(let f=0;f<h.length;f++)t[l++]=h[f];t.length=l}return{startRow:a,endRow:a+n.length}}function L4(t,e){if(!t)return null;const i="startIndices"in t?t.startIndices[e]:e,n=t.featureIds.value[i];return i!==-1?B4(t,n,i):null}function B4(t,e,i){const n={properties:{...t.properties[e]}};for(const s in t.numericProps)n.properties[s]=t.numericProps[s].value[i];return n}function U4(t,e){const i={points:null,lines:null,polygons:null};for(const n in i){const s=t[n].globalFeatureIds.value;i[n]=new Uint8ClampedArray(s.length*3);const r=[];for(let o=0;o<s.length;o++)e(s[o],r),i[n][o*3+0]=r[0],i[n][o*3+1]=r[1],i[n][o*3+2]=r[2]}return i}const z4=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Yu=192/256,u0=[],V4={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},xl=class xl extends Ir{getShaders(){return{...super.getShaders(),fs:z4}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(i,{index:n,target:s})=>this.encodePickingColor(n,s)}})}updateState(e){super.updateState(e);const{props:i,oldProps:n}=e;let{outlineColor:s}=i;s!==n.outlineColor&&(s=s.map(r=>r/255),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!i.sdf&&i.outlineWidth&&ve.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:i,smoothing:n,outlineWidth:s}=this.props,{outlineColor:r}=this.state,o=s?Math.max(n,Yu*(1-s)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:Yu,outlineBuffer:o,gamma:n,sdf:!!i,outlineColor:r},super.draw(e),i&&s){const{iconManager:a}=this.state,c=a.getTexture(),l=this.state.model;c&&(l.setUniforms({outlineBuffer:Yu}),l.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(i=>super.getInstanceOffset(i)):u0}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(i=>super.getInstanceIconFrame(i)):u0}};xl.defaultProps=V4,xl.layerName="MultiIconLayer";let Mf=xl;const Co=1e20;class j4{constructor({fontSize:e=24,buffer:i=3,radius:n=8,cutoff:s=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=i,this.cutoff=s,this.radius=n;const c=this.size=e+i*4,l=this._createCanvas(c),u=this.ctx=l.getContext("2d",{willReadFrequently:!0});u.font=`${a} ${o} ${e}px ${r}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(c*c),this.gridInner=new Float64Array(c*c),this.f=new Float64Array(c),this.z=new Float64Array(c+1),this.v=new Uint16Array(c)}_createCanvas(e){const i=document.createElement("canvas");return i.width=i.height=e,i}draw(e){const{width:i,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(n),c=0,l=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),u=Math.min(this.size-this.buffer,a+Math.ceil(s)),h=l+2*this.buffer,f=u+2*this.buffer,d=Math.max(h*f,0),p=new Uint8ClampedArray(d),g={data:p,width:h,height:f,glyphWidth:l,glyphHeight:u,glyphTop:a,glyphLeft:c,glyphAdvance:i};if(l===0||u===0)return g;const{ctx:_,buffer:m,gridInner:b,gridOuter:w}=this;_.clearRect(m,m,l,u),_.fillText(e,m,m+a);const S=_.getImageData(m,m,l,u);w.fill(Co,0,d),b.fill(0,0,d);for(let R=0;R<u;R++)for(let M=0;M<l;M++){const k=S.data[4*(R*l+M)+3]/255;if(k===0)continue;const F=(R+m)*h+M+m;if(k===1)w[F]=0,b[F]=Co;else{const I=.5-k;w[F]=I>0?I*I:0,b[F]=I<0?I*I:0}}h0(w,0,0,h,f,h,this.f,this.v,this.z),h0(b,m,m,l,u,h,this.f,this.v,this.z);for(let R=0;R<d;R++){const M=Math.sqrt(w[R])-Math.sqrt(b[R]);p[R]=Math.round(255-255*(M/this.radius+this.cutoff))}return g}}function h0(t,e,i,n,s,r,o,a,c){for(let l=e;l<e+n;l++)f0(t,i*r+l,r,s,o,a,c);for(let l=i;l<i+s;l++)f0(t,l*r+e,1,n,o,a,c)}function f0(t,e,i,n,s,r,o){r[0]=0,o[0]=-Co,o[1]=Co,s[0]=t[e];for(let a=1,c=0,l=0;a<n;a++){s[a]=t[e+a*i];const u=a*a;do{const h=r[c];l=(s[a]-s[h]+u-h*h)/(a-h)/2}while(l<=o[c]&&--c>-1);c++,r[c]=a,o[c]=l,o[c+1]=Co}for(let a=0,c=0;a<n;a++){for(;o[c+1]<a;)c++;const l=r[c],u=a-l;t[e+a*i]=s[l]+u*u}}const $4=32,H4=[];function W4(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function X4({characterSet:t,getFontWidth:e,fontHeight:i,buffer:n,maxCanvasWidth:s,mapping:r={},xOffset:o=0,yOffset:a=0}){let c=0,l=o;const u=i+n*2;for(const h of t)if(!r[h]){const f=e(h);l+f+n*2>s&&(l=0,c++),r[h]={x:l+n,y:a+c*u+n,width:f,height:u,layoutWidth:f,layoutHeight:i},l+=f+n*2}return{mapping:r,xOffset:l,yOffset:a+c*u,canvasHeight:W4(a+(c+1)*u)}}function Hv(t,e,i,n){var r;let s=0;for(let o=e;o<i;o++){const a=t[o];s+=((r=n[a])==null?void 0:r.layoutWidth)||0}return s}function Wv(t,e,i,n,s,r){let o=e,a=0;for(let c=e;c<i;c++){const l=Hv(t,c,c+1,s);a+l>n&&(o<c&&r.push(c),o=c,a=0),a+=l}return a}function q4(t,e,i,n,s,r){let o=e,a=e,c=e,l=0;for(let u=e;u<i;u++)if((t[u]===" "||t[u+1]===" "||u+1===i)&&(c=u+1),c>a){let h=Hv(t,a,c,s);l+h>n&&(o<a&&(r.push(a),o=a,l=0),h>n&&(h=Wv(t,a,c,n,s,r),o=r[r.length-1])),a=c,l+=h}return l}function Y4(t,e,i,n,s=0,r){r===void 0&&(r=t.length);const o=[];return e==="break-all"?Wv(t,s,r,i,n,o):q4(t,s,r,i,n,o),o}function K4(t,e,i,n,s,r){let o=0,a=0;for(let c=e;c<i;c++){const l=t[c],u=n[l];u?(a||(a=u.layoutHeight),s[c]=o+u.layoutWidth/2,o+=u.layoutWidth):(ve.warn(`Missing character: ${l} (${l.codePointAt(0)})`)(),s[c]=o,o+=$4)}r[0]=o,r[1]=a}function Z4(t,e,i,n,s){var _;const r=Array.from(t),o=r.length,a=new Array(o),c=new Array(o),l=new Array(o),u=(i==="break-word"||i==="break-all")&&isFinite(n)&&n>0,h=[0,0],f=[0,0];let d=0,p=0,g=0;for(let m=0;m<=o;m++){const b=r[m];if((b===`
`||m===o)&&(g=m),g>p){const w=u?Y4(r,i,n,s,p,g):H4;for(let S=0;S<=w.length;S++){const R=S===0?p:w[S-1],M=S<w.length?w[S]:g;K4(r,R,M,s,a,f);for(let k=R;k<M;k++){const F=r[k],I=((_=s[F])==null?void 0:_.layoutOffsetY)||0;c[k]=d+f[1]/2+I,l[k]=f[0]}d=d+f[1]*e,h[0]=Math.max(h[0],f[0])}p=g}b===`
`&&(a[p]=0,c[p]=0,l[p]=0,p++)}return h[1]=d,{x:a,y:c,rowWidth:l,size:h}}function G4({value:t,length:e,stride:i,offset:n,startIndices:s,characterSet:r}){const o=t.BYTES_PER_ELEMENT,a=i?i/o:1,c=n?n/o:0,l=s[e]||Math.ceil((t.length-c)/a),u=r&&new Set,h=new Array(e);let f=t;if(a>1||c>0){const d=t.constructor;f=new d(l);for(let p=0;p<l;p++)f[p]=t[p*a+c]}for(let d=0;d<e;d++){const p=s[d],g=s[d+1]||l,_=f.subarray(p,g);h[d]=String.fromCodePoint.apply(null,_),u&&_.forEach(u.add,u)}if(u)for(const d of u)r.add(String.fromCodePoint(d));return{texts:h,characterCount:l}}class Xv{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const i=this._cache[e];return i&&(this._deleteOrder(e),this._appendOrder(e)),i}set(e,i){this._cache[e]?(this.delete(e),this._cache[e]=i,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=i,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const i=this._order.indexOf(e);i>=0&&this._order.splice(i,1)}_appendOrder(e){this._order.push(e)}}function J4(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const dr={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:J4(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},d0=1024,p0=.9,g0=1.2,qv=3;let Kc=new Xv(qv);function Q4(t,e){let i;typeof e=="string"?i=new Set(Array.from(e)):i=new Set(e);const n=Kc.get(t);if(!n)return i;for(const s in n.mapping)i.has(s)&&i.delete(s);return i}function e6(t,e){for(let i=0;i<t.length;i++)e.data[4*i+3]=t[i]}function _0(t,e,i,n){t.font=`${n} ${i}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function t6(t){ve.assert(Number.isFinite(t)&&t>=qv,"Invalid cache limit"),Kc=new Xv(t)}class i6{constructor(){this.props={...dr}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:i}=this.props;return(e*g0+i*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const i=Q4(this._key,this.props.characterSet),n=Kc.get(this._key);if(n&&i.size===0){this._atlas!==n&&(this._atlas=n);return}const s=this._generateFontAtlas(i,n);this._atlas=s,Kc.set(this._key,s)}_generateFontAtlas(e,i){const{fontFamily:n,fontWeight:s,fontSize:r,buffer:o,sdf:a,radius:c,cutoff:l}=this.props;let u=i&&i.data;u||(u=document.createElement("canvas"),u.width=d0);const h=u.getContext("2d",{willReadFrequently:!0});_0(h,n,r,s);const{mapping:f,canvasHeight:d,xOffset:p,yOffset:g}=X4({getFontWidth:_=>h.measureText(_).width,fontHeight:r*g0,buffer:o,characterSet:e,maxCanvasWidth:d0,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(u.height!==d){const _=h.getImageData(0,0,u.width,u.height);u.height=d,h.putImageData(_,0,0)}if(_0(h,n,r,s),a){const _=new j4({fontSize:r,buffer:o,radius:c,cutoff:l,fontFamily:n,fontWeight:`${s}`});for(const m of e){const{data:b,width:w,height:S,glyphTop:R}=_.draw(m);f[m].width=w,f[m].layoutOffsetY=r*p0-R;const M=h.createImageData(w,S);e6(b,M),h.putImageData(M,f[m].x,f[m].y)}}else for(const _ of e)h.fillText(_,f[_].x,f[_].y+o+r*p0);return{xOffset:p,yOffset:g,mapping:f,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:e,fontWeight:i,fontSize:n,buffer:s,sdf:r,radius:o,cutoff:a}=this.props;return r?`${e} ${i} ${n} ${s} ${o} ${a}`:`${e} ${i} ${n} ${s}`}}const n6=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,s6=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,r6={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},Pl=class Pl extends Ji{getShaders(){return super.getShaders({vs:n6,fs:s6,modules:[Dr,Fr]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e);const{changeFlags:i}=e;i.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:i,sizeScale:n,sizeUnits:s,sizeMinPixels:r,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:c}=this.props;c.length<4&&(c=[c[0],c[1],c[0],c[1]]);const l=this.state.model;l.setUniforms(e),l.setUniforms({billboard:i,stroked:!!a,padding:c,sizeUnits:bs[s],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:o}),l.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,1,1,0,1];return new ui(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Mr({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}};Pl.defaultProps=r6,Pl.layerName="TextBackgroundLayer";let If=Pl;const m0={start:1,middle:0,end:-1},y0={top:1,center:0,bottom:-1},Ku=[0,0,0,255],o6=1,a6={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Ku},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:dr.characterSet},fontFamily:dr.fontFamily,fontWeight:dr.fontWeight,lineHeight:o6,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Ku},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Ku},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},Ml=class Ml extends Yo{constructor(){super(...arguments),this.getBoundingRect=(e,i)=>{let{size:[n,s]}=this.transformParagraph(e,i);const{fontSize:r}=this.state.fontAtlasManager.props;n/=r,s/=r;const{getTextAnchor:o,getAlignmentBaseline:a}=this.props,c=m0[typeof o=="function"?o(e,i):o],l=y0[typeof a=="function"?a(e,i):a];return[(c-1)*n/2,(l-1)*s/2,n,s]},this.getIconOffsets=(e,i)=>{const{getTextAnchor:n,getAlignmentBaseline:s}=this.props,{x:r,y:o,rowWidth:a,size:[c,l]}=this.transformParagraph(e,i),u=m0[typeof n=="function"?n(e,i):n],h=y0[typeof s=="function"?s(e,i):s],f=r.length,d=new Array(f*2);let p=0;for(let g=0;g<f;g++){const _=(1-u)*(c-a[g])/2;d[p++]=(u-1)*c/2+_+r[g],d[p++]=(h-1)*l/2+o[g]}return d}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new i6},this.props.maxWidth>0&&ve.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:i,oldProps:n,changeFlags:s}=e;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||i.lineHeight!==n.lineHeight||i.wordBreak!==n.wordBreak||i.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:i,fontWeight:n}=this.props,{fontAtlasManager:s,characterSet:r}=this.state,o={...e,characterSet:r,fontFamily:i,fontWeight:n};if(!s.mapping)return s.setProps(o),!0;for(const a in o)if(o[a]!==s.props[a])return s.setProps(o),!0;return!1}_updateText(){var c;const{data:e,characterSet:i}=this.props,n=(c=e.attributes)==null?void 0:c.getText;let{getText:s}=this.props,r=e.startIndices,o;const a=i==="auto"&&new Set;if(n&&r){const{texts:l,characterCount:u}=G4({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:r,characterSet:a});o=u,s=(h,{index:f})=>l[f]}else{const{iterable:l,objectInfo:u}=Yl(e);r=[0],o=0;for(const h of l){u.index++;const f=Array.from(s(h,u)||"");a&&f.forEach(a.add,a),o+=f.length,r.push(o)}}this.setState({getText:s,startIndices:r,numInstances:o,characterSet:a||i})}transformParagraph(e,i){const{fontAtlasManager:n}=this.state,s=n.mapping,r=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:c}=this.props,l=r(e,i)||"";return Z4(l,a,o,c*n.props.fontSize,s)}renderLayers(){const{startIndices:e,numInstances:i,getText:n,fontAtlasManager:{scale:s,atlas:r,mapping:o},styleVersion:a}=this.state,{data:c,_dataDiff:l,getPosition:u,getColor:h,getSize:f,getAngle:d,getPixelOffset:p,getBackgroundColor:g,getBorderColor:_,getBorderWidth:m,backgroundPadding:b,background:w,billboard:S,fontSettings:R,outlineWidth:M,outlineColor:k,sizeScale:F,sizeUnits:I,sizeMinPixels:N,sizeMaxPixels:C,transitions:V,updateTriggers:X}=this.props,K=this.getSubLayerClass("characters",Mf),B=this.getSubLayerClass("background",If);return[w&&new B({getFillColor:g,getLineColor:_,getLineWidth:m,padding:b,getPosition:u,getSize:f,getAngle:d,getPixelOffset:p,billboard:S,sizeScale:F,sizeUnits:I,sizeMinPixels:N,sizeMaxPixels:C,transitions:V&&{getPosition:V.getPosition,getAngle:V.getAngle,getSize:V.getSize,getFillColor:V.getBackgroundColor,getLineColor:V.getBorderColor,getLineWidth:V.getBorderWidth,getPixelOffset:V.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:X.getPosition,getAngle:X.getAngle,getSize:X.getSize,getFillColor:X.getBackgroundColor,getLineColor:X.getBorderColor,getLineWidth:X.getBorderWidth,getPixelOffset:X.getPixelOffset,getBoundingRect:{getText:X.getText,getTextAnchor:X.getTextAnchor,getAlignmentBaseline:X.getAlignmentBaseline,styleVersion:a}}}),{data:c.attributes&&c.attributes.background?{length:c.length,attributes:c.attributes.background}:c,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new K({sdf:R.sdf,smoothing:Number.isFinite(R.smoothing)?R.smoothing:dr.smoothing,outlineWidth:M/(R.radius||dr.radius),outlineColor:k,iconAtlas:r,iconMapping:o,getPosition:u,getColor:h,getSize:f,getAngle:d,getPixelOffset:p,billboard:S,sizeScale:F*s,sizeUnits:I,sizeMinPixels:N*s,sizeMaxPixels:C*s,transitions:V&&{getPosition:V.getPosition,getAngle:V.getAngle,getColor:V.getColor,getSize:V.getSize,getPixelOffset:V.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:X.getText,getPosition:X.getPosition,getAngle:X.getAngle,getColor:X.getColor,getSize:X.getSize,getPixelOffset:X.getPixelOffset,getIconOffsets:{getTextAnchor:X.getTextAnchor,getAlignmentBaseline:X.getAlignmentBaseline,styleVersion:a}}}),{data:c,_dataDiff:l,startIndices:e,numInstances:i,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){t6(e)}};Ml.defaultProps=a6,Ml.layerName="TextLayer";let Zc=Ml;const dc={circle:{type:Af,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Ir,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Zc,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},pc={type:xf,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Of={type:Pf,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function io({type:t,props:e}){const i={};for(const n in e)i[n]=t.defaultProps[e[n]];return i}function Zu(t,e){const{transitions:i,updateTriggers:n}=t.props,s={updateTriggers:{},transitions:i&&{getPosition:i.geometry}};for(const r in e){const o=e[r];let a=t.props[r];r.startsWith("get")&&(a=t.getSubLayerAccessor(a),s.updateTriggers[o]=n[r],i&&(s.transitions[o]=i[r])),s[o]=a}return s}function c6(t){if(Array.isArray(t))return t;switch(ve.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return ve.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function v0(t,e,i={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:r=t.length}=i;for(let o=s;o<r;o++){const a=t[o],{geometry:c}=a;if(c)if(c.type==="GeometryCollection"){ve.assert(Array.isArray(c.geometries),"GeoJSON does not have geometries array");const{geometries:l}=c;for(let u=0;u<l.length;u++){const h=l[u];b0(h,n,e,a,o)}}else b0(c,n,e,a,o)}return n}function b0(t,e,i,n,s){const{type:r,coordinates:o}=t,{pointFeatures:a,lineFeatures:c,polygonFeatures:l,polygonOutlineFeatures:u}=e;if(!u6(r,o)){ve.warn(`${r} coordinates are malformed`)();return}switch(r){case"Point":a.push(i({geometry:t},n,s));break;case"MultiPoint":o.forEach(h=>{a.push(i({geometry:{type:"Point",coordinates:h}},n,s))});break;case"LineString":c.push(i({geometry:t},n,s));break;case"MultiLineString":o.forEach(h=>{c.push(i({geometry:{type:"LineString",coordinates:h}},n,s))});break;case"Polygon":l.push(i({geometry:t},n,s)),o.forEach(h=>{u.push(i({geometry:{type:"LineString",coordinates:h}},n,s))});break;case"MultiPolygon":o.forEach(h=>{l.push(i({geometry:{type:"Polygon",coordinates:h}},n,s)),h.forEach(f=>{u.push(i({geometry:{type:"LineString",coordinates:f}},n,s))})});break}}const l6={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function u6(t,e){let i=l6[t];for(ve.assert(i,`Unknown GeoJSON type ${t}`);e&&--i>0;)e=e[0];return e&&Number.isFinite(e[0])}function Yv(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function qa(t){return t.geometry.coordinates}function h6(t,e){const i=Yv(),{pointFeatures:n,lineFeatures:s,polygonFeatures:r,polygonOutlineFeatures:o}=t;return i.points.data=n,i.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),i.points.getPosition=qa,i.lines.data=s,i.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),i.lines.getPath=qa,i.polygons.data=r,i.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),i.polygons.getPolygon=qa,i.polygonsOutline.data=o,i.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),i.polygonsOutline.getPath=qa,i}function f6(t,e){const i=Yv(),{points:n,lines:s,polygons:r}=t,o=U4(t,e);return i.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:3,value:o.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},i.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.lines._pathType="open",i.polygons.data={length:r.polygonIndices.value.length-1,startIndices:r.polygonIndices.value,attributes:{...r.attributes,getPolygon:r.positions,pickingColors:{size:3,value:o.polygons}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},i.polygons._normalize=!1,r.triangles&&(i.polygons.data.attributes.indices=r.triangles.value),i.polygonsOutline.data={length:r.primitivePolygonIndices.value.length-1,startIndices:r.primitivePolygonIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:o.polygons}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},i.polygonsOutline._pathType="open",i}const d6=["points","linestrings","polygons"],p6={...io(dc.circle),...io(dc.icon),...io(dc.text),...io(pc),...io(Of),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}},Il=class Il extends Yo{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:i}){if(!i.dataChanged)return;const{data:n}=this.props,s=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:s}),s?this._updateStateBinary({props:e,changeFlags:i}):this._updateStateJSON({props:e,changeFlags:i})}_updateStateBinary({props:e,changeFlags:i}){const n=f6(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:i}){const n=c6(e.data),s=this.getSubLayerRow.bind(this);let r={};const o={};if(Array.isArray(i.dataChanged)){const c=this.state.features;for(const l in c)r[l]=c[l].slice(),o[l]=[];for(const l of i.dataChanged){const u=v0(n,s,l);for(const h in c)o[h].push(F4({data:r[h],getIndex:f=>f.__source.index,dataRange:l,replace:u[h]}))}}else r=v0(n,s);const a=h6(r,o);this.setState({features:r,featuresDiff:o,layerProps:a})}getPickingInfo(e){const i=super.getPickingInfo(e),{index:n,sourceLayer:s}=i;return i.featureType=d6.find(r=>s.id.startsWith(`${this.id}-${r}-`)),n>=0&&s.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(i.index=this.props.data.points.globalFeatureIds.value[n]),i}_updateAutoHighlight(e){const i=`${this.id}-points-`,n=e.featureType==="points";for(const s of this.getSubLayers())s.id.startsWith(i)===n&&s.updateAutoHighlight(e)}_renderPolygonLayer(){var o;const{extruded:e,wireframe:i}=this.props,{layerProps:n}=this.state,s="polygons-fill",r=this.shouldRenderSubLayer(s,(o=n.polygons)==null?void 0:o.data)&&this.getSubLayerClass(s,Of.type);if(r){const a=Zu(this,Of.props),c=e&&i;return c||delete a.getLineColor,a.updateTriggers.lineColors=c,new r(a,this.getSubLayerProps({id:s,updateTriggers:a.updateTriggers}),n.polygons)}return null}_renderLineLayers(){var c,l;const{extruded:e,stroked:i}=this.props,{layerProps:n}=this.state,s="polygons-stroke",r="linestrings",o=!e&&i&&this.shouldRenderSubLayer(s,(c=n.polygonsOutline)==null?void 0:c.data)&&this.getSubLayerClass(s,pc.type),a=this.shouldRenderSubLayer(r,(l=n.lines)==null?void 0:l.data)&&this.getSubLayerClass(r,pc.type);if(o||a){const u=Zu(this,pc.props);return[o&&new o(u,this.getSubLayerProps({id:s,updateTriggers:u.updateTriggers}),n.polygonsOutline),a&&new a(u,this.getSubLayerProps({id:r,updateTriggers:u.updateTriggers}),n.lines)]}return null}_renderPointLayers(){var a;const{pointType:e}=this.props,{layerProps:i,binary:n}=this.state;let{highlightedObjectIndex:s}=this.props;!n&&Number.isFinite(s)&&(s=i.points.data.findIndex(c=>c.__source.index===s));const r=new Set(e.split("+")),o=[];for(const c of r){const l=`points-${c}`,u=dc[c],h=u&&this.shouldRenderSubLayer(l,(a=i.points)==null?void 0:a.data)&&this.getSubLayerClass(l,u.type);if(h){const f=Zu(this,u.props);let d=i.points;if(c==="text"&&n){const{instancePickingColors:p,...g}=d.data.attributes;d={...d,data:{...d.data,attributes:g}}}o.push(new h(f,this.getSubLayerProps({id:l,updateTriggers:f.updateTriggers,highlightedObjectIndex:s}),d))}}return o}renderLayers(){const{extruded:e}=this.props,i=this._renderPolygonLayer(),n=this._renderLineLayers(),s=this._renderPointLayers();return[!e&&i,n,s,e&&i]}getSubLayerAccessor(e){const{binary:i}=this.state;return!i||typeof e!="function"?super.getSubLayerAccessor(e):(n,s)=>{const{data:r,index:o}=s,a=L4(r,o);return e(a,s)}}};Il.layerName="GeoJsonLayer",Il.defaultProps=p6;let kf=Il;class g6{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:i,onLoad:n,onError:s}){const{index:r,id:o,bbox:a,userData:c,zoom:l}=this,u=this._loaderId;this._abortController=new AbortController;const{signal:h}=this._abortController,f=await i.scheduleRequest(this,g=>g.isSelected?1:-1);if(!f){this._isCancelled=!0;return}if(this._isCancelled){f.done();return}let d=null,p;try{d=await e({index:r,id:o,bbox:a,userData:c,zoom:l,signal:h})}catch(g){p=g||!0}finally{f.done()}if(u===this._loaderId){if(this._loader=void 0,this.content=d,this._isCancelled&&!d){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,p?s(p,this):n(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const kt={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},w0=new ee,_6=new ee;class Pd{constructor(e=[0,0,0],i=[0,0,0],n){n=n||w0.copy(e).add(i).scale(.5),this.center=new ee(n),this.halfDiagonal=new ee(i).subtract(this.center),this.minimum=new ee(e),this.maximum=new ee(i)}clone(){return new Pd(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:i}=this,n=_6.from(e.normal),s=i.x*Math.abs(n.x)+i.y*Math.abs(n.y)+i.z*Math.abs(n.z),r=this.center.dot(n)+e.distance;return r-s>0?kt.INSIDE:r+s<0?kt.OUTSIDE:kt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const i=w0.from(e).subtract(this.center),{halfDiagonal:n}=this;let s=0,r;return r=Math.abs(i.x)-n.x,r>0&&(s+=r*r),r=Math.abs(i.y)-n.y,r>0&&(s+=r*r),r=Math.abs(i.z)-n.z,r>0&&(s+=r*r),s}}const no=new ee,T0=new ee;class Md{constructor(e=[0,0,0],i=0){this.radius=-0,this.center=new ee,this.fromCenterRadius(e,i)}fromCenterRadius(e,i){return this.center.from(e),this.radius=i,this}fromCornerPoints(e,i){return i=no.from(i),this.center=new ee().from(e).add(i).scale(.5),this.radius=this.center.distance(i),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Md(this.center,this.radius)}union(e){const i=this.center,n=this.radius,s=e.center,r=e.radius,o=no.copy(s).subtract(i),a=o.magnitude();if(n>=a+r)return this.clone();if(r>=a+n)return e.clone();const c=(n+a+r)*.5;return T0.copy(o).scale((-n+c)/a).add(i),this.center.copy(T0),this.radius=c,this}expand(e){const n=no.from(e).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(e){this.center.transform(e);const i=AC(no,e);return this.radius=Math.max(i[0],Math.max(i[1],i[2]))*this.radius,this}distanceSquaredTo(e){const i=this.distanceTo(e);return i*i}distanceTo(e){const n=no.from(e).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(e){const i=this.center,n=this.radius,r=e.normal.dot(i)+e.distance;return r<-n?kt.OUTSIDE:r<n?kt.INTERSECTING:kt.INSIDE}}const m6=new ee,y6=new ee,Ya=new ee,Ka=new ee,Za=new ee,v6=new ee,b6=new ee,Wi={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Id{constructor(e=[0,0,0],i=[0,0,0,0,0,0,0,0,0]){this.center=new ee().from(e),this.halfAxes=new At(i)}get halfSize(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new ee(e).len(),new ee(i).len(),new ee(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),s=new ee(e).normalize(),r=new ee(i).normalize(),o=new ee(n).normalize();return new qg().fromMatrix3(new At([...s,...r,...o]))}fromCenterHalfSizeQuaternion(e,i,n){const s=new qg(n),r=new At().fromQuaternion(s);return r[0]=r[0]*i[0],r[1]=r[1]*i[0],r[2]=r[2]*i[0],r[3]=r[3]*i[1],r[4]=r[4]*i[1],r[5]=r[5]*i[1],r[6]=r[6]*i[2],r[7]=r[7]*i[2],r[8]=r[8]*i[2],this.center=new ee().from(e),this.halfAxes=r,this}clone(){return new Id(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Md){const i=this.halfAxes,n=i.getColumn(0,Ya),s=i.getColumn(1,Ka),r=i.getColumn(2,Za),o=m6.copy(n).add(s).add(r);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const i=this.center,n=e.normal,s=this.halfAxes,r=n.x,o=n.y,a=n.z,c=Math.abs(r*s[Wi.COLUMN0ROW0]+o*s[Wi.COLUMN0ROW1]+a*s[Wi.COLUMN0ROW2])+Math.abs(r*s[Wi.COLUMN1ROW0]+o*s[Wi.COLUMN1ROW1]+a*s[Wi.COLUMN1ROW2])+Math.abs(r*s[Wi.COLUMN2ROW0]+o*s[Wi.COLUMN2ROW1]+a*s[Wi.COLUMN2ROW2]),l=n.dot(i)+e.distance;return l<=-c?kt.OUTSIDE:l>=c?kt.INSIDE:kt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const i=y6.from(e).subtract(this.center),n=this.halfAxes,s=n.getColumn(0,Ya),r=n.getColumn(1,Ka),o=n.getColumn(2,Za),a=s.magnitude(),c=r.magnitude(),l=o.magnitude();s.normalize(),r.normalize(),o.normalize();let u=0,h;return h=Math.abs(i.dot(s))-a,h>0&&(u+=h*h),h=Math.abs(i.dot(r))-c,h>0&&(u+=h*h),h=Math.abs(i.dot(o))-l,h>0&&(u+=h*h),u}computePlaneDistances(e,i,n=[-0,-0]){let s=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,c=a.getColumn(0,Ya),l=a.getColumn(1,Ka),u=a.getColumn(2,Za),h=v6.copy(c).add(l).add(u).add(o),f=b6.copy(h).subtract(e);let d=i.dot(f);return s=Math.min(d,s),r=Math.max(d,r),h.copy(o).add(c).add(l).subtract(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),h.copy(o).add(c).subtract(l).add(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),h.copy(o).add(c).subtract(l).subtract(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),o.copy(h).subtract(c).add(l).add(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),o.copy(h).subtract(c).add(l).subtract(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),o.copy(h).subtract(c).subtract(l).add(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),o.copy(h).subtract(c).subtract(l).subtract(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),n[0]=s,n[1]=r,n}transform(e){this.center.transformAsPoint(e);const i=this.halfAxes.getColumn(0,Ya);i.transformAsPoint(e);const n=this.halfAxes.getColumn(1,Ka);n.transformAsPoint(e);const s=this.halfAxes.getColumn(2,Za);return s.transformAsPoint(e),this.halfAxes=new At([...i,...n,...s]),this}getTransform(){throw new Error("not implemented")}}const E0=new ee,S0=new ee;class Go{constructor(e=[0,0,1],i=0){this.normal=new ee,this.distance=-0,this.fromNormalDistance(e,i)}fromNormalDistance(e,i){return Wo(Number.isFinite(i)),this.normal.from(e).normalize(),this.distance=i,this}fromPointNormal(e,i){e=E0.from(e),this.normal.from(i).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,i,n,s){return this.normal.set(e,i,n),Wo(Zi(this.normal.len(),1)),this.distance=s,this}clone(){return new Go(this.normal,this.distance)}equals(e){return Zi(this.distance,e.distance)&&Zi(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const i=S0.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,i)}projectPointOntoPlane(e,i=[0,0,0]){const n=E0.from(e),s=this.getPointDistance(n),r=S0.copy(this.normal).scale(s);return n.subtract(r).to(i)}}const A0=[new ee([1,0,0]),new ee([0,1,0]),new ee([0,0,1])],R0=new ee,w6=new ee;class Ki{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*A0.length;const i=e.center,n=e.radius;let s=0;for(const r of A0){let o=this.planes[s],a=this.planes[s+1];o||(o=this.planes[s]=new Go),a||(a=this.planes[s+1]=new Go);const c=R0.copy(r).scale(-n).add(i);o.fromPointNormal(c,r);const l=R0.copy(r).scale(n).add(i),u=w6.copy(r).negate();a.fromPointNormal(l,u),s+=2}return this}computeVisibility(e){let i=kt.INSIDE;for(const n of this.planes)switch(e.intersectPlane(n)){case kt.OUTSIDE:return kt.OUTSIDE;case kt.INTERSECTING:i=kt.INTERSECTING;break}return i}computeVisibilityWithPlaneMask(e,i){if(Wo(Number.isFinite(i),"parentPlaneMask is required."),i===Ki.MASK_OUTSIDE||i===Ki.MASK_INSIDE)return i;let n=Ki.MASK_INSIDE;const s=this.planes;for(let r=0;r<this.planes.length;++r){const o=r<31?1<<r:0;if(r<31&&!(i&o))continue;const a=s[r],c=e.intersectPlane(a);if(c===kt.OUTSIDE)return Ki.MASK_OUTSIDE;c===kt.INTERSECTING&&(n|=o)}return n}}Ki.MASK_OUTSIDE=4294967295;Ki.MASK_INSIDE=0;Ki.MASK_INDETERMINATE=2147483647;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;const ki=new At,T6=new At,E6=new At,Ga=new At,C0=new At;function S6(t,e={}){const i=lx,n=10;let s=0,r=0;const o=T6,a=E6;o.identity(),a.copy(t);const c=i*A6(a);for(;r<n&&R6(a)>c;)C6(a,Ga),C0.copy(Ga).transpose(),a.multiplyRight(Ga),a.multiplyLeft(C0),o.multiplyRight(Ga),++s>2&&(++r,s=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function A6(t){let e=0;for(let i=0;i<9;++i){const n=t[i];e+=n*n}return Math.sqrt(e)}const Nf=[1,0,0],Df=[2,2,1];function R6(t){let e=0;for(let i=0;i<3;++i){const n=t[ki.getElementIndex(Df[i],Nf[i])];e+=2*n*n}return Math.sqrt(e)}function C6(t,e){const i=cx;let n=0,s=1;for(let l=0;l<3;++l){const u=Math.abs(t[ki.getElementIndex(Df[l],Nf[l])]);u>n&&(s=l,n=u)}const r=Nf[s],o=Df[s];let a=1,c=0;if(Math.abs(t[ki.getElementIndex(o,r)])>i){const l=t[ki.getElementIndex(o,o)],u=t[ki.getElementIndex(r,r)],h=t[ki.getElementIndex(o,r)],f=(l-u)/2/h;let d;f<0?d=-1/(-f+Math.sqrt(1+f*f)):d=1/(f+Math.sqrt(1+f*f)),a=1/Math.sqrt(1+d*d),c=d*a}return At.IDENTITY.to(e),e[ki.getElementIndex(r,r)]=e[ki.getElementIndex(o,o)]=a,e[ki.getElementIndex(o,r)]=c,e[ki.getElementIndex(r,o)]=-c,e}const cn=new ee,x6=new ee,P6=new ee,M6=new ee,I6=new ee,O6=new At,k6={diagonal:new At,unitary:new At};function N6(t,e=new Id){if(!t||t.length===0)return e.halfAxes=new At([0,0,0,0,0,0,0,0,0]),e.center=new ee,e;const i=t.length,n=new ee(0,0,0);for(const I of t)n.add(I);const s=1/i;n.multiplyByScalar(s);let r=0,o=0,a=0,c=0,l=0,u=0;for(const I of t){const N=cn.copy(I).subtract(n);r+=N.x*N.x,o+=N.x*N.y,a+=N.x*N.z,c+=N.y*N.y,l+=N.y*N.z,u+=N.z*N.z}r*=s,o*=s,a*=s,c*=s,l*=s,u*=s;const h=O6;h[0]=r,h[1]=o,h[2]=a,h[3]=o,h[4]=c,h[5]=l,h[6]=a,h[7]=l,h[8]=u;const{unitary:f}=S6(h,k6),d=e.halfAxes.copy(f);let p=d.getColumn(0,P6),g=d.getColumn(1,M6),_=d.getColumn(2,I6),m=-Number.MAX_VALUE,b=-Number.MAX_VALUE,w=-Number.MAX_VALUE,S=Number.MAX_VALUE,R=Number.MAX_VALUE,M=Number.MAX_VALUE;for(const I of t)cn.copy(I),m=Math.max(cn.dot(p),m),b=Math.max(cn.dot(g),b),w=Math.max(cn.dot(_),w),S=Math.min(cn.dot(p),S),R=Math.min(cn.dot(g),R),M=Math.min(cn.dot(_),M);p=p.multiplyByScalar(.5*(S+m)),g=g.multiplyByScalar(.5*(R+b)),_=_.multiplyByScalar(.5*(M+w)),e.center.copy(p).add(g).add(_);const k=x6.set(m-S,b-R,w-M).multiplyByScalar(.5),F=new At([k[0],0,0,0,k[1],0,0,0,k[2]]);return e.halfAxes.multiplyRight(F),e}const or=512,x0=3,Kv=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],Zv=Kv.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),D6=Zv.concat([[.25,.5],[.75,.5]]);class ar{constructor(e,i,n){this.x=e,this.y=i,this.z=n}get children(){if(!this._children){const e=this.x*2,i=this.y*2,n=this.z+1;this._children=[new ar(e,i,n),new ar(e,i+1,n),new ar(e+1,i,n),new ar(e+1,i+1,n)]}return this._children}update(e){const{viewport:i,cullingVolume:n,elevationBounds:s,minZ:r,maxZ:o,bounds:a,offset:c,project:l}=e,u=this.getBoundingVolume(s,c,l);if(a&&!this.insideBounds(a)||n.computeVisibility(u)<0)return!1;if(!this.childVisible){let{z:f}=this;if(f<o&&f>=r){const d=u.distanceTo(i.cameraPosition)*i.scale/i.height;f+=Math.floor(Math.log2(d))}if(f>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const f of this.children)f.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const i of this._children)i.getSelected(e);return e}insideBounds([e,i,n,s]){const r=Math.pow(2,this.z),o=or/r;return this.x*o<n&&this.y*o<s&&(this.x+1)*o>e&&(this.y+1)*o>i}getBoundingVolume(e,i,n){if(n){const c=this.z<1?D6:this.z<2?Zv:Kv,l=[];for(const u of c){const h=Lf(this.x+u[0],this.y+u[1],this.z);h[2]=e[0],l.push(n(h)),e[0]!==e[1]&&(h[2]=e[1],l.push(n(h)))}return N6(l)}const s=Math.pow(2,this.z),r=or/s,o=this.x*r+i*or,a=or-(this.y+1)*r;return new Pd([o,a,e[0]],[o+r,a+r,e[1]])}}function F6(t,e,i,n){const s=t instanceof PN&&t.resolution?t.projectPosition:null,r=Object.values(t.getFrustumPlanes()).map(({normal:d,distance:p})=>new Go(d.clone().negate(),p)),o=new Ki(r),a=t.distanceScales.unitsPerMeter[2],c=i&&i[0]*a||0,l=i&&i[1]*a||0,u=t instanceof Pr&&t.pitch<=60?e:0;if(n){const[d,p,g,_]=n,m=Cn([d,_]),b=Cn([g,p]);n=[m[0],or-m[1],b[0],or-b[1]]}const h=new ar(0,0,0),f={viewport:t,project:s,cullingVolume:o,elevationBounds:[c,l],minZ:u,maxZ:e,bounds:n,offset:0};if(h.update(f),t instanceof Pr&&t.subViewports&&t.subViewports.length>1){for(f.offset=-1;h.update(f)&&!(--f.offset<-x0););for(f.offset=1;h.update(f)&&!(++f.offset>x0););}return h.getSelected()}const Qi=512,L6=[-1/0,-1/0,1/0,1/0],B6={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(i=>typeof i=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const i=t.length;if(i!==e.length)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}};function Gv(t,e){const i=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...i.map(s=>s[0])),Math.min(...i.map(s=>s[1])),Math.max(...i.map(s=>s[0])),Math.max(...i.map(s=>s[1]))]}function U6(t){return Math.abs(t.split("").reduce((e,i)=>(e<<5)-e+i.charCodeAt(0)|0,0))}function z6(t,e){if(!t||!t.length)return null;const{index:i,id:n}=e;if(Array.isArray(t)){const r=U6(n)%t.length;t=t[r]}let s=t;for(const r of Object.keys(i)){const o=new RegExp(`{${r}}`,"g");s=s.replace(o,String(i[r]))}return Number.isInteger(i.y)&&Number.isInteger(i.z)&&(s=s.replace(/\{-y\}/g,String(Math.pow(2,i.z)-i.y-1))),s}function V6(t,e,i){let n;if(e&&e.length===2){const[s,r]=e,o=t.getBounds({z:s}),a=t.getBounds({z:r});n=[Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.max(o[2],a[2]),Math.max(o[3],a[3])]}else n=t.getBounds();return t.isGeospatial?[Math.max(n[0],i[0]),Math.max(n[1],i[1]),Math.min(n[2],i[2]),Math.min(n[3],i[3])]:[Math.max(Math.min(n[0],i[2]),i[0]),Math.max(Math.min(n[1],i[3]),i[1]),Math.min(Math.max(n[2],i[0]),i[2]),Math.min(Math.max(n[3],i[1]),i[3])]}function j6({viewport:t,z:e,cullRect:i}){return(t.subViewports||[t]).map(s=>Ff(s,e||0,i))}function Ff(t,e,i){if(!Array.isArray(e)){const r=i.x-t.x,o=i.y-t.y,{width:a,height:c}=i,l={targetZ:e},u=t.unproject([r,o],l),h=t.unproject([r+a,o],l),f=t.unproject([r,o+c],l),d=t.unproject([r+a,o+c],l);return[Math.min(u[0],h[0],f[0],d[0]),Math.min(u[1],h[1],f[1],d[1]),Math.max(u[0],h[0],f[0],d[0]),Math.max(u[1],h[1],f[1],d[1])]}const n=Ff(t,e[0],i),s=Ff(t,e[1],i);return[Math.min(n[0],s[0]),Math.min(n[1],s[1]),Math.max(n[2],s[2]),Math.max(n[3],s[3])]}function $6(t,e,i){return i?Gv(t,i).map(s=>s*e/Qi):t.map(n=>n*e/Qi)}function Od(t,e){return Math.pow(2,t)*Qi/e}function Lf(t,e,i){const n=Od(i,Qi),s=t/n*360-180,r=Math.PI-2*Math.PI*e/n,o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[s,o]}function P0(t,e,i,n){const s=Od(i,n);return[t/s*Qi,e/s*Qi]}function H6(t,e,i,n,s=Qi){if(t.isGeospatial){const[l,u]=Lf(e,i,n),[h,f]=Lf(e+1,i+1,n);return{west:l,north:u,east:h,south:f}}const[r,o]=P0(e,i,n,s),[a,c]=P0(e+1,i+1,n,s);return{left:r,top:o,right:a,bottom:c}}function W6(t,e,i,n,s){const r=V6(t,null,n),o=Od(e,i),[a,c,l,u]=$6(r,o,s),h=[];for(let f=Math.floor(a);f<l;f++)for(let d=Math.floor(c);d<u;d++)h.push({x:f,y:d,z:e});return h}function X6({viewport:t,maxZoom:e,minZoom:i,zRange:n,extent:s,tileSize:r=Qi,modelMatrix:o,modelMatrixInverse:a,zoomOffset:c=0}){let l=t.isGeospatial?Math.round(t.zoom+Math.log2(Qi/r))+c:Math.ceil(t.zoom)+c;if(typeof i=="number"&&Number.isFinite(i)&&l<i){if(!s)return[];l=i}typeof e=="number"&&Number.isFinite(e)&&l>e&&(l=e);let u=s;return o&&a&&s&&!t.isGeospatial&&(u=Gv(s,o)),t.isGeospatial?F6(t,l,n,s):W6(t,l,r,u||L6,a)}function q6(t){let e={},i;return n=>{for(const s in n)if(!Y6(n[s],e[s])){i=t(n),e=n;break}return i}}function Y6(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}return!1}const M0=1,Kl=2,K6="never",Z6="no-overlap",kd="best-available",G6=5,J6={[kd]:tD,[Z6]:iD,[K6]:()=>{}},Q6={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class eD{constructor(e){this._getCullBounds=q6(j6),this.opts={...Q6,...e},this.setOptions(this.opts),this.onTileLoad=i=>{var n,s;(s=(n=this.opts).onTileLoad)==null||s.call(n,i),this.opts.maxCacheByteSize&&(this._cacheByteSize+=i.byteLength,this._resizeCache())},this._requestScheduler=new kS({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Rt,this._modelMatrixInverse=new Rt}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const i=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(i)?this._cache.delete(e):i.setNeedsReload()}}update(e,{zRange:i,modelMatrix:n}={zRange:null,modelMatrix:null}){const s=n?new Rt(n):new Rt,r=!s.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Zi(this._zRange,i)||r){r&&(this._modelMatrixInverse=s.clone().invert(),this._modelMatrix=s),this._viewport=e,this._zRange=i;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:i,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(c=>this._getTile(c,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,i){if(!e.isVisible)return!1;if(i&&this._viewport){const n=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:i}),{bbox:s}=e;for(const[r,o,a,c]of n){let l;if("west"in s)l=s.west<a&&s.east>r&&s.south<c&&s.north>o;else{const u=Math.min(s.top,s.bottom),h=Math.max(s.top,s.bottom);l=s.left<a&&s.right>r&&u<c&&h>o}if(l)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:i,minZoom:n,zRange:s,modelMatrix:r,modelMatrixInverse:o}){const{tileSize:a,extent:c,zoomOffset:l}=this.opts;return X6({viewport:e,maxZoom:i,minZoom:n,zRange:s,tileSize:a,extent:c,modelMatrix:r,modelMatrixInverse:o,zoomOffset:l})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:i}=this.opts;return{bbox:H6(this._viewport,e.x,e.y,e.z,i)}}getParentIndex(e){const i=Math.floor(e.x/2),n=Math.floor(e.y/2),s=e.z-1;return{x:i,y:n,z:s}}updateTileStates(){const e=this.opts.refinementStrategy||kd,i=new Array(this._cache.size);let n=0;for(const s of this._cache.values())i[n++]=s.isVisible,s.isSelected=!1,s.isVisible=!1;for(const s of this._selectedTiles)s.isSelected=!0,s.isVisible=!0;(typeof e=="function"?e:J6[e])(Array.from(this._cache.values())),n=0;for(const s of this._cache.values())if(i[n++]!==s.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,i=[];let n=0;for(const s of this._cache.values())s.isLoading&&(n++,!s.isSelected&&!s.isVisible&&i.push(s));for(;e>0&&n>e&&i.length>0;)i.shift().abort(),n--}_rebuildTree(){const{_cache:e}=this;for(const i of e.values())i.parent=null,i.children&&(i.children.length=0);for(const i of e.values()){const n=this._getNearestAncestor(i);i.parent=n,n!=null&&n.children&&n.children.push(i)}}_resizeCache(){var o,a;const{_cache:e,opts:i}=this,n=i.maxCacheSize||(i.maxCacheByteSize?1/0:G6*this.selectedTiles.length),s=i.maxCacheByteSize||1/0;if(e.size>n||this._cacheByteSize>s){for(const[c,l]of e)if(!l.isVisible&&!l.isSelected&&(this._cacheByteSize-=i.maxCacheByteSize?l.byteLength:0,e.delete(c),(a=(o=this.opts).onTileUnload)==null||a.call(o,l)),e.size<=n&&this._cacheByteSize<=s)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((c,l)=>c.zoom-l.zoom),this._dirty=!1)}_getTile(e,i){const n=this.getTileId(e);let s=this._cache.get(n),r=!1;return!s&&i?(s=new g6(e),Object.assign(s,this.getTileMetadata(s.index)),Object.assign(s,{id:n,zoom:this.getTileZoom(s.index)}),r=!0,this._cache.set(n,s),this._dirty=!0):s&&s.needsReload&&(r=!0),s&&r&&s.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),s}_getNearestAncestor(e){const{_minZoom:i=0}=this;let n=e.index;for(;this.getTileZoom(n)>i;){n=this.getParentIndex(n);const s=this._getTile(n);if(s)return s}return null}}function tD(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!Jv(e)&&Nd(e);for(const e of t)e.isVisible=!!(e.state&Kl)}function iD(t){for(const i of t)i.state=0;for(const i of t)i.isSelected&&Jv(i);const e=Array.from(t).sort((i,n)=>i.zoom-n.zoom);for(const i of e)if(i.isVisible=!!(i.state&Kl),i.children&&(i.isVisible||i.state&M0))for(const n of i.children)n.state=M0;else i.isSelected&&Nd(i)}function Jv(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=Kl,!0;e=e.parent}return!1}function Nd(t){for(const e of t.children)e.isLoaded||e.content?e.state|=Kl:Nd(e)}const nD={TilesetClass:eD,data:{type:"data",value:[]},dataComparator:B6.equal,renderSubLayers:{type:"function",value:t=>new kf(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:kd,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0},Ol=class Ol extends Yo{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,i;(i=(e=this.state)==null?void 0:e.tileset)==null||i.finalize()}get isLoaded(){var e,i,n;return!!((n=(i=(e=this.state)==null?void 0:e.tileset)==null?void 0:i.selectedTiles)!=null&&n.every(s=>s.isLoaded&&s.layers&&s.layers.every(r=>r.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:i}=this.state;const n=e.propsOrDataChanged||e.updateTriggersChanged,s=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);i?n&&(i.setOptions(this._getTilesetOptions()),s?i.reloadAll():i.tiles.forEach(r=>{r.layers=null})):(i=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:i})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:i,maxCacheByteSize:n,refinementStrategy:s,extent:r,maxZoom:o,minZoom:a,maxRequests:c,debounceTime:l,zoomOffset:u}=this.props;return{maxCacheSize:i,maxCacheByteSize:n,maxZoom:o,minZoom:a,tileSize:e,refinementStrategy:s,extent:r,maxRequests:c,debounceTime:l,zoomOffset:u,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:i,modelMatrix:n}=this.props,s=e.update(this.context.viewport,{zRange:i,modelMatrix:n}),{isLoaded:r}=e,o=this.state.isLoaded!==r,a=this.state.frameNumber!==s;r&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:s}),this.state.isLoaded=r}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:i}=this.props;i&&i(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,i){this.props.onTileError(e),i.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:i,getTileData:n,fetch:s}=this.props,{signal:r}=e;return e.url=typeof i=="string"||Array.isArray(i)?z6(i,e):null,n?n(e):s&&e.url?s(e.url,{propName:"data",layer:this,signal:r}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const i=e.sourceLayer,n=i.props.tile,s=e.info;return s.picked&&(s.tile=n),s.sourceTile=n,s.sourceTileSubLayer=i,s}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const i=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)i&&e.layers[0]&&Object.keys(i).some(n=>e.layers[0].props[n]!==i[n])&&(e.layers=e.layers.map(n=>n.clone(i)));else{const n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=$l(n,Boolean).map(s=>s.clone({tile:e,...i}))}return e.layers})}filterSubLayer({layer:e,cullRect:i}){const{tile:n}=e.props;return this.state.tileset.isTileVisible(n,i)}};Ol.defaultProps=nD,Ol.layerName="TileLayer";let Bf=Ol;const sD="4.2.0";function rD(t){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,t)}function oD(t){var i,n;return((n=(i=globalThis.loaders)==null?void 0:i.modules)==null?void 0:n[t])||null}function aD(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.0"),globalThis._loadersgl_.version}const cD=aD();function lD(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const aa=typeof process!="object"||String(process)!=="[object process]"||process.browser,Dd=typeof importScripts=="function",I0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);I0&&parseFloat(I0[1]);const Gu={};async function Gc(t,e=null,i={},n=null){return e&&(t=uD(t,e,i,n)),Gu[t]=Gu[t]||hD(t),await Gu[t]}function uD(t,e,i={},n=null){if(!i.useLocalLibraries&&t.startsWith("http"))return t;n=n||t;const s=i.modules||{};return s[n]?s[n]:aa?i.CDN?(lD(i.CDN.startsWith("http")),`${i.CDN}/${e}@${cD}/dist/libs/${n}`):Dd?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function hD(t){if(t.endsWith("wasm"))return await dD(t);if(!aa)try{const{requireFromFile:i}=globalThis.loaders||{};return await(i==null?void 0:i(t))}catch(i){return console.error(i),null}if(Dd)return importScripts(t);const e=await pD(t);return fD(e,t)}function fD(t,e){if(!aa){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(t,e)}if(Dd)return eval.call(globalThis,t),null;const i=document.createElement("script");i.id=e;try{i.appendChild(document.createTextNode(t))}catch{i.text=t}return document.body.appendChild(i),null}async function dD(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return aa||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function pD(t){const{readFileAsText:e}=globalThis.loaders||{};return aa||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}const Jc={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let O0;async function k0(t){rD(t.modules);const e=oD("basis");return e||(O0||(O0=gD(t)),await O0)}async function gD(t){let e=null,i=null;return[e,i]=await Promise.all([await Gc(Jc.TRANSCODER,"textures",t),await Gc(Jc.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await _D(e,i)}function _D(t,e){const i={};return e&&(i.wasmBinary=e),new Promise(n=>{t(i).then(s=>{const{BasisFile:r,initializeBasis:o}=s;o(),n({BasisFile:r})})})}let Ju;async function N0(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(Ju=Ju||mD(t),await Ju)}async function mD(t){let e=null,i=null;return[e,i]=await Promise.all([await Gc(Jc.ENCODER,"textures",t),await Gc(Jc.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await yD(e,i)}function yD(t,e){const i={};return e&&(i.wasmBinary=e),new Promise(n=>{t(i).then(s=>{const{BasisFile:r,KTX2File:o,initializeBasis:a,BasisEncoder:c}=s;a(),n({BasisFile:r,KTX2File:o,BasisEncoder:c})})})}const Hs={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},vD=["","WEBKIT_","MOZ_"],D0={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Ja=null;function bD(t){if(!Ja){t=t||wD()||void 0,Ja=new Set;for(const e of vD)for(const i in D0)if(t&&t.getExtension(`${e}${i}`)){const n=D0[i];Ja.add(n)}}return Ja}function wD(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var F0,L0,B0,U0,z0,V0,j0,$0;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(F0||(F0={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(L0||(L0={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(B0||(B0={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(U0||(U0={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(z0||(z0={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(V0||(V0={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(j0||(j0={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}($0||($0={}));const Gt=[171,75,84,88,32,50,48,187,13,10,26,10];function TD(t){const e=new Uint8Array(t);return!(e.byteLength<Gt.length||e[0]!==Gt[0]||e[1]!==Gt[1]||e[2]!==Gt[2]||e[3]!==Gt[3]||e[4]!==Gt[4]||e[5]!==Gt[5]||e[6]!==Gt[6]||e[7]!==Gt[7]||e[8]!==Gt[8]||e[9]!==Gt[9]||e[10]!==Gt[10]||e[11]!==Gt[11])}const ED={etc1:{basisFormat:0,compressed:!0,format:Hs.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Hs.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Hs.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Hs.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Hs.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Hs.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function SD(t,e){if(e.basis.containerFormat==="auto"){if(TD(t)){const n=await N0(e);return H0(n.KTX2File,t,e)}const{BasisFile:i}=await k0(e);return Qu(i,t,e)}switch(e.basis.module){case"encoder":const i=await N0(e);switch(e.basis.containerFormat){case"ktx2":return H0(i.KTX2File,t,e);case"basis":default:return Qu(i.BasisFile,t,e)}case"transcoder":default:const{BasisFile:n}=await k0(e);return Qu(n,t,e)}}function Qu(t,e,i){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const s=n.getNumImages(),r=[];for(let o=0;o<s;o++){const a=n.getNumLevels(o),c=[];for(let l=0;l<a;l++)c.push(AD(n,o,l,i));r.push(c)}return r}finally{n.close(),n.delete()}}function AD(t,e,i,n){const s=t.getImageWidth(e,i),r=t.getImageHeight(e,i),o=t.getHasAlpha(),{compressed:a,format:c,basisFormat:l}=Qv(n,o),u=t.getImageTranscodedSizeInBytes(e,i,l),h=new Uint8Array(u);if(!t.transcodeImage(h,e,i,l,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:r,data:h,compressed:a,format:c,hasAlpha:o}}function H0(t,e,i){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=n.getLevels(),r=[];for(let o=0;o<s;o++){r.push(RD(n,o,i));break}return[r]}finally{n.close(),n.delete()}}function RD(t,e,i){const{alphaFlag:n,height:s,width:r}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:c}=Qv(i,n),l=t.getImageTranscodedSizeInBytes(e,0,0,c),u=new Uint8Array(l);if(!t.transcodeImage(u,e,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:r,height:s,data:u,compressed:o,levelSize:l,hasAlpha:n,format:a}}function Qv(t,e){let i=t&&t.basis&&t.basis.format;return i==="auto"&&(i=eb()),typeof i=="object"&&(i=e?i.alpha:i.noAlpha),i=i.toLowerCase(),ED[i]}function eb(){const t=bD();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const CD={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:sD,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},xD={...CD,parse:SD};function W0(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1}function PD(t){const e=t-1;return e*e*e+1}function Qc(t,{delay:e=0,duration:i=400,easing:n=qm}={}){const s=+getComputedStyle(t).opacity;return{delay:e,duration:i,easing:n,css:r=>`opacity: ${r*s}`}}function zi(t,{delay:e=0,duration:i=400,easing:n=PD,x:s=0,y:r=0,opacity:o=0}={}){const a=getComputedStyle(t),c=+a.opacity,l=a.transform==="none"?"":a.transform,u=c*(1-o),[h,f]=Zd(s),[d,p]=Zd(r);return{delay:e,duration:i,easing:n,css:(g,_)=>`
			transform: ${l} translate(${(1-g)*h}${f}, ${(1-g)*d}${p});
			opacity: ${c-u*_}`}}function X0(t){return Object.prototype.toString.call(t)==="[object Date]"}function Uf(t,e){if(t===e||t!==t)return()=>t;const i=typeof t;if(i!==typeof e||Array.isArray(t)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(t)){const n=e.map((s,r)=>Uf(t[r],s));return s=>n.map(r=>r(s))}if(i==="object"){if(!t||!e)throw new Error("Object cannot be null");if(X0(t)&&X0(e)){t=t.getTime(),e=e.getTime();const r=e-t;return o=>new Date(t+o*r)}const n=Object.keys(e),s={};return n.forEach(r=>{s[r]=Uf(t[r],e[r])}),r=>{const o={};return n.forEach(a=>{o[a]=s[a](r)}),o}}if(i==="number"){const n=e-t;return s=>t+s*n}throw new Error(`Cannot interpolate ${i} values`)}function zf(t,e={}){const i=Dl(t);let n,s=t;function r(o,a){if(t==null)return i.set(t=o),Promise.resolve();s=o;let c=n,l=!1,{delay:u=0,duration:h=400,easing:f=qm,interpolate:d=Uf}=Gd(Gd({},e),a);if(h===0)return c&&(c.abort(),c=null),i.set(t=s),Promise.resolve();const p=sw()+u;let g;return n=rw(_=>{if(_<p)return!0;l||(g=d(t,o),typeof h=="function"&&(h=h(t,o)),l=!0),c&&(c.abort(),c=null);const m=_-p;return m>h?(i.set(t=o),!1):(i.set(t=g(f(m/h))),!0)}),n.promise}return{set:r,update:(o,a)=>r(o(s,t),a),subscribe:i.subscribe}}function MD(t){console.log(t);let e=t.length;for(;e!=0;){let i=Math.floor(Math.random()*e);e--,[t[e],t[i]]=[t[i],t[e]]}}function ID(t){let e,i,n,s;return{c(){e=H("div"),i=H("canvas"),this.h()},l(r){e=W(r,"DIV",{class:!0});var o=se(e);i=W(o,"CANVAS",{width:!0,height:!0,style:!0,class:!0});var a=se(i);a.forEach(L),o.forEach(L),this.h()},h(){O(i,"width",n=t[1]*2),O(i,"height",s=t[0]*2),Ne(i,"width",t[1]+"px"),Ne(i,"height",t[0]+"px"),Ne(i,"opacity",Math.max(t[2],1)),O(i,"class","svelte-oi0wyw"),O(e,"class","canvas-container svelte-oi0wyw"),_n(e,"introFinished",t[4])},m(r,o){oe(r,e,o),U(e,i),t[18](i)},p(r,o){o&2&&n!==(n=r[1]*2)&&O(i,"width",n),o&1&&s!==(s=r[0]*2)&&O(i,"height",s),o&2&&Ne(i,"width",r[1]+"px"),o&1&&Ne(i,"height",r[0]+"px"),o&4&&Ne(i,"opacity",Math.max(r[2],1)),o&16&&_n(e,"introFinished",r[4])},d(r){r&&L(e),t[18](null)}}}function OD(t){let e,i=t[5]&&ID(t);return{c(){i&&i.c(),e=mr()},l(n){i&&i.l(n),e=mr()},m(n,s){i&&i.m(n,s),oe(n,e,s)},p(n,[s]){n[5]&&i.p(n,s)},i:pt,o:pt,d(n){n&&L(e),i&&i.d(n)}}}let kD=1e4;function ND(t,e){return[t,e]}function DD(t,e,i){let n,s,r,o,a,c;const l=Ym();let{sizes:u}=e,{geoJSON:h}=e,{courtData:f}=e,{viewportHeight:d}=e,{viewportWidth:p}=e,g=kh().domain([.2,1]).range([0,1]).exponent(10).clamp(!0),_=kh().domain([0,1]).range([3,1]).exponent(.5).clamp(!0);MD(f);let m=f.map(N=>N.latLong);const b={type:"Sphere"};let w=zf(0,{duration:kD,easing:W0});wn(t,w,N=>i(2,a=N));let S=zf(0,{duration:2e3,easing:W0});wn(t,S,N=>i(17,c=N)),wy(ND).fitWidth(p*2,b).scale(1e3);let R,M,k,F;Nl(()=>{i(12,k=M.getContext("2d")),w.set(1).then(()=>{i(11,R=!0),console.log("here"),S.set(1).then(()=>{i(4,F=!0),l("finished",{text:"Hello!"})}),o()})});function I(N){fh[N?"unshift":"push"](()=>{M=N,i(3,M)})}return t.$$set=N=>{"sizes"in N&&i(8,u=N.sizes),"geoJSON"in N&&i(9,h=N.geoJSON),"courtData"in N&&i(10,f=N.courtData),"viewportHeight"in N&&i(0,d=N.viewportHeight),"viewportWidth"in N&&i(1,p=N.viewportWidth)},t.$$.update=()=>{t.$$.dirty&7&&i(16,n=eE().fitWidth(d,b).rotate([110*_(a),-40]).translate([p,d]).scale(1e3*Math.max(a*1.5,.1)).precision(0)),t.$$.dirty&512&&i(15,s=h?RE(h,h.objects.land):null),t.$$.dirty&65536&&i(14,r=jT(n).pointRadius(2)),t.$$.dirty&253191&&i(13,o=()=>{k&&(k.clearRect(0,0,p*2,d*2),R&&p>500?(i(12,k.fillStyle=`rgba(54,53,49,${1-c})`,k),k.beginPath(),r.context(k),r(s),k.fill(),f.forEach((N,C)=>{let V=iy(n(m[C]),N.coordinates.map(re=>re*2)),X=Lo(1.5/2,u.size*2);i(12,k.fillStyle=N.color.slice(0,7),k);let K=V(c),B=X(c);k.beginPath(),k.rect(K[0],K[1],B,B),k.fill()})):(i(12,k.fillStyle="rgba(12,12,11,1)",k),k.beginPath(),r.context(k),r(b),k.fill(),i(12,k.fillStyle="rgba(54,53,49,1)",k),k.beginPath(),r.context(k),r(s),k.fill(),i(12,k.fillStyle="#7d6a51",k),k.beginPath(),r.context(k),r({type:"MultiPoint",coordinates:m.slice(0,Math.floor(m.length*g(a)))}),k.fill()))}),t.$$.dirty&24576&&o()},[d,p,a,M,F,m,w,S,u,h,f,R,k,o,r,s,n,c,I]}class FD extends On{constructor(e){super(),kn(this,e,DD,OD,en,{sizes:8,geoJSON:9,courtData:10,viewportHeight:0,viewportWidth:1})}}let LD=function(t,e,i){var n,s,r=Math.ceil(Math.sqrt(t*e/i));Math.floor(r*i/e)*r<t?n=i/Math.ceil(r*i/e):n=e/r;var o=Math.ceil(Math.sqrt(t*i/e));return Math.floor(o*e/i)*o<t?s=e/Math.ceil(e*o/i):s=i/o,Math.max(n,s)};function BD(t,e,i,n){let s,r=t,o=i,a=e,c;return c=LD(o,r,a),s=c,s=Math.round(s*100)/100,{rowSize:Math.floor(r/s),size:s}}let UD=function(t,e,i){var n,s,r=Math.ceil(Math.sqrt(t*e/i));Math.floor(r*i/e)*r<t?n=i/Math.ceil(r*i/e):n=e/r;var o=Math.ceil(Math.sqrt(t*i/e));return Math.floor(o*e/i)*o<t?s=e/Math.ceil(e*o/i):s=i/o,Math.max(n,s)};function zD(t,e,i,n){let s,r=t,o=i,a=e,c;return c=UD(o,r,a),s=c,s=Math.round(s*100)/100,{rowSize:Math.floor(r/s),size:s}}const tb='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 218 52"><path id="color-stroke" fill="#3AE660" d="M212.5 10.8a5 5 0 0 0-2.2.5h-.3a6 6 0 0 0-3.8-.3 27 27 0 0 0-4.6 1.8h-.2l-1.2.6h-.2a32.2 32.2 0 0 1-2.1 1.3l-1.3.8h-.2c-.2-.4-.6-.7-1-1a43 43 0 0 0-2.8-2c-1.5-1-2.8-1.7-4.4-1.7-1 0-2.2.3-3.6.9h-.2a5.7 5.7 0 0 0-4.5-.5l-2.2.7c-.2.6-.4 1-.8 1.5-.1.2-.3.2-.4 0l-.5-.5c-.1-.2 0-.4.2-.5l1.5-.5a5.9 5.9 0 0 0-1.4-6l-2.6-2.6a5.8 5.8 0 0 0-7.6-.5h-.4a5.8 5.8 0 0 0-6-1.6l-6 1.9a4.8 4.8 0 0 0-2.3 7.8c.3.3.4.6.6 1v.6l-.6.2-1.3.7-1.2.6-.6.4c-.2.1-.4 0-.4-.2V6.7a5.8 5.8 0 0 0-7.6-5.5l-6 1.9a4.8 4.8 0 0 0-2.3 7.8l.6 1v.6l-.6.2h-.1l-1.2.7-1.2.6-1.2.8h-.2a5.8 5.8 0 0 0-7.2-3.6l-4.3 1.3h-.2a5.8 5.8 0 0 0-5.8-1.3l-2 .6c-.1 0-.3 0-.3-.2v-2a5.9 5.9 0 0 0-3.9-5.6l-1.3-.6-1-.4a23.5 23.5 0 0 0-3.5-1.4 25 25 0 0 0-2-.6c-.4-.2-1-.2-1.4-.2-1.3 0-2.8.3-4.6 1.1a45.6 45.6 0 0 0-2.3 1l-.2-.2-1-.5a9.3 9.3 0 0 0-1.6-.8c-.3-.1-.6-.3-1-.3-.5-.2-1-.3-1.6-.3a6.3 6.3 0 0 0-3.5 1l-.8.5a14 14 0 0 0-2 1.4l-1.2.9A23.6 23.6 0 0 0 72 7.9a14.4 14.4 0 0 0-1.5 2.3c-.4.7-.6 1.5-.6 2.3 0 .1 0 .2-.1 0a6.2 6.2 0 0 0-.9-.7 5 5 0 0 0-3-1c-.5 0-1 0-1.6.2a44.8 44.8 0 0 0-5.8 2.5l-2 1.2-1 .6c-.2.1-.3.1-.4 0l-.9-.8-2.8-2a8.1 8.1 0 0 0-4.4-1.7h-.4a.3.3 0 0 1-.4-.3V6.7a5.8 5.8 0 0 0-7.5-5.6l-4.1 1.3a5 5 0 0 0-2.6.8l-.5.3c-.1 0-.2.1-.2 0a18 18 0 0 1-3.7-.7l-5.7-1.5A102.8 102.8 0 0 0 14.7.1a8.5 8.5 0 0 0-3.4.9 16.7 16.7 0 0 0-3.7 2 31.8 31.8 0 0 0-4.5 3.7l-.8.8-.1.2-.8 1L.6 10c-.4.8-.6 1.7-.6 2.6 0 1.1.3 2.3.9 3.8l1.2 2.4a5 5 0 0 0 1.5 1.7v.4L3.3 23v.1a22.3 22.3 0 0 0 0 6l.1.1v.1a17.8 17.8 0 0 0 2.2 5.8c.5.8 1 1.5 1.6 2.1v.1l.2.2a15.8 15.8 0 0 0 4.3 3.3h.3a18.3 18.3 0 0 0 18-1.2h.1l.2-.2h.5a4.9 4.9 0 0 0 4.1 2.4h7.3c.5 0 .9 0 1.3-.2h.2l1.4.2h7.3c1.2 0 2.3-.4 3.2-1.1h.4l.2.1h.3l.9.5h.1a16.4 16.4 0 0 0 5.1 1.2c.7 0 1.5-.2 2.2-.5.3 0 .6-.2.9-.4.3-.2.7-.3 1-.6h.2l.7-.6 1-.7.7-.6 1-.9c.1 0 .3 0 .3.2a5 5 0 0 0 5 4.4 5 5 0 0 0 1.6-.3c.2 0 .4.1.3.3v.1l-.3.6-.1.2v.3l-.3.4a4.9 4.9 0 0 0 4.4 7h9a4.9 4.9 0 0 0 4.4-7l-.3-.8v-.1a8 8 0 0 1-.3-.6v-.1l-.2-.4a12 12 0 0 0 2.8-1.4l1.3-.7.1-.1 1.6-1 1.8-1 2-1V37h.1c.2-.1.3 0 .4 0 .4.7.9 1.2 1.4 1.7l2.8 2c1.7 1 3 1.7 4.5 1.7 1.1 0 2.3-.4 3.7-1h.3a5.7 5.7 0 0 0 3.9.5l6-1.4h.6l.3.2h.1c1.7 1 3 1.7 4.4 1.7 1.2 0 2.3-.4 3.8-1.1h.3a5.6 5.6 0 0 0 4 .6l6-1.4h.5l.3.2h.1c1.7 1 3 1.7 4.4 1.7 1.2 0 2.3-.4 3.8-1.1h.3a5.7 5.7 0 0 0 4 .6l4-1h.3c.7.5 1.6.8 2.5.8h7.4c.4 0 .7 0 1.1-.2h.2l1.3.2h7.3c.5 0 1 0 1.4-.2h.2l1.3.2h4.2c.1 0 .3.2.2.3v.6c.1 1.7.9 3.2 2.1 4.3l2.7 2c2.1 1.6 4 2.4 6 2.4.5 0 1 0 1.6-.2l1.7-.5 1.2-.5 1.5-.8a17 17 0 0 0 2.6-1.7 16 16 0 0 0 2.6-2.1 15.2 15.2 0 0 0 4.2-5.9l.3-2.1V15.7a5 5 0 0 0-5-5ZM78 27.8l-.1.3a16.8 16.8 0 0 0-3.4 2.5c-.1.2-.4.1-.5 0a4.9 4.9 0 0 0-4.6-3.3c-.2 0-.3-.2-.2-.3l2.4-1.7a6 6 0 0 0 2.4-3.8c0-.3.2-.4.4-.3l1.3.5c.2 0 .3.1.3.3v.4c0 1.5.6 3 1.7 4.1l.3.3v1Z"/><path id="color-stroke" fill="#3AE660" d="m78.1 27.8-.1.3a16.8 16.8 0 0 0-3.4 2.5c-.1.2-.4.1-.5 0a4.9 4.9 0 0 0-4.6-3.3c-.2 0-.3-.2-.2-.3l2.4-1.7a6 6 0 0 0 2.4-3.8c0-.3.2-.4.4-.3l1.3.5c.2 0 .3.1.3.3v.4c0 1.5.6 3 1.7 4.1l.3.3v1ZM177.7 12c-.2.6-.6 1.2-1 1.8a4 4 0 0 0-1-1.2l2-.7Z"/><path id="color-stroke" fill="#3AE660" d="M177.7 12c-.2.6-.6 1.2-1 1.8a4 4 0 0 0-1-1.2l2-.7Z"/><path fill="#111" d="M168.8 13.4c.5.4 1.1.4 1.5 0l2.6-2.6c.4-.4.4-1 0-1.5l-2.6-2.6a1 1 0 0 0-1.5 0l-2.5 2.6a1 1 0 0 0 0 1.5l2.5 2.6ZM19.2 31l3.7-2c.3-.3.5-.6.5-1V14.2a1 1 0 0 0-1.5-.9l-3.7 2a1 1 0 0 0-.5 1V30a1 1 0 0 0 1.5 1Z"/><path fill="#111" d="m51.8 33.5-.2-4.6V19a1 1 0 0 0-.4-.8 36.2 36.2 0 0 0-4.3-2.7 6 6 0 0 0-2.3.7l-1.6 1c-.7.3-1.6-.2-1.6-1V6.7a1 1 0 0 0-1.4-1l-5 1.6h-.2c0-.1-.2-.1-.2 0l-.2.1-.2.1-.3.1v.2l-.7.3c-.5.2-1 .3-1.6.3-.4 0-1 0-1.8-.2l-3.5-.8L20.7 6a98 98 0 0 0-6-1.1L14 5c-.3 0-.5.2-.8.3a11.4 11.4 0 0 0-1.8 1 16.5 16.5 0 0 0-2 1.5 29.6 29.6 0 0 0-2.9 2.4l-.7.7a11 11 0 0 0-.9 1.3l-.1.4c0 .4.1 1 .5 1.9l1 2c.3.5 1 .7 1.4.4l2.6-1.4c.5-.3.7-1 .4-1.4l-2-3.7c-.5-1-.6-1.6-.3-1.6a1653.6 1653.6 0 0 1 8.1 1.8l5.7 1.4 1.8.5.7.2c.4.1.8.5.8 1V32c0 .6-.4 1-1 1h-.2l-1.2.1c-3.2 0-5.7-.8-7.5-2.6-1.7-1.7-2.6-4.3-2.6-8 0-1.4.2-2.9.5-4.5.4-1.6 1.1-3 2.2-4.5v-.1h-.2a14.5 14.5 0 0 0-2.2 1.3A21.2 21.2 0 0 0 11 17a21.4 21.4 0 0 0-2 3 14.9 14.9 0 0 0-.5 10.7 11 11 0 0 0 9.2 7.1 12.7 12.7 0 0 0 12-4.6l1-1.3a11 11 0 0 0 1.4-2.5.2.2 0 0 0-.4-.2 10.7 10.7 0 0 1-4.3 3.2c-.7.3-1.3-.2-1.3-.9V14.2c0-.6.5-1 1.1-1l1 .2c.8 0 1.8-.6 3-1.7a23 23 0 0 0 2.1-2.3c.5-.5 1.3-.5 1.6.1l.3.7c.4 1 .6 2.2.6 3.6V29a26.4 26.4 0 0 1-1 7.9h7.5a16 16 0 0 1-.8-3.4l-.2-4.5v-9.3a5.8 5.8 0 0 0 0-.6l.1-.2v-.3h.1l.2-.2h.1c.5 0 1.1.3 1.9.9l2 1.5c.3.2.4.5.4.8V29c0 1.7 0 3.2-.2 4.4a13 13 0 0 1-.8 3.4v.1h7.4a16 16 0 0 1-.7-3.4Zm17.6-1.4a9.4 9.4 0 0 1-3 1.7 16.9 16.9 0 0 1-5.2-1.6 1 1 0 0 1-.5-1v-3.4c0-.4.2-.7.4-.9l7.8-5.5c.5-.3.6-1 .3-1.3A21.3 21.3 0 0 0 67 17a5.5 5.5 0 0 0-.7-1 2.2 2.2 0 0 0-.4-.4h-.6l-.7.3a50.5 50.5 0 0 0-3.7 1.7l-1 .6-1 .6c-.4.2-.8.4-1 .7l-1 .6a15.6 15.6 0 0 0-1.2 1l-.3.5-.2.4v12c0 .3.2.6.4.8l.6.4 1 .6a36.6 36.6 0 0 1 2.1 1 10 10 0 0 0 2 .5 5.6 5.6 0 0 0 1.4.3l.4-.1.5-.3.7-.3.6-.5.8-.6.8-.6.8-.6.7-.7a12.6 12.6 0 0 0 1.2-1.1l.4-.4V32h-.2Zm-8.7-9.5v-4.5h.1V18h.1c.3 0 .8.5 1.6 1.6l2 3c.3.5.2 1.1-.2 1.5l-2 1.3a1 1 0 0 1-1.6-.8v-2Zm132.4 10.8L193 29V19a1 1 0 0 0-.4-.8 36.1 36.1 0 0 0-4.3-2.7c-.5 0-1.2.2-2.3.8l-2 1a1 1 0 0 1-1.4-.7c0-.7-.6-1.1-1.2-1l-6 2-.1.1v.1c.6.7 1.1 1.5 1.5 2.5.3 1 .5 2.1.5 3.6v5c0 1.8 0 3.3-.2 4.5-.1 1-.4 2.2-.8 3.3l.1.1h7.3c-.4-1.2-.7-2.3-.8-3.5-.2-1.2-.2-2.6-.2-4.4v-9.4a5.7 5.7 0 0 0 0-.8 1.1 1.1 0 0 1 .2-.4h.3c.5 0 1 .2 1.8.8l2 1.5c.3.2.5.5.5.8V29c0 1.7 0 3.2-.2 4.4-.2 1.2-.4 2.3-.8 3.4v.1h7.4a16 16 0 0 1-.8-3.4Zm19.4-17.8h-.1l-1.2 1a1 1 0 0 1-1.2.1 18.2 18.2 0 0 0-2.3-1.1h-.6l-.7.3a34.8 34.8 0 0 0-4 1.7 34.2 34.2 0 0 1-2 1.2c-.4.2-.8.4-1 .7a23.5 23.5 0 0 0-2.3 1.7l-.4.5-.1.3v12c0 .3.1.6.4.8a40 40 0 0 0 2.6 1.9c1 .6 1.6.9 2 .9a34.5 34.5 0 0 0 4-1.9c.6-.5 1.5 0 1.5.9v7.1l-.2.1h-.6l-.6-.3-.7-.4a15.7 15.7 0 0 1-2.7-1.8l-.9-.7-.8-.7a18.8 18.8 0 0 1-.8-.7 1 1 0 0 0-1.4.1l-2.4 2.3a1 1 0 0 0 0 1.6l2.6 2c1.2.8 2.2 1.3 3 1.3h.7l1-.4 1-.4 1-.6 1.1-.6 1.1-.8a11.4 11.4 0 0 0 2.2-1.7l1-1a7.7 7.7 0 0 0 1.3-1.8l.5-1V15.7ZM207 29.3V32a8.7 8.7 0 0 1 0 1.5v.4l-.1.2v.3h-.3c-.6 0-1.2-.2-2-.7l-2.2-1.3a1 1 0 0 1-.4-.9V19.3a5.7 5.7 0 0 0 0-.6 4.7 4.7 0 0 1 .2-.6V18h.4c.4 0 1 .3 1.9 1l2.1 1.6c.3.2.4.5.4.9v7.8ZM102.8 8.5a38.8 38.8 0 0 1-1.5-.6l-1.2-.5a19.6 19.6 0 0 0-2.1-1 15.6 15.6 0 0 0-2.8-.9A56 56 0 0 0 88.8 8c-.4.3-.8.2-1.2 0l-.2-.2a21.3 21.3 0 0 0-4.5-2.2h-.5l-.6.4a7 7 0 0 0-.7.4 9.8 9.8 0 0 0-1.7 1.1l-.9.7a18.4 18.4 0 0 0-2.3 2.2 13.3 13.3 0 0 0-1.4 1.7l-.1.2v.2c0 .5 0 1.1.4 2l1 2c.3.5 1 .7 1.5.4l2.6-1.5c.5-.2.7-.9.4-1.4a53.5 53.5 0 0 1-2.3-5.2l1.7.8 2.5 1.6c.3.2.5.5.5.9v7.4l-.4.7-1.4 1.4a1 1 0 0 0 0 1.5l1.4 1.5c.2.1.4.4.4.7v6c0 .2-.3.4-.6.4H82c-.7 0-1.7.5-3 1.5s-2.4 2.4-3.5 4.5l.1.2h.2c.5-.5.9-1 1.3-1.2.5-.4 1-.6 1.7-.6a74.7 74.7 0 0 1 3.2.3c.6.1 1 .6 1 1v.8a19.6 19.6 0 0 1-.3 3.5l-.1 1a8.8 8.8 0 0 1-.5 1.7l-.4 1-.4 1v.1h9.1v-.1a16.9 16.9 0 0 1-1.5-4.7v-1l-.2-1.2v-1.3c0-.3.3-.5.6-.5a36.4 36.4 0 0 0 2 .3c.2 0 .4 0 .7-.2a12.4 12.4 0 0 0 2.2-1 47.9 47.9 0 0 1 3-1.8 734 734 0 0 1 5.7-3c.3-.2.6-.6.6-1V9.5a1 1 0 0 0-.7-1ZM90.8 32c0 .6-.5 1-1 .9h-.2c-.5-.2-.9-.6-.9-1.1v-22a5.7 5.7 0 0 0 0-.6l.1-.1v-.4h.1l.2-.2h.2l.6.1.2.1c.5.1.8.5.8 1V32Zm6.9-2.2V33a3.7 3.7 0 0 1 0 .7l-.1.1v.3l-.1.1-.2.1H97c-.2 0-1 0-2-.3l-2.8-.6a1 1 0 0 1-.8-1v-7.2c0-.5.3-.9.8-1l4-1.2a1 1 0 0 1 1.4 1v5.8Zm0-8.6c0 .5-.3.9-.8 1l-4 1.2a1 1 0 0 1-1.4-1v-.9c0-.4.3-.8.8-1l4-1.2a1 1 0 0 1 1.4 1v1Zm0-3.7c0 .5-.3.9-.8 1l-4 1.2a1 1 0 0 1-1.4-1v-8a1 1 0 0 1 1.4-1l1.6.7 2.6 1.2c.4.1.6.5.6 1v5ZM173 33.4a28 28 0 0 1-.3-4.5V16.7a1 1 0 0 0-1.4-1l-6 2-.1.2v.1c.7.7 1.1 1.6 1.5 2.5.3 1 .5 2.1.5 3.6v4.8a27.3 27.3 0 0 1-1 7.9h7.5l-.8-3.4Zm-47.7 2-.2-.2-.3-.4-.4-.6a21.8 21.8 0 0 1-.5-1.4l-.1-1-.1-1.3V16.7a1 1 0 0 0-1.4-1l-6 2-.1.2v.1c.7.7 1.2 1.6 1.5 2.5.3 1 .5 2.1.5 3.6V32a8.7 8.7 0 0 1 0 1.4v.2l-.1.3a4.8 4.8 0 0 0 0 .3.5.5 0 0 1-.1.2h-.3c-.5 0-1-.2-1.8-.6l-2-1.4a1 1 0 0 1-.5-.8V16.8a1 1 0 0 0-1.3-1l-6 1.9c-.1 0-.2 0-.2.2l.1.1c.6.7 1.1 1.6 1.4 2.5.4 1 .5 2.1.5 3.6v10c0 .3.2.6.4.8a44 44 0 0 0 4.4 2.7 37.6 37.6 0 0 0 4.3-2c.6-.5 1.4 0 1.4.7 0 .6.6 1 1.2.9l6-1.4h.1l-.4-.4Zm19.5 0-.2-.2-.3-.4-.3-.5v-.1a15.4 15.4 0 0 1-.5-1.4 49.8 49.8 0 0 1-.3-2l-.1-1.3V6.7a1 1 0 0 0-1.4-1l-6 2c.6.8 1 1.6 1.4 2.5.3 1 .5 2.2.5 3.7v1c0 .5-.3.8-.7 1a35.9 35.9 0 0 0-4 1.7l-1 .6a23 23 0 0 0-2 1.3 25 25 0 0 0-2.3 1.7l-.4.4V34c0 .3 0 .6.3.8l2.6 1.9c1 .6 1.6.9 2 .9a6 6 0 0 0 2.3-1l2-1.2a1 1 0 0 1 1.4.8c0 .7.6 1.1 1.2 1l6.1-1.4v-.1l-.3-.3Zm-7.2-6.1V32a8.7 8.7 0 0 1 0 1.5v.4l-.1.2v.3h-.4a4 4 0 0 1-2-.7l-2.2-1.3a1 1 0 0 1-.4-.9V19.3a5.7 5.7 0 0 0 0-.6 4.7 4.7 0 0 1 .2-.6V18h.4c.4 0 1 .3 1.9 1l2.1 1.6c.3.2.4.5.4.9v7.8Zm26.6 6.1-.2-.2-.3-.4-.3-.5v-.1a15.3 15.3 0 0 1-.5-1.4 49.8 49.8 0 0 1-.3-2V6.7a1 1 0 0 0-1.4-1l-6.1 2c.6.8 1 1.6 1.4 2.5.4 1 .5 2.2.5 3.7v1c0 .5-.3.8-.7 1a36.3 36.3 0 0 0-4 1.7l-1 .6a23 23 0 0 0-2 1.3 25 25 0 0 0-2.3 1.7c-.2.2-.3.3-.3.5l-.2.3v12c0 .3.2.6.4.8l2.6 1.9c1 .6 1.7.9 2 .9a6 6 0 0 0 2.3-1l2-1.2a1 1 0 0 1 1.5.8c0 .7.5 1.1 1.1 1l6.1-1.4v-.1l-.3-.3Zm-7.2-6.1V32a8.7 8.7 0 0 1 0 1.5v.6l-.1.1a.4.4 0 0 1-.1.2h-.3c-.4 0-1-.2-2-.7l-2-1.3a1 1 0 0 1-.5-.9V19.3a5.7 5.7 0 0 0 0-.6 4.7 4.7 0 0 1 .2-.6l.1-.1h.3c.5 0 1 .3 1.9 1l2.2 1.6c.2.2.3.5.3.9v7.8Z"/></svg>',el=Dl(!1),xo=Dl(!1),Qa=Dl(!1);function VD(t){let e,i,n="Close",s,r,o='By <a target="_blank" href="https://pudding.cool/author/matt-daniels/" class="svelte-ctrkxl">Matthew Daniels</a>, for visual journalism publication <a href="https://pudding.cool/" class="svelte-ctrkxl">The Pudding</a>.',a,c,l="Reach out at matt@pudding.cool",u,h,f='Court Locations via <a href="https://www.openstreetmap.org/#map=4/38.01/-95.84" class="svelte-ctrkxl">Open Street Map</a>. Satellite imagery via Google. Notable prior art in satellite imagery: Joshua Begley’s <a href="https://www.studioptcd.com/reference-projects/prison-map" target="_blank" class="svelte-ctrkxl">Prison Map</a> (currently offline), <a href="https://theintercept.co/officer-involved/" target="_blank" class="svelte-ctrkxl">Officer Involved</a>, and <a href="https://projects.theintercept.com/fatal-migrations/" target="_blank" class="svelte-ctrkxl">Fatal Migrations</a>, as well as Jenny Odell’s <a href="https://www.jennyodell.com/satellite.html" target="_blank" class="svelte-ctrkxl">Satellite Collections</a>.',d,p,g='If you like this project, consider supporting <a href="https://www.instagram.com/project_backboard/" target="_blank" class="svelte-ctrkxl">Project Backboard</a>, a non-profit that painted/renovated many of the courts seen in the satellite imagery.',_,m;return{c(){e=H("div"),i=H("button"),i.textContent=n,s=ae(),r=H("p"),r.innerHTML=o,a=ae(),c=H("p"),c.textContent=l,u=ae(),h=H("p"),h.innerHTML=f,d=ae(),p=H("p"),p.innerHTML=g,this.h()},l(b){e=W(b,"DIV",{class:!0});var w=se(e);i=W(w,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(i)!=="svelte-bxc8wg"&&(i.textContent=n),s=ce(w),r=W(w,"P",{class:!0,"data-svelte-h":!0}),Re(r)!=="svelte-1efp8n3"&&(r.innerHTML=o),a=ce(w),c=W(w,"P",{class:!0,"data-svelte-h":!0}),Re(c)!=="svelte-ks3mf2"&&(c.textContent=l),u=ce(w),h=W(w,"P",{class:!0,"data-svelte-h":!0}),Re(h)!=="svelte-1x3vttr"&&(h.innerHTML=f),d=ce(w),p=W(w,"P",{class:!0,"data-svelte-h":!0}),Re(p)!=="svelte-b5tmh1"&&(p.innerHTML=g),w.forEach(L),this.h()},h(){O(i,"class","close svelte-ctrkxl"),O(r,"class","svelte-ctrkxl"),O(c,"class","svelte-ctrkxl"),O(h,"class","svelte-ctrkxl"),O(p,"class","svelte-ctrkxl"),O(e,"class","about svelte-ctrkxl")},m(b,w){oe(b,e,w),U(e,i),U(e,s),U(e,r),U(e,a),U(e,c),U(e,u),U(e,h),U(e,d),U(e,p),_||(m=gt(i,"click",t[0]),_=!0)},p:pt,i:pt,o:pt,d(b){b&&L(e),_=!1,m()}}}function jD(t,e,i){let n;wn(t,el,r=>i(1,n=r));function s(){pn(el,n=!1,n)}return[s]}class $D extends On{constructor(e){super(),kn(this,e,jD,VD,en,{})}}function HD(t){let e,i="",n,s,r,o='<div id="cesiumContainer" style="" class="svelte-9iqq6b"></div>',a,c;return{c(){e=H("script"),e.innerHTML=i,s=ae(),r=H("div"),r.innerHTML=o,this.h()},l(l){const u=Xm("svelte-rc6uig",document.head);e=W(u,"SCRIPT",{src:!0,"data-svelte-h":!0}),Re(e)!=="svelte-qvkiq1"&&(e.innerHTML=i),u.forEach(L),s=ce(l),r=W(l,"DIV",{class:!0,"data-svelte-h":!0}),Re(r)!=="svelte-xdau3z"&&(r.innerHTML=o),this.h()},h(){tw(e.src,n="https://ajax.googleapis.com/ajax/libs/cesiumjs/1.105/Build/Cesium/Cesium.js")||O(e,"src",n),O(r,"class","parent svelte-9iqq6b")},m(l,u){U(document.head,e),oe(l,s,u),oe(l,r,u),a||(c=gt(e,"load",t[0]),a=!0)},p:pt,i:pt,o:pt,d(l){l&&(L(s),L(r)),L(e),a=!1,c()}}}function WD(t,e,i){const n="AIzaSyBRQrRe8Ife25sH5b32ELrhwqkABnlXAqM";let{coords:s}=e;function r(){console.log("playing");const o=new Cesium.Viewer("cesiumContainer",{imageryProvider:!1,requestRenderMode:!0,navigationHelpButton:!1,animation:!1,timeline:!1,baseLayerPicker:!1,geocoder:!1,sceneModePicker:!1,fullscreenButton:!1,homeButton:!1,infoBox:!1,selectionIndicator:!1,navigationInstructionsInitiallyVisible:!1});o.scene.primitives.add(new Cesium.Cesium3DTileset({url:`https://tile.googleapis.com/v1/3dtiles/root.json?key=${n}`}));var a=.96,c=-1.2,l=0,u=400;console.log("setting coords",s[0],s[1]);var h=Cesium.Cartesian3.fromDegrees(s[0]-2e-4,s[1]-1e-4,u),f={heading:a,pitch:c,roll:l};o.camera.setView({destination:h,orientation:f,endTransform:Cesium.Matrix4.IDENTITY}),o.camera.changed.addEventListener(function(){var d=o.camera.positionCartographic,p=Cesium.Math.toDegrees(d.latitude),g=Cesium.Math.toDegrees(d.longitude),_=o.camera.heading,m=o.camera.pitch,b=o.camera.roll;console.log(g,p,_,m,b)})}return Nl(async()=>{}),t.$$set=o=>{"coords"in o&&i(1,s=o.coords)},t.$$.update=()=>{t.$$.dirty&2&&console.log(s)},[r,s]}class XD extends On{constructor(e){super(),kn(this,e,WD,HD,en,{coords:1})}}const qD=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...i)=>yr(()=>Promise.resolve().then(()=>ca),void 0,import.meta.url).then(({default:n})=>n(...i)):e=fetch,(...i)=>e(...i)};class Fd extends Error{constructor(e,i="FunctionsError",n){super(e),this.name=i,this.context=n}}class YD extends Fd{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class KD extends Fd{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ZD extends Fd{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Vf;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Vf||(Vf={}));var GD=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};class JD{constructor(e,{headers:i={},customFetch:n,region:s=Vf.Any}={}){this.url=e,this.headers=i,this.region=s,this.fetch=qD(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,i={}){var n;return GD(this,void 0,void 0,function*(){try{const{headers:s,method:r,body:o}=i;let a={},{region:c}=i;c||(c=this.region),c&&c!=="any"&&(a["x-region"]=c);let l;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",l=o):typeof o=="string"?(a["Content-Type"]="text/plain",l=o):typeof FormData<"u"&&o instanceof FormData?l=o:(a["Content-Type"]="application/json",l=JSON.stringify(o)));const u=yield this.fetch(`${this.url}/${e}`,{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:l}).catch(p=>{throw new YD(p)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new KD(u);if(!u.ok)throw new ZD(u);let f=((n=u.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),d;return f==="application/json"?d=yield u.json():f==="application/octet-stream"?d=yield u.blob():f==="text/event-stream"?d=u:f==="multipart/form-data"?d=yield u.formData():d=yield u.text(),{data:d,error:null}}catch(s){return{data:null,error:s}}})}}var QD=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Or=QD();const eF=Or.fetch,Ld=Or.fetch.bind(Or),ib=Or.Headers,tF=Or.Request,iF=Or.Response,ca=Object.freeze(Object.defineProperty({__proto__:null,Headers:ib,Request:tF,Response:iF,default:Ld,fetch:eF},Symbol.toStringTag,{value:"Module"}));class nF extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}class sF{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Ld:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{var o,a,c;let l=null,u=null,h=null,f=r.status,d=r.statusText;if(r.ok){if(this.method!=="HEAD"){const m=await r.text();m===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=m:u=JSON.parse(m))}const g=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),_=(a=r.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");g&&_&&_.length>1&&(h=parseInt(_[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(l={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,f=406,d="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const g=await r.text();try{l=JSON.parse(g),Array.isArray(l)&&r.status===404&&(u=[],l=null,f=200,d="OK")}catch{r.status===404&&g===""?(f=204,d="No Content"):l={message:g}}if(l&&this.isMaybeSingle&&(!((c=l==null?void 0:l.details)===null||c===void 0)&&c.includes("0 rows"))&&(l=null,f=200,d="OK"),l&&this.shouldThrowOnError)throw new nF(l)}return{error:l,data:u,count:h,status:f,statusText:d}});return this.shouldThrowOnError||(s=s.catch(r=>{var o,a,c;return{error:{message:`${(o=r==null?void 0:r.name)!==null&&o!==void 0?o:"FetchError"}: ${r==null?void 0:r.message}`,details:`${(a=r==null?void 0:r.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(c=r==null?void 0:r.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,i)}}class rF extends sF{select(e){let i=!1;const n=(e??"*").split("").map(s=>/\s/.test(s)&&!i?"":(s==='"'&&(i=!i),s)).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:i=!0,nullsFirst:n,foreignTable:s,referencedTable:r=s}={}){const o=r?`${r}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${i?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:i,referencedTable:n=i}={}){const s=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,i,{foreignTable:n,referencedTable:s=n}={}){const r=typeof s>"u"?"offset":`${s}.offset`,o=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this.url.searchParams.set(o,`${i-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:i=!1,settings:n=!1,buffers:s=!1,wal:r=!1,format:o="text"}={}){var a;const c=[e?"analyze":null,i?"verbose":null,n?"settings":null,s?"buffers":null,r?"wal":null].filter(Boolean).join("|"),l=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${l}"; options=${c};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class Zs extends rF{eq(e,i){return this.url.searchParams.append(e,`eq.${i}`),this}neq(e,i){return this.url.searchParams.append(e,`neq.${i}`),this}gt(e,i){return this.url.searchParams.append(e,`gt.${i}`),this}gte(e,i){return this.url.searchParams.append(e,`gte.${i}`),this}lt(e,i){return this.url.searchParams.append(e,`lt.${i}`),this}lte(e,i){return this.url.searchParams.append(e,`lte.${i}`),this}like(e,i){return this.url.searchParams.append(e,`like.${i}`),this}likeAllOf(e,i){return this.url.searchParams.append(e,`like(all).{${i.join(",")}}`),this}likeAnyOf(e,i){return this.url.searchParams.append(e,`like(any).{${i.join(",")}}`),this}ilike(e,i){return this.url.searchParams.append(e,`ilike.${i}`),this}ilikeAllOf(e,i){return this.url.searchParams.append(e,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(e,i){return this.url.searchParams.append(e,`ilike(any).{${i.join(",")}}`),this}is(e,i){return this.url.searchParams.append(e,`is.${i}`),this}in(e,i){const n=Array.from(new Set(i)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,i){return typeof i=="string"?this.url.searchParams.append(e,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(e,`cs.{${i.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(i)}`),this}containedBy(e,i){return typeof i=="string"?this.url.searchParams.append(e,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(e,`cd.{${i.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(i)}`),this}rangeGt(e,i){return this.url.searchParams.append(e,`sr.${i}`),this}rangeGte(e,i){return this.url.searchParams.append(e,`nxl.${i}`),this}rangeLt(e,i){return this.url.searchParams.append(e,`sl.${i}`),this}rangeLte(e,i){return this.url.searchParams.append(e,`nxr.${i}`),this}rangeAdjacent(e,i){return this.url.searchParams.append(e,`adj.${i}`),this}overlaps(e,i){return typeof i=="string"?this.url.searchParams.append(e,`ov.${i}`):this.url.searchParams.append(e,`ov.{${i.join(",")}}`),this}textSearch(e,i,{config:n,type:s}={}){let r="";s==="plain"?r="pl":s==="phrase"?r="ph":s==="websearch"&&(r="w");const o=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${r}fts${o}.${i}`),this}match(e){return Object.entries(e).forEach(([i,n])=>{this.url.searchParams.append(i,`eq.${n}`)}),this}not(e,i,n){return this.url.searchParams.append(e,`not.${i}.${n}`),this}or(e,{foreignTable:i,referencedTable:n=i}={}){const s=n?`${n}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,i,n){return this.url.searchParams.append(e,`${i}.${n}`),this}}class oF{constructor(e,{headers:i={},schema:n,fetch:s}){this.url=e,this.headers=i,this.schema=n,this.fetch=s}select(e,{head:i=!1,count:n}={}){const s=i?"HEAD":"GET";let r=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!r?"":(a==='"'&&(r=!r),a)).join("");return this.url.searchParams.set("select",o),n&&(this.headers.Prefer=`count=${n}`),new Zs({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:i,defaultToNull:n=!0}={}){const s="POST",r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),i&&r.push(`count=${i}`),n||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){const o=e.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(o.length>0){const a=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new Zs({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:i,ignoreDuplicates:n=!1,count:s,defaultToNull:r=!0}={}){const o="POST",a=[`resolution=${n?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),r||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const c=e.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(c.length>0){const l=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new Zs({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:i}={}){const n="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),i&&s.push(`count=${i}`),this.headers.Prefer=s.join(","),new Zs({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const i="DELETE",n=[];return e&&n.push(`count=${e}`),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),new Zs({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const aF="1.15.2",cF={"X-Client-Info":`postgrest-js/${aF}`};class Bd{constructor(e,{headers:i={},schema:n,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},cF),i),this.schemaName=n,this.fetch=s}from(e){const i=new URL(`${this.url}/${e}`);return new oF(i,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Bd(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,i={},{head:n=!1,get:s=!1,count:r}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let c;n||s?(o=n?"HEAD":"GET",Object.entries(i).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{a.searchParams.append(u,h)})):(o="POST",c=i);const l=Object.assign({},this.headers);return r&&(l.Prefer=`count=${r}`),new Zs({method:o,url:a,headers:l,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}}const lF="2.9.5",uF={"X-Client-Info":`realtime-js/${lF}`},hF="1.0.0",nb=1e4,fF=1e3;var pr;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(pr||(pr={}));var Jt;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Jt||(Jt={}));var mi;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(mi||(mi={}));var jf;(function(t){t.websocket="websocket"})(jf||(jf={}));var Zn;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Zn||(Zn={}));class sb{constructor(e,i){this.callback=e,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class dF{constructor(){this.HEADER_LENGTH=1}decode(e,i){return e.constructor===ArrayBuffer?i(this._binaryDecode(e)):i(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const i=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,i,n)}_decodeBroadcast(e,i,n){const s=i.getUint8(1),r=i.getUint8(2);let o=this.HEADER_LENGTH+2;const a=n.decode(e.slice(o,o+s));o=o+s;const c=n.decode(e.slice(o,o+r));o=o+r;const l=JSON.parse(n.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:c,payload:l}}}class eh{constructor(e,i,n={},s=nb){this.channel=e,this.event=i,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,i){var n;return this._hasReceived(e)&&i((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:i}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(i))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var q0;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(q0||(q0={}));class Po{constructor(e,i){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(i==null?void 0:i.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Po.syncState(this.state,s,r,o),this.pendingDiffs.forEach(c=>{this.state=Po.syncDiff(this.state,c,r,o)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},s=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Po.syncDiff(this.state,s,r,o),a())}),this.onJoin((s,r,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:r,newPresences:o})}),this.onLeave((s,r,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:r,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,i,n,s){const r=this.cloneDeep(e),o=this.transformState(i),a={},c={};return this.map(r,(l,u)=>{o[l]||(c[l]=u)}),this.map(o,(l,u)=>{const h=r[l];if(h){const f=u.map(_=>_.presence_ref),d=h.map(_=>_.presence_ref),p=u.filter(_=>d.indexOf(_.presence_ref)<0),g=h.filter(_=>f.indexOf(_.presence_ref)<0);p.length>0&&(a[l]=p),g.length>0&&(c[l]=g)}else a[l]=u}),this.syncDiff(r,{joins:a,leaves:c},n,s)}static syncDiff(e,i,n,s){const{joins:r,leaves:o}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(r,(a,c)=>{var l;const u=(l=e[a])!==null&&l!==void 0?l:[];if(e[a]=this.cloneDeep(c),u.length>0){const h=e[a].map(d=>d.presence_ref),f=u.filter(d=>h.indexOf(d.presence_ref)<0);e[a].unshift(...f)}n(a,u,c)}),this.map(o,(a,c)=>{let l=e[a];if(!l)return;const u=c.map(h=>h.presence_ref);l=l.filter(h=>u.indexOf(h.presence_ref)<0),e[a]=l,s(a,l,c),l.length===0&&delete e[a]}),e}static map(e,i){return Object.getOwnPropertyNames(e).map(n=>i(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((i,n)=>{const s=e[n];return"metas"in s?i[n]=s.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):i[n]=s,i},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var We;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(We||(We={}));const Y0=(t,e,i={})=>{var n;const s=(n=i.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((r,o)=>(r[o]=pF(o,t,e,s),r),{})},pF=(t,e,i,n)=>{const s=e.find(a=>a.name===t),r=s==null?void 0:s.type,o=i[t];return r&&!n.includes(r)?rb(r,o):$f(o)},rb=(t,e)=>{if(t.charAt(0)==="_"){const i=t.slice(1,t.length);return yF(e,i)}switch(t){case We.bool:return gF(e);case We.float4:case We.float8:case We.int2:case We.int4:case We.int8:case We.numeric:case We.oid:return _F(e);case We.json:case We.jsonb:return mF(e);case We.timestamp:return vF(e);case We.abstime:case We.date:case We.daterange:case We.int4range:case We.int8range:case We.money:case We.reltime:case We.text:case We.time:case We.timestamptz:case We.timetz:case We.tsrange:case We.tstzrange:return $f(e);default:return $f(e)}},$f=t=>t,gF=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},_F=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},mF=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},yF=(t,e)=>{if(typeof t!="string")return t;const i=t.length-1,n=t[i];if(t[0]==="{"&&n==="}"){let r;const o=t.slice(1,i);try{r=JSON.parse("["+o+"]")}catch{r=o?o.split(","):[]}return r.map(a=>rb(e,a))}return t},vF=t=>typeof t=="string"?t.replace(" ","T"):t;var K0;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(K0||(K0={}));var Z0;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes"})(Z0||(Z0={}));var G0;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(G0||(G0={}));class Ud{constructor(e,i={config:{}},n){this.topic=e,this.params=i,this.socket=n,this.bindings={},this.state=Jt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},i.config),this.timeout=this.socket.timeout,this.joinPush=new eh(this,mi.join,this.params,this.timeout),this.rejoinTimer=new sb(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Jt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Jt.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Jt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Jt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(mi.reply,{},(s,r)=>{this._trigger(this._replyEventName(r),s)}),this.presence=new Po(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,i=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:r,presence:o}}=this.params;this._onError(l=>e&&e("CHANNEL_ERROR",l)),this._onClose(()=>e&&e("CLOSED"));const a={},c={broadcast:r,presence:o,postgres_changes:(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(l=>l.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:c},a)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",({postgres_changes:l})=>{var u;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),l===void 0){e&&e("SUBSCRIBED");return}else{const h=this.bindings.postgres_changes,f=(u=h==null?void 0:h.length)!==null&&u!==void 0?u:0,d=[];for(let p=0;p<f;p++){const g=h[p],{filter:{event:_,schema:m,table:b,filter:w}}=g,S=l&&l[p];if(S&&S.event===_&&S.schema===m&&S.table===b&&S.filter===w)d.push(Object.assign(Object.assign({},g),{id:S.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=d,e&&e("SUBSCRIBED");return}}).receive("error",l=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(l).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,i={}){return await this.send({type:"presence",event:"track",payload:e},i.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,i,n){return this._on(e,i,n)}async send(e,i={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:r,payload:o}=e,a={method:"POST",headers:{apikey:(n=this.socket.apiKey)!==null&&n!==void 0?n:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:o}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=i.timeout)!==null&&s!==void 0?s:this.timeout)).ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var o,a,c;const l=this._push(e.type,e,i.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&r("ok"),l.receive("ok",()=>r("ok")),l.receive("error",()=>r("error")),l.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Jt.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(mi.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(n=>{const s=new eh(this,mi.leave,{},e);s.receive("ok",()=>{i(),n("ok")}).receive("timeout",()=>{i(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,i,n){const s=new AbortController,r=setTimeout(()=>s.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},i),{signal:s.signal}));return clearTimeout(r),o}_push(e,i,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new eh(this,e,i,n);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,i,n){return i}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,i,n){var s,r;const o=e.toLocaleLowerCase(),{close:a,error:c,leave:l,join:u}=mi;if(n&&[a,c,l,u].indexOf(o)>=0&&n!==this._joinRef())return;let f=this._onMessage(o,i,n);if(i&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(d=>{var p,g,_;return((p=d.filter)===null||p===void 0?void 0:p.event)==="*"||((_=(g=d.filter)===null||g===void 0?void 0:g.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===o}).map(d=>d.callback(f,n)):(r=this.bindings[o])===null||r===void 0||r.filter(d=>{var p,g,_,m,b,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in d){const S=d.id,R=(p=d.filter)===null||p===void 0?void 0:p.event;return S&&((g=i.ids)===null||g===void 0?void 0:g.includes(S))&&(R==="*"||(R==null?void 0:R.toLocaleLowerCase())===((_=i.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const S=(b=(m=d==null?void 0:d.filter)===null||m===void 0?void 0:m.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return S==="*"||S===((w=i==null?void 0:i.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return d.type.toLocaleLowerCase()===o}).map(d=>{if(typeof f=="object"&&"ids"in f){const p=f.data,{schema:g,table:_,commit_timestamp:m,type:b,errors:w}=p;f=Object.assign(Object.assign({},{schema:g,table:_,commit_timestamp:m,eventType:b,new:{},old:{},errors:w}),this._getPayloadRecords(p))}d.callback(f,n)})}_isClosed(){return this.state===Jt.closed}_isJoined(){return this.state===Jt.joined}_isJoining(){return this.state===Jt.joining}_isLeaving(){return this.state===Jt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,i,n){const s=e.toLocaleLowerCase(),r={type:s,filter:i,callback:n};return this.bindings[s]?this.bindings[s].push(r):this.bindings[s]=[r],this}_off(e,i){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(s=>{var r;return!(((r=s.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===n&&Ud.isEqual(s.filter,i))}),this}static isEqual(e,i){if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const n in e)if(e[n]!==i[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(mi.close,{},e)}_onError(e){this._on(mi.error,{},i=>e(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Jt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const i={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(i.new=Y0(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(i.old=Y0(e.columns,e.old_record)),i}}const bF=()=>{},wF=typeof WebSocket<"u";class TF{constructor(e,i){var n;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=uF,this.params={},this.timeout=nb,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=bF,this.conn=null,this.sendBuffer=[],this.serializer=new dF,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=r=>{let o;return r?o=r:typeof fetch>"u"?o=(...a)=>yr(()=>Promise.resolve().then(()=>ca),void 0,import.meta.url).then(({default:c})=>c(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${jf.websocket}`,i!=null&&i.transport?this.transport=i.transport:this.transport=null,i!=null&&i.params&&(this.params=i.params),i!=null&&i.headers&&(this.headers=Object.assign(Object.assign({},this.headers),i.headers)),i!=null&&i.timeout&&(this.timeout=i.timeout),i!=null&&i.logger&&(this.logger=i.logger),i!=null&&i.heartbeatIntervalMs&&(this.heartbeatIntervalMs=i.heartbeatIntervalMs);const s=(n=i==null?void 0:i.params)===null||n===void 0?void 0:n.apikey;s&&(this.accessToken=s,this.apiKey=s),this.reconnectAfterMs=i!=null&&i.reconnectAfterMs?i.reconnectAfterMs:r=>[1e3,2e3,5e3,1e4][r-1]||1e4,this.encode=i!=null&&i.encode?i.encode:(r,o)=>o(JSON.stringify(r)),this.decode=i!=null&&i.decode?i.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new sb(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(i==null?void 0:i.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(wF){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new EF(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),yr(()=>import("../chunks/browser.BVZztmgU.js").then(e=>e.b),__vite__mapDeps([0,1,2,3]),import.meta.url).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,i){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,i??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const i=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const e=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.disconnect(),e}log(e,i,n){this.logger(e,i,n)}connectionState(){switch(this.conn&&this.conn.readyState){case pr.connecting:return Zn.Connecting;case pr.open:return Zn.Open;case pr.closing:return Zn.Closing;default:return Zn.Closed}}isConnected(){return this.connectionState()===Zn.Open}channel(e,i={config:{}}){const n=new Ud(`realtime:${e}`,i,this);return this.channels.push(n),n}push(e){const{topic:i,event:n,payload:s,ref:r}=e,o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${i} ${n} (${r})`,s),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(i=>{e&&i.updateJoinPayload({access_token:e}),i.joinedOnce&&i._isJoined()&&i._push(mi.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let i=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${e}"`),i.unsubscribe())}_remove(e){this.channels=this.channels.filter(i=>i._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:hF}))}_onConnMessage(e){this.decode(e.data,i=>{let{topic:n,event:s,payload:r,ref:o}=i;(o&&o===this.pendingHeartbeatRef||s===(r==null?void 0:r.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${n} ${s} ${o&&"("+o+")"||""}`,r),this.channels.filter(a=>a._isMember(n)).forEach(a=>a._trigger(s,r,o)),this.stateChangeCallbacks.message.forEach(a=>a(i))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(i=>i(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(i=>i(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(mi.error))}_appendParams(e,i){if(Object.keys(i).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(i);return`${e}${n}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(fF,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class EF{constructor(e,i,n){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=pr.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=n.close}}class zd extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function It(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class SF extends zd{constructor(e,i){super(e),this.name="StorageApiError",this.status=i}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class J0 extends zd{constructor(e,i){super(e),this.name="StorageUnknownError",this.originalError=i}}var AF=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const ob=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...i)=>yr(()=>Promise.resolve().then(()=>ca),void 0,import.meta.url).then(({default:n})=>n(...i)):e=fetch,(...i)=>e(...i)},RF=()=>AF(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield yr(()=>Promise.resolve().then(()=>ca),void 0,import.meta.url)).Response:Response});var Br=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const th=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),CF=(t,e)=>Br(void 0,void 0,void 0,function*(){const i=yield RF();t instanceof i?t.json().then(n=>{e(new SF(th(n),t.status||500))}).catch(n=>{e(new J0(th(n),n))}):e(new J0(th(t),t))}),xF=(t,e,i,n)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),i))};function Zl(t,e,i,n,s,r){return Br(this,void 0,void 0,function*(){return new Promise((o,a)=>{t(i,xF(e,n,s,r)).then(c=>{if(!c.ok)throw c;return n!=null&&n.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>CF(c,a))})})}function Hf(t,e,i,n){return Br(this,void 0,void 0,function*(){return Zl(t,"GET",e,i,n)})}function fn(t,e,i,n,s){return Br(this,void 0,void 0,function*(){return Zl(t,"POST",e,n,s,i)})}function PF(t,e,i,n,s){return Br(this,void 0,void 0,function*(){return Zl(t,"PUT",e,n,s,i)})}function ab(t,e,i,n,s){return Br(this,void 0,void 0,function*(){return Zl(t,"DELETE",e,n,s,i)})}var si=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const MF={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Q0={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class IF{constructor(e,i={},n,s){this.url=e,this.headers=i,this.bucketId=n,this.fetch=ob(s)}uploadOrUpdate(e,i,n,s){return si(this,void 0,void 0,function*(){try{let r;const o=Object.assign(Object.assign({},Q0),s),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&n instanceof Blob?(r=new FormData,r.append("cacheControl",o.cacheControl),r.append("",n)):typeof FormData<"u"&&n instanceof FormData?(r=n,r.append("cacheControl",o.cacheControl)):(r=n,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const c=this._removeEmptyFolders(i),l=this._getFinalPath(c),u=yield this.fetch(`${this.url}/object/${l}`,Object.assign({method:e,body:r,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),h=yield u.json();return u.ok?{data:{path:c,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(r){if(It(r))return{data:null,error:r};throw r}})}upload(e,i,n){return si(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,i,n)})}uploadToSignedUrl(e,i,n,s){return si(this,void 0,void 0,function*(){const r=this._removeEmptyFolders(e),o=this._getFinalPath(r),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",i);try{let c;const l=Object.assign({upsert:Q0.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",l.cacheControl)):(c=n,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:u}),f=yield h.json();return h.ok?{data:{path:r,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(It(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e){return si(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e);const n=yield fn(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:this.headers}),s=new URL(this.url+n.url),r=s.searchParams.get("token");if(!r)throw new zd("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:r},error:null}}catch(i){if(It(i))return{data:null,error:i};throw i}})}update(e,i,n){return si(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,i,n)})}move(e,i){return si(this,void 0,void 0,function*(){try{return{data:yield fn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i},{headers:this.headers}),error:null}}catch(n){if(It(n))return{data:null,error:n};throw n}})}copy(e,i){return si(this,void 0,void 0,function*(){try{return{data:{path:(yield fn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i},{headers:this.headers})).Key},error:null}}catch(n){if(It(n))return{data:null,error:n};throw n}})}createSignedUrl(e,i,n){return si(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),r=yield fn(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:i},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return r={signedUrl:encodeURI(`${this.url}${r.signedURL}${o}`)},{data:r,error:null}}catch(s){if(It(s))return{data:null,error:s};throw s}})}createSignedUrls(e,i,n){return si(this,void 0,void 0,function*(){try{const s=yield fn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:i,paths:e},{headers:this.headers}),r=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${r}`):null})),error:null}}catch(s){if(It(s))return{data:null,error:s};throw s}})}download(e,i){return si(this,void 0,void 0,function*(){const s=typeof(i==null?void 0:i.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((i==null?void 0:i.transform)||{}),o=r?`?${r}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Hf(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(It(a))return{data:null,error:a};throw a}})}getPublicUrl(e,i){const n=this._getFinalPath(e),s=[],r=i!=null&&i.download?`download=${i.download===!0?"":i.download}`:"";r!==""&&s.push(r);const a=typeof(i==null?void 0:i.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((i==null?void 0:i.transform)||{});c!==""&&s.push(c);let l=s.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${l}`)}}}remove(e){return si(this,void 0,void 0,function*(){try{return{data:yield ab(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(i){if(It(i))return{data:null,error:i};throw i}})}list(e,i,n){return si(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},MF),i),{prefix:e||""});return{data:yield fn(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(It(s))return{data:null,error:s};throw s}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const i=[];return e.width&&i.push(`width=${e.width}`),e.height&&i.push(`height=${e.height}`),e.resize&&i.push(`resize=${e.resize}`),e.format&&i.push(`format=${e.format}`),e.quality&&i.push(`quality=${e.quality}`),i.join("&")}}const OF="2.5.5",kF={"X-Client-Info":`storage-js/${OF}`};var Ws=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};class NF{constructor(e,i={},n){this.url=e,this.headers=Object.assign(Object.assign({},kF),i),this.fetch=ob(n)}listBuckets(){return Ws(this,void 0,void 0,function*(){try{return{data:yield Hf(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(It(e))return{data:null,error:e};throw e}})}getBucket(e){return Ws(this,void 0,void 0,function*(){try{return{data:yield Hf(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(i){if(It(i))return{data:null,error:i};throw i}})}createBucket(e,i={public:!1}){return Ws(this,void 0,void 0,function*(){try{return{data:yield fn(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(It(n))return{data:null,error:n};throw n}})}updateBucket(e,i){return Ws(this,void 0,void 0,function*(){try{return{data:yield PF(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(It(n))return{data:null,error:n};throw n}})}emptyBucket(e){return Ws(this,void 0,void 0,function*(){try{return{data:yield fn(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(i){if(It(i))return{data:null,error:i};throw i}})}deleteBucket(e){return Ws(this,void 0,void 0,function*(){try{return{data:yield ab(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(i){if(It(i))return{data:null,error:i};throw i}})}}class DF extends NF{constructor(e,i={},n){super(e,i,n)}from(e){return new IF(this.url,this.headers,e,this.fetch)}}const FF="2.43.4";let mo="";typeof Deno<"u"?mo="deno":typeof document<"u"?mo="web":typeof navigator<"u"&&navigator.product==="ReactNative"?mo="react-native":mo="node";const LF={"X-Client-Info":`supabase-js-${mo}/${FF}`},BF={headers:LF},UF={schema:"public"},zF={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},VF={};var jF=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const $F=t=>{let e;return t?e=t:typeof fetch>"u"?e=Ld:e=fetch,(...i)=>e(...i)},HF=()=>typeof Headers>"u"?ib:Headers,WF=(t,e,i)=>{const n=$F(i),s=HF();return(r,o)=>jF(void 0,void 0,void 0,function*(){var a;const c=(a=yield e())!==null&&a!==void 0?a:t;let l=new s(o==null?void 0:o.headers);return l.has("apikey")||l.set("apikey",t),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),n(r,Object.assign(Object.assign({},o),{headers:l}))})};function XF(t){return t.replace(/\/$/,"")}function qF(t,e){const{db:i,auth:n,realtime:s,global:r}=t,{db:o,auth:a,realtime:c,global:l}=e;return{db:Object.assign(Object.assign({},o),i),auth:Object.assign(Object.assign({},a),n),realtime:Object.assign(Object.assign({},c),s),global:Object.assign(Object.assign({},l),r)}}const cb="2.64.2",YF="http://localhost:9999",KF="supabase.auth.token",ZF={"X-Client-Info":`gotrue-js/${cb}`},em=10,Wf="X-Supabase-Api-Version",lb={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function GF(t){return Math.round(Date.now()/1e3)+t}function JF(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const _i=()=>typeof document<"u",$n={tested:!1,writable:!1},Mo=()=>{if(!_i())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if($n.tested)return $n.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),$n.tested=!0,$n.writable=!0}catch{$n.tested=!0,$n.writable=!1}return $n.writable};function ih(t){const e={},i=new URL(t);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((s,r)=>{e[r]=s})}catch{}return i.searchParams.forEach((n,s)=>{e[s]=n}),e}const ub=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...i)=>yr(()=>Promise.resolve().then(()=>ca),void 0,import.meta.url).then(({default:n})=>n(...i)):e=fetch,(...i)=>e(...i)},QF=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",hb=async(t,e,i)=>{await t.setItem(e,JSON.stringify(i))},ec=async(t,e)=>{const i=await t.getItem(e);if(!i)return null;try{return JSON.parse(i)}catch{return i}},nh=async(t,e)=>{await t.removeItem(e)};function eL(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let i="",n,s,r,o,a,c,l,u=0;for(t=t.replace("-","+").replace("_","/");u<t.length;)o=e.indexOf(t.charAt(u++)),a=e.indexOf(t.charAt(u++)),c=e.indexOf(t.charAt(u++)),l=e.indexOf(t.charAt(u++)),n=o<<2|a>>4,s=(a&15)<<4|c>>2,r=(c&3)<<6|l,i=i+String.fromCharCode(n),c!=64&&s!=0&&(i=i+String.fromCharCode(s)),l!=64&&r!=0&&(i=i+String.fromCharCode(r));return i}class Gl{constructor(){this.promise=new Gl.promiseConstructor((e,i)=>{this.resolve=e,this.reject=i})}}Gl.promiseConstructor=Promise;function tm(t){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,i=t.split(".");if(i.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(i[1]))throw new Error("JWT is not valid: payload is not in base64url format");const n=i[1];return JSON.parse(eL(n))}async function tL(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function iL(t,e){return new Promise((n,s)=>{(async()=>{for(let r=0;r<1/0;r++)try{const o=await t(r);if(!e(r,null,o)){n(o);return}}catch(o){if(!e(r,o)){s(o);return}}})()})}function nL(t){return("0"+t.toString(16)).substr(-2)}function sL(){const e=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=i.length;let s="";for(let r=0;r<56;r++)s+=i.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,nL).join("")}async function rL(t){const i=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",i),s=new Uint8Array(n);return Array.from(s).map(r=>String.fromCharCode(r)).join("")}function oL(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function aL(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const i=await rL(t);return oL(i)}async function Xs(t,e,i=!1){const n=sL();let s=n;i&&(s+="/PASSWORD_RECOVERY"),await hb(t,`${e}-code-verifier`,s);const r=await aL(n);return[r,n===r?"plain":"s256"]}const cL=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function lL(t){const e=t.headers.get(Wf);if(!e||!e.match(cL))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class Vd extends Error{constructor(e,i,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=n}}function ye(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class uL extends Vd{constructor(e,i,n){super(e,i,n),this.name="AuthApiError",this.status=i,this.code=n}}function hL(t){return ye(t)&&t.name==="AuthApiError"}class fb extends Vd{constructor(e,i){super(e),this.name="AuthUnknownError",this.originalError=i}}class xs extends Vd{constructor(e,i,n,s){super(e,n,s),this.name=i,this.status=n}}class Hn extends xs{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class sh extends xs{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class tc extends xs{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ic extends xs{constructor(e,i=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class im extends xs{constructor(e,i=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Xf extends xs{constructor(e,i){super(e,"AuthRetryableFetchError",i,void 0)}}function rh(t){return ye(t)&&t.name==="AuthRetryableFetchError"}class nm extends xs{constructor(e,i,n){super(e,"AuthWeakPasswordError",i,"weak_password"),this.reasons=n}}var fL=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(i[n[s]]=t[n[s]]);return i};const qn=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),dL=[502,503,504];async function sm(t){var e;if(!QF(t))throw new Xf(qn(t),0);if(dL.includes(t.status))throw new Xf(qn(t),t.status);let i;try{i=await t.json()}catch(r){throw new fb(qn(r),r)}let n;const s=lL(t);if(s&&s.getTime()>=lb["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?n=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(n=i.error_code),n){if(n==="weak_password")throw new nm(qn(i),t.status,((e=i.weak_password)===null||e===void 0?void 0:e.reasons)||[])}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((r,o)=>r&&typeof o=="string",!0))throw new nm(qn(i),t.status,i.weak_password.reasons);throw new uL(qn(i),t.status||500,n)}const pL=(t,e,i,n)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),i))};async function we(t,e,i,n){var s;const r=Object.assign({},n==null?void 0:n.headers);r[Wf]||(r[Wf]=lb["2024-01-01"].name),n!=null&&n.jwt&&(r.Authorization=`Bearer ${n.jwt}`);const o=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await gL(t,e,i+a,{headers:r,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(c):{data:Object.assign({},c),error:null}}async function gL(t,e,i,n,s,r){const o=pL(e,n,s,r);let a;try{a=await t(i,Object.assign({},o))}catch(c){throw console.error(c),new Xf(qn(c),0)}if(a.ok||await sm(a),n!=null&&n.noResolveJson)return a;try{return await a.json()}catch(c){await sm(c)}}function un(t){var e;let i=null;vL(t)&&(i=Object.assign({},t),t.expires_at||(i.expires_at=GF(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:i,user:n},error:null}}function rm(t){const e=un(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((i,n)=>i&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function gn(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function _L(t){return{data:t,error:null}}function mL(t){const{action_link:e,email_otp:i,hashed_token:n,redirect_to:s,verification_type:r}=t,o=fL(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:i,hashed_token:n,redirect_to:s,verification_type:r},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function yL(t){return t}function vL(t){return t.access_token&&t.refresh_token&&t.expires_in}var bL=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(i[n[s]]=t[n[s]]);return i};class wL{constructor({url:e="",headers:i={},fetch:n}){this.url=e,this.headers=i,this.fetch=ub(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,i="global"){try{return await we(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(ye(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,i={}){try{return await we(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:gn})}catch(n){if(ye(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:i}=e,n=bL(e,["options"]),s=Object.assign(Object.assign({},n),i);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await we(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:mL,redirectTo:i==null?void 0:i.redirectTo})}catch(i){if(ye(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(e){try{return await we(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:gn})}catch(i){if(ye(i))return{data:{user:null},error:i};throw i}}async listUsers(e){var i,n,s,r,o,a,c;try{const l={nextPage:null,lastPage:0,total:0},u=await we(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(i=e==null?void 0:e.page)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:"",per_page:(r=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:""},xform:yL});if(u.error)throw u.error;const h=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,d=(c=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return d.length>0&&(d.forEach(p=>{const g=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(p.split(";")[1].split("=")[1]);l[`${_}Page`]=g}),l.total=parseInt(f)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if(ye(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await we(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:gn})}catch(i){if(ye(i))return{data:{user:null},error:i};throw i}}async updateUserById(e,i){try{return await we(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:i,headers:this.headers,xform:gn})}catch(n){if(ye(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,i=!1){try{return await we(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:i},xform:gn})}catch(n){if(ye(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){try{const{data:i,error:n}=await we(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:i,error:n}}catch(i){if(ye(i))return{data:null,error:i};throw i}}async _deleteFactor(e){try{return{data:await we(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(i){if(ye(i))return{data:null,error:i};throw i}}}const TL={getItem:t=>Mo()?globalThis.localStorage.getItem(t):null,setItem:(t,e)=>{Mo()&&globalThis.localStorage.setItem(t,e)},removeItem:t=>{Mo()&&globalThis.localStorage.removeItem(t)}};function om(t={}){return{getItem:e=>t[e]||null,setItem:(e,i)=>{t[e]=i},removeItem:e=>{delete t[e]}}}function EL(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const qs={debug:!!(globalThis&&Mo()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class db extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class SL extends db{}async function AL(t,e,i){qs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),qs.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){qs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await i()}finally{qs.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw qs.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new SL(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(qs.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}})}EL();const RL={url:YF,storageKey:KF,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ZF,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},so=30*1e3,am=3;async function cm(t,e,i){return await i()}class Jo{constructor(e){var i,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Jo.nextInstanceID,Jo.nextInstanceID+=1,this.instanceID>0&&_i()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},RL),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new wL({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=ub(s.fetch),this.lock=s.lock||cm,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:_i()&&(!((i=globalThis==null?void 0:globalThis.navigator)===null||i===void 0)&&i.locks)?this.lock=AL:this.lock=cm,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Mo()?this.storage=TL:(this.memoryStorage={},this.storage=om(this.memoryStorage)):(this.memoryStorage={},this.storage=om(this.memoryStorage)),_i()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",r)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async r=>{this._debug("received broadcast notification from other tab or client",r),await this._notifyAllSubscribers(r.data.event,r.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${cb}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=_i()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:i,error:n}=await this._getSessionFromURL(e);if(n)return this._debug("#_initialize()","error detecting session from URL",n),(n==null?void 0:n.message)==="Identity is already linked"||(n==null?void 0:n.message)==="Identity is already linked to another user"?{error:n}:(await this._removeSession(),{error:n});const{session:s,redirectType:r}=i;return this._debug("#_initialize()","detected session in URL",s,"redirect type",r),await this._saveSession(s),setTimeout(async()=>{r==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return ye(e)?{error:e}:{error:new fb("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var i,n,s;try{await this._removeSession();const r=await we(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:un}),{data:o,error:a}=r;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(r){if(ye(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(e){var i,n,s;try{await this._removeSession();let r;if("email"in e){const{email:u,password:h,options:f}=e;let d=null,p=null;this.flowType==="pkce"&&([d,p]=await Xs(this.storage,this.storageKey)),r=await we(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:h,data:(i=f==null?void 0:f.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:d,code_challenge_method:p},xform:un})}else if("phone"in e){const{phone:u,password:h,options:f}=e;r=await we(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(n=f==null?void 0:f.data)!==null&&n!==void 0?n:{},channel:(s=f==null?void 0:f.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:un})}else throw new tc("You must provide either an email or phone number and a password");const{data:o,error:a}=r;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(r){if(ye(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(e){try{await this._removeSession();let i;if("email"in e){const{email:r,password:o,options:a}=e;i=await we(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:rm})}else if("phone"in e){const{phone:r,password:o,options:a}=e;i=await we(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:rm})}else throw new tc("You must provide either an email or phone number and a password");const{data:n,error:s}=i;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new sh}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(i){if(ye(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOAuth(e){var i,n,s,r;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(r=e.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const i=await ec(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(i??"").split("/"),{data:r,error:o}=await we(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:un});return await nh(this.storage,`${this.storageKey}-code-verifier`),o?{data:{user:null,session:null,redirectType:null},error:o}:!r||!r.session||!r.user?{data:{user:null,session:null,redirectType:null},error:new sh}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign(Object.assign({},r),{redirectType:s??null}),error:o})}async signInWithIdToken(e){await this._removeSession();try{const{options:i,provider:n,token:s,access_token:r,nonce:o}=e,a=await we(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:r,nonce:o,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:un}),{data:c,error:l}=a;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new sh}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(i){if(ye(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOtp(e){var i,n,s,r,o;try{if(await this._removeSession(),"email"in e){const{email:a,options:c}=e;let l=null,u=null;this.flowType==="pkce"&&([l,u]=await Xs(this.storage,this.storageKey));const{error:h}=await we(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(i=c==null?void 0:c.data)!==null&&i!==void 0?i:{},create_user:(n=c==null?void 0:c.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:c}=e,{data:l,error:u}=await we(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:u}}throw new tc("You must provide either an email or phone number.")}catch(a){if(ye(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var i,n;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let s,r;"options"in e&&(s=(i=e.options)===null||i===void 0?void 0:i.redirectTo,r=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:a}=await we(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:s,xform:un});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,l=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(s){if(ye(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var i,n,s;try{await this._removeSession();let r=null,o=null;return this.flowType==="pkce"&&([r,o]=await Xs(this.storage,this.storageKey)),await we(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(i=e.options)===null||i===void 0?void 0:i.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:o}),headers:this.headers,xform:_L})}catch(r){if(ye(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:i},error:n}=e;if(n)throw n;if(!i)throw new Hn;const{error:s}=await we(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(ye(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const i=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:r}=e,{error:o}=await we(this.fetch,"POST",i,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},redirectTo:r==null?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:n,type:s,options:r}=e,{data:o,error:a}=await we(this.fetch,"POST",i,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new tc("You must provide either an email or phone number and a type")}catch(i){if(ye(i))return{data:{user:null,session:null},error:i};throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async i=>i))}async _acquireLock(e,i){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await i()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=i();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await e(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const i=await ec(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?e=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.storage.isServer){const o=this.suppressGetSessionWarning;e=new Proxy(e,{get(c,l,u){return!o&&l==="user"&&console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),Reflect.get(c,l,u)}})}return{data:{session:e},error:null}}const{session:s,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await we(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:gn}):await this._useSession(async i=>{var n,s,r;const{data:o,error:a}=i;if(a)throw a;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Hn}:await we(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0,xform:gn})})}catch(i){if(ye(i))return{data:{user:null},error:i};throw i}}async updateUser(e,i={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,i))}async _updateUser(e,i={}){try{return await this._useSession(async n=>{const{data:s,error:r}=n;if(r)throw r;if(!s.session)throw new Hn;const o=s.session;let a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=await Xs(this.storage,this.storageKey));const{data:l,error:u}=await we(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i==null?void 0:i.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:o.access_token,xform:gn});if(u)throw u;return o.user=l.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(n){if(ye(n))return{data:{user:null},error:n};throw n}}_decodeJWT(e){return tm(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Hn;const i=Date.now()/1e3;let n=i,s=!0,r=null;const o=tm(e.access_token);if(o.exp&&(n=o.exp,s=n<=i),s){const{session:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};r=a}else{const{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;r={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-i,expires_at:n},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(i){if(ye(i))return{data:{session:null,user:null},error:i};throw i}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async i=>{var n;if(!e){const{data:o,error:a}=i;if(a)throw a;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Hn;const{session:s,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(i){if(ye(i))return{data:{user:null,session:null},error:i};throw i}}async _getSessionFromURL(e){try{if(!_i())throw new ic("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new ic("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new im("Not a valid PKCE flow url.");const i=ih(window.location.href);if(e){if(!i.code)throw new im("No code detected.");const{data:b,error:w}=await this._exchangeCodeForSession(i.code);if(w)throw w;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:b.session,redirectType:null},error:null}}if(i.error||i.error_description||i.error_code)throw new ic(i.error_description||"Error in URL with unspecified error_description",{error:i.error||"unspecified_error",code:i.error_code||"unspecified_code"});const{provider_token:n,provider_refresh_token:s,access_token:r,refresh_token:o,expires_in:a,expires_at:c,token_type:l}=i;if(!r||!a||!o||!l)throw new ic("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(a);let f=u+h;c&&(f=parseInt(c));const d=f-u;d*1e3<=so&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${h}s`);const p=f-h;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,f,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",p,f,u);const{data:g,error:_}=await this._getUser(r);if(_)throw _;const m={provider_token:n,provider_refresh_token:s,access_token:r,expires_in:h,expires_at:f,refresh_token:o,token_type:l,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:i.type},error:null}}catch(i){if(ye(i))return{data:{session:null,redirectType:null},error:i};throw i}}_isImplicitGrantFlow(){const e=ih(window.location.href);return!!(_i()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=ih(window.location.href),i=await ec(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&i)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async i=>{var n;const{data:s,error:r}=i;if(r)return{error:r};const o=(n=s.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(hL(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await nh(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const i=JF(),n={id:i,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async i=>{var n,s;try{const{data:{session:r},error:o}=i;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(r){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r),console.error(r)}})}async resetPasswordForEmail(e,i={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Xs(this.storage,this.storageKey,!0));try{return await we(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(r){if(ye(r))return{data:null,error:r};throw r}}async getUserIdentities(){var e;try{const{data:i,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=i.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(i){if(ye(i))return{data:null,error:i};throw i}}async linkIdentity(e){var i;try{const{data:n,error:s}=await this._useSession(async r=>{var o,a,c,l,u;const{data:h,error:f}=r;if(f)throw f;const d=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await we(this.fetch,"GET",d,{headers:this.headers,jwt:(u=(l=h.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return _i()&&!(!((i=e.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(ye(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async i=>{var n,s;const{data:r,error:o}=i;if(o)throw o;return await we(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(i){if(ye(i))return{data:null,error:i};throw i}}async _refreshAccessToken(e){const i=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{const n=Date.now();return await iL(async s=>(s>0&&await tL(200*Math.pow(2,s-1)),this._debug(i,"refreshing attempt",s),await we(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:un})),(s,r)=>{const o=200*Math.pow(2,s);return r&&rh(r)&&Date.now()+o-n<so})}catch(n){if(this._debug(i,"error",n),ye(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(i,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,i){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",i,"url",n),_i()&&!i.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const n=await ec(this.storage,this.storageKey);if(this._debug(i,"session from storage",n),!this._isValidSession(n)){this._debug(i,"session is not valid"),n!==null&&await this._removeSession();return}const s=Math.round(Date.now()/1e3),r=((e=n.expires_at)!==null&&e!==void 0?e:1/0)<s+em;if(this._debug(i,`session has${r?"":" not"} expired with margin of ${em}s`),r){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),rh(o)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(i,"error",n),console.error(n);return}finally{this._debug(i,"end")}}async _callRefreshToken(e){var i,n;if(!e)throw new Hn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Gl;const{data:r,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!r.session)throw new Hn;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const a={session:r.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(r){if(this._debug(s,"error",r),ye(r)){const o={session:null,error:r};return rh(r)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(r),r}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,i,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",i,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:i});const r=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,i)}catch(c){r.push(c)}});if(await Promise.all(o),r.length>0){for(let a=0;a<r.length;a+=1)console.error(r[a]);throw r[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await hb(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await nh(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&_i()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),so);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async i=>{const{data:{session:n}}=i;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/so);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${so}ms, refresh threshold is ${am} ticks`),s<=am&&await this._callRefreshToken(n.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof db)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!_i()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const i=`#_onVisibilityChanged(${e})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,i,n){const s=[`provider=${encodeURIComponent(i)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[r,o]=await Xs(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(n!=null&&n.queryParams){const r=new URLSearchParams(n.queryParams);s.push(r.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async i=>{var n;const{data:s,error:r}=i;return r?{data:null,error:r}:await we(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(i){if(ye(i))return{data:null,error:i};throw i}}async _enroll(e){try{return await this._useSession(async i=>{var n,s;const{data:r,error:o}=i;if(o)return{data:null,error:o};const{data:a,error:c}=await we(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(!((s=a==null?void 0:a.totp)===null||s===void 0)&&s.qr_code&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(i){if(ye(i))return{data:null,error:i};throw i}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var n;const{data:s,error:r}=i;if(r)return{data:null,error:r};const{data:o,error:a}=await we(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(i){if(ye(i))return{data:null,error:i};throw i}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var n;const{data:s,error:r}=i;return r?{data:null,error:r}:await we(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(i){if(ye(i))return{data:null,error:i};throw i}})}async _challengeAndVerify(e){const{data:i,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:i.id,code:e.code})}async _listFactors(){const{data:{user:e},error:i}=await this.getUser();if(i)return{data:null,error:i};const n=(e==null?void 0:e.factors)||[],s=n.filter(r=>r.factor_type==="totp"&&r.status==="verified");return{data:{all:n,totp:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var i,n;const{data:{session:s},error:r}=e;if(r)return{data:null,error:r};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const o=this._decodeJWT(s.access_token);let a=null;o.aal&&(a=o.aal);let c=a;((n=(i=s.user.factors)===null||i===void 0?void 0:i.filter(h=>h.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}}Jo.nextInstanceID=0;const CL=Jo;class xL extends CL{constructor(e){super(e)}}var PL=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};class ML{constructor(e,i,n){var s,r,o;if(this.supabaseUrl=e,this.supabaseKey=i,!e)throw new Error("supabaseUrl is required.");if(!i)throw new Error("supabaseKey is required.");const a=XF(e);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:UF,realtime:VF,auth:Object.assign(Object.assign({},zF),{storageKey:c}),global:BF},u=qF(n??{},l);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(r=u.global.headers)!==null&&r!==void 0?r:{},this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=WF(i,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},u.realtime)),this.rest=new Bd(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new JD(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new DF(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,i={},n={}){return this.rest.rpc(e,i,n)}channel(e,i={config:{}}){return this.realtime.channel(e,i)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,i;return PL(this,void 0,void 0,function*(){const{data:n}=yield this.auth.getSession();return(i=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&i!==void 0?i:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:i,detectSessionInUrl:n,storage:s,storageKey:r,flowType:o,debug:a},c,l){var u;const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new xL({url:this.authUrl,headers:Object.assign(Object.assign({},h),c),storageKey:r,autoRefreshToken:e,persistSession:i,detectSessionInUrl:n,storage:s,flowType:o,debug:a,fetch:l,hasCustomAuthorizationHeader:(u="Authorization"in this.headers)!==null&&u!==void 0?u:!1})}_initRealtimeClient(e){return new TF(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((i,n)=>{this._handleTokenChanged(i,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,i,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?(this.realtime.setAuth(n??null),this.changedAccessToken=n):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),i=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const IL=(t,e,i)=>new ML(t,e,i),pb="https://dbmtysppmiwwjwaeneex.supabase.co",gb="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRibXR5c3BwbWl3d2p3YWVuZWV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2NDQ5NTI0NDUsImV4cCI6MTk2MDUyODQ0NX0.i_1JrAfv5fieeVaiJrVIQPL6V0_-H9sR-PKIuGDAIfI";console.log(pb,gb);const Jl=IL(pb,gb),OL=async t=>{let{data:e,error:i}=await Jl.from("courts_comments").select().eq("court_id",t).eq("moderation",!0);if(i){console.error(i);return}return e},kL=async(t,e)=>{const i=await Jl.from("courts_comments").insert([{court_id:t,comment:e}],{returning:"minimal"}).select();if(i.error)throw console.log(i.error),new Error("insert failed");return!0},NL=async()=>{try{const{data:t,error:e}=await Jl.rpc("courts_calc");if(e)throw e;return t}catch(t){console.error("Error fetching map counts:",t)}},DL=async t=>{const e=await Jl.from("courts_faves").insert([{court_id:t}],{returning:"minimal"}).select();if(e.error)throw console.log(e.error),new Error("insert failed");return!0};function lm(t,e,i){const n=t.slice();n[1]=e[i];const s=new Date(n[1].created_at);return n[9]=s,n}function um(t){let e,i=t[0].length+"",n,s,r,o=t[0].length>1?"s":"",a;return{c(){e=H("p"),n=Ut(i),s=Ut(" comment"),r=H("span"),a=Ut(o),this.h()},l(c){e=W(c,"P",{class:!0});var l=se(e);n=zt(l,i),s=zt(l," comment"),r=W(l,"SPAN",{});var u=se(r);a=zt(u,o),u.forEach(L),l.forEach(L),this.h()},h(){O(e,"class","comment-count svelte-13hikzc")},m(c,l){oe(c,e,l),U(e,n),U(e,s),U(e,r),U(r,a)},p(c,l){l&1&&i!==(i=c[0].length+"")&&Sn(n,i),l&1&&o!==(o=c[0].length>1?"s":"")&&Sn(a,o)},d(c){c&&L(e)}}}function hm(t){let e,i,n=t[9].toLocaleDateString("en-US",t[4])+"",s,r=t[1].comment+"",o;return{c(){e=H("p"),i=H("span"),s=Ut(n),o=Ut(r),this.h()},l(a){e=W(a,"P",{class:!0});var c=se(e);i=W(c,"SPAN",{class:!0});var l=se(i);s=zt(l,n),l.forEach(L),o=zt(c,r),c.forEach(L),this.h()},h(){O(i,"class","svelte-13hikzc"),O(e,"class","comment svelte-13hikzc")},m(a,c){oe(a,e,c),U(e,i),U(i,s),U(e,o)},p(a,c){c&1&&n!==(n=a[9].toLocaleDateString("en-US",a[4])+"")&&Sn(s,n),c&1&&r!==(r=a[1].comment+"")&&Sn(o,r)},d(a){a&&L(e)}}}function FL(t){let e,i,n,s,r="Close",o,a,c,l,u="Share your comments:",h,f,d,p,g,_,m,b,w,S,R,M=t[0].length>0&&um(t),k=An(t[0]),F=[];for(let I=0;I<k.length;I+=1)F[I]=hm(lm(t,k,I));return{c(){e=H("div"),i=H("div"),n=H("div"),s=H("button"),s.textContent=r,o=ae(),M&&M.c(),a=ae();for(let I=0;I<F.length;I+=1)F[I].c();c=ae(),l=H("p"),l.textContent=u,h=ae(),f=H("form"),d=H("textarea"),p=ae(),g=H("button"),_=Ut("Submit Comment"),this.h()},l(I){e=W(I,"DIV",{class:!0});var N=se(e);i=W(N,"DIV",{class:!0});var C=se(i);n=W(C,"DIV",{class:!0});var V=se(n);s=W(V,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(s)!=="svelte-bxc8wg"&&(s.textContent=r),o=ce(V),M&&M.l(V),a=ce(V);for(let B=0;B<F.length;B+=1)F[B].l(V);c=ce(V),l=W(V,"P",{class:!0,"data-svelte-h":!0}),Re(l)!=="svelte-161vlou"&&(l.textContent=u),h=ce(V),f=W(V,"FORM",{});var X=se(f);d=W(X,"TEXTAREA",{rows:!0,placeholder:!0,class:!0}),se(d).forEach(L),p=ce(X),g=W(X,"BUTTON",{type:!0});var K=se(g);_=zt(K,"Submit Comment"),K.forEach(L),X.forEach(L),V.forEach(L),C.forEach(L),N.forEach(L),this.h()},h(){O(s,"class","close svelte-13hikzc"),O(l,"class","instructions svelte-13hikzc"),O(d,"rows","4"),O(d,"placeholder","Write your comment..."),O(d,"class","svelte-13hikzc"),O(g,"type","submit"),g.disabled=m=t[1].trim()==="",O(n,"class","comment-wrapper svelte-13hikzc"),O(i,"class","modal svelte-13hikzc"),O(e,"class","blackout svelte-13hikzc")},m(I,N){oe(I,e,N),U(e,i),U(i,n),U(n,s),U(n,o),M&&M.m(n,null),U(n,a);for(let C=0;C<F.length;C+=1)F[C]&&F[C].m(n,null);U(n,c),U(n,l),U(n,h),U(n,f),U(f,d),Jd(d,t[1]),U(f,p),U(f,g),U(g,_),w=!0,S||(R=[gt(s,"click",t[2]),gt(d,"input",t[6]),gt(f,"submit",iw(t[3]))],S=!0)},p(I,[N]){if(I[0].length>0?M?M.p(I,N):(M=um(I),M.c(),M.m(n,a)):M&&(M.d(1),M=null),N&17){k=An(I[0]);let C;for(C=0;C<k.length;C+=1){const V=lm(I,k,C);F[C]?F[C].p(V,N):(F[C]=hm(V),F[C].c(),F[C].m(n,c))}for(;C<F.length;C+=1)F[C].d(1);F.length=k.length}N&2&&Jd(d,I[1]),(!w||N&2&&m!==(m=I[1].trim()===""))&&(g.disabled=m)},i(I){w||(I&&In(()=>{w&&(b||(b=Ui(i,zi,{y:-100,duration:300},!0)),b.run(1))}),w=!0)},o(I){I&&(b||(b=Ui(i,zi,{y:-100,duration:300},!1)),b.run(0)),w=!1},d(I){I&&L(e),M&&M.d(),kl(F,I),I&&b&&b.end(),S=!1,Qo(R)}}}function LL(t,e,i){let n;wn(t,xo,f=>i(7,n=f));const s=Ym();let{commentId:r}=e,o="",a=[];new Promise(async(f,d)=>{i(0,a=await OL(r))});function c(){pn(xo,n=!1,n)}function l(){o.trim()!==""&&(i(1,o=o.trim()),kL(r,o),pn(xo,n=!1,n),s("formSubmit",r))}const u={year:"numeric",month:"long",day:"numeric"};function h(){o=this.value,i(1,o)}return t.$$set=f=>{"commentId"in f&&i(5,r=f.commentId)},[a,o,c,l,u,r,h]}class BL extends On{constructor(e){super(),kn(this,e,LL,FL,en,{commentId:5})}}var Ur=zL,UL=Object.prototype.hasOwnProperty;function zL(){for(var t={},e=0;e<arguments.length;e++){var i=arguments[e];for(var n in i)UL.call(i,n)&&(t[n]=i[n])}return t}var _b={exports:{}};(function(t,e){(function(){var i={};t.exports=i,i.simpleFilter=function(n,s){return s.filter(function(r){return i.test(n,r)})},i.test=function(n,s){return i.match(n,s)!==null},i.match=function(n,s,r){r=r||{};var o=0,a=[],c=s.length,l=0,u=0,h=r.pre||"",f=r.post||"",d=r.caseSensitive&&s||s.toLowerCase(),p;n=r.caseSensitive&&n||n.toLowerCase();for(var g=0;g<c;g++)p=s[g],d[g]===n[o]?(p=h+p+f,o+=1,u+=1+u):u=0,l+=u,a[a.length]=p;return o===n.length?(l=d===n?1/0:l,{rendered:a.join(""),score:l}):null},i.filter=function(n,s,r){return!s||s.length===0?[]:typeof n!="string"?s:(r=r||{},s.reduce(function(o,a,c,l){var u=a;r.extract&&(u=r.extract(a));var h=i.match(n,u,r);return h!=null&&(o[o.length]={string:h.rendered,score:h.score,index:c,original:a}),o},[]).sort(function(o,a){var c=a.score-o.score;return c||o.index-a.index}))}})()})(_b);var VL=_b.exports,qt=function(t){return this.component=t,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};qt.prototype.show=function(){this.element.style.display="block"};qt.prototype.hide=function(){this.element.style.display="none"};qt.prototype.add=function(t){this.items.push(t)};qt.prototype.clear=function(){this.items=[],this.active=0};qt.prototype.isEmpty=function(){return!this.items.length};qt.prototype.isVisible=function(){return this.element.style.display==="block"};qt.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()};qt.prototype.drawItem=function(t,e){var i=document.createElement("li"),n=document.createElement("a");e&&(i.className+=" active"),n.innerHTML=t.string,i.appendChild(n),this.element.appendChild(i),i.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),i.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,t)}).bind(this))};qt.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()};qt.prototype.move=function(t){this.active=t,this.draw()};qt.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};qt.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};qt.prototype.drawError=function(t){var e=document.createElement("li");e.innerHTML=t,this.element.appendChild(e),this.show()};var jL=qt,$L=Ur,HL=VL,WL=jL,Nt=function(t,e,i){return i=i||{},this.options=$L({minLength:2,limit:5,filter:!0,hideOnBlur:!0},i),this.el=t,this.data=e||[],this.list=new WL(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(n){this.handleKeyUp(n.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(n){this.handleKeyDown(n)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(n){this.handlePaste(n)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Nt.prototype.handleKeyUp=function(t){t===40||t===38||t===27||t===13||t===9||this.handleInputChange(this.el.value)};Nt.prototype.handleKeyDown=function(t){switch(t.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&t.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Nt.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Nt.prototype.handlePaste=function(t){if(t.clipboardData)this.handleInputChange(t.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(t.target.value)},100)}};Nt.prototype.handleInputChange=function(t){if(this.query=this.normalize(t),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(e){for(var i=0;i<e.length&&(this.list.add(e[i]),i!==this.options.limit-1);i++);this.list.draw()}).bind(this))};Nt.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Nt.prototype.update=function(t){this.data=t,this.handleKeyUp()};Nt.prototype.clear=function(){this.data=[],this.list.clear()};Nt.prototype.normalize=function(t){return t=t.toLowerCase(),t};Nt.prototype.match=function(t,e){return t.indexOf(e)>-1};Nt.prototype.value=function(t){if(this.selected=t,this.el.value=this.getItemValue(t),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")};Nt.prototype.getCandidates=function(t){var e={pre:"<strong>",post:"</strong>",extract:(function(n){return this.getItemValue(n)}).bind(this)},i;this.options.filter?(i=HL.filter(this.query,this.data,e),i=i.map((function(n){return{original:n.original,string:this.render(n.original,n.string)}}).bind(this))):i=this.data.map((function(n){var s=this.render(n);return{original:n,string:s}}).bind(this)),t(i)};Nt.prototype.getItemValue=function(t){return t};Nt.prototype.render=function(t,e){if(e)return e;for(var i=t.original?this.getItemValue(t.original):this.getItemValue(t),n=this.normalize(i),s=n.lastIndexOf(this.query);s>-1;){var r=s+this.query.length;i=i.slice(0,s)+"<strong>"+i.slice(s,r)+"</strong>"+i.slice(r),s=n.slice(0,s).lastIndexOf(this.query)}return i};Nt.prototype.renderError=function(t){this.list.drawError(t)};var XL=Nt,mb=XL,qL=mb;typeof window<"u"&&(window.Suggestions=mb);var jd={exports:{}},gr=typeof Reflect=="object"?Reflect:null,fm=gr&&typeof gr.apply=="function"?gr.apply:function(e,i,n){return Function.prototype.apply.call(e,i,n)},gc;gr&&typeof gr.ownKeys=="function"?gc=gr.ownKeys:Object.getOwnPropertySymbols?gc=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:gc=function(e){return Object.getOwnPropertyNames(e)};function YL(t){console&&console.warn&&console.warn(t)}var yb=Number.isNaN||function(e){return e!==e};function Fe(){Fe.init.call(this)}jd.exports=Fe;jd.exports.once=JL;Fe.EventEmitter=Fe;Fe.prototype._events=void 0;Fe.prototype._eventsCount=0;Fe.prototype._maxListeners=void 0;var dm=10;function Ql(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Fe,"defaultMaxListeners",{enumerable:!0,get:function(){return dm},set:function(t){if(typeof t!="number"||t<0||yb(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");dm=t}});Fe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Fe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||yb(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function vb(t){return t._maxListeners===void 0?Fe.defaultMaxListeners:t._maxListeners}Fe.prototype.getMaxListeners=function(){return vb(this)};Fe.prototype.emit=function(e){for(var i=[],n=1;n<arguments.length;n++)i.push(arguments[n]);var s=e==="error",r=this._events;if(r!==void 0)s=s&&r.error===void 0;else if(!s)return!1;if(s){var o;if(i.length>0&&(o=i[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=r[e];if(c===void 0)return!1;if(typeof c=="function")fm(c,this,i);else for(var l=c.length,u=Sb(c,l),n=0;n<l;++n)fm(u[n],this,i);return!0};function bb(t,e,i,n){var s,r,o;if(Ql(i),r=t._events,r===void 0?(r=t._events=Object.create(null),t._eventsCount=0):(r.newListener!==void 0&&(t.emit("newListener",e,i.listener?i.listener:i),r=t._events),o=r[e]),o===void 0)o=r[e]=i,++t._eventsCount;else if(typeof o=="function"?o=r[e]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),s=vb(t),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,YL(a)}return t}Fe.prototype.addListener=function(e,i){return bb(this,e,i,!1)};Fe.prototype.on=Fe.prototype.addListener;Fe.prototype.prependListener=function(e,i){return bb(this,e,i,!0)};function KL(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function wb(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},s=KL.bind(n);return s.listener=i,n.wrapFn=s,s}Fe.prototype.once=function(e,i){return Ql(i),this.on(e,wb(this,e,i)),this};Fe.prototype.prependOnceListener=function(e,i){return Ql(i),this.prependListener(e,wb(this,e,i)),this};Fe.prototype.removeListener=function(e,i){var n,s,r,o,a;if(Ql(i),s=this._events,s===void 0)return this;if(n=s[e],n===void 0)return this;if(n===i||n.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||i));else if(typeof n!="function"){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===i||n[o].listener===i){a=n[o].listener,r=o;break}if(r<0)return this;r===0?n.shift():ZL(n,r),n.length===1&&(s[e]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",e,a||i)}return this};Fe.prototype.off=Fe.prototype.removeListener;Fe.prototype.removeAllListeners=function(e){var i,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var r=Object.keys(n),o;for(s=0;s<r.length;++s)o=r[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=n[e],typeof i=="function")this.removeListener(e,i);else if(i!==void 0)for(s=i.length-1;s>=0;s--)this.removeListener(e,i[s]);return this};function Tb(t,e,i){var n=t._events;if(n===void 0)return[];var s=n[e];return s===void 0?[]:typeof s=="function"?i?[s.listener||s]:[s]:i?GL(s):Sb(s,s.length)}Fe.prototype.listeners=function(e){return Tb(this,e,!0)};Fe.prototype.rawListeners=function(e){return Tb(this,e,!1)};Fe.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Eb.call(t,e)};Fe.prototype.listenerCount=Eb;function Eb(t){var e=this._events;if(e!==void 0){var i=e[t];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}Fe.prototype.eventNames=function(){return this._eventsCount>0?gc(this._events):[]};function Sb(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}function ZL(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function GL(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}function JL(t,e){return new Promise(function(i,n){function s(o){t.removeListener(e,r),n(o)}function r(){typeof t.removeListener=="function"&&t.removeListener("error",s),i([].slice.call(arguments))}Ab(t,e,r,{once:!0}),e!=="error"&&QL(t,s,{once:!0})})}function QL(t,e,i){typeof t.on=="function"&&Ab(t,"error",e,i)}function Ab(t,e,i,n){if(typeof t.on=="function")n.once?t.once(e,i):t.on(e,i);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(r){n.once&&t.removeEventListener(e,s),i(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var eB=jd.exports,tB={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function iB(t){var e=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return e?{key:e[1],value:e[2]}:null}function nB(t){var e=t.match(/<?([^>]*)>(.*)/);if(!e)return null;var i=e[1],n=e[2].split(";"),s=null,r=n.reduce(function(o,a){var c=iB(a);return c?c.key==="rel"?(s||(s=c.value),o):(o[c.key]=c.value,o):o},{});return s?{url:i,rel:s,params:r}:null}function sB(t){return t?t.split(/,\s*</).reduce(function(e,i){var n=nB(i);if(!n)return e;var s=n.rel.split(/\s+/);return s.forEach(function(r){e[r]||(e[r]={url:n.url,params:n.params})}),e},{}):{}}var rB=sB,oB=rB;function $d(t,e){this.request=t,this.headers=e.headers,this.rawBody=e.body,this.statusCode=e.statusCode;try{this.body=JSON.parse(e.body||"{}")}catch{this.body=e.body}this.links=oB(this.headers.link)}$d.prototype.hasNextPage=function(){return!!this.links.next};$d.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var aB=$d,eu={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},pm=eu;function cB(t){var e=t.type||pm.ERROR_HTTP,i;if(t.body)try{i=JSON.parse(t.body)}catch{i=t.body}else i=null;var n=t.message||null;n||(typeof i=="string"?n=i:i&&typeof i.message=="string"?n=i.message:e===pm.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=e,this.statusCode=t.statusCode||null,this.request=t.request,this.body=i}var lB=cB;function uB(t){var e=t.indexOf(":"),i=t.substring(0,e).trim().toLowerCase(),n=t.substring(e+1).trim();return{name:i,value:n}}function hB(t){var e={};return t&&t.trim().split(/[\r|\n]+/).forEach(function(i){var n=uB(i);e[n.name]=n.value}),e}var fB=hB,dB=aB,gm=lB,oh=eu,pB=fB,tl={};function gB(t){var e=tl[t.id];e&&(e.abort(),delete tl[t.id])}function _B(t,e){return new dB(t,{body:e.response,headers:pB(e.getAllResponseHeaders()),statusCode:e.status})}function _m(t){var e=t.total,i=t.loaded,n=100*i/e;return{total:e,transferred:i,percent:n}}function Rb(t,e){return new Promise(function(i,n){e.onprogress=function(o){t.emitter.emit(oh.EVENT_PROGRESS_DOWNLOAD,_m(o))};var s=t.file;s&&(e.upload.onprogress=function(o){t.emitter.emit(oh.EVENT_PROGRESS_UPLOAD,_m(o))}),e.onerror=function(o){n(o)},e.onabort=function(){var o=new gm({request:t,type:oh.ERROR_REQUEST_ABORTED});n(o)},e.onload=function(){if(delete tl[t.id],e.status<200||e.status>=400){var o=new gm({request:t,body:e.response,statusCode:e.status});n(o);return}i(e)};var r=t.body;typeof r=="string"?e.send(r):r?e.send(JSON.stringify(r)):s?e.send(s):e.send(),tl[t.id]=e}).then(function(i){return _B(t,i)})}function Cb(t,e){var i=t.url(e),n=new window.XMLHttpRequest;return n.open(t.method,i),Object.keys(t.headers).forEach(function(s){n.setRequestHeader(s,t.headers[s])}),n}function mB(t){return Promise.resolve().then(function(){var e=Cb(t,t.client.accessToken);return Rb(t,e)})}var yB={browserAbort:gB,sendRequestXhr:Rb,browserSend:mB,createRequestXhr:Cb},il={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */il.exports;(function(t,e){(function(i){var n=e,s=t&&t.exports==n&&t,r=typeof cr=="object"&&cr;(r.global===r||r.window===r)&&(i=r);var o=function(p){this.message=p};o.prototype=new Error,o.prototype.name="InvalidCharacterError";var a=function(p){throw new o(p)},c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=/[\t\n\f\r ]/g,u=function(p){p=String(p).replace(l,"");var g=p.length;g%4==0&&(p=p.replace(/==?$/,""),g=p.length),(g%4==1||/[^+a-zA-Z0-9/]/.test(p))&&a("Invalid character: the string to be decoded is not correctly encoded.");for(var _=0,m,b,w="",S=-1;++S<g;)b=c.indexOf(p.charAt(S)),m=_%4?m*64+b:b,_++%4&&(w+=String.fromCharCode(255&m>>(-2*_&6)));return w},h=function(p){p=String(p),/[^\0-\xFF]/.test(p)&&a("The string to be encoded contains characters outside of the Latin1 range.");for(var g=p.length%3,_="",m=-1,b,w,S,R,M=p.length-g;++m<M;)b=p.charCodeAt(m)<<16,w=p.charCodeAt(++m)<<8,S=p.charCodeAt(++m),R=b+w+S,_+=c.charAt(R>>18&63)+c.charAt(R>>12&63)+c.charAt(R>>6&63)+c.charAt(R&63);return g==2?(b=p.charCodeAt(m)<<8,w=p.charCodeAt(++m),R=b+w,_+=c.charAt(R>>10)+c.charAt(R>>4&63)+c.charAt(R<<2&63)+"="):g==1&&(R=p.charCodeAt(m),_+=c.charAt(R>>2)+c.charAt(R<<4&63)+"=="),_},f={encode:h,decode:u,version:"0.1.0"};if(n&&!n.nodeType)if(s)s.exports=f;else for(var d in f)f.hasOwnProperty(d)&&(n[d]=f[d]);else i.base64=f})(cr)})(il,il.exports);var vB=il.exports,bB=vB,ah={};function wB(t){if(ah[t])return ah[t];var e=t.split("."),i=e[0],n=e[1];if(!n)throw new Error("Invalid token");var s=TB(n),r={usage:i,user:s.u};return Wn(s,"a")&&(r.authorization=s.a),Wn(s,"exp")&&(r.expires=s.exp*1e3),Wn(s,"iat")&&(r.created=s.iat*1e3),Wn(s,"scopes")&&(r.scopes=s.scopes),Wn(s,"client")&&(r.client=s.client),Wn(s,"ll")&&(r.lastLogin=s.ll),Wn(s,"iu")&&(r.impersonator=s.iu),ah[t]=r,r}function TB(t){try{return JSON.parse(bB.decode(t))}catch{throw new Error("Invalid token")}}function Wn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var xb=wB,Pb={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(i=!1));function s(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function r(c,l,u,h,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new s(u,h||c,f),p=i?i+l:l;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],d]:c._events[p].push(d):(c._events[p]=d,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new n:delete c._events[l]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,h;if(this._eventsCount===0)return l;for(h in u=this._events)e.call(u,h)&&l.push(i?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=i?i+l:l,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,d=h.length,p=new Array(d);f<d;f++)p[f]=h[f].fn;return p},a.prototype.listenerCount=function(l){var u=i?i+l:l,h=this._events[u];return h?h.fn?1:h.length:0},a.prototype.emit=function(l,u,h,f,d,p){var g=i?i+l:l;if(!this._events[g])return!1;var _=this._events[g],m=arguments.length,b,w;if(_.fn){switch(_.once&&this.removeListener(l,_.fn,void 0,!0),m){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,u),!0;case 3:return _.fn.call(_.context,u,h),!0;case 4:return _.fn.call(_.context,u,h,f),!0;case 5:return _.fn.call(_.context,u,h,f,d),!0;case 6:return _.fn.call(_.context,u,h,f,d,p),!0}for(w=1,b=new Array(m-1);w<m;w++)b[w-1]=arguments[w];_.fn.apply(_.context,b)}else{var S=_.length,R;for(w=0;w<S;w++)switch(_[w].once&&this.removeListener(l,_[w].fn,void 0,!0),m){case 1:_[w].fn.call(_[w].context);break;case 2:_[w].fn.call(_[w].context,u);break;case 3:_[w].fn.call(_[w].context,u,h);break;case 4:_[w].fn.call(_[w].context,u,h,f);break;default:if(!b)for(R=1,b=new Array(m-1);R<m;R++)b[R-1]=arguments[R];_[w].fn.apply(_[w].context,b)}}return!0},a.prototype.on=function(l,u,h){return r(this,l,u,h,!1)},a.prototype.once=function(l,u,h){return r(this,l,u,h,!0)},a.prototype.removeListener=function(l,u,h,f){var d=i?i+l:l;if(!this._events[d])return this;if(!u)return o(this,d),this;var p=this._events[d];if(p.fn)p.fn===u&&(!f||p.once)&&(!h||p.context===h)&&o(this,d);else{for(var g=0,_=[],m=p.length;g<m;g++)(p[g].fn!==u||f&&!p[g].once||h&&p[g].context!==h)&&_.push(p[g]);_.length?this._events[d]=_.length===1?_[0]:_:o(this,d)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=i?i+l:l,this._events[u]&&o(this,u)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a})(Pb);var EB=Pb.exports;function SB(t){return t.map(encodeURIComponent).join(",")}function Mb(t){return Array.isArray(t)?SB(t):encodeURIComponent(String(t))}function Ib(t,e,i){if(i===!1||i===null)return t;var n=/\?/.test(t)?"&":"?",s=encodeURIComponent(e);return i!==void 0&&i!==""&&i!==!0&&(s+="="+Mb(i)),""+t+n+s}function AB(t,e){if(!e)return t;var i=t;return Object.keys(e).forEach(function(n){var s=e[n];s!==void 0&&(Array.isArray(s)&&(s=s.filter(function(r){return r!=null}).join(",")),i=Ib(i,n,s))}),i}function RB(t,e){if(!e||t.slice(0,4)==="http")return t;var i=t[0]==="/"?"":"/";return""+e.replace(/\/$/,"")+i+t}function CB(t,e){return e?t.replace(/\/:([a-zA-Z0-9]+)/g,function(i,n){var s=e[n];if(s===void 0)throw new Error("Unspecified route parameter "+n);var r=Mb(s);return"/"+r}):t}var xB={appendQueryObject:AB,appendQueryParam:Ib,prependOrigin:RB,interpolateRouteParams:CB},PB=xb,Hd=Ur,MB=EB,nc=xB,mm=eu,IB=1;function Pn(t,e){if(!t)throw new Error("MapiRequest requires a client");if(!e||!e.path||!e.method)throw new Error("MapiRequest requires an options object with path and method properties");var i={};e.body&&(i["content-type"]="application/json");var n=Hd(i,e.headers),s=Object.keys(n).reduce(function(r,o){return r[o.toLowerCase()]=n[o],r},{});this.id=IB++,this._options=e,this.emitter=new MB,this.client=t,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=e.path,this.method=e.method,this.origin=e.origin||t.origin,this.query=e.query||{},this.params=e.params||{},this.body=e.body||null,this.file=e.file||null,this.encoding=e.encoding||"utf8",this.sendFileAs=e.sendFileAs||null,this.headers=s}Pn.prototype.url=function(e){var i=nc.prependOrigin(this.path,this.origin);i=nc.appendQueryObject(i,this.query);var n=this.params,s=e??this.client.accessToken;if(s){i=nc.appendQueryParam(i,"access_token",s);var r=PB(s).user;n=Hd({ownerId:r},n)}return i=nc.interpolateRouteParams(i,n),i};Pn.prototype.send=function(){var e=this;if(e.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return e.sent=!0,e.client.sendRequest(e).then(function(i){return e.response=i,e.emitter.emit(mm.EVENT_RESPONSE,i),i},function(i){throw e.error=i,e.emitter.emit(mm.EVENT_ERROR,i),i})};Pn.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Pn.prototype.eachPage=function(e){var i=this;function n(o){function a(){delete i._nextPageRequest;var c=o.nextPage();c&&(i._nextPageRequest=c,r(c))}e(null,o,a)}function s(o){e(o,null,function(){})}function r(o){o.send().then(n,s)}r(this)};Pn.prototype.clone=function(){return this._extend()};Pn.prototype._extend=function(e){var i=Hd(this._options,e);return new Pn(this.client,i)};var OB=Pn,kB=xb,NB=OB,DB=eu;function Ob(t){if(!t||!t.accessToken)throw new Error("Cannot create a client without an access token");kB(t.accessToken),this.accessToken=t.accessToken,this.origin=t.origin||DB.API_ORIGIN}Ob.prototype.createRequest=function(e){return new NB(this,e)};var kb=Ob,Nb=yB,Db=kb;function kr(t){Db.call(this,t)}kr.prototype=Object.create(Db.prototype);kr.prototype.constructor=kr;kr.prototype.sendRequest=Nb.browserSend;kr.prototype.abortRequest=Nb.browserAbort;function FB(t){return new kr(t)}var Fb=FB,LB=Fb,BB=LB,UB=Object.prototype.toString,zB=function(t){var e;return UB.call(t)==="[object Object]"&&(e=Object.getPrototypeOf(t),e===null||e===Object.getPrototypeOf({}))},VB=zB,jB=Ur,Lb="value",ch=`
  `,qe={};qe.assert=function(t,e){return e=e||{},function(i){var n=Mn(t,i);if(n){var s=Wd(n,e);throw e.apiName&&(s=e.apiName+": "+s),new Error(s)}}};qe.shape=function(e){var i=XB(e);return function(s){var r=Mn(qe.plainObject,s);if(r)return r;for(var o,a,c=[],l=0;l<i.length;l++)o=i[l].key,a=i[l].value,r=Mn(a,s[o]),r&&c.push([o].concat(r));return c.length<2?c[0]:function(u){c=c.map(function(d){var p=d[0],g=Wd(d,u).split(`
`).join(ch);return"- "+p+": "+g});var h=u.path.join("."),f=h===Lb?"":" of "+h;return"The following properties"+f+" have invalid values:"+ch+c.join(ch)}}};qe.strictShape=function(e){var i=qe.shape(e);return function(s){var r=i(s);if(r)return r;var o=Object.keys(s).reduce(function(a,c){return e[c]===void 0&&a.push(c),a},[]);if(o.length!==0)return function(){return"The following keys are invalid: "+o.join(", ")}}};qe.arrayOf=function(e){return Bb(e)};qe.tuple=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return Bb(e)};function Bb(t){var e=Array.isArray(t),i=function(n){return e?t[n]:t};return function(s){var r=Mn(qe.plainArray,s);if(r)return r;if(e&&s.length!==t.length)return"an array with "+t.length+" items";for(var o=0;o<s.length;o++)if(r=Mn(i(o),s[o]),r)return[o].concat(r)}}qe.required=function(e){function i(n){return n==null?function(s){return Ub(s,zb(s.path)?"cannot be undefined/null.":"is required.")}:e.apply(this,arguments)}return i.__required=!0,i};qe.oneOfType=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(n){var s=e.map(function(r){return Mn(r,n)}).filter(Boolean);if(s.length===e.length)return s.every(function(r){return r.length===1&&typeof r[0]=="string"})?$B(s.map(function(r){return r[0]})):s.reduce(function(r,o){return o.length>r.length?o:r})}};qe.equal=function(e){return function(n){if(n!==e)return JSON.stringify(e)}};qe.oneOf=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),i=e.map(function(n){return qe.equal(n)});return qe.oneOfType.apply(this,i)};qe.range=function(e){var i=e[0],n=e[1];return function(r){var o=Mn(qe.number,r);if(o||r<i||r>n)return"number between "+i+" & "+n+" (inclusive)"}};qe.any=function(){};qe.boolean=function(e){if(typeof e!="boolean")return"boolean"};qe.number=function(e){if(typeof e!="number")return"number"};qe.plainArray=function(e){if(!Array.isArray(e))return"array"};qe.plainObject=function(e){if(!VB(e))return"object"};qe.string=function(e){if(typeof e!="string")return"string"};qe.func=function(e){if(typeof e!="function")return"function"};function Mn(t,e){if(!(e==null&&!t.hasOwnProperty("__required"))){var i=t(e);if(i)return Array.isArray(i)?i:[i]}}function Wd(t,e){var i=t.length,n=t[i-1],s=t.slice(0,i-1);return s.length===0&&(s=[Lb]),e=jB(e,{path:s}),typeof n=="function"?n(e):Ub(e,HB(n))}function $B(t){return t.length<2?t[0]:t.length===2?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t.slice(-1)}function HB(t){return"must be "+WB(t)+"."}function WB(t){return/^an? /.test(t)?t:/^[aeiou]/i.test(t)?"an "+t:/^[a-z]/i.test(t)?"a "+t:t}function Ub(t,e){var i=zb(t.path),n=t.path.join(".")+" "+e,s=i?"Item at position ":"";return s+n}function zb(t){return typeof t[t.length-1]=="number"||typeof t[0]=="number"}function XB(t){return Object.keys(t||{}).map(function(e){return{key:e,value:t[e]}})}qe.validate=Mn;qe.processMessage=Wd;var qB=qe,YB=Ur,_r=qB;function KB(t){if(typeof window<"u")return t instanceof cr.Blob||t instanceof cr.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof t=="string"||t.pipe!==void 0))return"Filename or Readable stream"}function ZB(t,e){return _r.assert(_r.strictShape(t),e)}function GB(t){var e="date";if(typeof t=="boolean")return e;try{var i=new Date(t);if(i.getTime&&isNaN(i.getTime()))return e}catch{return e}}function JB(t){return _r.tuple(_r.number,_r.number)(t)}var QB=YB(_r,{file:KB,date:GB,coordinates:JB,assertShape:ZB});function e5(t,e){var i=function(n,s){return e.indexOf(n)!==-1&&s!==void 0};return typeof e=="function"&&(i=e),Object.keys(t).filter(function(n){return i(n,t[n])}).reduce(function(n,s){return n[s]=t[s],n},{})}var t5=e5;function i5(t,e){return Object.keys(t).reduce(function(i,n){return i[n]=e(n,t[n]),i},{})}var n5=i5,s5=n5;function r5(t){return s5(t,function(e,i){return typeof i=="boolean"?JSON.stringify(i):i})}var o5=r5,a5=kb,c5=Fb;function l5(t){return function(e){var i;a5.prototype.isPrototypeOf(e)?i=e:i=c5(e);var n=Object.create(t);return n.client=i,n}}var u5=l5,Vb=Ur,Te=QB,nl=t5,jb=o5,h5=u5,Xd={},$b=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Xd.forwardGeocode=function(t){Te.assertShape({query:Te.required(Te.string),mode:Te.oneOf("mapbox.places","mapbox.places-permanent"),countries:Te.arrayOf(Te.string),proximity:Te.oneOf(Te.coordinates,"ip"),types:Te.arrayOf(Te.oneOf($b)),autocomplete:Te.boolean,bbox:Te.arrayOf(Te.number),limit:Te.number,language:Te.arrayOf(Te.string),routing:Te.boolean,fuzzyMatch:Te.boolean,worldview:Te.string})(t),t.mode=t.mode||"mapbox.places";var e=jb(Vb({country:t.countries},nl(t,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:nl(t,["mode","query"]),query:e})};Xd.reverseGeocode=function(t){Te.assertShape({query:Te.required(Te.coordinates),mode:Te.oneOf("mapbox.places","mapbox.places-permanent"),countries:Te.arrayOf(Te.string),types:Te.arrayOf(Te.oneOf($b)),bbox:Te.arrayOf(Te.number),limit:Te.number,language:Te.arrayOf(Te.string),reverseMode:Te.oneOf("distance","score"),routing:Te.boolean,worldview:Te.string})(t),t.mode=t.mode||"mapbox.places";var e=jb(Vb({country:t.countries},nl(t,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:nl(t,["mode","query"]),query:e})};var f5=h5(Xd);let d5="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Hb=t=>crypto.getRandomValues(new Uint8Array(t)),Wb=(t,e,i)=>{let n=(2<<Math.log(t.length-1)/Math.LN2)-1,s=-~(1.6*n*e/t.length);return(r=e)=>{let o="";for(;;){let a=i(s),c=s;for(;c--;)if(o+=t[a[c]&n]||"",o.length===r)return o}}},p5=(t,e=21)=>Wb(t,e,Hb),g5=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,i)=>(i&=63,i<36?e+=i.toString(36):i<62?e+=(i-26).toString(36).toUpperCase():i>62?e+="-":e+="_",e),"");const _5=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:p5,customRandom:Wb,nanoid:g5,random:Hb,urlAlphabet:d5},Symbol.toStringTag,{value:"Module"})),m5=aw(_5);var y5=m5.nanoid;function Xb(t){this.origin=t.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=t.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=t,this.send=this.send.bind(this),this.countries=t.countries?t.countries.split(","):null,this.types=t.types?t.types.split(","):null,this.bbox=t.bbox?t.bbox:null,this.language=t.language?t.language.split(","):null,this.limit=t.limit?+t.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(t),this.eventQueue=new Array,this.flushInterval=t.flushInterval||1e3,this.maxQueueSize=t.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}Xb.prototype={select:function(t,e){var i=this.getSelectedIndex(t,e),n=this.getEventPayload("search.select",e);if(n.resultIndex=i,n.resultPlaceName=t.place_name,n.resultId=t.id,!(i===this.lastSentIndex&&n.queryString===this.lastSentInput||i==-1)&&(this.lastSentIndex=i,this.lastSentInput=n.queryString,!!n.queryString))return this.push(n)},start:function(t){var e=this.getEventPayload("search.start",t);if(e.queryString)return this.push(e)},keyevent:function(t,e){if(t.key&&!(t.metaKey||[9,27,37,39,13,38,40].indexOf(t.keyCode)!==-1)){var i=this.getEventPayload("search.keystroke",e);if(i.lastAction=t.key,!!i.queryString)return this.push(i)}},send:function(t,e){if(!this.enableEventLogging)return e?e():void 0;var i=this.getRequestOptions(t);this.request(i,(function(n){if(n)return this.handleError(n,e);if(e)return e()}).bind(this))},getRequestOptions:function(t){Array.isArray(t)||(t=[t]);var e={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return e},getEventPayload:function(t,e){var i;e.options.proximity?typeof e.options.proximity=="object"?i=[e.options.proximity.longitude,e.options.proximity.latitude]:e.options.proximity==="ip"?i=[999,999]:i=e.options.proximity:i=null;var n=e._map?e._map.getZoom():void 0,s={event:t,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:e.options.autocomplete,fuzzyMatch:e.options.fuzzyMatch,proximity:i,limit:e.options.limit,routing:e.options.routing,worldview:e.options.worldview,mapZoom:n,keyboardLocale:this.locale};return t==="search.select"?s.queryString=e.inputString:t!="search.select"&&e._inputEl?s.queryString=e._inputEl.value:s.queryString=e.inputString,s},request:function(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(this.readyState==4)return this.status==204?e(null):e(this.statusText)},i.open(t.method,t.host+"/"+t.path,!0);for(var n in t.headers){var s=t.headers[n];i.setRequestHeader(n,s)}i.send(t.body)},handleError:function(t,e){if(e)return e(t)},generateSessionID:function(){return y5()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(t,e){if(e._typeahead){var i=e._typeahead.data,n=t.id,s=i.map(function(o){return o.id}),r=s.indexOf(n);return r}},shouldEnableLogging:function(t){return!(t.enableEventLogging===!1||t.origin&&t.origin!=="https://api.mapbox.com"||t.localGeocoder||t.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(t,e){this.eventQueue.push(t),(this.eventQueue.length>=this.maxQueueSize||e)&&this.flush()},remove:function(){this.flush()}};var v5=Xb,b5={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},w5={placeholder:b5},qb={exports:{}};(function(t){(function(e,i,n){t.exports?t.exports=n():e[i]=n()})(cr,"subtag",function(){var e="",i=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(c){return c.match(i)||[]}function s(c){return n(c).filter(function(l,u){return l&&u})}function r(c){return c=n(c),{language:c[1]||e,extlang:c[2]||e,script:c[3]||e,region:c[4]||e}}function o(c,l,u){Object.defineProperty(c,l,{value:u,enumerable:!0})}function a(c,l,u){function h(f){return n(f)[c]||e}o(h,"pattern",l),o(r,u,h)}return a(1,/^[a-zA-Z]{2,3}$/,"language"),a(2,/^[a-zA-Z]{3}$/,"extlang"),a(3,/^[a-zA-Z]{4}$/,"script"),a(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),o(r,"split",s),r})})(qb);var T5=qb.exports;function Yb(){}Yb.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const t={enableHighAccuracy:!0};return new Promise(function(e,i){window.navigator.geolocation.getCurrentPosition(e,i,t)})}};var E5=Yb;function S5(t,e){const i=Kb(t),n=["address","street","place","country"];var s;if(typeof e=="function")return e(i);const r=n.indexOf(e);return r===-1?s=n:s=n.slice(r),s.reduce(function(o,a){return i[a]?(o!==""&&(o=o+", "),o+i[a]):o},"")}function Kb(t){const e=t.address||"",i=t.text||"",n=t.place_name||"",r={address:n.split(",")[0],houseNumber:e,street:i,placeName:n};return t.context.forEach(function(o){const a=o.id.split(".")[0];r[a]=o.text}),r}const A5=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var R5={transformFeatureToGeolocationText:S5,getAddressInfo:Kb,REVERSE_GEOCODE_COORD_RGX:A5},C5=qL,x5=cw,Yn=Ur,P5=eB.EventEmitter,ym=tB,lh=BB,uh=f5,M5=v5,I5=w5,O5=T5,k5=E5,vm=R5;const ln={FORWARD:0,LOCAL:1,REVERSE:2};function N5(){var t=document.createElement("div");return t.className="mapboxgl-ctrl-geocoder--powered-by",t.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',t}function Zb(t){this._eventEmitter=new P5,this.options=Yn({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new k5}Zb.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(t){return t.place_name},render:function(t){var e=t.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"}},addTo:function(t){function e(i,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const s=i.onAdd();n.appendChild(s)}if(t._controlContainer)t.addControl(this);else if(t instanceof HTMLElement)e(this,t);else if(typeof t=="string"){const i=document.querySelectorAll(t);if(i.length===0)throw new Error("Element ",t,"not found.");if(i.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,i[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(t){if(t&&typeof t!="string"&&(this._map=t),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=uh(lh({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new M5(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var i=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",x5(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(l){this.eventManager.keyevent(l,this)}).bind(this));var n=document.createElement("div");n.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var s=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(s),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),e.appendChild(i),e.appendChild(this._inputEl),e.appendChild(n),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var r=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(r),n.appendChild(this._geolocateEl),this._showGeolocateButton()}var o=this._typeahead=new C5(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),o.getItemValue=this.options.getItemValue;var a=o.list.draw,c=this._footerNode=N5();return o.list.draw=function(){a.call(this),c.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),c.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(c)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),e},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(t){this._hideLoadingIcon();const e={geometry:{type:"Point",coordinates:[t.coords.longitude,t.coords.latitude]}};this._handleMarker(e),this._fly(e),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(e),this._showClearButton(),this.fresh=!1;const i={limit:1,language:[this.options.language],query:e.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const n=e.geometry.coordinates[0]+","+e.geometry.coordinates[1];this._setInputValue(n),this._eventEmitter.emit("result",{result:e})}else this.geocoderService.reverseGeocode(i).send().then((function(n){const s=n.body.features[0];if(s){const r=vm.transformFeatureToGeolocationText(s,this.options.addressAccuracy);this._setInputValue(r),s.user_coordinates=e.geometry.coordinates,this._eventEmitter.emit("result",{result:s})}else this._eventEmitter.emit("result",{result:{user_coordinates:e.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(t){t.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+t),i.setAttribute("viewBox","0 0 18 18"),i.setAttribute("xml:space","preserve"),i.setAttribute("width",18),i.setAttribute("height",18),i.innerHTML=e,i},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(t){this._inputEl.value=t,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(t){var e=(t.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this._geocode(e)},_onKeyDown:function(t){var e=27,i=9;if(t.keyCode===e&&this.options.clearAndBlurOnEsc)return this._clear(t),this._inputEl.blur();var n=t.target&&t.target.shadowRoot?t.target.shadowRoot.activeElement:t.target,s=n?n.value:"";if(!s)return this.fresh=!0,t.keyCode!==i&&this.clear(t),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(t.metaKey||[i,e,37,39,13,38,40].indexOf(t.keyCode)!==-1)&&n.value.length>=this.options.minLength&&this._geocode(n.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(t){this.options.clearOnBlur&&this._clearOnBlur(t),this.options.collapsed&&this._collapse()},_onChange:function(){var t=this._typeahead.selected;t&&JSON.stringify(t)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(t),this.options.marker&&this._mapboxgl&&this._handleMarker(t),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(t),this._eventEmitter.emit("result",{result:t}),this.eventManager.select(t,this))},_fly:function(t){var e;if(t.properties&&ym[t.properties.short_code])e=Yn({},this.options.flyTo),this._map&&this._map.fitBounds(ym[t.properties.short_code].bbox,e);else if(t.bbox){var i=t.bbox;e=Yn({},this.options.flyTo),this._map&&this._map.fitBounds([[i[0],i[1]],[i[2],i[3]]],e)}else{var n={zoom:this.options.zoom};e=Yn({},n,this.options.flyTo),t.center?e.center=t.center:t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&(e.center=t.geometry.coordinates),this._map&&this._map.flyTo(e)}},_requestType:function(t,e){var i;return t.localGeocoderOnly?i=ln.LOCAL:t.reverseGeocode&&vm.REVERSE_GEOCODE_COORD_RGX.test(e)?i=ln.REVERSE:i=ln.FORWARD,i},_setupConfig:function(t,e){const i=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],n=/[\s,]+/;var s=this,r=i.reduce(function(a,c){if(s.options[c]===void 0||s.options[c]===null)return a;["countries","types","language"].indexOf(c)>-1?a[c]=s.options[c].split(n):a[c]=s.options[c];const l=typeof s.options[c].longitude=="number"&&typeof s.options[c].latitude=="number";if(c==="proximity"&&l){const u=s.options[c].longitude,h=s.options[c].latitude;a[c]=[u,h]}return a},{});switch(t){case ln.REVERSE:{var o=e.split(n).map(function(a){return parseFloat(a,10)});s.options.flipCoordinates||o.reverse(),r.types&&r.types[0],r=Yn(r,{query:o,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(a){a in r&&delete r[a]})}break;case ln.FORWARD:{const a=e.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(a)&&(e=e.replace(/,/g," ")),r=Yn(r,{query:e})}break}return r},_geocode:function(t){this.inputString=t,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:t});const e=this._requestType(this.options,t),i=this._setupConfig(e,t);var n;switch(e){case ln.LOCAL:n=Promise.resolve();break;case ln.FORWARD:n=this.geocoderService.forwardGeocode(i).send();break;case ln.REVERSE:n=this.geocoderService.reverseGeocode(i).send();break}var s=this.options.localGeocoder?this.options.localGeocoder(t)||[]:[],r=[],o=null;return n.catch((function(a){o=a}).bind(this)).then((function(a){this._hideLoadingIcon();var c={};return a?a.statusCode=="200"&&(c=a.body,c.request=a.request,c.headers=a.headers):c={type:"FeatureCollection",features:[]},c.config=i,this.fresh&&(this.eventManager.start(this),this.fresh=!1),c.features=c.features?s.concat(c.features):s,this.options.externalGeocoder?(r=this.options.externalGeocoder(t,c.features)||Promise.resolve([]),r.then(function(l){return c.features=c.features?l.concat(c.features):l,c},function(){return c})):c}).bind(this)).then((function(a){if(o)throw o;this.options.filter&&a.features.length&&(a.features=a.features.filter(this.options.filter)),a.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",a),this._typeahead.update(a.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",a))}).bind(this)).catch((function(a){this._hideLoadingIcon(),this._hideAttribution(),s.length&&this.options.localGeocoder||r.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(s)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:s}),this._eventEmitter.emit("error",{error:a})}).bind(this)),n},_clear:function(t){t&&t.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(t){this._clear(t),this._inputEl.focus()},_clearOnBlur:function(t){var e=this;t.relatedTarget&&e._clear(t)},_onQueryResult:function(t){var e=t.body;if(e.features.length){var i=e.features[0];this._typeahead.selected=i,this._inputEl.value=i.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var t=this._map.getCenter().wrap();this.setProximity({longitude:t.lng,latitude:t.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(t){return this._geocode(t).then(this._onQueryResult),this},_renderError:function(){var t="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(t)},_renderLocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(t)},_renderNoResults:function(){var t="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(t)},_renderUserDeniedGeolocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(t)},_renderMessage:function(t){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(t)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var t=this.options.language.split(",")[0],e=O5.language(t),i=I5.placeholder[e];if(i)return i}return"Search"},setInput:function(t,e){return e===void 0&&(e=!1),this._inputEl.value=t,this._typeahead.selected=null,this._typeahead.clear(),t.length>=this.options.minLength&&(e?this._geocode(t):this._onChange()),this},setProximity:function(t,e=!0){return this.options.proximity=t,e&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(t){return t&&typeof t=="function"&&(this._typeahead.render=t),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(t){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=t||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(t){return this.options.zoom=t,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(t){return this.options.flyTo=t,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(t){return this.options.placeholder=t||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(t){return this.options.bbox=t,this},getCountries:function(){return this.options.countries},setCountries:function(t){return this.options.countries=t,this},getTypes:function(){return this.options.types},setTypes:function(t){return this.options.types=t,this},getMinLength:function(){return this.options.minLength},setMinLength:function(t){return this.options.minLength=t,this._typeahead&&(this._typeahead.options.minLength=t),this},getLimit:function(){return this.options.limit},setLimit:function(t){return this.options.limit=t,this._typeahead&&(this._typeahead.options.limit=t),this},getFilter:function(){return this.options.filter},setFilter:function(t){return this.options.filter=t,this},setOrigin:function(t){return this.options.origin=t,this.geocoderService=uh(lh({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(t){return this.options.accessToken=t,this.geocoderService=uh(lh({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(t){return this.options.autocomplete=t,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(t){return this.options.fuzzyMatch=t,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(t){return this.options.routing=t,this},getRouting:function(){return this.options.routing},setWorldview:function(t){return this.options.worldview=t,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(t){if(this._map){this._removeMarker();var e={color:"#4668F2"},i=Yn({},e,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(i),t.center?this.mapMarker.setLngLat(t.center).addTo(this._map):t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&this.mapMarker.setLngLat(t.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(t,e){return this._eventEmitter.on(t,e),this},off:function(t,e){return this._eventEmitter.removeListener(t,e),this.eventManager.remove(),this}};var D5=Zb;const F5=Yf(D5);function bm(t,e,i){const n=t.slice();return n[120]=e[i],n}function wm(t,e,i){const n=t.slice();return n[123]=e[i],n[125]=i,n}function Tm(t){let e,i,n="Close",s,r,o,a="↗️ Google Maps",c,l,u,h,f,d,p,g=t[2]&&!t[9]&&Em(t),_=(!t[2]||t[9])&&Sm(t);return{c(){e=H("div"),i=H("button"),i.textContent=n,s=ae(),r=H("a"),o=H("button"),o.textContent=a,l=ae(),g&&g.c(),u=ae(),_&&_.c(),this.h()},l(m){e=W(m,"DIV",{class:!0});var b=se(e);i=W(b,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(i)!=="svelte-ylojzz"&&(i.textContent=n),s=ce(b),r=W(b,"A",{target:!0,href:!0});var w=se(r);o=W(w,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(o)!=="svelte-1du5rck"&&(o.textContent=a),w.forEach(L),l=ce(b),g&&g.l(b),u=ce(b),_&&_.l(b),b.forEach(L),this.h()},h(){O(i,"class","three-d-close svelte-10su6yg"),O(o,"class","maps-link svelte-10su6yg"),O(r,"target","_blank"),O(r,"href",c="http://maps.google.com/maps?q="+t[22][1]+","+t[22][0]),O(e,"class","three-d svelte-10su6yg"),_n(e,"show3D",t[9])},m(m,b){oe(m,e,b),U(e,i),U(e,s),U(e,r),U(r,o),U(e,l),g&&g.m(e,null),U(e,u),_&&_.m(e,null),f=!0,d||(p=gt(i,"click",t[45]),d=!0)},p(m,b){(!f||b[0]&4194304&&c!==(c="http://maps.google.com/maps?q="+m[22][1]+","+m[22][0]))&&O(r,"href",c),m[2]&&!m[9]?g?g.p(m,b):(g=Em(m),g.c(),g.m(e,u)):g&&(g.d(1),g=null),!m[2]||m[9]?_?(_.p(m,b),b[0]&516&&ue(_,1)):(_=Sm(m),_.c(),ue(_,1),_.m(e,null)):_&&(ei(),Se(_,1,1,()=>{_=null}),ti()),(!f||b[0]&512)&&_n(e,"show3D",m[9])},i(m){f||(ue(_),m&&(h||In(()=>{h=qf(e,zi,{y:-20,duration:500}),h.start()})),f=!0)},o(m){Se(_),f=!1},d(m){m&&L(e),g&&g.d(),_&&_.d(),d=!1,p()}}}function Em(t){let e,i="Show 3D (experimental)",n,s;return{c(){e=H("button"),e.textContent=i,this.h()},l(r){e=W(r,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(e)!=="svelte-1gimkf0"&&(e.textContent=i),this.h()},h(){O(e,"class","show-3d-link maps-link svelte-10su6yg")},m(r,o){oe(r,e,o),n||(s=gt(e,"click",t[46]),n=!0)},p:pt,d(r){r&&L(e),n=!1,s()}}}function Sm(t){let e,i="Explore by Pan and Zooming",n,s,r;return s=new XD({props:{coords:t[22]}}),{c(){e=H("p"),e.textContent=i,n=ae(),hs(s.$$.fragment),this.h()},l(o){e=W(o,"P",{class:!0,"data-svelte-h":!0}),Re(e)!=="svelte-w0hcp3"&&(e.textContent=i),n=ce(o),fs(s.$$.fragment,o),this.h()},h(){O(e,"class","instructions svelte-10su6yg")},m(o,a){oe(o,e,a),oe(o,n,a),ds(s,o,a),r=!0},p(o,a){const c={};a[0]&4194304&&(c.coords=o[22]),s.$set(c)},i(o){r||(ue(s.$$.fragment,o),r=!0)},o(o){Se(s.$$.fragment,o),r=!1},d(o){o&&(L(e),L(n)),ps(s,o)}}}function Am(t){let e,i,n,s,r=t[25]&&t[18]&&Rm(t),o=t[24]&&Cm(t),a=t[26]&&Pm(t);return{c(){e=H("div"),r&&r.c(),i=ae(),o&&o.c(),n=ae(),a&&a.c(),this.h()},l(c){e=W(c,"DIV",{class:!0,style:!0});var l=se(e);r&&r.l(l),i=ce(l),o&&o.l(l),n=ce(l),a&&a.l(l),l.forEach(L),this.h()},h(){O(e,"class","loading-overlay svelte-10su6yg"),Ne(e,"display",(t[21],""))},m(c,l){oe(c,e,l),r&&r.m(e,null),U(e,i),o&&o.m(e,null),U(e,n),a&&a.m(e,null),s=!0},p(c,l){c[25]&&c[18]?r?(r.p(c,l),l[0]&33816576&&ue(r,1)):(r=Rm(c),r.c(),ue(r,1),r.m(e,i)):r&&(ei(),Se(r,1,1,()=>{r=null}),ti()),c[24]?o?(o.p(c,l),l[0]&16777216&&ue(o,1)):(o=Cm(c),o.c(),ue(o,1),o.m(e,n)):o&&(ei(),Se(o,1,1,()=>{o=null}),ti()),c[26]?a?(a.p(c,l),l[0]&67108864&&ue(a,1)):(a=Pm(c),a.c(),ue(a,1),a.m(e,null)):a&&(ei(),Se(a,1,1,()=>{a=null}),ti()),(!s||l[0]&2097152)&&Ne(e,"display",(c[21],""))},i(c){s||(ue(r),ue(o),ue(a),s=!0)},o(c){Se(r),Se(o),Se(a),s=!1},d(c){c&&L(e),r&&r.d(),o&&o.d(),a&&a.d()}}}function Rm(t){let e,i,n;return i=new FD({props:{sizes:t[17],geoJSON:t[25],courtData:t[18],viewportHeight:t[0],viewportWidth:t[1]}}),i.$on("finished",t[43]),{c(){e=H("div"),hs(i.$$.fragment),this.h()},l(s){e=W(s,"DIV",{class:!0});var r=se(e);fs(i.$$.fragment,r),r.forEach(L),this.h()},h(){O(e,"class","world-map svelte-10su6yg")},m(s,r){oe(s,e,r),ds(i,e,null),n=!0},p(s,r){const o={};r[0]&131072&&(o.sizes=s[17]),r[0]&33554432&&(o.geoJSON=s[25]),r[0]&262144&&(o.courtData=s[18]),r[0]&1&&(o.viewportHeight=s[0]),r[0]&2&&(o.viewportWidth=s[1]),i.$set(o)},i(s){n||(ue(i.$$.fragment,s),n=!0)},o(s){Se(i.$$.fragment,s),n=!1},d(s){s&&L(e),ps(i)}}}function Cm(t){let e,i,n,s=!t[26]&&xm(t);return{c(){e=H("div"),s&&s.c(),this.h()},l(r){e=W(r,"DIV",{class:!0});var o=se(e);s&&s.l(o),o.forEach(L),this.h()},h(){O(e,"class","loading-text loading-start svelte-10su6yg")},m(r,o){oe(r,e,o),s&&s.m(e,null),n=!0},p(r,o){r[26]?s&&(ei(),Se(s,1,1,()=>{s=null}),ti()):s?(s.p(r,o),o[0]&67108864&&ue(s,1)):(s=xm(r),s.c(),ue(s,1),s.m(e,null))},i(r){n||(ue(s),r&&In(()=>{n&&(i||(i=Ui(e,zi,{y:20,duration:1e3,delay:500},!0)),i.run(1))}),n=!0)},o(r){Se(s),r&&(i||(i=Ui(e,zi,{y:20,duration:1e3,delay:500},!1)),i.run(0)),n=!1},d(r){r&&L(e),s&&s.d(),r&&i&&i.end()}}}function xm(t){var h,f;let e,i,n=t[34](Math.round(t[32]*((h=t[18])==null?void 0:h.length)/100)*100)+"",s,r,o=t[34]((f=t[18])==null?void 0:f.length)+"",a,c,l,u;return{c(){e=H("p"),i=Ut("Loading Satellite Imagery of "),s=Ut(n),r=Ut(" of "),a=Ut(o),c=Ut(" Basketball Courts"),this.h()},l(d){e=W(d,"P",{class:!0});var p=se(e);i=zt(p,"Loading Satellite Imagery of "),s=zt(p,n),r=zt(p," of "),a=zt(p,o),c=zt(p," Basketball Courts"),p.forEach(L),this.h()},h(){O(e,"class","every every-start svelte-10su6yg")},m(d,p){oe(d,e,p),U(e,i),U(e,s),U(e,r),U(e,a),U(e,c),u=!0},p(d,p){var g,_;(!u||p[0]&262144|p[1]&2)&&n!==(n=d[34](Math.round(d[32]*((g=d[18])==null?void 0:g.length)/100)*100)+"")&&Sn(s,n),(!u||p[0]&262144)&&o!==(o=d[34]((_=d[18])==null?void 0:_.length)+"")&&Sn(a,o)},i(d){u||(d&&In(()=>{u&&(l||(l=Ui(e,zi,{y:20,duration:1e3,delay:0},!0)),l.run(1))}),u=!0)},o(d){d&&(l||(l=Ui(e,zi,{y:20,duration:1e3,delay:0},!1)),l.run(0)),u=!1},d(d){d&&L(e),d&&l&&l.end()}}}function Pm(t){let e,i,n,s,r,o,a='<span class="svelte-10su6yg">Every Outdoor Basketball Court in the U.S.A.</span>',c,l,u='<span class="svelte-10su6yg">Help us document the stories behind the 59,507 outdoor courts in America.</span>',h,f,d;function p(m,b){return m[10]?L5:B5}let g=p(t),_=g(t);return{c(){e=H("div"),i=H("div"),n=H("a"),s=new Km(!1),r=ae(),o=H("p"),o.innerHTML=a,c=ae(),l=H("p"),l.innerHTML=u,h=ae(),_.c(),this.h()},l(m){e=W(m,"DIV",{class:!0});var b=se(e);i=W(b,"DIV",{class:!0});var w=se(i);n=W(w,"A",{href:!0,target:!0,class:!0});var S=se(n);s=Zm(S,!1),S.forEach(L),w.forEach(L),r=ce(b),o=W(b,"P",{class:!0,"data-svelte-h":!0}),Re(o)!=="svelte-1x853zu"&&(o.innerHTML=a),c=ce(b),l=W(b,"P",{class:!0,"data-svelte-h":!0}),Re(l)!=="svelte-brmps9"&&(l.innerHTML=u),h=ce(b),_.l(b),b.forEach(L),this.h()},h(){s.a=null,O(n,"href","https://pudding.cool"),O(n,"target","_blank"),O(n,"class","svelte-10su6yg"),O(i,"class","logo svelte-10su6yg"),O(o,"class","every svelte-10su6yg"),O(l,"class","every every-small svelte-10su6yg"),O(e,"class","loading-text svelte-10su6yg")},m(m,b){oe(m,e,b),U(e,i),U(i,n),s.m(tb,n),U(e,r),U(e,o),U(e,c),U(e,l),U(e,h),_.m(e,null),d=!0},p(m,b){g===(g=p(m))&&_?_.p(m,b):(_.d(1),_=g(m),_&&(_.c(),_.m(e,null)))},i(m){d||(m&&In(()=>{d&&(f||(f=Ui(e,zi,{y:20,duration:1e3,delay:500},!0)),f.run(1))}),d=!0)},o(m){m&&(f||(f=Ui(e,zi,{y:20,duration:1e3,delay:500},!1)),f.run(0)),d=!1},d(m){m&&L(e),_.d(),m&&f&&f.end()}}}function L5(t){let e,i,n="Begin Exploring",s,r;return{c(){e=H("div"),i=H("button"),i.textContent=n,this.h()},l(o){e=W(o,"DIV",{class:!0});var a=se(e);i=W(a,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(i)!=="svelte-1ibfhhu"&&(i.textContent=n),a.forEach(L),this.h()},h(){O(i,"class","start-button svelte-10su6yg"),O(e,"class","start-button-container")},m(o,a){oe(o,e,a),U(e,i),s||(r=gt(i,"click",t[47]),s=!0)},p:pt,d(o){o&&L(e),s=!1,r()}}}function B5(t){let e,i='<span class="svelte-10su6yg">Still loading...</span>';return{c(){e=H("p"),e.innerHTML=i,this.h()},l(n){e=W(n,"P",{class:!0,"data-svelte-h":!0}),Re(e)!=="svelte-cs25od"&&(e.innerHTML=i),this.h()},h(){O(e,"class","every every-small svelte-10su6yg")},m(n,s){oe(n,e,s)},p:pt,d(n){n&&L(e)}}}function Mm(t){let e,i='<p class="every every-small svelte-10su6yg"><span class="svelte-10su6yg">Loading...</span></p>',n,s;return{c(){e=H("div"),e.innerHTML=i,this.h()},l(r){e=W(r,"DIV",{class:!0,"data-svelte-h":!0}),Re(e)!=="svelte-1stijpb"&&(e.innerHTML=i),this.h()},h(){O(e,"class","waiting svelte-10su6yg")},m(r,o){oe(r,e,o),s=!0},i(r){s||(r&&In(()=>{s&&(n||(n=Ui(e,Qc,{duration:500},!0)),n.run(1))}),s=!0)},o(r){r&&(n||(n=Ui(e,Qc,{duration:500},!1)),n.run(0)),s=!1},d(r){r&&L(e),r&&n&&n.end()}}}function Im(t){let e,i;return e=new BL({props:{commentId:t[19]}}),e.$on("formSubmit",t[36]),{c(){hs(e.$$.fragment)},l(n){fs(e.$$.fragment,n)},m(n,s){ds(e,n,s),i=!0},p(n,s){const r={};s[0]&524288&&(r.commentId=n[19]),e.$set(r)},i(n){i||(ue(e.$$.fragment,n),i=!0)},o(n){Se(e.$$.fragment,n),i=!1},d(n){ps(e,n)}}}function Om(t){let e,i;return e=new $D({}),{c(){hs(e.$$.fragment)},l(n){fs(e.$$.fragment,n)},m(n,s){ds(e,n,s),i=!0},i(n){i||(ue(e.$$.fragment,n),i=!0)},o(n){Se(e.$$.fragment,n),i=!1},d(n){ps(e,n)}}}function km(t){let e,i='<p class="svelte-10su6yg">Zoom-in to Explore, like a Map!</p> <div class="finger svelte-10su6yg"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 76 114"><path fill="#fff" d="M75 67v16c0 6-2 12-6 16-2 3-4 7-4 10v3a1 1 0 0 1-1 2 1 1 0 0 1-2-1v-4c0-4 2-8 5-12s5-9 5-14V67a4 4 0 0 0-1-3 3 3 0 0 0-4 0 4 4 0 0 0-2 3 1 1 0 1 1-3 0v-5a3 3 0 0 0-3-4 3 3 0 0 0-4 4v5a1 1 0 1 1-3 0v-5a3 3 0 0 0-2-3 4 4 0 0 0-4 0 3 3 0 0 0-1 3v5a1 1 0 1 1-3 0V35a4 4 0 0 0-4-4 4 4 0 0 0-4 4v42a1 1 0 1 1-3 0V66a4 4 0 0 0-4 4v13c0 5 2 10 5 14s5 8 5 12v4a2 2 0 0 1-2 1 2 2 0 0 1-1-2v-3c0-3-2-7-4-10-4-4-6-10-6-16V70a7 7 0 0 1 7-7V35a7 7 0 0 1 7-7 7 7 0 0 1 7 7v21a7 7 0 0 1 7 0l2 2a7 7 0 0 1 5-3 6 6 0 0 1 6 6h1a6 6 0 0 1 9 6ZM27 47a2 2 0 0 0 1-3 14 14 0 1 1 20 0 1 1 0 1 0 2 3 17 17 0 1 0-24 0h1ZM17 33H5l2-2a2 2 0 0 0-2-2l-4 5a1 1 0 0 0 0 2l4 5a2 2 0 0 0 2-3l-2-2h12a2 2 0 0 0 0-3Zm58 1-4-5a1 1 0 0 0-2 2l2 2H60a2 2 0 0 0 0 3h11l-2 2a1 1 0 1 0 2 3l4-5a1 1 0 0 0 0-2ZM40 5v10a1 1 0 1 1-3 0V5l-2 2a1 1 0 0 1-3-2l5-5a2 2 0 0 1 2 0l5 5a1 1 0 0 1-2 2l-2-2Z"></path></svg></div>',n,s,r;return{c(){e=H("div"),e.innerHTML=i,this.h()},l(o){e=W(o,"DIV",{class:!0,"data-svelte-h":!0}),Re(e)!=="svelte-bk9v5p"&&(e.innerHTML=i),this.h()},h(){O(e,"class","helper svelte-10su6yg")},m(o,a){oe(o,e,a),r=!0},i(o){r||(o&&In(()=>{r&&(s&&s.end(1),n=qf(e,Qc,{delay:1e3,duration:2e3}),n.start())}),r=!0)},o(o){n&&n.invalidate(),o&&(s=ow(e,Qc,{duration:3e3})),r=!1},d(o){o&&L(e),o&&s&&s.end()}}}function Nm(t){let e,i,n=(t[6].length>15?t[6].slice(0,12).concat("..."):t[6])+"",s,r,o,a,c,l,u;return{c(){e=H("div"),i=H("button"),s=Ut(n),r=ae(),o=yo("svg"),a=yo("path"),c=yo("path"),this.h()},l(h){e=W(h,"DIV",{class:!0});var f=se(e);i=W(f,"BUTTON",{class:!0});var d=se(i);s=zt(d,n),r=ce(d),o=vo(d,"svg",{xmlns:!0,x:!0,y:!0,viewBox:!0,width:!0,height:!0,"xml:space":!0,class:!0});var p=se(o);a=vo(p,"path",{d:!0}),se(a).forEach(L),c=vo(p,"path",{d:!0}),se(c).forEach(L),p.forEach(L),d.forEach(L),f.forEach(L),this.h()},h(){O(a,"d","M0.5,8C0.37,8,0.24,7.95,0.15,7.85c-0.2-0.2-0.2-0.51,0-0.71l7-7c0.2-0.2,0.51-0.2,0.71,0s0.2,0.51,0,0.71l-7,7 C0.76,7.95,0.63,8,0.5,8z"),O(c,"d","M7.5,8C7.37,8,7.24,7.95,7.15,7.85l-7-7c-0.2-0.2-0.2-0.51,0-0.71s0.51-0.2,0.71,0l7,7c0.2,0.2,0.2,0.51,0,0.71 C7.76,7.95,7.63,8,7.5,8z"),O(o,"xmlns","http://www.w3.org/2000/svg"),O(o,"x","0px"),O(o,"y","0px"),O(o,"viewBox","0 0 8 8"),O(o,"width","8px"),O(o,"height","8px"),O(o,"xml:space","preserve"),O(o,"class","svelte-1x4usti svelte-10su6yg"),O(i,"class","svelte-10su6yg"),O(e,"class","location-queried svelte-10su6yg")},m(h,f){oe(h,e,f),U(e,i),U(i,s),U(i,r),U(i,o),U(o,a),U(o,c),l||(u=gt(i,"click",t[48]),l=!0)},p(h,f){f[0]&64&&n!==(n=(h[6].length>15?h[6].slice(0,12).concat("..."):h[6])+"")&&Sn(s,n)},d(h){h&&L(e),l=!1,u()}}}function Dm(t){let e,i,n="zoom in",s,r,o="zoom out",a,c;return{c(){e=H("div"),i=H("button"),i.textContent=n,s=ae(),r=H("button"),r.textContent=o,this.h()},l(l){e=W(l,"DIV",{class:!0});var u=se(e);i=W(u,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(i)!=="svelte-1d2rxg3"&&(i.textContent=n),s=ce(u),r=W(u,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(r)!=="svelte-2rqyrx"&&(r.textContent=o),u.forEach(L),this.h()},h(){O(i,"class","svelte-10su6yg"),O(r,"class","svelte-10su6yg"),O(e,"class","zoom svelte-10su6yg")},m(l,u){oe(l,e,u),U(e,i),U(e,s),U(e,r),a||(c=[gt(i,"click",t[50]),gt(r,"click",t[51])],a=!0)},p:pt,d(l){l&&L(e),a=!1,Qo(c)}}}function Fm(t){let e,i,n,s;function r(){return t[52](t[123])}return{c(){e=H("button"),this.h()},l(o){e=W(o,"BUTTON",{class:!0,style:!0});var a=se(e);a.forEach(L),this.h()},h(){O(e,"class",i=Qd(t[123]==t[11]?"swatch-selected":"")+" svelte-10su6yg"),Ne(e,"background",t[123]),Ne(e,"border-top-right-radius",t[125]==t[33].length-1?"5px":""),Ne(e,"border-bottom-right-radius",t[125]==t[33].length-1?"5px":""),Ne(e,"border-top-left-radius",t[125]==0?"5px":""),Ne(e,"border-bottom-left-radius",t[125]==0?"5px":"")},m(o,a){oe(o,e,a),n||(s=gt(e,"click",r),n=!0)},p(o,a){t=o,a[0]&2048&&i!==(i=Qd(t[123]==t[11]?"swatch-selected":"")+" svelte-10su6yg")&&O(e,"class",i)},d(o){o&&L(e),n=!1,s()}}}function Lm(t){let e,i,n,s,r,o,a,c,l="About",u,h;return{c(){e=H("div"),i=H("div"),n=H("label"),s=H("input"),r=Ut(" Keyboard Navigation"),o=ae(),a=H("div"),c=H("button"),c.textContent=l,this.h()},l(f){e=W(f,"DIV",{class:!0});var d=se(e);i=W(d,"DIV",{class:!0});var p=se(i);n=W(p,"LABEL",{for:!0,class:!0});var g=se(n);s=W(g,"INPUT",{id:!0,name:!0,type:!0,class:!0}),r=zt(g," Keyboard Navigation"),g.forEach(L),p.forEach(L),o=ce(d),a=W(d,"DIV",{class:!0});var _=se(a);c=W(_,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(c)!=="svelte-go2gp6"&&(c.textContent=l),_.forEach(L),d.forEach(L),this.h()},h(){O(s,"id","checkbox1"),O(s,"name","checkbox"),O(s,"type","checkbox"),O(s,"class","svelte-10su6yg"),O(n,"for","checkbox1"),O(n,"class","svelte-10su6yg"),O(i,"class","keyboard-controls svelte-10su6yg"),O(c,"class","svelte-10su6yg"),O(a,"class","about svelte-10su6yg"),O(e,"class","about-keyboard svelte-10su6yg")},m(f,d){oe(f,e,d),U(e,i),U(i,n),U(n,s),s.checked=t[7],U(n,r),U(e,o),U(e,a),U(a,c),u||(h=[gt(s,"change",t[55]),gt(c,"click",t[56])],u=!0)},p(f,d){d[0]&128&&(s.checked=f[7])},d(f){f&&L(e),u=!1,Qo(h)}}}function Bm(t){let e,i,n,s;return{c(){e=H("div"),i=yo("svg"),n=yo("path"),this.h()},l(r){e=W(r,"DIV",{class:!0,style:!0});var o=se(e);i=vo(o,"svg",{viewBox:!0,fill:!0,xmlns:!0,class:!0});var a=se(i);n=vo(a,"path",{d:!0,fill:!0}),se(n).forEach(L),a.forEach(L),o.forEach(L),this.h()},h(){O(n,"d","M108.993 28.105C109.106 33.5843 107.785 38.7298 105.622 43.7363C103.599 48.409 101.013 52.7481 97.7541 56.6698C96.3211 58.3664 94.86 60.0352 93.2865 61.5928C84.9975 69.9091 76.54 78.0586 67.7172 85.8186C64.8512 88.3219 61.9852 90.8251 58.782 92.939C56.5903 94.3853 52.8252 94.3575 50.6335 92.8278C49.5939 92.1046 48.5262 91.3814 47.5708 90.5748C36.4158 81.1459 25.6262 71.2998 15.286 60.9809C9.35732 55.0566 4.97401 48.1865 2.22039 40.2874C0.871683 36.3935 -0.0274579 32.3327 0.000640266 28.2162C0.0568366 18.843 3.51291 10.9995 11.549 5.52015C14.1902 3.71225 17.1124 2.4606 20.0908 1.32024C21.9172 0.652705 23.7998 0.430212 25.7104 0.207701C33.6903 -0.682341 40.8834 1.29246 47.2898 6.04862C49.3129 7.55057 51.2517 9.2194 53.2185 10.8326C53.8367 11.3332 55.2697 11.361 55.8879 10.8882C56.3936 10.4988 56.9275 10.1651 57.4333 9.77566C58.4167 8.96906 59.3158 8.07904 60.2993 7.27243C61.2827 6.46583 62.2942 5.71487 63.362 5.01952C68.5601 1.62624 74.2359 -0.0982711 80.5018 0.0129841C87.8074 0.124239 94.1856 2.62753 99.8053 7.189C103.879 10.471 106.549 14.7265 108.066 19.6774C108.909 22.4309 108.965 25.2679 108.993 28.105Z"),O(n,"fill","#FF0000"),O(i,"viewBox","0 0 109 94"),O(i,"fill","none"),O(i,"xmlns","http://www.w3.org/2000/svg"),O(i,"class","svelte-10su6yg"),O(e,"class","heart-popup svelte-10su6yg"),Ne(e,"width",30/Math.pow(2,6-t[3])+10+"px"),Ne(e,"left",t[27][0]+"px"),Ne(e,"top",t[27][1]-50+"px")},m(r,o){oe(r,e,o),U(e,i),U(i,n)},p(r,o){o[0]&8&&Ne(e,"width",30/Math.pow(2,6-r[3])+10+"px"),o[0]&134217728&&Ne(e,"left",r[27][0]+"px"),o[0]&134217728&&Ne(e,"top",r[27][1]-50+"px")},i(r){r&&(s||In(()=>{s=qf(e,zi,{y:20,duration:5e3}),s.start()}))},o:pt,d(r){r&&L(e)}}}function Um(t){let e,i="";return{c(){e=H("div"),e.innerHTML=i,this.h()},l(n){e=W(n,"DIV",{class:!0,"data-svelte-h":!0}),Re(e)!=="svelte-18f8tb9"&&(e.innerHTML=i),this.h()},h(){O(e,"class","search-results svelte-10su6yg")},m(n,s){oe(n,e,s)},d(n){n&&L(e)}}}function zm(t){let e,i=An(t[13]),n=[];for(let s=0;s<i.length;s+=1)n[s]=Vm(bm(t,i,s));return{c(){e=H("div");for(let s=0;s<n.length;s+=1)n[s].c();this.h()},l(s){e=W(s,"DIV",{class:!0});var r=se(e);for(let o=0;o<n.length;o+=1)n[o].l(r);r.forEach(L),this.h()},h(){O(e,"class","screen-coords svelte-10su6yg")},m(s,r){oe(s,e,r);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(e,null)},p(s,r){if(r[0]&8192|r[1]&128){i=An(s[13]);let o;for(o=0;o<i.length;o+=1){const a=bm(s,i,o);n[o]?n[o].p(a,r):(n[o]=Vm(a),n[o].c(),n[o].m(e,null))}for(;o<n.length;o+=1)n[o].d(1);n.length=i.length}},d(s){s&&L(e),kl(n,s)}}}function Vm(t){let e,i,n="",s,r,o="",a,c,l="",u,h,f;function d(..._){return t[58](t[120],..._)}function p(..._){return t[59](t[120],..._)}function g(..._){return t[60](t[120],..._)}return{c(){e=H("div"),i=H("button"),i.innerHTML=n,s=ae(),r=H("button"),r.innerHTML=o,a=ae(),c=H("button"),c.innerHTML=l,u=ae(),this.h()},l(_){e=W(_,"DIV",{class:!0,style:!0});var m=se(e);i=W(m,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(i)!=="svelte-9zpd79"&&(i.innerHTML=n),s=ce(m),r=W(m,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(r)!=="svelte-g6q2an"&&(r.innerHTML=o),a=ce(m),c=W(m,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(c)!=="svelte-t3jczr"&&(c.innerHTML=l),u=ce(m),m.forEach(L),this.h()},h(){O(i,"class","like svelte-10su6yg"),O(r,"class","comment svelte-10su6yg"),O(c,"class","mag svelte-10su6yg"),O(e,"class","screen-coord svelte-10su6yg"),Ne(e,"left",t[120].screenPosition[0]+"px"),Ne(e,"top",t[120].screenPosition[1]+"px"),Ne(e,"width",t[120].screenWidth+"px"),Ne(e,"height",t[120].screenWidth+"px")},m(_,m){oe(_,e,m),U(e,i),U(e,s),U(e,r),U(e,a),U(e,c),U(e,u),h||(f=[gt(i,"click",d),gt(r,"click",p),gt(c,"click",g)],h=!0)},p(_,m){t=_,m[0]&8192&&Ne(e,"left",t[120].screenPosition[0]+"px"),m[0]&8192&&Ne(e,"top",t[120].screenPosition[1]+"px"),m[0]&8192&&Ne(e,"width",t[120].screenWidth+"px"),m[0]&8192&&Ne(e,"height",t[120].screenWidth+"px")},d(_){_&&L(e),h=!1,Qo(f)}}}function jm(t){let e,i;return{c(){e=H("div"),this.h()},l(n){e=W(n,"DIV",{class:!0,style:!0});var s=se(e);s.forEach(L),this.h()},h(){O(e,"class",i="noise-overlay mounted "+(t[4]?"hide-overlay":"")+" svelte-10su6yg"),Ne(e,"background","url(assets/noise-light.png)")},m(n,s){oe(n,e,s)},p(n,s){s[0]&16&&i!==(i="noise-overlay mounted "+(n[4]?"hide-overlay":"")+" svelte-10su6yg")&&O(e,"class",i)},d(n){n&&L(e)}}}function U5(t){let e,i,n,s,r,o,a,c,l,u,h,f,d,p,g,_,m,b,w,S="Court Color",R,M,k,F,I="Sort By",N,C,V,X="♡",K,B,re="💬",be,Ce,fe,Ze,_t="",xe,Le,Ct=t[27],le,Ye,st,Ge,Ie,Je,Dt,xt,bt,Pt,jt,ge=t[30]==!0&&Tm(t),pe=!t[4]&&Am(t),Be=t[12]&&Mm(),$e=t[31]==!0&&Im(t),Pe=t[29]&&Om(),_e=t[8]&&km(),de=t[6]&&Nm(t),ut=t[7]&&Dm(t),Yt=An(t[33]),ct=[];for(let z=0;z<Yt.length;z+=1)ct[z]=Fm(wm(t,Yt,z));let ht=t[1]>500&&Lm(t),wt=Bm(t),He=t[18]&&Um(),lt=t[13].length>0&&t[7]&&zm(t),Ue=t[20]&&t[1]>500&&jm(t);return{c(){ge&&ge.c(),e=ae(),pe&&pe.c(),i=ae(),Be&&Be.c(),n=ae(),s=H("div"),$e&&$e.c(),r=ae(),Pe&&Pe.c(),o=ae(),_e&&_e.c(),a=ae(),c=H("div"),l=H("div"),u=H("a"),h=new Km(!1),f=ae(),d=H("div"),p=H("div"),de&&de.c(),g=ae(),_=H("div"),ut&&ut.c(),m=ae(),b=H("div"),w=H("span"),w.textContent=S,R=ae(),M=H("div");for(let z=0;z<ct.length;z+=1)ct[z].c();k=ae(),F=H("span"),F.textContent=I,N=ae(),C=H("div"),V=H("button"),V.textContent=X,K=ae(),B=H("button"),B.textContent=re,be=ae(),ht&&ht.c(),fe=ae(),Ze=H("div"),Ze.innerHTML=_t,xe=ae(),Le=H("div"),wt.c(),le=ae(),Ye=H("p"),st=Ut("Like Added to Court "),Ge=Ut(t[15]),Ie=ae(),He&&He.c(),Je=ae(),lt&&lt.c(),Dt=ae(),Ue&&Ue.c(),xt=mr(),this.h()},l(z){ge&&ge.l(z),e=ce(z),pe&&pe.l(z),i=ce(z),Be&&Be.l(z),n=ce(z),s=W(z,"DIV",{class:!0,id:!0});var te=se(s);$e&&$e.l(te),r=ce(te),Pe&&Pe.l(te),te.forEach(L),o=ce(z),_e&&_e.l(z),a=ce(z),c=W(z,"DIV",{class:!0});var Me=se(c);l=W(Me,"DIV",{class:!0});var Kt=se(l);u=W(Kt,"A",{href:!0,target:!0,class:!0});var fi=se(u);h=Zm(fi,!1),fi.forEach(L),Kt.forEach(L),f=ce(Me),d=W(Me,"DIV",{class:!0});var Si=se(d);p=W(Si,"DIV",{id:!0,class:!0});var Fn=se(p);de&&de.l(Fn),Fn.forEach(L),g=ce(Si),_=W(Si,"DIV",{class:!0});var $t=se(_);ut&&ut.l($t),m=ce($t),b=W($t,"DIV",{class:!0});var ii=se(b);w=W(ii,"SPAN",{class:!0,"data-svelte-h":!0}),Re(w)!=="svelte-1x22fca"&&(w.textContent=S),R=ce(ii),M=W(ii,"DIV",{class:!0});var Ps=se(M);for(let tn=0;tn<ct.length;tn+=1)ct[tn].l(Ps);Ps.forEach(L),k=ce(ii),F=W(ii,"SPAN",{class:!0,"data-svelte-h":!0}),Re(F)!=="svelte-1eada5v"&&(F.textContent=I),N=ce(ii),C=W(ii,"DIV",{class:!0});var ji=se(C);V=W(ji,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(V)!=="svelte-1ja0pf5"&&(V.textContent=X),K=ce(ji),B=W(ji,"BUTTON",{class:!0,"data-svelte-h":!0}),Re(B)!=="svelte-69dauq"&&(B.textContent=re),ji.forEach(L),ii.forEach(L),be=ce($t),ht&&ht.l($t),$t.forEach(L),Si.forEach(L),Me.forEach(L),fe=ce(z),Ze=W(z,"DIV",{style:!0,class:!0,"data-svelte-h":!0}),Re(Ze)!=="svelte-1r38rh7"&&(Ze.innerHTML=_t),xe=ce(z),Le=W(z,"DIV",{class:!0});var di=se(Le);wt.l(di),le=ce(di),Ye=W(di,"P",{class:!0});var Ai=se(Ye);st=zt(Ai,"Like Added to Court "),Ge=zt(Ai,t[15]),Ai.forEach(L),di.forEach(L),Ie=ce(z),He&&He.l(z),Je=ce(z),lt&&lt.l(z),Dt=ce(z),Ue&&Ue.l(z),xt=mr(),this.h()},h(){O(s,"class","overlay svelte-10su6yg"),O(s,"id","overlay"),h.a=null,O(u,"href","https://pudding.cool"),O(u,"target","_blank"),O(u,"class","svelte-10su6yg"),O(l,"class","toolbar-logo svelte-10su6yg"),O(p,"id","geocoder"),O(p,"class","geocoder svelte-10su6yg"),O(w,"class","svelte-10su6yg"),O(M,"class","color-swatches svelte-10su6yg"),O(F,"class","sorted-by svelte-10su6yg"),O(V,"class","svelte-10su6yg"),O(B,"class","svelte-10su6yg"),O(C,"class","sort-buttons svelte-10su6yg"),O(b,"class","color-finder svelte-10su6yg"),O(_,"class","bottom svelte-10su6yg"),O(d,"class","settings svelte-10su6yg"),O(c,"class",Ce="toolbar "+(t[4]?"toolbar-visible":"")+" svelte-10su6yg"),O(Ze,"style",""),O(Ze,"class","el svelte-10su6yg"),_n(Ze,"showEl",t[5]),O(Ye,"class","svelte-10su6yg"),O(Le,"class","favorite-text svelte-10su6yg"),_n(Le,"favoriteActive",t[23])},m(z,te){ge&&ge.m(z,te),oe(z,e,te),pe&&pe.m(z,te),oe(z,i,te),Be&&Be.m(z,te),oe(z,n,te),oe(z,s,te),$e&&$e.m(s,null),U(s,r),Pe&&Pe.m(s,null),oe(z,o,te),_e&&_e.m(z,te),oe(z,a,te),oe(z,c,te),U(c,l),U(l,u),h.m(tb,u),U(c,f),U(c,d),U(d,p),de&&de.m(p,null),t[49](p),U(d,g),U(d,_),ut&&ut.m(_,null),U(_,m),U(_,b),U(b,w),U(b,R),U(b,M);for(let Me=0;Me<ct.length;Me+=1)ct[Me]&&ct[Me].m(M,null);U(b,k),U(b,F),U(b,N),U(b,C),U(C,V),U(C,K),U(C,B),U(_,be),ht&&ht.m(_,null),oe(z,fe,te),oe(z,Ze,te),t[57](Ze),oe(z,xe,te),oe(z,Le,te),wt.m(Le,null),U(Le,le),U(Le,Ye),U(Ye,st),U(Ye,Ge),oe(z,Ie,te),He&&He.m(z,te),oe(z,Je,te),lt&&lt.m(z,te),oe(z,Dt,te),Ue&&Ue.m(z,te),oe(z,xt,te),bt=!0,Pt||(jt=[gt(V,"click",t[53]),gt(B,"click",t[54])],Pt=!0)},p(z,te){if(z[30]==!0?ge?(ge.p(z,te),te[0]&1073741824&&ue(ge,1)):(ge=Tm(z),ge.c(),ue(ge,1),ge.m(e.parentNode,e)):ge&&(ei(),Se(ge,1,1,()=>{ge=null}),ti()),z[4]?pe&&(ei(),Se(pe,1,1,()=>{pe=null}),ti()):pe?(pe.p(z,te),te[0]&16&&ue(pe,1)):(pe=Am(z),pe.c(),ue(pe,1),pe.m(i.parentNode,i)),z[12]?Be?te[0]&4096&&ue(Be,1):(Be=Mm(),Be.c(),ue(Be,1),Be.m(n.parentNode,n)):Be&&(ei(),Se(Be,1,1,()=>{Be=null}),ti()),z[31]==!0?$e?($e.p(z,te),te[1]&1&&ue($e,1)):($e=Im(z),$e.c(),ue($e,1),$e.m(s,r)):$e&&(ei(),Se($e,1,1,()=>{$e=null}),ti()),z[29]?Pe?te[0]&536870912&&ue(Pe,1):(Pe=Om(),Pe.c(),ue(Pe,1),Pe.m(s,null)):Pe&&(ei(),Se(Pe,1,1,()=>{Pe=null}),ti()),z[8]?_e?te[0]&256&&ue(_e,1):(_e=km(),_e.c(),ue(_e,1),_e.m(a.parentNode,a)):_e&&(ei(),Se(_e,1,1,()=>{_e=null}),ti()),z[6]?de?de.p(z,te):(de=Nm(z),de.c(),de.m(p,null)):de&&(de.d(1),de=null),z[7]?ut?ut.p(z,te):(ut=Dm(z),ut.c(),ut.m(_,m)):ut&&(ut.d(1),ut=null),te[0]&2048|te[1]&2052){Yt=An(z[33]);let Me;for(Me=0;Me<Yt.length;Me+=1){const Kt=wm(z,Yt,Me);ct[Me]?ct[Me].p(Kt,te):(ct[Me]=Fm(Kt),ct[Me].c(),ct[Me].m(M,null))}for(;Me<ct.length;Me+=1)ct[Me].d(1);ct.length=Yt.length}z[1]>500?ht?ht.p(z,te):(ht=Lm(z),ht.c(),ht.m(_,null)):ht&&(ht.d(1),ht=null),(!bt||te[0]&16&&Ce!==(Ce="toolbar "+(z[4]?"toolbar-visible":"")+" svelte-10su6yg"))&&O(c,"class",Ce),(!bt||te[0]&32)&&_n(Ze,"showEl",z[5]),te[0]&134217728&&en(Ct,Ct=z[27])?(ei(),Se(wt,1,1,pt),ti(),wt=Bm(z),wt.c(),ue(wt,1),wt.m(Le,le)):wt.p(z,te),(!bt||te[0]&32768)&&Sn(Ge,z[15]),(!bt||te[0]&8388608)&&_n(Le,"favoriteActive",z[23]),z[18]?He||(He=Um(),He.c(),He.m(Je.parentNode,Je)):He&&(He.d(1),He=null),z[13].length>0&&z[7]?lt?lt.p(z,te):(lt=zm(z),lt.c(),lt.m(Dt.parentNode,Dt)):lt&&(lt.d(1),lt=null),z[20]&&z[1]>500?Ue?Ue.p(z,te):(Ue=jm(z),Ue.c(),Ue.m(xt.parentNode,xt)):Ue&&(Ue.d(1),Ue=null)},i(z){bt||(ue(ge),ue(pe),ue(Be),ue($e),ue(Pe),ue(_e),ue(wt),bt=!0)},o(z){Se(ge),Se(pe),Se(Be),Se($e),Se(Pe),Se(_e),Se(wt),bt=!1},d(z){z&&(L(e),L(i),L(n),L(s),L(o),L(a),L(c),L(fe),L(Ze),L(xe),L(Le),L(Ie),L(Je),L(Dt),L(xt)),ge&&ge.d(z),pe&&pe.d(z),Be&&Be.d(z),$e&&$e.d(),Pe&&Pe.d(),_e&&_e.d(z),de&&de.d(),t[49](null),ut&&ut.d(),kl(ct,z),ht&&ht.d(),t[57](null),wt.d(z),He&&He.d(z),lt&&lt.d(z),Ue&&Ue.d(z),Pt=!1,Qo(jt)}}}let z5=64,V5=64;function j5(t,e,i){let n,s,r,o,a,c=pt,l=()=>(c(),c=nw(n,$=>i(32,a=$)),n);wn(t,el,$=>i(29,s=$)),wn(t,Qa,$=>i(30,r=$)),wn(t,xo,$=>i(31,o=$)),t.$$.on_destroy.push(()=>c());let{viewportHeight:u}=e,{viewportWidth:h}=e,f=!1,d=!1,p=!1,g=0,_=!1,m,b=!1,w=0,S=!1,R=!0,M=!1,k=!0,F=!1,I;h<500&&(S=!0,w=4,R=!1,k=!1);let N,C,V=!1,X=null,K=!1,B=["rgb(45, 181, 77)","rgb(66, 102, 235)","rgb(96, 216, 230)","rgb(168, 59, 157)","rgb(207, 21, 24)","rgb(225, 108, 51)","rgb(227, 198, 36)","rgb(235, 122, 184)"],re=Qf(","),be=[],Ce,fe=1,Ze=4.5;h<500&&(Ze=4.99);let _t,xe,Le,Ct,le,Ye,st,Ge=[],Ie=!1,Je,Dt,xt=!1,bt={},Pt,jt=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],ge=[],pe=[],Be=[],$e,Pe={},_e={},de=[0];async function ut(){V&&!R&&!k&&(i(12,K=!0),R=!0,k=!0,await fi(),await Me(),xe.setProps({layers:pe.concat([Ue,z,te])}),setTimeout(()=>{i(12,K=!1)},500),console.log("show text layer",fe,w))}function Yt($,Z){let ie=Object.keys(Pe),J=Object.keys(_e),G;$.length>0?G=Z.filter(he=>$.indexOf(he.id)>-1):G=Z.map(he=>he),N=zD(h,u,G.length);let ne=N.rowSize;return G=G.map((he,ze)=>{let ft=0,rt=0,Ke=he.id.replace(".jpg",""),Lt=Pt.has(+Ke)?Pt.get(+Ke):null;Lt&&(ft=Lt.count?Lt.count:0,rt=Lt.comment_count?Lt.comment_count:0),ie.indexOf(Ke)>-1&&(ft=ft+Pe[Ke]),J.indexOf(Ke)>-1&&(rt=rt+_e[Ke]);let Fs=ze%ne*le.size+ze%ne*.1,qr=Math.floor(ze/ne)*le.size+Math.floor(ze/ne)*.1;return{coordinates:[Fs,qr],id:Ke,color:he.color,court_count:ze,latLong:he.center.split(",").map(da=>+da),location:he.location,state:he.state,geo:he.geo,squareSize:ne,likes:ft,comments:rt}}),Ft&&(G=G.sort((he,ze)=>{if(Ft=="heart")return ze.likes-he.likes;if(Ft=="comment")return ze.comments-he.comments}),G.forEach((he,ze)=>{let ft=ze%ne*le.size+ze%ne*.1,rt=Math.floor(ze/ne)*le.size+Math.floor(ze/ne)*.1;he.coordinates=[ft,rt]})),G}async function ct(){let $={};for(let Z of jt){let ie=C.map(G=>({geo:G.geo,x:+G.x,y:+G.y,width:z5,height:V5,mask:!1,id:G.id.replace(".jpg","").replace(".jpeg","")})).filter(G=>G.geo==Z);const J={};for(let G of ie)J[G.id]=G;$[Z]=J}return $}function ht(){return new Promise(async($,Z)=>{await rs("assets/load.basis").then(()=>{console.log("BasisLoader preloaded"),$()})})}function wt($){return new Promise(async(Z,ie)=>{await rs(`assets/${$}.basis`).then(J=>{console.log("basis loaded ",$);let ne={data:J[0],width:4096,height:4096,compressed:!0};ge[$].iconAtlas=ne,Z()})})}let He=0,lt=jt.length-1,Ue,z,te;async function Me(){return new Promise(async($,Z)=>{let ie={marker:{width:1500,height:1510,x:0,y:0,mask:!1}},J={id:"IconLayer_test",getIcon:G=>"marker",data:Ye,getPosition:G=>G.coordinates,getSize:le.size,sizeUnits:"common",visible:R,iconMapping:ie,iconAtlas:"assets/toolbar-3.png"};S||(J.transitions={getPosition:{duration:500,easing:ya}}),z=new Ir({...J}),$()})}async function Kt(){return new Promise(async($,Z)=>{let ie=[];for(let J of Ye){let G=JSON.stringify(J.likes),ne=JSON.stringify(J.comments);ie.push({text:`${J.location}, ${J.state}`,position:[J.coordinates[0]-.48*le.size,J.coordinates[1]+.44*le.size],size:.08*le.size}),ie.push({text:G,position:[J.coordinates[0]+.41*le.size,J.coordinates[1]+.438*le.size],size:.066*le.size}),ie.push({text:ne,position:[J.coordinates[0]+.41*le.size,J.coordinates[1]+.314*le.size],size:.066*le.size})}$(ie)})}async function fi(){return new Promise(async($,Z)=>{console.log(I,R);let ie={data:I,id:"TextLayer-test",getPosition:J=>J.position,getText:J=>J.text,maxWidth:10,getAlignmentBaseline:"top",fontFamily:"-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif",getAlignmentBaseline:"center",getColor:[255,255,255],visible:R,getSize:J=>J.size,getTextAnchor:"start",sizeUnits:"common",updateTriggers:{getText:de}};S||(ie.transitions={getPosition:{duration:500,easing:ya}}),te=new Zc({...ie}),$()})}async function Si(){i(12,K=!0),S&&(R=!1,k=!1),await di(),await Ms(),I=await Kt(),Is(1,!0),setTimeout(async()=>{await Me(),await fi(),xe.setProps({layers:pe.concat([Ue,z,te])}),Ft||(de=[de[0]+1],de=[...de]),i(12,K=!1)},1e3)}async function Fn(){let $;i(12,K=!0),await di(),await Ms(),I=await Kt(),Ft||(console.log("changing court fave count"),de=[de[0]+1],de=[...de]),N.rowSize!==0&&($=Math.log2(N.size/le.size),Is($-.2)),setTimeout(async()=>{await Me(),await fi(),await tn(),xe.setProps({layers:pe.concat([Ue,z,te])}),i(12,K=!1)},1e3)}async function $t(){await Me(),I=await Kt(),await fi(),xe.setProps({layers:pe.concat([Ue,z,te])}),i(4,f=!0),i(8,b=!0),setTimeout(()=>{i(8,b=!1)},6e3)}async function ii(){for(;await Ps();)Ms(),xe.setProps({layers:pe});await tn(),i(10,V=!0),console.log("loading done")}function Ps(){return console.log("fetching new chunk"),He<lt?(He++,new Promise(async($,Z)=>{console.log(He),await rs(`assets/${He}.basis`).then(ie=>{console.log("basis loaded ",He);let G={data:ie[0],width:4096,height:4096,compressed:!0};ge[He].iconAtlas=G,$(!0)})})):null}async function ji(){for(let $ of jt){let Z={id:`IconLayer_${$}`,getIcon:ie=>ie.id,getPosition:ie=>ie.coordinates,getSize:le.size,mask:!1,sizeUnits:"common",iconMapping:bt[$]};h>500&&(Z.transitions={getPosition:{duration:500,easing:ya}}),ge.push(Z)}return await ht(),f||n.set(1).then(()=>{i(26,Ai=!0)}),await Promise.all(jt.slice(0,1).map(async $=>{await wt($)})),!0}async function di(){console.log(ge);for(let $ in ge){let Z=Ye.filter(ie=>ie.geo==jt[$]);ge[$].data=Z}return!0}let Ai;async function tn(){return new Promise(async($,Z)=>{Ue=new Bf({tileSize:256,minZoom:5,debounceTime:100,id:"tileLayer_",coordinateSystem:Ee.CARTESIAN,onViewportLoad:J=>{let G=Be.length;if(Be=Array.from(J.flatMap(ne=>ne.content?ne.content:[]).reduce((ne,he)=>(ne.has(+he.id)||ne.set(+he.id,he),ne),new Map).values()),G==0&&Be.length>0){const ne=h,he=u,ze=[_t[0],_t[1],0],ft=-ne/2,rt=ne/2,Ke=he/2,Lt=-he/2,Fs=new Ov({width:ne,height:he,left:ft,right:rt,top:Ke,bottom:Lt,target:ze,zoom:fe});Vr(Fs)}},getTileData:async({id:J,bbox:G,signal:ne})=>fe<Ze||ne.aborted?null:tu(G,J,ne),updateTriggers:{renderSubLayers:de,getTileData:[de,Ft,X,p],all:de},renderSubLayers:J=>{J.tile;let G=[];if(J.data&&J.data.length>0)for(let ne in J.data){J.data[ne].tileId=J.id;let he=J.data[ne].id,ze=J.data[ne].coordinates,ft=[ze[0]-le.size/2,ze[1]+le.size/2,ze[0]+le.size/2,ze[1]-le.size/2],rt="jpg",Ke=`https://s3.amazonaws.com/pudding.cool/projects/courts/${rt}/${he}.${rt}`;if(h<500&&(rt="webp",Ke=`https://s3.amazonaws.com/pudding.cool/projects/courts/${rt}/150/${he}.${rt}`),fe>Ze&&J.tile.zoom>3){const Lt=new Sf(J,{image:Ke,id:`${J.id}_${he}_bitmap`,bounds:ft});G.push(Lt)}}return G}}),$()})}async function Ms(){pe=[];for(let $ in ge.slice(0,He+1)){let Z=new Ir({...ge[$]});pe.push(Z)}return!0}function zr($,Z){return $&&Z?Z.project([$[0]-le.size/2,$[1]-le.size/2]):[0,0]}function Vr($){i(13,be=Be.map(Z=>{let ie=zr(Z.coordinates,$),J=zr([le.size*2,0],$)[0]-zr([le.size,0],$)[0];return{id:Z.id,screenPosition:ie,screenWidth:J,info:Z}}))}async function tu($,Z,ie){if(await new Promise(ft=>setTimeout(ft,100)),!C)return[];if(ie.aborted)return null;const{left:J,right:G,top:ne,bottom:he}=$;let ze=[];for(let ft=0;ft<Ye.length;ft++){const rt=Ye[ft],[Ke,Lt]=rt.coordinates;Ke+le.size/2>=J&&Ke+le.size/2<=G&&Lt+le.size/2>=ne&&Lt+le.size/2<=he&&ze.push(rt)}return ze}Nl(async()=>{i(20,Ie=!0),C=await new Promise(async(Z,ie)=>{const J=await sT("assets/data.csv");Z(J)}),i(17,le=BD(h,u,C.length)),await new Promise(async(Z,ie)=>{const G=await(await fetch("assets/land-110m.json")).json();Z(G)}).then(Z=>{i(25,$e=Z)}),await new Promise(async(Z,ie)=>{i(24,Pt=hw(await NL(),J=>J.court_id)),console.log(Pt),Z(Pt)}).then(Z=>{console.log(Z)});let $=eb();aA({basis:{format:$,maxConcurrency:1,CDN:!1,worker:!0,useLocalLibraries:!0,workerUrl:"libs-2/basis-worker.js"},worker:!0,CDN:!1,maxConcurrency:1,useLocalLibraries:!0}),jy(xD),i(18,Ye=await Yt([],C)),g=[...Ye],console.log("sprite positions loaded"),bt=await ct(),await ji(),await di(),await Ms(),m=new F5({accessToken:"pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2x5YzVlcXZ4MW1qajJsb3RoeWI0bzhmZyJ9.DY653tAkLZCDMMEPuFvoGA",types:"region,postcode,district,place,neighborhood",options:{marker:!1}}),m.addTo(Ct),m.setPlaceholder("Search for a location..."),m.setCountries("pr,us,vi,gu"),m.on("result",async Z=>{if("result".indexOf(Object.keys(Z))>-1){Ft=null,i(11,X=null),await Os(Z,!1),Fn();const ie=document.querySelector(".mapboxgl-ctrl-geocoder input");ie&&ie.blur(),i(6,p=Z.result.text)}}),xe=new mf({parent:Ce,views:new Kn,initialViewState:{target:[h/2,u/2,0],zoom:fe,transitionInterpolator:new Xo(["zoom","target"]),transitionDuration:1e3},getCursor:({isDragging:Z})=>F?"pointer":Z?"grabbing":"grab",onHover:({x:Z,y:ie})=>{if(!S){let J=be.filter(G=>{let ne=[G.screenPosition[0],G.screenPosition[0]+G.screenWidth,G.screenPosition[1],G.screenPosition[1]+G.screenWidth];return ne[0]<Z&&ne[1]>Z&&ne[2]<ie&&ie<ne[3]});if(J.length>0){let G=J[0],ne=(Z-G.screenPosition[0])/G.screenWidth,he=(ie-G.screenPosition[1])/G.screenWidth;ne>.79?(he>.89||he>.75)&&(F=!0):ne<.1&&he<.13?F=!0:F=!1}else F=!1}},onClick:({x:Z,y:ie})=>{console.log(Z,ie);let J=be.filter(G=>{let ne=[G.screenPosition[0],G.screenPosition[0]+G.screenWidth,G.screenPosition[1],G.screenPosition[1]+G.screenWidth];return ne[0]<Z&&ne[1]>Z&&ne[2]<ie&&ie<ne[3]});if(J.length>0){let G=J[0],ne=(Z-G.screenPosition[0])/G.screenWidth,he=(ie-G.screenPosition[1])/G.screenWidth;ne>.79?he>.89?(console.log("heart clicked"),Ln(G.id,G,[Z,ie])):he>.75&&ua(G.id):ne<.1&&he<.13&&(G.info.id,i(22,Dt=G.info.latLong),pn(Qa,r=!0,r))}},onLoad:()=>{i(21,Je=!0),ii()},onViewStateChange:({viewState:Z})=>{i(3,fe=Z.zoom),_t=Z.target;let ie=h,J=u,G=new Kn().makeViewport({width:ie,height:J,viewState:Z});Vr(G)},controller:!0,layers:pe})});function Is($,Z){return new Promise((ie,J)=>{console.log("zoomStart");const G=new Xo({transitionProps:["zoom","target"]});let ne=[Math.floor(N.rowSize*le.size/2),Math.floor(Ye.length/N.rowSize)*le.size/2,0];if(Z)xe.setProps({views:new Kn,initialViewState:{target:[h/2,u/2,0],zoom:1,controller:!0,layers:pe}});else if(S)xe.setProps({views:new Kn,initialViewState:{target:ne,zoom:$,controller:!0,layers:pe}});else{let he=1e3;Ye.length==C.length&&h<500&&(he=0),xe.setProps({views:new Kn,initialViewState:{target:ne,zoom:$,controller:!0,transitionDuration:he,transitionInterpolator:G,transitionEasing:ya,layers:pe,onTransitionEnd:()=>{}}})}})}let la=[-100,-100];async function Ln($,Z,ie){i(27,la=ie),i(15,Le=`#${re(Z.info.court_count)} in ${Z.info.location}, ${Z.info.state}`),i(23,xt=!0),Pe[$]=(Pe[$]||0)+1,i(18,Ye=await Yt(Ge,C)),I=await Kt(),de=[de[0]+1],de=[...de],await fi(),xe.setProps({layers:pe.concat([Ue,z,te])}),DL($),setTimeout(()=>{i(23,xt=!1)},3e3)}async function ua($){i(19,st=$),pn(xo,o=!0,o)}async function iu($){const Z=$.detail;_e[Z]=(_e[Z]||0)+1,de=[de[0]+1],de=[...de],i(18,Ye=await Yt(Ge,C)),I=[...await Kt()],de=[de[0]+1],de=[...de],await fi(),xe.setProps({layers:pe.concat([Ue,z,te])})}function Os($,Z){return new Promise((ie,J)=>{$?(Ge=XE(C,$,"bbox"),Ge.length==0&&(Ge=["none"])):Z?(Ge=qE(C,Z),Ge.length==0&&(Ge=["none"])):Ge=[],i(18,Ye=Yt(Ge,C)),ie()})}let Ft=null;async function jr($){Ft=$,i(11,X=null),m.setInput(""),i(6,p=null),await Os(!1,!1),Si()}async function Bn($,Z,ie){$=="like"?Ln(Z.id,Z,[ie.x,ie.y]):$=="comment"?ua(Z.id):$=="mag"&&(Z.info.id,i(22,Dt=Z.info.latLong),pn(Qa,r=!0,r))}async function ha(){pn(el,s=!0,s)}async function ks($){console.log(fe),$=="out"?Is(fe-1):Is(fe+1)}async function $r(){m.setInput(""),Ft=null,i(6,p=null),Ge=[],Ft=null,i(11,X=null),i(18,Ye=g),Si()}async function Hr($){Ft=null,m.setInput(""),i(6,p=null),X!==$?(i(11,X=$),await Os(!1,$),Fn()):(i(11,X=null),i(18,Ye=g),Si())}function fa(){console.log("world finished"),i(5,d=!0)}const Wr=()=>{pn(Qa,r=!1,r)},$i=()=>{i(9,M=!0)},Un=()=>$t(),zn=()=>$r();function Ns($){fh[$?"unshift":"push"](()=>{Ct=$,i(16,Ct)})}const Xr=()=>ks("in"),nu=()=>ks("out"),su=$=>Hr($),Ds=()=>jr("heart"),Ht=()=>jr("comment");function nn(){_=this.checked,i(7,_)}const Ri=()=>ha();function pi($){fh[$?"unshift":"push"](()=>{Ce=$,i(14,Ce)})}const Vn=($,Z)=>Bn("like",$,Z),ni=($,Z)=>Bn("comment",$,Z),gi=($,Z)=>Bn("mag",$,Z);return t.$$set=$=>{"viewportHeight"in $&&i(0,u=$.viewportHeight),"viewportWidth"in $&&i(1,h=$.viewportWidth)},t.$$.update=()=>{t.$$.dirty[0]&8&&console.log(fe),t.$$.dirty[0]&12|t.$$.dirty[1]&8192&&S&&fe>w&&ut()},l(i(28,n=zf(0,{duration:1e4}))),[u,h,S,fe,f,d,p,_,b,M,V,X,K,be,Ce,Le,Ct,le,Ye,st,Ie,Je,Dt,xt,Pt,$e,Ai,la,n,s,r,o,a,B,re,$t,iu,jr,Bn,ha,ks,$r,Hr,fa,w,Wr,$i,Un,zn,Ns,Xr,nu,su,Ds,Ht,nn,Ri,pi,Vn,ni,gi]}class $5 extends On{constructor(e){super(),kn(this,e,j5,U5,en,{viewportHeight:0,viewportWidth:1},null,[-1,-1,-1,-1,-1])}}function $m(t){let e,i;return e=new $5({props:{viewportWidth:t[0].width,viewportHeight:t[0].height}}),{c(){hs(e.$$.fragment)},l(n){fs(e.$$.fragment,n)},m(n,s){ds(e,n,s),i=!0},p(n,s){const r={};s&1&&(r.viewportWidth=n[0].width),s&1&&(r.viewportHeight=n[0].height),e.$set(r)},i(n){i||(ue(e.$$.fragment,n),i=!0)},o(n){Se(e.$$.fragment,n),i=!1},d(n){ps(e,n)}}}function H5(t){let e,i,n="",s,r=t[1]&&t[0]&&$m(t);return{c(){r&&r.c(),e=ae(),i=H("div"),i.innerHTML=n,this.h()},l(o){r&&r.l(o),e=ce(o),i=W(o,"DIV",{class:!0,"data-svelte-h":!0}),Re(i)!=="svelte-199sfvp"&&(i.innerHTML=n),this.h()},h(){O(i,"class","overlay svelte-16ft1lt")},m(o,a){r&&r.m(o,a),oe(o,e,a),oe(o,i,a),s=!0},p(o,[a]){o[1]&&o[0]?r?(r.p(o,a),a&3&&ue(r,1)):(r=$m(o),r.c(),ue(r,1),r.m(e.parentNode,e)):r&&(ei(),Se(r,1,1,()=>{r=null}),ti())},i(o){s||(ue(r),s=!0)},o(o){Se(r),s=!1},d(o){o&&(L(e),L(i)),r&&r.d(o)}}}function W5(t,e,i){let n;wn(t,lw,r=>i(0,n=r));let s;return Nl(async()=>{i(1,s=!0)}),t.$$.update=()=>{t.$$.dirty&1&&console.log(n)},[n,s]}class X5 extends On{constructor(e){super(),kn(this,e,W5,H5,en,{})}}const q5="Title TK",Y5="Description tk.",Hm={title:q5,description:Y5};function K5(){console.log("--- --- --- --- --- ---"),console.log("svelte-starter: 5.17.0"),console.log("build: 2024-09-16-20:54"),console.log("--- --- --- --- --- ---")}function Z5(t){let e,i,n,s;return e=new _w({props:{title:t[1],description:t[2],url:t[3],preloadFont:t[0],keywords:t[4]}}),n=new X5({}),{c(){hs(e.$$.fragment),i=ae(),hs(n.$$.fragment)},l(r){fs(e.$$.fragment,r),i=ce(r),fs(n.$$.fragment,r)},m(r,o){ds(e,r,o),oe(r,i,o),ds(n,r,o),s=!0},p:pt,i(r){s||(ue(e.$$.fragment,r),ue(n.$$.fragment,r),s=!0)},o(r){Se(e.$$.fragment,r),Se(n.$$.fragment,r),s=!1},d(r){r&&L(i),ps(e,r),ps(n,r)}}}function G5(t,e,i){let{data:n}=e;K5();const s=[],{title:r,description:o,url:a,keywords:c}=Hm;return ep("copy",Hm),ep("data",n.data),t.$$set=l=>{"data"in l&&i(5,n=l.data)},[s,r,o,a,c,n]}class lU extends On{constructor(e){super(),kn(this,e,G5,Z5,en,{data:5})}}export{lU as component};
