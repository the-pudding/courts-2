const __vite__fileDeps=["../chunks/browser.BVZztmgU.js","../chunks/viewport.CNTsduTY.js","../chunks/index.BCKwTHzZ.js","../chunks/scheduler.DWvxBnEd.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var $b=Object.defineProperty;var Hb=(t,e,i)=>e in t?$b(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var y=(t,e,i)=>(Hb(t,typeof e!="symbol"?e+"":e,i),i);import{s as Hi,e as K,k as nr,C as Om,c as Z,d as j,p as L,f as H,n as St,H as Of,i as re,N as Nm,ac as zd,_ as Vd,a4 as km,h as un,o as cl,a as oe,q as ot,Z as Ds,r as Gu,j as ue,w as We,l as he,E as hi,ad as Ln,ae as Wb,t as Ot,b as Nt,x as jd,af as Xb,L as ls,G as Dm,g as Zn,a9 as Fm,aa as Lm,ag as $d,$ as Hd,a0 as Wd,ah as qb,a6 as Xd}from"../chunks/scheduler.DWvxBnEd.js";import{S as vn,i as bn,n as Yb,l as Kb,h as dn,a as se,g as si,t as Ae,c as ri,b as Gn,d as Jn,m as Qn,j as Nf,e as es,k as Zb}from"../chunks/index.C32fdg8C.js";import{e as sr}from"../chunks/each.D6YF6ztN.js";import{g as kf,c as Ys,a as Gb,l as Jb,v as Qb}from"../chunks/viewport.CNTsduTY.js";import{d as ew,i as tw}from"../chunks/transform.BIl3ljzv.js";import{w as ll}from"../chunks/index.BCKwTHzZ.js";import{_ as rr}from"../chunks/preload-helper.D6kgxu3v.js";function iw(t,e){for(var i=0;i<e.length;i++){const n=e[i];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in t)){const r=Object.getOwnPropertyDescriptor(n,s);r&&Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}function qd(t,e,i){const n=t.slice();return n[5]=e[i],n}function Yd(t){let e,i;return{c(){e=K("link"),this.h()},l(n){e=Z(n,"LINK",{rel:!0,href:!0,as:!0,type:!0,crossorigin:!0}),this.h()},h(){L(e,"rel","preload"),L(e,"href",i=t[5]),L(e,"as","font"),L(e,"type","font/woff2"),L(e,"crossorigin","")},m(n,s){re(n,e,s)},p(n,s){s&16&&i!==(i=n[5])&&L(e,"href",i)},d(n){n&&j(e)}}}function nw(t){let e,i,n,s,r,o,a,c,l,u,h,f,d,p,g,_,b,T,v,E,R,P,M,U,O,D;document.title=e=t[0];let I=sr(t[4]),V=[];for(let k=0;k<I.length;k+=1)V[k]=Yd(qd(t,I,k));return{c(){i=K("meta"),n=K("meta"),s=K("meta"),r=K("meta"),o=K("meta"),a=K("meta"),c=K("meta"),l=K("meta"),u=K("meta"),h=K("meta"),d=K("meta"),p=K("meta"),g=K("meta"),_=K("meta"),b=K("meta"),T=K("meta"),v=K("meta"),E=K("meta"),R=K("meta"),M=K("meta"),U=K("link");for(let k=0;k<V.length;k+=1)V[k].c();D=nr(),this.h()},l(k){const B=Om("svelte-cxxwj9",document.head);i=Z(B,"META",{name:!0,content:!0}),n=Z(B,"META",{name:!0,content:!0}),s=Z(B,"META",{name:!0,content:!0}),r=Z(B,"META",{property:!0,content:!0}),o=Z(B,"META",{property:!0,content:!0}),a=Z(B,"META",{property:!0,content:!0}),c=Z(B,"META",{property:!0,content:!0}),l=Z(B,"META",{property:!0,content:!0}),u=Z(B,"META",{property:!0,content:!0}),h=Z(B,"META",{property:!0,content:!0}),d=Z(B,"META",{property:!0,content:!0}),p=Z(B,"META",{property:!0,content:!0}),g=Z(B,"META",{property:!0,content:!0}),_=Z(B,"META",{name:!0,content:!0}),b=Z(B,"META",{name:!0,content:!0}),T=Z(B,"META",{name:!0,content:!0}),v=Z(B,"META",{name:!0,content:!0}),E=Z(B,"META",{name:!0,content:!0}),R=Z(B,"META",{name:!0,content:!0}),M=Z(B,"META",{name:!0,content:!0}),U=Z(B,"LINK",{rel:!0,href:!0});for(let F=0;F<V.length;F+=1)V[F].l(B);D=nr(),B.forEach(j),this.h()},h(){L(i,"name","description"),L(i,"content",t[1]),L(n,"name","author"),L(n,"content","The Pudding"),L(s,"name","news_keywords"),L(s,"content",t[3]),L(r,"property","og:title"),L(r,"content",t[0]),L(o,"property","og:site_name"),L(o,"content","The Pudding"),L(a,"property","og:url"),L(a,"content",t[2]),L(c,"property","og:description"),L(c,"content",t[1]),L(l,"property","og:type"),L(l,"content","article"),L(u,"property","og:locale"),L(u,"content","en_US"),L(h,"property","og:image"),L(h,"content",f=t[2]+"/assets/social-facebook.jpg"),L(d,"property","og:image:type"),L(d,"content","image/jpeg"),L(p,"property","og:image:width"),L(p,"content","1200"),L(g,"property","og:image:height"),L(g,"content","600"),L(_,"name","twitter:card"),L(_,"content","summary_large_image"),L(b,"name","twitter:site"),L(b,"content","https://pudding.cool"),L(T,"name","twitter:creator"),L(T,"content","@puddingviz"),L(v,"name","twitter:title"),L(v,"content",t[0]),L(E,"name","twitter:description"),L(E,"content",t[1]),L(R,"name","twitter:image:src"),L(R,"content",P=t[2]+"/assets/social-twitter.jpg"),L(M,"name","robots"),L(M,"content","max-image-preview:large"),L(U,"rel","canonical"),L(U,"href",O=t[2]+"/")},m(k,B){H(document.head,i),H(document.head,n),H(document.head,s),H(document.head,r),H(document.head,o),H(document.head,a),H(document.head,c),H(document.head,l),H(document.head,u),H(document.head,h),H(document.head,d),H(document.head,p),H(document.head,g),H(document.head,_),H(document.head,b),H(document.head,T),H(document.head,v),H(document.head,E),H(document.head,R),H(document.head,M),H(document.head,U);for(let F=0;F<V.length;F+=1)V[F]&&V[F].m(document.head,null);H(document.head,D)},p(k,[B]){if(B&1&&e!==(e=k[0])&&(document.title=e),B&2&&L(i,"content",k[1]),B&8&&L(s,"content",k[3]),B&1&&L(r,"content",k[0]),B&4&&L(a,"content",k[2]),B&2&&L(c,"content",k[1]),B&4&&f!==(f=k[2]+"/assets/social-facebook.jpg")&&L(h,"content",f),B&1&&L(v,"content",k[0]),B&2&&L(E,"content",k[1]),B&4&&P!==(P=k[2]+"/assets/social-twitter.jpg")&&L(R,"content",P),B&4&&O!==(O=k[2]+"/")&&L(U,"href",O),B&16){I=sr(k[4]);let F;for(F=0;F<I.length;F+=1){const ee=qd(k,I,F);V[F]?V[F].p(ee,B):(V[F]=Yd(ee),V[F].c(),V[F].m(D.parentNode,D))}for(;F<V.length;F+=1)V[F].d(1);V.length=I.length}},i:St,o:St,d(k){j(i),j(n),j(s),j(r),j(o),j(a),j(c),j(l),j(u),j(h),j(d),j(p),j(g),j(_),j(b),j(T),j(v),j(E),j(R),j(M),j(U),Of(V,k),j(D)}}}function sw(t,e,i){let{title:n="Every Outdoor Basketball Court in the U.S.A."}=e,{description:s="Explore Satellite Imagery of 59,507 Basketball Courts"}=e,{url:r="https://pudding.cool/2024/09/courts"}=e,{keywords:o="basketball,courts,satellite,images"}=e,{preloadFont:a=[]}=e;return t.$$set=c=>{"title"in c&&i(0,n=c.title),"description"in c&&i(1,s=c.description),"url"in c&&i(2,r=c.url),"keywords"in c&&i(3,o=c.keywords),"preloadFont"in c&&i(4,a=c.preloadFont)},[n,s,r,o,a]}class rw extends vn{constructor(e){super(),bn(this,e,sw,nw,Hi,{title:0,description:1,url:2,keywords:3,preloadFont:4})}}function ka(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Bm(t){let e,i,n;t.length!==2?(e=ka,i=(a,c)=>ka(t(a),c),n=(a,c)=>t(a)-c):(e=t===ka||t===ew?t:ow,i=t,n=t);function s(a,c,l=0,u=a.length){if(l<u){if(e(c,c)!==0)return u;do{const h=l+u>>>1;i(a[h],c)<0?l=h+1:u=h}while(l<u)}return l}function r(a,c,l=0,u=a.length){if(l<u){if(e(c,c)!==0)return u;do{const h=l+u>>>1;i(a[h],c)<=0?l=h+1:u=h}while(l<u)}return l}function o(a,c,l=0,u=a.length){const h=s(a,c,l,u-1);return h>l&&n(a[h-1],c)>-n(a[h],c)?h-1:h}return{left:s,center:o,right:r}}function ow(){return 0}function aw(t){return t===null?NaN:+t}const cw=Bm(ka),lw=cw.right;Bm(aw).center;class ts{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const i=this._partials;let n=0;for(let s=0;s<this._n&&s<32;s++){const r=i[s],o=e+r,a=Math.abs(e)<Math.abs(r)?e-(o-r):r-(o-e);a&&(i[n++]=a),e=o}return i[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let i=this._n,n,s,r,o=0;if(i>0){for(o=e[--i];i>0&&(n=o,s=e[--i],o=n+s,r=s-(o-n),!r););i>0&&(r<0&&e[i-1]<0||r>0&&e[i-1]>0)&&(s=r*2,n=o+s,s==n-o&&(o=n))}return o}}const uw=Math.sqrt(50),hw=Math.sqrt(10),fw=Math.sqrt(2);function Xa(t,e,i){const n=(e-t)/Math.max(0,i),s=Math.floor(Math.log10(n)),r=n/Math.pow(10,s),o=r>=uw?10:r>=hw?5:r>=fw?2:1;let a,c,l;return s<0?(l=Math.pow(10,-s)/o,a=Math.round(t*l),c=Math.round(e*l),a/l<t&&++a,c/l>e&&--c,l=-l):(l=Math.pow(10,s)*o,a=Math.round(t/l),c=Math.round(e/l),a*l<t&&++a,c*l>e&&--c),c<a&&.5<=i&&i<2?Xa(t,e,i*2):[a,c,l]}function dw(t,e,i){if(e=+e,t=+t,i=+i,!(i>0))return[];if(t===e)return[t];const n=e<t,[s,r,o]=n?Xa(e,t,i):Xa(t,e,i);if(!(r>=s))return[];const a=r-s+1,c=new Array(a);if(n)if(o<0)for(let l=0;l<a;++l)c[l]=(r-l)/-o;else for(let l=0;l<a;++l)c[l]=(r-l)*o;else if(o<0)for(let l=0;l<a;++l)c[l]=(s+l)/-o;else for(let l=0;l<a;++l)c[l]=(s+l)*o;return c}function Ju(t,e,i){return e=+e,t=+t,i=+i,Xa(t,e,i)[2]}function pw(t,e,i){e=+e,t=+t,i=+i;const n=e<t,s=n?Ju(e,t,i):Ju(t,e,i);return(n?-1:1)*(s<0?1/-s:s)}function*gw(t){for(const e of t)yield*e}function Um(t){return Array.from(gw(t))}function Df(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function zm(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function No(){}var po=.7,qa=1/po,Ks="\\s*([+-]?\\d+)\\s*",go="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",xi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",_w=/^#([0-9a-f]{3,8})$/,mw=new RegExp(`^rgb\\(${Ks},${Ks},${Ks}\\)$`),yw=new RegExp(`^rgb\\(${xi},${xi},${xi}\\)$`),vw=new RegExp(`^rgba\\(${Ks},${Ks},${Ks},${go}\\)$`),bw=new RegExp(`^rgba\\(${xi},${xi},${xi},${go}\\)$`),ww=new RegExp(`^hsl\\(${go},${xi},${xi}\\)$`),Tw=new RegExp(`^hsla\\(${go},${xi},${xi},${go}\\)$`),Kd={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Df(No,_o,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Zd,formatHex:Zd,formatHex8:Ew,formatHsl:Sw,formatRgb:Gd,toString:Gd});function Zd(){return this.rgb().formatHex()}function Ew(){return this.rgb().formatHex8()}function Sw(){return Vm(this).formatHsl()}function Gd(){return this.rgb().formatRgb()}function _o(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=_w.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?Jd(e):i===3?new kt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?Yo(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?Yo(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=mw.exec(t))?new kt(e[1],e[2],e[3],1):(e=yw.exec(t))?new kt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=vw.exec(t))?Yo(e[1],e[2],e[3],e[4]):(e=bw.exec(t))?Yo(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=ww.exec(t))?tp(e[1],e[2]/100,e[3]/100,1):(e=Tw.exec(t))?tp(e[1],e[2]/100,e[3]/100,e[4]):Kd.hasOwnProperty(t)?Jd(Kd[t]):t==="transparent"?new kt(NaN,NaN,NaN,0):null}function Jd(t){return new kt(t>>16&255,t>>8&255,t&255,1)}function Yo(t,e,i,n){return n<=0&&(t=e=i=NaN),new kt(t,e,i,n)}function Aw(t){return t instanceof No||(t=_o(t)),t?(t=t.rgb(),new kt(t.r,t.g,t.b,t.opacity)):new kt}function Qu(t,e,i,n){return arguments.length===1?Aw(t):new kt(t,e,i,n??1)}function kt(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}Df(kt,Qu,zm(No,{brighter(t){return t=t==null?qa:Math.pow(qa,t),new kt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?po:Math.pow(po,t),new kt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new kt(jn(this.r),jn(this.g),jn(this.b),Ya(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Qd,formatHex:Qd,formatHex8:Rw,formatRgb:ep,toString:ep}));function Qd(){return`#${Bn(this.r)}${Bn(this.g)}${Bn(this.b)}`}function Rw(){return`#${Bn(this.r)}${Bn(this.g)}${Bn(this.b)}${Bn((isNaN(this.opacity)?1:this.opacity)*255)}`}function ep(){const t=Ya(this.opacity);return`${t===1?"rgb(":"rgba("}${jn(this.r)}, ${jn(this.g)}, ${jn(this.b)}${t===1?")":`, ${t})`}`}function Ya(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function jn(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Bn(t){return t=jn(t),(t<16?"0":"")+t.toString(16)}function tp(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new oi(t,e,i,n)}function Vm(t){if(t instanceof oi)return new oi(t.h,t.s,t.l,t.opacity);if(t instanceof No||(t=_o(t)),!t)return new oi;if(t instanceof oi)return t;t=t.rgb();var e=t.r/255,i=t.g/255,n=t.b/255,s=Math.min(e,i,n),r=Math.max(e,i,n),o=NaN,a=r-s,c=(r+s)/2;return a?(e===r?o=(i-n)/a+(i<n)*6:i===r?o=(n-e)/a+2:o=(e-i)/a+4,a/=c<.5?r+s:2-r-s,o*=60):a=c>0&&c<1?0:o,new oi(o,a,c,t.opacity)}function eh(t,e,i,n){return arguments.length===1?Vm(t):new oi(t,e,i,n??1)}function oi(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}Df(oi,eh,zm(No,{brighter(t){return t=t==null?qa:Math.pow(qa,t),new oi(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?po:Math.pow(po,t),new oi(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,s=2*i-n;return new kt($l(t>=240?t-240:t+120,s,n),$l(t,s,n),$l(t<120?t+240:t-120,s,n),this.opacity)},clamp(){return new oi(ip(this.h),Ko(this.s),Ko(this.l),Ya(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ya(this.opacity);return`${t===1?"hsl(":"hsla("}${ip(this.h)}, ${Ko(this.s)*100}%, ${Ko(this.l)*100}%${t===1?")":`, ${t})`}`}}));function ip(t){return t=(t||0)%360,t<0?t+360:t}function Ko(t){return Math.max(0,Math.min(1,t||0))}function $l(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}const Ff=t=>()=>t;function Cw(t,e){return function(i){return t+i*e}}function xw(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}function Pw(t){return(t=+t)==1?jm:function(e,i){return i-e?xw(e,i,t):Ff(isNaN(e)?i:e)}}function jm(t,e){var i=e-t;return i?Cw(t,i):Ff(isNaN(t)?e:t)}const np=function t(e){var i=Pw(e);function n(s,r){var o=i((s=Qu(s)).r,(r=Qu(r)).r),a=i(s.g,r.g),c=i(s.b,r.b),l=jm(s.opacity,r.opacity);return function(u){return s.r=o(u),s.g=a(u),s.b=c(u),s.opacity=l(u),s+""}}return n.gamma=t,n}(1);function $m(t,e){e||(e=[]);var i=t?Math.min(e.length,t.length):0,n=e.slice(),s;return function(r){for(s=0;s<i;++s)n[s]=t[s]*(1-r)+e[s]*r;return n}}function Mw(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Iw(t,e){var i=e?e.length:0,n=t?Math.min(i,t.length):0,s=new Array(n),r=new Array(i),o;for(o=0;o<n;++o)s[o]=Lf(t[o],e[o]);for(;o<i;++o)r[o]=e[o];return function(a){for(o=0;o<n;++o)r[o]=s[o](a);return r}}function Ow(t,e){var i=new Date;return t=+t,e=+e,function(n){return i.setTime(t*(1-n)+e*n),i}}function mo(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}function Nw(t,e){var i={},n={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?i[s]=Lf(t[s],e[s]):n[s]=e[s];return function(r){for(s in i)n[s]=i[s](r);return n}}var th=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Hl=new RegExp(th.source,"g");function kw(t){return function(){return t}}function Dw(t){return function(e){return t(e)+""}}function Fw(t,e){var i=th.lastIndex=Hl.lastIndex=0,n,s,r,o=-1,a=[],c=[];for(t=t+"",e=e+"";(n=th.exec(t))&&(s=Hl.exec(e));)(r=s.index)>i&&(r=e.slice(i,r),a[o]?a[o]+=r:a[++o]=r),(n=n[0])===(s=s[0])?a[o]?a[o]+=s:a[++o]=s:(a[++o]=null,c.push({i:o,x:mo(n,s)})),i=Hl.lastIndex;return i<e.length&&(r=e.slice(i),a[o]?a[o]+=r:a[++o]=r),a.length<2?c[0]?Dw(c[0].x):kw(e):(e=c.length,function(l){for(var u=0,h;u<e;++u)a[(h=c[u]).i]=h.x(l);return a.join("")})}function Lf(t,e){var i=typeof e,n;return e==null||i==="boolean"?Ff(e):(i==="number"?mo:i==="string"?(n=_o(e))?(e=n,np):Fw:e instanceof _o?np:e instanceof Date?Ow:Mw(e)?$m:Array.isArray(e)?Iw:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Nw:mo)(t,e)}function Lw(t,e){return t=+t,e=+e,function(i){return Math.round(t*(1-i)+e*i)}}function sp(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var rp={},Wl={},Xl=34,Mr=10,ql=13;function Hm(t){return new Function("d","return {"+t.map(function(e,i){return JSON.stringify(e)+": d["+i+'] || ""'}).join(",")+"}")}function Bw(t,e){var i=Hm(t);return function(n,s){return e(i(n),s,t)}}function op(t){var e=Object.create(null),i=[];return t.forEach(function(n){for(var s in n)s in e||i.push(e[s]=s)}),i}function It(t,e){var i=t+"",n=i.length;return n<e?new Array(e-n+1).join(0)+i:i}function Uw(t){return t<0?"-"+It(-t,6):t>9999?"+"+It(t,6):It(t,4)}function zw(t){var e=t.getUTCHours(),i=t.getUTCMinutes(),n=t.getUTCSeconds(),s=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":Uw(t.getUTCFullYear())+"-"+It(t.getUTCMonth()+1,2)+"-"+It(t.getUTCDate(),2)+(s?"T"+It(e,2)+":"+It(i,2)+":"+It(n,2)+"."+It(s,3)+"Z":n?"T"+It(e,2)+":"+It(i,2)+":"+It(n,2)+"Z":i||e?"T"+It(e,2)+":"+It(i,2)+"Z":"")}function Vw(t){var e=new RegExp('["'+t+`
\r]`),i=t.charCodeAt(0);function n(h,f){var d,p,g=s(h,function(_,b){if(d)return d(_,b-1);p=_,d=f?Bw(_,f):Hm(_)});return g.columns=p||[],g}function s(h,f){var d=[],p=h.length,g=0,_=0,b,T=p<=0,v=!1;h.charCodeAt(p-1)===Mr&&--p,h.charCodeAt(p-1)===ql&&--p;function E(){if(T)return Wl;if(v)return v=!1,rp;var P,M=g,U;if(h.charCodeAt(M)===Xl){for(;g++<p&&h.charCodeAt(g)!==Xl||h.charCodeAt(++g)===Xl;);return(P=g)>=p?T=!0:(U=h.charCodeAt(g++))===Mr?v=!0:U===ql&&(v=!0,h.charCodeAt(g)===Mr&&++g),h.slice(M+1,P-1).replace(/""/g,'"')}for(;g<p;){if((U=h.charCodeAt(P=g++))===Mr)v=!0;else if(U===ql)v=!0,h.charCodeAt(g)===Mr&&++g;else if(U!==i)continue;return h.slice(M,P)}return T=!0,h.slice(M,p)}for(;(b=E())!==Wl;){for(var R=[];b!==rp&&b!==Wl;)R.push(b),b=E();f&&(R=f(R,_++))==null||d.push(R)}return d}function r(h,f){return h.map(function(d){return f.map(function(p){return u(d[p])}).join(t)})}function o(h,f){return f==null&&(f=op(h)),[f.map(u).join(t)].concat(r(h,f)).join(`
`)}function a(h,f){return f==null&&(f=op(h)),r(h,f).join(`
`)}function c(h){return h.map(l).join(`
`)}function l(h){return h.map(u).join(t)}function u(h){return h==null?"":h instanceof Date?zw(h):e.test(h+="")?'"'+h.replace(/"/g,'""')+'"':h}return{parse:n,parseRows:s,format:o,formatBody:a,formatRows:c,formatRow:l,formatValue:u}}var jw=Vw(","),$w=jw.parse;function Hw(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function Ww(t,e){return fetch(t,e).then(Hw)}function Xw(t){return function(e,i,n){return arguments.length===2&&typeof i=="function"&&(n=i,i=void 0),Ww(e,i).then(function(s){return t(s,n)})}}var qw=Xw($w);function Yw(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Ka(t,e){if((i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var i,n=t.slice(0,i);return[n.length>1?n[0]+n.slice(2):n,+t.slice(i+1)]}function or(t){return t=Ka(Math.abs(t)),t?t[1]:NaN}function Kw(t,e){return function(i,n){for(var s=i.length,r=[],o=0,a=t[0],c=0;s>0&&a>0&&(c+a+1>n&&(a=Math.max(1,n-c)),r.push(i.substring(s-=a,s+a)),!((c+=a+1)>n));)a=t[o=(o+1)%t.length];return r.reverse().join(e)}}function Zw(t){return function(e){return e.replace(/[0-9]/g,function(i){return t[+i]})}}var Gw=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Za(t){if(!(e=Gw.exec(t)))throw new Error("invalid format: "+t);var e;return new Bf({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Za.prototype=Bf.prototype;function Bf(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Bf.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Jw(t){e:for(var e=t.length,i=1,n=-1,s;i<e;++i)switch(t[i]){case".":n=s=i;break;case"0":n===0&&(n=i),s=i;break;default:if(!+t[i])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(s+1):t}var Wm;function Qw(t,e){var i=Ka(t,e);if(!i)return t+"";var n=i[0],s=i[1],r=s-(Wm=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,o=n.length;return r===o?n:r>o?n+new Array(r-o+1).join("0"):r>0?n.slice(0,r)+"."+n.slice(r):"0."+new Array(1-r).join("0")+Ka(t,Math.max(0,e+r-1))[0]}function ap(t,e){var i=Ka(t,e);if(!i)return t+"";var n=i[0],s=i[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}const cp={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Yw,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>ap(t*100,e),r:ap,s:Qw,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function lp(t){return t}var up=Array.prototype.map,hp=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function eT(t){var e=t.grouping===void 0||t.thousands===void 0?lp:Kw(up.call(t.grouping,Number),t.thousands+""),i=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",r=t.numerals===void 0?lp:Zw(up.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"−":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function l(h){h=Za(h);var f=h.fill,d=h.align,p=h.sign,g=h.symbol,_=h.zero,b=h.width,T=h.comma,v=h.precision,E=h.trim,R=h.type;R==="n"?(T=!0,R="g"):cp[R]||(v===void 0&&(v=12),E=!0,R="g"),(_||f==="0"&&d==="=")&&(_=!0,f="0",d="=");var P=g==="$"?i:g==="#"&&/[boxX]/.test(R)?"0"+R.toLowerCase():"",M=g==="$"?n:/[%p]/.test(R)?o:"",U=cp[R],O=/[defgprs%]/.test(R);v=v===void 0?6:/[gprs]/.test(R)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function D(I){var V=P,k=M,B,F,ee;if(R==="c")k=U(I)+k,I="";else{I=+I;var _e=I<0||1/I<0;if(I=isNaN(I)?c:U(Math.abs(I),v),E&&(I=Jw(I)),_e&&+I==0&&p!=="+"&&(_e=!1),V=(_e?p==="("?p:a:p==="-"||p==="("?"":p)+V,k=(R==="s"?hp[8+Wm/3]:"")+k+(_e&&p==="("?")":""),O){for(B=-1,F=I.length;++B<F;)if(ee=I.charCodeAt(B),48>ee||ee>57){k=(ee===46?s+I.slice(B+1):I.slice(B))+k,I=I.slice(0,B);break}}}T&&!_&&(I=e(I,1/0));var ae=V.length+I.length+k.length,Ee=ae<b?new Array(b-ae+1).join(f):"";switch(T&&_&&(I=e(Ee+I,Ee.length?b-k.length:1/0),Ee=""),d){case"<":I=V+I+k+Ee;break;case"=":I=V+Ee+I+k;break;case"^":I=Ee.slice(0,ae=Ee.length>>1)+V+I+k+Ee.slice(ae);break;default:I=Ee+V+I+k;break}return r(I)}return D.toString=function(){return h+""},D}function u(h,f){var d=l((h=Za(h),h.type="f",h)),p=Math.max(-8,Math.min(8,Math.floor(or(f)/3)))*3,g=Math.pow(10,-p),_=hp[8+p/3];return function(b){return d(g*b)+_}}return{format:l,formatPrefix:u}}var Zo,Uf,Xm;tT({thousands:",",grouping:[3],currency:["$",""]});function tT(t){return Zo=eT(t),Uf=Zo.format,Xm=Zo.formatPrefix,Zo}function iT(t){return Math.max(0,-or(Math.abs(t)))}function nT(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(or(e)/3)))*3-or(Math.abs(t)))}function sT(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,or(e)-or(t))+1}var Be=1e-6,rT=1e-12,ve=Math.PI,Ht=ve/2,fp=ve/4,Kt=ve*2,ki=180/ve,zt=ve/180,Ge=Math.abs,oT=Math.atan,ar=Math.atan2,Ke=Math.cos,Xe=Math.sin,aT=Math.sign||function(t){return t>0?1:t<0?-1:0},wn=Math.sqrt;function cT(t){return t>1?0:t<-1?ve:Math.acos(t)}function is(t){return t>1?Ht:t<-1?-Ht:Math.asin(t)}function Wt(){}function Ga(t,e){t&&pp.hasOwnProperty(t.type)&&pp[t.type](t,e)}var dp={Feature:function(t,e){Ga(t.geometry,e)},FeatureCollection:function(t,e){for(var i=t.features,n=-1,s=i.length;++n<s;)Ga(i[n].geometry,e)}},pp={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var i=t.coordinates,n=-1,s=i.length;++n<s;)t=i[n],e.point(t[0],t[1],t[2])},LineString:function(t,e){ih(t.coordinates,e,0)},MultiLineString:function(t,e){for(var i=t.coordinates,n=-1,s=i.length;++n<s;)ih(i[n],e,0)},Polygon:function(t,e){gp(t.coordinates,e)},MultiPolygon:function(t,e){for(var i=t.coordinates,n=-1,s=i.length;++n<s;)gp(i[n],e)},GeometryCollection:function(t,e){for(var i=t.geometries,n=-1,s=i.length;++n<s;)Ga(i[n],e)}};function ih(t,e,i){var n=-1,s=t.length-i,r;for(e.lineStart();++n<s;)r=t[n],e.point(r[0],r[1],r[2]);e.lineEnd()}function gp(t,e){var i=-1,n=t.length;for(e.polygonStart();++i<n;)ih(t[i],e,1);e.polygonEnd()}function Os(t,e){t&&dp.hasOwnProperty(t.type)?dp[t.type](t,e):Ga(t,e)}function nh(t){return[ar(t[1],t[0]),is(t[2])]}function cr(t){var e=t[0],i=t[1],n=Ke(i);return[n*Ke(e),n*Xe(e),Xe(i)]}function Go(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ja(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Yl(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Jo(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function sh(t){var e=wn(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function rh(t,e){function i(n,s){return n=t(n,s),e(n[0],n[1])}return t.invert&&e.invert&&(i.invert=function(n,s){return n=e.invert(n,s),n&&t.invert(n[0],n[1])}),i}function oh(t,e){return Ge(t)>ve&&(t-=Math.round(t/Kt)*Kt),[t,e]}oh.invert=oh;function lT(t,e,i){return(t%=Kt)?e||i?rh(mp(t),yp(e,i)):mp(t):e||i?yp(e,i):oh}function _p(t){return function(e,i){return e+=t,Ge(e)>ve&&(e-=Math.round(e/Kt)*Kt),[e,i]}}function mp(t){var e=_p(t);return e.invert=_p(-t),e}function yp(t,e){var i=Ke(t),n=Xe(t),s=Ke(e),r=Xe(e);function o(a,c){var l=Ke(c),u=Ke(a)*l,h=Xe(a)*l,f=Xe(c),d=f*i+u*n;return[ar(h*s-d*r,u*i-f*n),is(d*s+h*r)]}return o.invert=function(a,c){var l=Ke(c),u=Ke(a)*l,h=Xe(a)*l,f=Xe(c),d=f*s-h*r;return[ar(h*s+f*r,u*i+d*n),is(d*i-u*n)]},o}function uT(t,e,i,n,s,r){if(i){var o=Ke(e),a=Xe(e),c=n*i;s==null?(s=e+n*Kt,r=e-c/2):(s=vp(o,s),r=vp(o,r),(n>0?s<r:s>r)&&(s+=n*Kt));for(var l,u=s;n>0?u>r:u<r;u-=c)l=nh([o,-a*Ke(u),-a*Xe(u)]),t.point(l[0],l[1])}}function vp(t,e){e=cr(e),e[0]-=t,sh(e);var i=cT(-e[1]);return((-e[2]<0?-i:i)+Kt-Be)%Kt}function qm(){var t=[],e;return{point:function(i,n,s){e.push([i,n,s])},lineStart:function(){t.push(e=[])},lineEnd:Wt,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var i=t;return t=[],e=null,i}}}function Da(t,e){return Ge(t[0]-e[0])<Be&&Ge(t[1]-e[1])<Be}function Qo(t,e,i,n){this.x=t,this.z=e,this.o=i,this.e=n,this.v=!1,this.n=this.p=null}function Ym(t,e,i,n,s){var r=[],o=[],a,c;if(t.forEach(function(p){if(!((g=p.length-1)<=0)){var g,_=p[0],b=p[g],T;if(Da(_,b)){if(!_[2]&&!b[2]){for(s.lineStart(),a=0;a<g;++a)s.point((_=p[a])[0],_[1]);s.lineEnd();return}b[0]+=2*Be}r.push(T=new Qo(_,p,null,!0)),o.push(T.o=new Qo(_,null,T,!1)),r.push(T=new Qo(b,p,null,!1)),o.push(T.o=new Qo(b,null,T,!0))}}),!!r.length){for(o.sort(e),bp(r),bp(o),a=0,c=o.length;a<c;++a)o[a].e=i=!i;for(var l=r[0],u,h;;){for(var f=l,d=!0;f.v;)if((f=f.n)===l)return;u=f.z,s.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(a=0,c=u.length;a<c;++a)s.point((h=u[a])[0],h[1]);else n(f.x,f.n.x,1,s);f=f.n}else{if(d)for(u=f.p.z,a=u.length-1;a>=0;--a)s.point((h=u[a])[0],h[1]);else n(f.x,f.p.x,-1,s);f=f.p}f=f.o,u=f.z,d=!d}while(!f.v);s.lineEnd()}}}function bp(t){if(e=t.length){for(var e,i=0,n=t[0],s;++i<e;)n.n=s=t[i],s.p=n,n=s;n.n=s=t[0],s.p=n}}function Kl(t){return Ge(t[0])<=ve?t[0]:aT(t[0])*((Ge(t[0])+ve)%Kt-ve)}function hT(t,e){var i=Kl(e),n=e[1],s=Xe(n),r=[Xe(i),-Ke(i),0],o=0,a=0,c=new ts;s===1?n=Ht+Be:s===-1&&(n=-Ht-Be);for(var l=0,u=t.length;l<u;++l)if(f=(h=t[l]).length)for(var h,f,d=h[f-1],p=Kl(d),g=d[1]/2+fp,_=Xe(g),b=Ke(g),T=0;T<f;++T,p=E,_=P,b=M,d=v){var v=h[T],E=Kl(v),R=v[1]/2+fp,P=Xe(R),M=Ke(R),U=E-p,O=U>=0?1:-1,D=O*U,I=D>ve,V=_*P;if(c.add(ar(V*O*Xe(D),b*M+V*Ke(D))),o+=I?U+O*Kt:U,I^p>=i^E>=i){var k=Ja(cr(d),cr(v));sh(k);var B=Ja(r,k);sh(B);var F=(I^U>=0?-1:1)*is(B[2]);(n>F||n===F&&(k[0]||k[1]))&&(a+=I^U>=0?1:-1)}}return(o<-Be||o<Be&&c<-rT)^a&1}function Km(t,e,i,n){return function(s){var r=e(s),o=qm(),a=e(o),c=!1,l,u,h,f={point:d,lineStart:g,lineEnd:_,polygonStart:function(){f.point=b,f.lineStart=T,f.lineEnd=v,u=[],l=[]},polygonEnd:function(){f.point=d,f.lineStart=g,f.lineEnd=_,u=Um(u);var E=hT(l,n);u.length?(c||(s.polygonStart(),c=!0),Ym(u,dT,E,i,s)):E&&(c||(s.polygonStart(),c=!0),s.lineStart(),i(null,null,1,s),s.lineEnd()),c&&(s.polygonEnd(),c=!1),u=l=null},sphere:function(){s.polygonStart(),s.lineStart(),i(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function d(E,R){t(E,R)&&s.point(E,R)}function p(E,R){r.point(E,R)}function g(){f.point=p,r.lineStart()}function _(){f.point=d,r.lineEnd()}function b(E,R){h.push([E,R]),a.point(E,R)}function T(){a.lineStart(),h=[]}function v(){b(h[0][0],h[0][1]),a.lineEnd();var E=a.clean(),R=o.result(),P,M=R.length,U,O,D;if(h.pop(),l.push(h),h=null,!!M){if(E&1){if(O=R[0],(U=O.length-1)>0){for(c||(s.polygonStart(),c=!0),s.lineStart(),P=0;P<U;++P)s.point((D=O[P])[0],D[1]);s.lineEnd()}return}M>1&&E&2&&R.push(R.pop().concat(R.shift())),u.push(R.filter(fT))}}return f}}function fT(t){return t.length>1}function dT(t,e){return((t=t.x)[0]<0?t[1]-Ht-Be:Ht-t[1])-((e=e.x)[0]<0?e[1]-Ht-Be:Ht-e[1])}const wp=Km(function(){return!0},pT,_T,[-ve,-Ht]);function pT(t){var e=NaN,i=NaN,n=NaN,s;return{lineStart:function(){t.lineStart(),s=1},point:function(r,o){var a=r>0?ve:-ve,c=Ge(r-e);Ge(c-ve)<Be?(t.point(e,i=(i+o)/2>0?Ht:-Ht),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(a,i),t.point(r,i),s=0):n!==a&&c>=ve&&(Ge(e-n)<Be&&(e-=n*Be),Ge(r-a)<Be&&(r-=a*Be),i=gT(e,i,r,o),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(a,i),s=0),t.point(e=r,i=o),n=a},lineEnd:function(){t.lineEnd(),e=i=NaN},clean:function(){return 2-s}}}function gT(t,e,i,n){var s,r,o=Xe(t-i);return Ge(o)>Be?oT((Xe(e)*(r=Ke(n))*Xe(i)-Xe(n)*(s=Ke(e))*Xe(t))/(s*r*o)):(e+n)/2}function _T(t,e,i,n){var s;if(t==null)s=i*Ht,n.point(-ve,s),n.point(0,s),n.point(ve,s),n.point(ve,0),n.point(ve,-s),n.point(0,-s),n.point(-ve,-s),n.point(-ve,0),n.point(-ve,s);else if(Ge(t[0]-e[0])>Be){var r=t[0]<e[0]?ve:-ve;s=i*r/2,n.point(-r,s),n.point(0,s),n.point(r,s)}else n.point(e[0],e[1])}function mT(t){var e=Ke(t),i=2*zt,n=e>0,s=Ge(e)>Be;function r(u,h,f,d){uT(d,t,i,f,u,h)}function o(u,h){return Ke(u)*Ke(h)>e}function a(u){var h,f,d,p,g;return{lineStart:function(){p=d=!1,g=1},point:function(_,b){var T=[_,b],v,E=o(_,b),R=n?E?0:l(_,b):E?l(_+(_<0?ve:-ve),b):0;if(!h&&(p=d=E)&&u.lineStart(),E!==d&&(v=c(h,T),(!v||Da(h,v)||Da(T,v))&&(T[2]=1)),E!==d)g=0,E?(u.lineStart(),v=c(T,h),u.point(v[0],v[1])):(v=c(h,T),u.point(v[0],v[1],2),u.lineEnd()),h=v;else if(s&&h&&n^E){var P;!(R&f)&&(P=c(T,h,!0))&&(g=0,n?(u.lineStart(),u.point(P[0][0],P[0][1]),u.point(P[1][0],P[1][1]),u.lineEnd()):(u.point(P[1][0],P[1][1]),u.lineEnd(),u.lineStart(),u.point(P[0][0],P[0][1],3)))}E&&(!h||!Da(h,T))&&u.point(T[0],T[1]),h=T,d=E,f=R},lineEnd:function(){d&&u.lineEnd(),h=null},clean:function(){return g|(p&&d)<<1}}}function c(u,h,f){var d=cr(u),p=cr(h),g=[1,0,0],_=Ja(d,p),b=Go(_,_),T=_[0],v=b-T*T;if(!v)return!f&&u;var E=e*b/v,R=-e*T/v,P=Ja(g,_),M=Jo(g,E),U=Jo(_,R);Yl(M,U);var O=P,D=Go(M,O),I=Go(O,O),V=D*D-I*(Go(M,M)-1);if(!(V<0)){var k=wn(V),B=Jo(O,(-D-k)/I);if(Yl(B,M),B=nh(B),!f)return B;var F=u[0],ee=h[0],_e=u[1],ae=h[1],Ee;ee<F&&(Ee=F,F=ee,ee=Ee);var vt=ee-F,ke=Ge(vt-ve)<Be,Je=ke||vt<Be;if(!ke&&ae<_e&&(Ee=_e,_e=ae,ae=Ee),Je?ke?_e+ae>0^B[1]<(Ge(B[0]-F)<Be?_e:ae):_e<=B[1]&&B[1]<=ae:vt>ve^(F<=B[0]&&B[0]<=ee)){var Qe=Jo(O,(-D+k)/I);return Yl(Qe,M),[B,nh(Qe)]}}}function l(u,h){var f=n?t:ve-t,d=0;return u<-f?d|=1:u>f&&(d|=2),h<-f?d|=4:h>f&&(d|=8),d}return Km(o,a,r,n?[0,-t]:[-ve,t-ve])}function yT(t,e,i,n,s,r){var o=t[0],a=t[1],c=e[0],l=e[1],u=0,h=1,f=c-o,d=l-a,p;if(p=i-o,!(!f&&p>0)){if(p/=f,f<0){if(p<u)return;p<h&&(h=p)}else if(f>0){if(p>h)return;p>u&&(u=p)}if(p=s-o,!(!f&&p<0)){if(p/=f,f<0){if(p>h)return;p>u&&(u=p)}else if(f>0){if(p<u)return;p<h&&(h=p)}if(p=n-a,!(!d&&p>0)){if(p/=d,d<0){if(p<u)return;p<h&&(h=p)}else if(d>0){if(p>h)return;p>u&&(u=p)}if(p=r-a,!(!d&&p<0)){if(p/=d,d<0){if(p>h)return;p>u&&(u=p)}else if(d>0){if(p<u)return;p<h&&(h=p)}return u>0&&(t[0]=o+u*f,t[1]=a+u*d),h<1&&(e[0]=o+h*f,e[1]=a+h*d),!0}}}}}var Vr=1e9,ea=-Vr;function vT(t,e,i,n){function s(l,u){return t<=l&&l<=i&&e<=u&&u<=n}function r(l,u,h,f){var d=0,p=0;if(l==null||(d=o(l,h))!==(p=o(u,h))||c(l,u)<0^h>0)do f.point(d===0||d===3?t:i,d>1?n:e);while((d=(d+h+4)%4)!==p);else f.point(u[0],u[1])}function o(l,u){return Ge(l[0]-t)<Be?u>0?0:3:Ge(l[0]-i)<Be?u>0?2:1:Ge(l[1]-e)<Be?u>0?1:0:u>0?3:2}function a(l,u){return c(l.x,u.x)}function c(l,u){var h=o(l,1),f=o(u,1);return h!==f?h-f:h===0?u[1]-l[1]:h===1?l[0]-u[0]:h===2?l[1]-u[1]:u[0]-l[0]}return function(l){var u=l,h=qm(),f,d,p,g,_,b,T,v,E,R,P,M={point:U,lineStart:V,lineEnd:k,polygonStart:D,polygonEnd:I};function U(F,ee){s(F,ee)&&u.point(F,ee)}function O(){for(var F=0,ee=0,_e=d.length;ee<_e;++ee)for(var ae=d[ee],Ee=1,vt=ae.length,ke=ae[0],Je,Qe,je=ke[0],et=ke[1];Ee<vt;++Ee)Je=je,Qe=et,ke=ae[Ee],je=ke[0],et=ke[1],Qe<=n?et>n&&(je-Je)*(n-Qe)>(et-Qe)*(t-Je)&&++F:et<=n&&(je-Je)*(n-Qe)<(et-Qe)*(t-Je)&&--F;return F}function D(){u=h,f=[],d=[],P=!0}function I(){var F=O(),ee=P&&F,_e=(f=Um(f)).length;(ee||_e)&&(l.polygonStart(),ee&&(l.lineStart(),r(null,null,1,l),l.lineEnd()),_e&&Ym(f,a,F,r,l),l.polygonEnd()),u=l,f=d=p=null}function V(){M.point=B,d&&d.push(p=[]),R=!0,E=!1,T=v=NaN}function k(){f&&(B(g,_),b&&E&&h.rejoin(),f.push(h.result())),M.point=U,E&&u.lineEnd()}function B(F,ee){var _e=s(F,ee);if(d&&p.push([F,ee]),R)g=F,_=ee,b=_e,R=!1,_e&&(u.lineStart(),u.point(F,ee));else if(_e&&E)u.point(F,ee);else{var ae=[T=Math.max(ea,Math.min(Vr,T)),v=Math.max(ea,Math.min(Vr,v))],Ee=[F=Math.max(ea,Math.min(Vr,F)),ee=Math.max(ea,Math.min(Vr,ee))];yT(ae,Ee,t,e,i,n)?(E||(u.lineStart(),u.point(ae[0],ae[1])),u.point(Ee[0],Ee[1]),_e||u.lineEnd(),P=!1):_e&&(u.lineStart(),u.point(F,ee),P=!1)}T=F,v=ee,E=_e}return M}}const ah=t=>t;var Zl=new ts,ch=new ts,Zm,Gm,lh,uh,Li={point:Wt,lineStart:Wt,lineEnd:Wt,polygonStart:function(){Li.lineStart=bT,Li.lineEnd=TT},polygonEnd:function(){Li.lineStart=Li.lineEnd=Li.point=Wt,Zl.add(Ge(ch)),ch=new ts},result:function(){var t=Zl/2;return Zl=new ts,t}};function bT(){Li.point=wT}function wT(t,e){Li.point=Jm,Zm=lh=t,Gm=uh=e}function Jm(t,e){ch.add(uh*t-lh*e),lh=t,uh=e}function TT(){Jm(Zm,Gm)}var lr=1/0,Qa=lr,yo=-lr,ec=yo,tc={point:ET,lineStart:Wt,lineEnd:Wt,polygonStart:Wt,polygonEnd:Wt,result:function(){var t=[[lr,Qa],[yo,ec]];return yo=ec=-(Qa=lr=1/0),t}};function ET(t,e){t<lr&&(lr=t),t>yo&&(yo=t),e<Qa&&(Qa=e),e>ec&&(ec=e)}var hh=0,fh=0,jr=0,ic=0,nc=0,Fs=0,dh=0,ph=0,$r=0,Qm,ey,Si,Ai,$t={point:ns,lineStart:Tp,lineEnd:Ep,polygonStart:function(){$t.lineStart=RT,$t.lineEnd=CT},polygonEnd:function(){$t.point=ns,$t.lineStart=Tp,$t.lineEnd=Ep},result:function(){var t=$r?[dh/$r,ph/$r]:Fs?[ic/Fs,nc/Fs]:jr?[hh/jr,fh/jr]:[NaN,NaN];return hh=fh=jr=ic=nc=Fs=dh=ph=$r=0,t}};function ns(t,e){hh+=t,fh+=e,++jr}function Tp(){$t.point=ST}function ST(t,e){$t.point=AT,ns(Si=t,Ai=e)}function AT(t,e){var i=t-Si,n=e-Ai,s=wn(i*i+n*n);ic+=s*(Si+t)/2,nc+=s*(Ai+e)/2,Fs+=s,ns(Si=t,Ai=e)}function Ep(){$t.point=ns}function RT(){$t.point=xT}function CT(){ty(Qm,ey)}function xT(t,e){$t.point=ty,ns(Qm=Si=t,ey=Ai=e)}function ty(t,e){var i=t-Si,n=e-Ai,s=wn(i*i+n*n);ic+=s*(Si+t)/2,nc+=s*(Ai+e)/2,Fs+=s,s=Ai*t-Si*e,dh+=s*(Si+t),ph+=s*(Ai+e),$r+=s*3,ns(Si=t,Ai=e)}function iy(t){this._context=t}iy.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:{this._context.moveTo(t,e),this._point=1;break}case 1:{this._context.lineTo(t,e);break}default:{this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,Kt);break}}},result:Wt};var gh=new ts,Gl,ny,sy,Hr,Wr,vo={point:Wt,lineStart:function(){vo.point=PT},lineEnd:function(){Gl&&ry(ny,sy),vo.point=Wt},polygonStart:function(){Gl=!0},polygonEnd:function(){Gl=null},result:function(){var t=+gh;return gh=new ts,t}};function PT(t,e){vo.point=ry,ny=Hr=t,sy=Wr=e}function ry(t,e){Hr-=t,Wr-=e,gh.add(wn(Hr*Hr+Wr*Wr)),Hr=t,Wr=e}let Sp,sc,Ap,Rp;class Cp{constructor(e){this._append=e==null?oy:MT(e),this._radius=4.5,this._=""}pointRadius(e){return this._radius=+e,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(e,i){switch(this._point){case 0:{this._append`M${e},${i}`,this._point=1;break}case 1:{this._append`L${e},${i}`;break}default:{if(this._append`M${e},${i}`,this._radius!==Ap||this._append!==sc){const n=this._radius,s=this._;this._="",this._append`m0,${n}a${n},${n} 0 1,1 0,${-2*n}a${n},${n} 0 1,1 0,${2*n}z`,Ap=n,sc=this._append,Rp=this._,this._=s}this._+=Rp;break}}}result(){const e=this._;return this._="",e.length?e:null}}function oy(t){let e=1;this._+=t[0];for(const i=t.length;e<i;++e)this._+=arguments[e]+t[e]}function MT(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return oy;if(e!==Sp){const i=10**e;Sp=e,sc=function(s){let r=1;this._+=s[0];for(const o=s.length;r<o;++r)this._+=Math.round(arguments[r]*i)/i+s[r]}}return sc}function IT(t,e){let i=3,n=4.5,s,r;function o(a){return a&&(typeof n=="function"&&r.pointRadius(+n.apply(this,arguments)),Os(a,s(r))),r.result()}return o.area=function(a){return Os(a,s(Li)),Li.result()},o.measure=function(a){return Os(a,s(vo)),vo.result()},o.bounds=function(a){return Os(a,s(tc)),tc.result()},o.centroid=function(a){return Os(a,s($t)),$t.result()},o.projection=function(a){return arguments.length?(s=a==null?(t=null,ah):(t=a).stream,o):t},o.context=function(a){return arguments.length?(r=a==null?(e=null,new Cp(i)):new iy(e=a),typeof n!="function"&&r.pointRadius(n),o):e},o.pointRadius=function(a){return arguments.length?(n=typeof a=="function"?a:(r.pointRadius(+a),+a),o):n},o.digits=function(a){if(!arguments.length)return i;if(a==null)i=null;else{const c=Math.floor(a);if(!(c>=0))throw new RangeError(`invalid digits: ${a}`);i=c}return e===null&&(r=new Cp(i)),o},o.projection(t).digits(i).context(e)}function zf(t){return function(e){var i=new _h;for(var n in t)i[n]=t[n];return i.stream=e,i}}function _h(){}_h.prototype={constructor:_h,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Vf(t,e,i){var n=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),n!=null&&t.clipExtent(null),Os(i,t.stream(tc)),e(tc.result()),n!=null&&t.clipExtent(n),t}function ay(t,e,i){return Vf(t,function(n){var s=e[1][0]-e[0][0],r=e[1][1]-e[0][1],o=Math.min(s/(n[1][0]-n[0][0]),r/(n[1][1]-n[0][1])),a=+e[0][0]+(s-o*(n[1][0]+n[0][0]))/2,c=+e[0][1]+(r-o*(n[1][1]+n[0][1]))/2;t.scale(150*o).translate([a,c])},i)}function OT(t,e,i){return ay(t,[[0,0],e],i)}function NT(t,e,i){return Vf(t,function(n){var s=+e,r=s/(n[1][0]-n[0][0]),o=(s-r*(n[1][0]+n[0][0]))/2,a=-r*n[0][1];t.scale(150*r).translate([o,a])},i)}function kT(t,e,i){return Vf(t,function(n){var s=+e,r=s/(n[1][1]-n[0][1]),o=-r*n[0][0],a=(s-r*(n[1][1]+n[0][1]))/2;t.scale(150*r).translate([o,a])},i)}var xp=16,DT=Ke(30*zt);function Pp(t,e){return+e?LT(t,e):FT(t)}function FT(t){return zf({point:function(e,i){e=t(e,i),this.stream.point(e[0],e[1])}})}function LT(t,e){function i(n,s,r,o,a,c,l,u,h,f,d,p,g,_){var b=l-n,T=u-s,v=b*b+T*T;if(v>4*e&&g--){var E=o+f,R=a+d,P=c+p,M=wn(E*E+R*R+P*P),U=is(P/=M),O=Ge(Ge(P)-1)<Be||Ge(r-h)<Be?(r+h)/2:ar(R,E),D=t(O,U),I=D[0],V=D[1],k=I-n,B=V-s,F=T*k-b*B;(F*F/v>e||Ge((b*k+T*B)/v-.5)>.3||o*f+a*d+c*p<DT)&&(i(n,s,r,o,a,c,I,V,O,E/=M,R/=M,P,g,_),_.point(I,V),i(I,V,O,E,R,P,l,u,h,f,d,p,g,_))}}return function(n){var s,r,o,a,c,l,u,h,f,d,p,g,_={point:b,lineStart:T,lineEnd:E,polygonStart:function(){n.polygonStart(),_.lineStart=R},polygonEnd:function(){n.polygonEnd(),_.lineStart=T}};function b(U,O){U=t(U,O),n.point(U[0],U[1])}function T(){h=NaN,_.point=v,n.lineStart()}function v(U,O){var D=cr([U,O]),I=t(U,O);i(h,f,u,d,p,g,h=I[0],f=I[1],u=U,d=D[0],p=D[1],g=D[2],xp,n),n.point(h,f)}function E(){_.point=b,n.lineEnd()}function R(){T(),_.point=P,_.lineEnd=M}function P(U,O){v(s=U,O),r=h,o=f,a=d,c=p,l=g,_.point=v}function M(){i(h,f,u,d,p,g,r,o,s,a,c,l,xp,n),_.lineEnd=E,E()}return _}}var BT=zf({point:function(t,e){this.stream.point(t*zt,e*zt)}});function UT(t){return zf({point:function(e,i){var n=t(e,i);return this.stream.point(n[0],n[1])}})}function zT(t,e,i,n,s){function r(o,a){return o*=n,a*=s,[e+t*o,i-t*a]}return r.invert=function(o,a){return[(o-e)/t*n,(i-a)/t*s]},r}function Mp(t,e,i,n,s,r){if(!r)return zT(t,e,i,n,s);var o=Ke(r),a=Xe(r),c=o*t,l=a*t,u=o/t,h=a/t,f=(a*i-o*e)/t,d=(a*e+o*i)/t;function p(g,_){return g*=n,_*=s,[c*g-l*_+e,i-l*g-c*_]}return p.invert=function(g,_){return[n*(u*g-h*_+f),s*(d-h*g-u*_)]},p}function cy(t){return VT(function(){return t})()}function VT(t){var e,i=150,n=480,s=250,r=0,o=0,a=0,c=0,l=0,u,h=0,f=1,d=1,p=null,g=wp,_=null,b,T,v,E=ah,R=.5,P,M,U,O,D;function I(F){return U(F[0]*zt,F[1]*zt)}function V(F){return F=U.invert(F[0],F[1]),F&&[F[0]*ki,F[1]*ki]}I.stream=function(F){return O&&D===F?O:O=BT(UT(u)(g(P(E(D=F)))))},I.preclip=function(F){return arguments.length?(g=F,p=void 0,B()):g},I.postclip=function(F){return arguments.length?(E=F,_=b=T=v=null,B()):E},I.clipAngle=function(F){return arguments.length?(g=+F?mT(p=F*zt):(p=null,wp),B()):p*ki},I.clipExtent=function(F){return arguments.length?(E=F==null?(_=b=T=v=null,ah):vT(_=+F[0][0],b=+F[0][1],T=+F[1][0],v=+F[1][1]),B()):_==null?null:[[_,b],[T,v]]},I.scale=function(F){return arguments.length?(i=+F,k()):i},I.translate=function(F){return arguments.length?(n=+F[0],s=+F[1],k()):[n,s]},I.center=function(F){return arguments.length?(r=F[0]%360*zt,o=F[1]%360*zt,k()):[r*ki,o*ki]},I.rotate=function(F){return arguments.length?(a=F[0]%360*zt,c=F[1]%360*zt,l=F.length>2?F[2]%360*zt:0,k()):[a*ki,c*ki,l*ki]},I.angle=function(F){return arguments.length?(h=F%360*zt,k()):h*ki},I.reflectX=function(F){return arguments.length?(f=F?-1:1,k()):f<0},I.reflectY=function(F){return arguments.length?(d=F?-1:1,k()):d<0},I.precision=function(F){return arguments.length?(P=Pp(M,R=F*F),B()):wn(R)},I.fitExtent=function(F,ee){return ay(I,F,ee)},I.fitSize=function(F,ee){return OT(I,F,ee)},I.fitWidth=function(F,ee){return NT(I,F,ee)},I.fitHeight=function(F,ee){return kT(I,F,ee)};function k(){var F=Mp(i,0,0,f,d,h).apply(null,e(r,o)),ee=Mp(i,n-F[0],s-F[1],f,d,h);return u=lT(a,c,l),M=rh(e,ee),U=rh(u,M),P=Pp(M,R),B()}function B(){return O=D=null,I}return function(){return e=t.apply(this,arguments),I.invert=e.invert&&V,k()}}function jT(t){return function(e,i){var n=wn(e*e+i*i),s=t(n),r=Xe(s),o=Ke(s);return[ar(e*r,n*o),is(n&&i*r/n)]}}function ly(t,e){return[Ke(e)*Xe(t),Xe(e)]}ly.invert=jT(is);function $T(){return cy(ly).scale(249.5).clipAngle(90+Be)}function HT(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function WT(t){return function(){return t}}function XT(t){return+t}var Ip=[0,1];function on(t){return t}function mh(t,e){return(e-=t=+t)?function(i){return(i-t)/e}:WT(isNaN(e)?NaN:.5)}function qT(t,e){var i;return t>e&&(i=t,t=e,e=i),function(n){return Math.max(t,Math.min(e,n))}}function YT(t,e,i){var n=t[0],s=t[1],r=e[0],o=e[1];return s<n?(n=mh(s,n),r=i(o,r)):(n=mh(n,s),r=i(r,o)),function(a){return r(n(a))}}function KT(t,e,i){var n=Math.min(t.length,e.length)-1,s=new Array(n),r=new Array(n),o=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<n;)s[o]=mh(t[o],t[o+1]),r[o]=i(e[o],e[o+1]);return function(a){var c=lw(t,a,1,n)-1;return r[c](s[c](a))}}function ZT(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function GT(){var t=Ip,e=Ip,i=Lf,n,s,r,o=on,a,c,l;function u(){var f=Math.min(t.length,e.length);return o!==on&&(o=qT(t[0],t[f-1])),a=f>2?KT:YT,c=l=null,h}function h(f){return f==null||isNaN(f=+f)?r:(c||(c=a(t.map(n),e,i)))(n(o(f)))}return h.invert=function(f){return o(s((l||(l=a(e,t.map(n),mo)))(f)))},h.domain=function(f){return arguments.length?(t=Array.from(f,XT),u()):t.slice()},h.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},h.rangeRound=function(f){return e=Array.from(f),i=Lw,u()},h.clamp=function(f){return arguments.length?(o=f?!0:on,u()):o!==on},h.interpolate=function(f){return arguments.length?(i=f,u()):i},h.unknown=function(f){return arguments.length?(r=f,h):r},function(f,d){return n=f,s=d,u()}}function JT(t,e,i,n){var s=pw(t,e,i),r;switch(n=Za(n??",f"),n.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(r=nT(s,o))&&(n.precision=r),Xm(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(r=sT(s,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=r-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(r=iT(s))&&(n.precision=r-(n.type==="%")*2);break}}return Uf(n)}function QT(t){var e=t.domain;return t.ticks=function(i){var n=e();return dw(n[0],n[n.length-1],i??10)},t.tickFormat=function(i,n){var s=e();return JT(s[0],s[s.length-1],i??10,n)},t.nice=function(i){i==null&&(i=10);var n=e(),s=0,r=n.length-1,o=n[s],a=n[r],c,l,u=10;for(a<o&&(l=o,o=a,a=l,l=s,s=r,r=l);u-- >0;){if(l=Ju(o,a,i),l===c)return n[s]=o,n[r]=a,e(n);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;c=l}return t},t}function Op(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function eE(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function tE(t){return t<0?-t*t:t*t}function iE(t){var e=t(on,on),i=1;function n(){return i===1?t(on,on):i===.5?t(eE,tE):t(Op(i),Op(1/i))}return e.exponent=function(s){return arguments.length?(i=+s,n()):i},QT(e)}function yh(){var t=iE(GT());return t.copy=function(){return ZT(t,yh()).exponent(t.exponent())},HT.apply(t,arguments),t}function jf(t,e,i){i===void 0&&(i={});var n={type:"Feature"};return(i.id===0||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=e||{},n.geometry=t,n}function nE(t,e,i){if(i===void 0&&(i={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Np(t[0])||!Np(t[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:t};return jf(n,e,i)}function sE(t,e,i){i===void 0&&(i={});for(var n=0,s=t;n<s.length;n++){var r=s[n];if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<r[r.length-1].length;o++)if(r[r.length-1][o]!==r[0][o])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:t};return jf(a,e,i)}function rE(t,e){e===void 0&&(e={});var i={type:"FeatureCollection"};return e.id&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.features=t,i}function oE(t,e,i){i===void 0&&(i={});var n={type:"MultiPoint",coordinates:t};return jf(n,e,i)}function Np(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function uy(t,e,i){if(t!==null)for(var n,s,r,o,a,c,l,u=0,h=0,f,d=t.type,p=d==="FeatureCollection",g=d==="Feature",_=p?t.features.length:1,b=0;b<_;b++){l=p?t.features[b].geometry:g?t.geometry:t,f=l?l.type==="GeometryCollection":!1,a=f?l.geometries.length:1;for(var T=0;T<a;T++){var v=0,E=0;if(o=f?l.geometries[T]:l,o!==null){c=o.coordinates;var R=o.type;switch(u=i&&(R==="Polygon"||R==="MultiPolygon")?1:0,R){case null:break;case"Point":if(e(c,h,b,v,E)===!1)return!1;h++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(e(c[n],h,b,v,E)===!1)return!1;h++,R==="MultiPoint"&&v++}R==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(s=0;s<c[n].length-u;s++){if(e(c[n][s],h,b,v,E)===!1)return!1;h++}R==="MultiLineString"&&v++,R==="Polygon"&&E++}R==="Polygon"&&v++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(E=0,s=0;s<c[n].length;s++){for(r=0;r<c[n][s].length-u;r++){if(e(c[n][s][r],h,b,v,E)===!1)return!1;h++}E++}v++}break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(uy(o.geometries[n],e,i)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function aE(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var i=0;i<t.features.length&&e(t.features[i],i)!==!1;i++);}function kp(t,e){var i,n,s,r,o,a,c,l,u,h,f=0,d=t.type==="FeatureCollection",p=t.type==="Feature",g=d?t.features.length:1;for(i=0;i<g;i++){for(a=d?t.features[i].geometry:p?t.geometry:t,l=d?t.features[i].properties:p?t.properties:{},u=d?t.features[i].bbox:p?t.bbox:void 0,h=d?t.features[i].id:p?t.id:void 0,c=a?a.type==="GeometryCollection":!1,o=c?a.geometries.length:1,s=0;s<o;s++){if(r=c?a.geometries[s]:a,r===null){if(e(null,f,l,u,h)===!1)return!1;continue}switch(r.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(r,f,l,u,h)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<r.geometries.length;n++)if(e(r.geometries[n],f,l,u,h)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}f++}}function cE(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function lE(t){return t.type==="Feature"?t.geometry:t}function Dp(t,e,i){if(i===void 0&&(i={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=cE(t),s=lE(e),r=s.type,o=e.bbox,a=s.coordinates;if(o&&uE(n,o)===!1)return!1;r==="Polygon"&&(a=[a]);for(var c=!1,l=0;l<a.length&&!c;l++)if(Fp(n,a[l][0],i.ignoreBoundary)){for(var u=!1,h=1;h<a[l].length&&!u;)Fp(n,a[l][h],!i.ignoreBoundary)&&(u=!0),h++;u||(c=!0)}return c}function Fp(t,e,i){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var s=0,r=e.length-1;s<e.length;r=s++){var o=e[s][0],a=e[s][1],c=e[r][0],l=e[r][1],u=t[1]*(o-c)+a*(c-t[0])+l*(t[0]-o)===0&&(o-t[0])*(c-t[0])<=0&&(a-t[1])*(l-t[1])<=0;if(u)return!i;var h=a>t[1]!=l>t[1]&&t[0]<(c-o)*(t[1]-a)/(l-a)+o;h&&(n=!n)}return n}function uE(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}function hE(t,e){var i=[];return aE(t,function(n){var s=!1;if(n.geometry.type==="Point")kp(e,function(o){Dp(n,o)&&(s=!0)}),s&&i.push(n);else if(n.geometry.type==="MultiPoint"){var r=[];kp(e,function(o){uy(n,function(a){Dp(a,o)&&(s=!0,r.push(a))})}),s&&i.push(oE(r))}else throw new Error("Input geometry must be a Point or MultiPoint")}),rE(i)}function fE(t){return t}function dE(t){if(t==null)return fE;var e,i,n=t.scale[0],s=t.scale[1],r=t.translate[0],o=t.translate[1];return function(a,c){c||(e=i=0);var l=2,u=a.length,h=new Array(u);for(h[0]=(e+=a[0])*n+r,h[1]=(i+=a[1])*s+o;l<u;)h[l]=a[l],++l;return h}}function pE(t,e){for(var i,n=t.length,s=n-e;s<--n;)i=t[s],t[s++]=t[n],t[n]=i}function gE(t,e){return typeof e=="string"&&(e=t.objects[e]),e.type==="GeometryCollection"?{type:"FeatureCollection",features:e.geometries.map(function(i){return Lp(t,i)})}:Lp(t,e)}function Lp(t,e){var i=e.id,n=e.bbox,s=e.properties==null?{}:e.properties,r=_E(t,e);return i==null&&n==null?{type:"Feature",properties:s,geometry:r}:n==null?{type:"Feature",id:i,properties:s,geometry:r}:{type:"Feature",id:i,bbox:n,properties:s,geometry:r}}function _E(t,e){var i=dE(t.transform),n=t.arcs;function s(u,h){h.length&&h.pop();for(var f=n[u<0?~u:u],d=0,p=f.length;d<p;++d)h.push(i(f[d],d));u<0&&pE(h,p)}function r(u){return i(u)}function o(u){for(var h=[],f=0,d=u.length;f<d;++f)s(u[f],h);return h.length<2&&h.push(h[0]),h}function a(u){for(var h=o(u);h.length<4;)h.push(h[0]);return h}function c(u){return u.map(a)}function l(u){var h=u.type,f;switch(h){case"GeometryCollection":return{type:h,geometries:u.geometries.map(l)};case"Point":f=r(u.coordinates);break;case"MultiPoint":f=u.coordinates.map(r);break;case"LineString":f=o(u.arcs);break;case"MultiLineString":f=u.arcs.map(o);break;case"Polygon":f=c(u.arcs);break;case"MultiPolygon":f=u.arcs.map(c);break;default:return null}return{type:h,coordinates:f}}return l(e)}function mE(t,e){e===void 0&&(e={});var i=Number(t[0]),n=Number(t[1]),s=Number(t[2]),r=Number(t[3]);if(t.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var o=[i,n],a=[i,r],c=[s,r],l=[s,n];return sE([[o,l,c,a,o]],e.properties,{bbox:t,id:e.id})}var $f={exports:{}};$f.exports=ul;$f.exports.default=ul;function ul(t,e,i){i=i||2;var n=e&&e.length,s=n?e[0]*i:t.length,r=hy(t,0,s,i,!0),o=[];if(!r||r.next===r.prev)return o;var a,c,l,u,h,f,d;if(n&&(r=TE(t,e,r,i)),t.length>80*i){a=l=t[0],c=u=t[1];for(var p=i;p<s;p+=i)h=t[p],f=t[p+1],h<a&&(a=h),f<c&&(c=f),h>l&&(l=h),f>u&&(u=f);d=Math.max(l-a,u-c),d=d!==0?32767/d:0}return bo(r,o,i,a,c,d,0),o}function hy(t,e,i,n,s){var r,o;if(s===wh(t,e,i,n)>0)for(r=e;r<i;r+=n)o=Bp(r,t[r],t[r+1],o);else for(r=i-n;r>=e;r-=n)o=Bp(r,t[r],t[r+1],o);return o&&hl(o,o.next)&&(To(o),o=o.next),o}function ss(t,e){if(!t)return t;e||(e=t);var i=t,n;do if(n=!1,!i.steiner&&(hl(i,i.next)||Ze(i.prev,i,i.next)===0)){if(To(i),i=e=i.prev,i===i.next)break;n=!0}else i=i.next;while(n||i!==e);return e}function bo(t,e,i,n,s,r,o){if(t){!o&&r&&CE(t,n,s,r);for(var a=t,c,l;t.prev!==t.next;){if(c=t.prev,l=t.next,r?vE(t,n,s,r):yE(t)){e.push(c.i/i|0),e.push(t.i/i|0),e.push(l.i/i|0),To(t),t=l.next,a=l.next;continue}if(t=l,t===a){o?o===1?(t=bE(ss(t),e,i),bo(t,e,i,n,s,r,2)):o===2&&wE(t,e,i,n,s,r):bo(ss(t),e,i,n,s,r,1);break}}}}function yE(t){var e=t.prev,i=t,n=t.next;if(Ze(e,i,n)>=0)return!1;for(var s=e.x,r=i.x,o=n.x,a=e.y,c=i.y,l=n.y,u=s<r?s<o?s:o:r<o?r:o,h=a<c?a<l?a:l:c<l?c:l,f=s>r?s>o?s:o:r>o?r:o,d=a>c?a>l?a:l:c>l?c:l,p=n.next;p!==e;){if(p.x>=u&&p.x<=f&&p.y>=h&&p.y<=d&&Ls(s,a,r,c,o,l,p.x,p.y)&&Ze(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function vE(t,e,i,n){var s=t.prev,r=t,o=t.next;if(Ze(s,r,o)>=0)return!1;for(var a=s.x,c=r.x,l=o.x,u=s.y,h=r.y,f=o.y,d=a<c?a<l?a:l:c<l?c:l,p=u<h?u<f?u:f:h<f?h:f,g=a>c?a>l?a:l:c>l?c:l,_=u>h?u>f?u:f:h>f?h:f,b=vh(d,p,e,i,n),T=vh(g,_,e,i,n),v=t.prevZ,E=t.nextZ;v&&v.z>=b&&E&&E.z<=T;){if(v.x>=d&&v.x<=g&&v.y>=p&&v.y<=_&&v!==s&&v!==o&&Ls(a,u,c,h,l,f,v.x,v.y)&&Ze(v.prev,v,v.next)>=0||(v=v.prevZ,E.x>=d&&E.x<=g&&E.y>=p&&E.y<=_&&E!==s&&E!==o&&Ls(a,u,c,h,l,f,E.x,E.y)&&Ze(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;v&&v.z>=b;){if(v.x>=d&&v.x<=g&&v.y>=p&&v.y<=_&&v!==s&&v!==o&&Ls(a,u,c,h,l,f,v.x,v.y)&&Ze(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;E&&E.z<=T;){if(E.x>=d&&E.x<=g&&E.y>=p&&E.y<=_&&E!==s&&E!==o&&Ls(a,u,c,h,l,f,E.x,E.y)&&Ze(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function bE(t,e,i){var n=t;do{var s=n.prev,r=n.next.next;!hl(s,r)&&fy(s,n,n.next,r)&&wo(s,r)&&wo(r,s)&&(e.push(s.i/i|0),e.push(n.i/i|0),e.push(r.i/i|0),To(n),To(n.next),n=t=r),n=n.next}while(n!==t);return ss(n)}function wE(t,e,i,n,s,r){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&ME(o,a)){var c=dy(o,a);o=ss(o,o.next),c=ss(c,c.next),bo(o,e,i,n,s,r,0),bo(c,e,i,n,s,r,0);return}a=a.next}o=o.next}while(o!==t)}function TE(t,e,i,n){var s=[],r,o,a,c,l;for(r=0,o=e.length;r<o;r++)a=e[r]*n,c=r<o-1?e[r+1]*n:t.length,l=hy(t,a,c,n,!1),l===l.next&&(l.steiner=!0),s.push(PE(l));for(s.sort(EE),r=0;r<s.length;r++)i=SE(s[r],i);return i}function EE(t,e){return t.x-e.x}function SE(t,e){var i=AE(t,e);if(!i)return e;var n=dy(i,t);return ss(n,n.next),ss(i,i.next)}function AE(t,e){var i=e,n=t.x,s=t.y,r=-1/0,o;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>r&&(r=a,o=i.x<i.next.x?i:i.next,a===n))return o}i=i.next}while(i!==e);if(!o)return null;var c=o,l=o.x,u=o.y,h=1/0,f;i=o;do n>=i.x&&i.x>=l&&n!==i.x&&Ls(s<u?n:r,s,l,u,s<u?r:n,s,i.x,i.y)&&(f=Math.abs(s-i.y)/(n-i.x),wo(i,t)&&(f<h||f===h&&(i.x>o.x||i.x===o.x&&RE(o,i)))&&(o=i,h=f)),i=i.next;while(i!==c);return o}function RE(t,e){return Ze(t.prev,t,e.prev)<0&&Ze(e.next,t,t.next)<0}function CE(t,e,i,n){var s=t;do s.z===0&&(s.z=vh(s.x,s.y,e,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,xE(s)}function xE(t){var e,i,n,s,r,o,a,c,l=1;do{for(i=t,t=null,r=null,o=0;i;){for(o++,n=i,a=0,e=0;e<l&&(a++,n=n.nextZ,!!n);e++);for(c=l;a>0||c>0&&n;)a!==0&&(c===0||!n||i.z<=n.z)?(s=i,i=i.nextZ,a--):(s=n,n=n.nextZ,c--),r?r.nextZ=s:t=s,s.prevZ=r,r=s;i=n}r.nextZ=null,l*=2}while(o>1);return t}function vh(t,e,i,n,s){return t=(t-i)*s|0,e=(e-n)*s|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function PE(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Ls(t,e,i,n,s,r,o,a){return(s-o)*(e-a)>=(t-o)*(r-a)&&(t-o)*(n-a)>=(i-o)*(e-a)&&(i-o)*(r-a)>=(s-o)*(n-a)}function ME(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!IE(t,e)&&(wo(t,e)&&wo(e,t)&&OE(t,e)&&(Ze(t.prev,t,e.prev)||Ze(t,e.prev,e))||hl(t,e)&&Ze(t.prev,t,t.next)>0&&Ze(e.prev,e,e.next)>0)}function Ze(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function hl(t,e){return t.x===e.x&&t.y===e.y}function fy(t,e,i,n){var s=ia(Ze(t,e,i)),r=ia(Ze(t,e,n)),o=ia(Ze(i,n,t)),a=ia(Ze(i,n,e));return!!(s!==r&&o!==a||s===0&&ta(t,i,e)||r===0&&ta(t,n,e)||o===0&&ta(i,t,n)||a===0&&ta(i,e,n))}function ta(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function ia(t){return t>0?1:t<0?-1:0}function IE(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&fy(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function wo(t,e){return Ze(t.prev,t,t.next)<0?Ze(t,e,t.next)>=0&&Ze(t,t.prev,e)>=0:Ze(t,e,t.prev)<0||Ze(t,t.next,e)<0}function OE(t,e){var i=t,n=!1,s=(t.x+e.x)/2,r=(t.y+e.y)/2;do i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==t);return n}function dy(t,e){var i=new bh(t.i,t.x,t.y),n=new bh(e.i,e.x,e.y),s=t.next,r=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function Bp(t,e,i,n){var s=new bh(t,e,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function To(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bh(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ul.deviation=function(t,e,i,n){var s=e&&e.length,r=s?e[0]*i:t.length,o=Math.abs(wh(t,0,r,i));if(s)for(var a=0,c=e.length;a<c;a++){var l=e[a]*i,u=a<c-1?e[a+1]*i:t.length;o-=Math.abs(wh(t,l,u,i))}var h=0;for(a=0;a<n.length;a+=3){var f=n[a]*i,d=n[a+1]*i,p=n[a+2]*i;h+=Math.abs((t[f]-t[p])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[p+1]-t[f+1]))}return o===0&&h===0?0:Math.abs((h-o)/o)};function wh(t,e,i,n){for(var s=0,r=e,o=i-n;r<i;r+=n)s+=(t[o]-t[r])*(t[r+1]+t[o+1]),o=r;return s}ul.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,s=0;s<t.length;s++){for(var r=0;r<t[s].length;r++)for(var o=0;o<e;o++)i.vertices.push(t[s][r][o]);s>0&&(n+=t[s-1].length,i.holes.push(n))}return i};var NE=$f.exports;const kE=kf(NE);function DE(t,e,i){if(i=="bbox"){let n=e.result.bbox,s=mE(n),r=t.map(a=>nE(a.center.split(","),{id:a.id}));return r={type:"FeatureCollection",features:r},console.log(r),console.log(s),hE(r,s).features.map(a=>a.properties.id)}}function FE(t,e){let i=t.filter(n=>{let s=n.color,r=eh(s),o=eh(e),a=r.s,c=r.h-o.h;if(c<70&&c>-70&&a>.3)return n}).map(n=>n.id);return console.log(i.length),i}function Up(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const py=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),zp=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);zp&&parseFloat(zp[1]);const na=globalThis,ws=globalThis.process||{},LE=globalThis.navigator||{};function gy(t){var n,s;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,i=t||e;return!!(i&&i.indexOf("Electron")>=0)}function Tn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||gy()}function BE(t){return!t&&!Tn()?"Node":gy(t)?"Electron":(t||LE.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const _y="4.0.7";function UE(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch{return null}}class zE{constructor(e,i,n="sessionStorage"){this.storage=UE(n),this.id=e,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let e={};if(this.storage){const i=this.storage.getItem(this.id);e=i?JSON.parse(i):{}}return Object.assign(this.config,e),this}}function VE(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function jE(t,e=8){const i=Math.max(e-t.length,0);return`${" ".repeat(i)}${t}`}var rc;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(rc||(rc={}));const $E=10;function Vp(t){return typeof t!="string"?t:(t=t.toUpperCase(),rc[t]||rc.WHITE)}function HE(t,e,i){return!Tn&&typeof t=="string"&&(e&&(t=`\x1B[${Vp(e)}m${t}\x1B[39m`),i&&(t=`\x1B[${Vp(i)+$E}m${t}\x1B[49m`)),t}function WE(t,e=["constructor"]){const i=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(i),s=t;for(const r of n){const o=s[r];typeof o=="function"&&(e.find(a=>r===a)||(s[r]=o.bind(t)))}}function Hf(t,e){if(!t)throw new Error(e||"Assertion failed")}function Ts(){var e,i,n;let t;if(Tn()&&na.performance)t=(i=(e=na==null?void 0:na.performance)==null?void 0:e.now)==null?void 0:i.call(e);else if("hrtime"in ws){const s=(n=ws==null?void 0:ws.hrtime)==null?void 0:n.call(ws);t=s[0]*1e3+s[1]/1e6}else t=Date.now();return t}const Es={debug:Tn()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},XE={enabled:!0,level:0};function Ss(){}const jp={},$p={once:!0};class ko{constructor({id:e}={id:""}){this.VERSION=_y,this._startTs=Ts(),this._deltaTs=Ts(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new zE(`__probe-${this.id}__`,XE),this.timeStamp(`${this.id} started`),WE(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ts()-this._startTs).toPrecision(10))}getDelta(){return Number((Ts()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,i){this._storage.setConfiguration({[e]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,i){if(!e)throw new Error(i||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Es.warn,arguments,$p)}error(e){return this._getLogFunction(0,e,Es.error,arguments)}deprecated(e,i){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${i}\` instead`)}removed(e,i){return this.error(`\`${e}\` has been removed. Use \`${i}\` instead`)}probe(e,i){return this._getLogFunction(e,i,Es.log,arguments,{time:!0,once:!0})}log(e,i){return this._getLogFunction(e,i,Es.debug,arguments)}info(e,i){return this._getLogFunction(e,i,console.info,arguments)}once(e,i){return this._getLogFunction(e,i,Es.debug||Es.info,arguments,$p)}table(e,i,n){return i?this._getLogFunction(e,i,console.table||Ss,n&&[n],{tag:YE(i)}):Ss}time(e,i){return this._getLogFunction(e,i,console.time?console.time:console.info)}timeEnd(e,i){return this._getLogFunction(e,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,i){return this._getLogFunction(e,i,console.timeStamp||Ss)}group(e,i,n={collapsed:!1}){const s=Hp({logLevel:e,message:i,opts:n}),{collapsed:r}=n;return s.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,i,n={}){return this.group(e,i,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ss)}withGroup(e,i,n){this.group(e,i)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=my(e)}_getLogFunction(e,i,n,s,r){if(this._shouldLog(e)){r=Hp({logLevel:e,message:i,args:s,opts:r}),n=n||r.method,Hf(n),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Ts();const o=r.tag||r.message;if(r.once&&o)if(!jp[o])jp[o]=Ts();else return Ss;return i=qE(this.id,r.message,r),n.bind(console,i,...r.args)}return Ss}}ko.VERSION=_y;function my(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Hf(Number.isFinite(e)&&e>=0),e}function Hp(t){const{logLevel:e,message:i}=t;t.logLevel=my(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==i;);switch(typeof e){case"string":case"function":i!==void 0&&n.unshift(i),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return Hf(s==="string"||s==="object"),Object.assign(t,{args:n},t.opts)}function qE(t,e,i){if(typeof e=="string"){const n=i.time?jE(VE(i.total)):"";e=i.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=HE(e,i.color,i.background)}return e}function YE(t){for(const e in t)for(const i in t[e])return i||"untitled";return"empty"}function KE(t,e){return yy(t||{},e)}function yy(t,e,i=0){if(i>3)return e;const n={...t};for(const[s,r]of Object.entries(e))r&&typeof r=="object"&&!Array.isArray(r)?n[s]=yy(n[s]||{},e[s],i+1):n[s]=e[s];return n}function ZE(t){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,t)}const GE="latest";function JE(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.0-beta.2"),globalThis._loadersgl_.version}const QE=JE();function pn(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const $n=typeof process!="object"||String(process)!=="[object process]"||process.browser,eS=typeof window<"u"&&typeof window.orientation<"u",Wp=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Wp&&parseFloat(Wp[1]);class tS{constructor(e,i){y(this,"name");y(this,"workerThread");y(this,"isRunning",!0);y(this,"result");y(this,"_resolve",()=>{});y(this,"_reject",()=>{});this.name=e,this.workerThread=i,this.result=new Promise((n,s)=>{this._resolve=n,this._reject=s})}postMessage(e,i){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:i})}done(e){pn(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){pn(this.isRunning),this.isRunning=!1,this._reject(e)}}class Jl{terminate(){}}const Ql=new Map;function iS(t){pn(t.source&&!t.url||!t.source&&t.url);let e=Ql.get(t.source||t.url);return e||(t.url&&(e=nS(t.url),Ql.set(t.url,e)),t.source&&(e=vy(t.source),Ql.set(t.source,e))),pn(e),e}function nS(t){if(!t.startsWith("http"))return t;const e=sS(t);return vy(e)}function vy(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function sS(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function by(t,e=!0,i){const n=i||new Set;if(t){if(Xp(t))n.add(t);else if(Xp(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const s in t)by(t[s],e,n)}}return i===void 0?Array.from(n):[]}function Xp(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const eu=()=>{};class Th{constructor(e){y(this,"name");y(this,"source");y(this,"url");y(this,"terminated",!1);y(this,"worker");y(this,"onMessage");y(this,"onError");y(this,"_loadableURL","");const{name:i,source:n,url:s}=e;pn(n||s),this.name=i,this.source=n,this.url=s,this.onMessage=eu,this.onError=r=>console.log(r),this.worker=$n?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&$n||typeof Jl<"u"&&!$n}destroy(){this.onMessage=eu,this.onError=eu,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,i){i=i||by(e),this.worker.postMessage(e,i)}_getErrorFromErrorEvent(e){let i="Failed to load ";return i+=`worker ${this.name} from ${this.url}. `,e.message&&(i+=`${e.message} in `),e.lineno&&(i+=`:${e.lineno}:${e.colno}`),new Error(i)}_createBrowserWorker(){this._loadableURL=iS({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},e.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},e.onmessageerror=i=>console.error(i),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Jl(n,{eval:!1})}else if(this.source)e=new Jl(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",i=>{this.onMessage(i)}),e.on("error",i=>{this.onError(i)}),e.on("exit",i=>{}),e}}class rS{constructor(e){y(this,"name","unnamed");y(this,"source");y(this,"url");y(this,"maxConcurrency",1);y(this,"maxMobileConcurrency",1);y(this,"onDebug",()=>{});y(this,"reuseWorkers",!0);y(this,"props",{});y(this,"jobQueue",[]);y(this,"idleQueue",[]);y(this,"count",0);y(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Th.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,i=(s,r,o)=>s.done(o),n=(s,r)=>s.error(r)){const s=new Promise(r=>(this.jobQueue.push({name:e,onMessage:i,onError:n,onStart:r}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:e,backlog:this.jobQueue.length});const n=new tS(i.name,e);e.onMessage=s=>i.onMessage(n,s.type,s.payload),e.onError=s=>i.onError(n,s),i.onStart(n);try{await n.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!$n||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Th({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return eS?this.maxMobileConcurrency:this.maxConcurrency}}const oS={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},sn=class sn{constructor(e){y(this,"props");y(this,"workerPools",new Map);this.props={...oS},this.setProps(e),this.workerPools=new Map}static isSupported(){return Th.isSupported()}static getWorkerFarm(e={}){return sn._workerFarm=sn._workerFarm||new sn({}),sn._workerFarm.setProps(e),sn._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:i,source:n,url:s}=e;let r=this.workerPools.get(i);return r||(r=new rS({name:i,source:n,url:s}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};y(sn,"_workerFarm");let oc=sn;function aS(t,e={}){const i=e[t.id]||{},n=$n?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let s=i.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&($n?s=`modules/${t.module}/dist/${n}`:s=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!s){let r=t.version;r==="latest"&&(r=GE);const o=r?`@${r}`:"";s=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${n}`}return pn(s),s}function cS(t,e=QE){pn(t,"no worker provided");const i=t.version;return!(!e||!i)}function lS(t,e){return!oc.isSupported()||!$n&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function uS(t,e,i,n,s){const r=t.id,o=aS(t,i),c=oc.getWorkerFarm(i).getWorkerPool({name:r,url:o});i=JSON.parse(JSON.stringify(i)),n=JSON.parse(JSON.stringify(n||{}));const l=await c.startJob("process-on-worker",hS.bind(null,s));return l.postMessage("process",{input:e,options:i,context:n}),await(await l.result).result}async function hS(t,e,i,n){switch(i){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:s,input:r,options:o}=n;try{const a=await t(r,o);e.postMessage("done",{id:s,result:a})}catch(a){const c=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:s,error:c})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function fS(t,e,i){if(i=i||t.byteLength,t.byteLength<i||e.byteLength<i)return!1;const n=new Uint8Array(t),s=new Uint8Array(e);for(let r=0;r<n.length;++r)if(n[r]!==s[r])return!1;return!0}function dS(...t){return pS(t)}function pS(t){const e=t.map(r=>r instanceof ArrayBuffer?new Uint8Array(r):r),i=e.reduce((r,o)=>r+o.byteLength,0),n=new Uint8Array(i);let s=0;for(const r of e)n.set(r,s),s+=r.byteLength;return n.buffer}async function gS(t){const e=[];for await(const i of t)e.push(i);return dS(...e)}function qp(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Yp{constructor(e,i){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=i,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=qp(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(qp()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Do{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,i="count"){return this._getOrCreate({name:e,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const i of Object.values(this.stats))e(i)}getTable(){const e={};return this.forEach(i=>{e[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(i=>this._getOrCreate(i))}_getOrCreate(e){const{name:i,type:n}=e;let s=this.stats[i];return s||(e instanceof Yp?s=e:s=new Yp(i,n),this.stats[i]=s),s}}const _S="Queued Requests",mS="Active Requests",yS="Cancelled Requests",vS="Queued Requests Ever",bS="Active Requests Ever",wS={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class TS{constructor(e={}){y(this,"props");y(this,"stats");y(this,"activeRequestCount",0);y(this,"requestQueue",[]);y(this,"requestMap",new Map);y(this,"updateTimer",null);this.props={...wS,...e},this.stats=new Do({id:this.props.id}),this.stats.get(_S),this.stats.get(mS),this.stats.get(yS),this.stats.get(vS),this.stats.get(bS)}scheduleRequest(e,i=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:i},s=new Promise(r=>(n.resolve=r,n));return this.requestQueue.push(n),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){const{handle:i,resolve:n}=e;let s=!1;const r=()=>{s||(s=!0,this.requestMap.delete(i),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let i=0;i<e;++i){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const e=this.requestQueue;for(let i=0;i<e.length;++i){const n=e[i];this._updateRequest(n)||(e.splice(i,1),this.requestMap.delete(n.handle),i--)}e.sort((i,n)=>i.priority-n.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let ES="";const Kp={};function SS(t){for(const e in Kp)if(t.startsWith(e)){const i=Kp[e];t=t.replace(e,i)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${ES}${t}`),t}function AS(t){return t&&typeof t=="object"&&t.isBuffer}function wy(t){if(AS(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function Ty(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function RS(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const CS=t=>typeof t=="boolean",Qr=t=>typeof t=="function",Fo=t=>t!==null&&typeof t=="object",Zp=t=>Fo(t)&&t.constructor==={}.constructor,xS=t=>!!t&&typeof t[Symbol.iterator]=="function",PS=t=>t&&typeof t[Symbol.asyncIterator]=="function",us=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,hs=t=>typeof Blob<"u"&&t instanceof Blob,MS=t=>t&&typeof t=="object"&&t.isBuffer,IS=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Fo(t)&&Qr(t.tee)&&Qr(t.cancel)&&Qr(t.getReader),OS=t=>Fo(t)&&Qr(t.read)&&Qr(t.pipe)&&CS(t.readable),Ey=t=>IS(t)||OS(t);class NS extends Error{constructor(i,n){super(i);y(this,"reason");y(this,"url");y(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const kS=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,DS=/^([-\w.]+\/[-\w.+]+)/;function Gp(t,e){return t.toLowerCase()===e.toLowerCase()}function FS(t){const e=DS.exec(t);return e?e[1]:t}function Jp(t){const e=kS.exec(t);return e?e[1]:""}const Sy=/\?.*/;function LS(t){const e=t.match(Sy);return e&&e[0]}function Wf(t){return t.replace(Sy,"")}function BS(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function fl(t){return us(t)?t.url:hs(t)?t.name||"":typeof t=="string"?t:""}function Xf(t){if(us(t)){const e=t,i=e.headers.get("content-type")||"",n=Wf(e.url);return FS(i)||Jp(n)}return hs(t)?t.type||"":typeof t=="string"?Jp(t):""}function US(t){return us(t)?t.headers["content-length"]||-1:hs(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function Ay(t){if(us(t))return t;const e={},i=US(t);i>=0&&(e["content-length"]=String(i));const n=fl(t),s=Xf(t);s&&(e["content-type"]=s);const r=await jS(t);r&&(e["x-first-bytes"]=r),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:n}),o}async function zS(t){if(!t.ok)throw await VS(t)}async function VS(t){const e=BS(t.url);let i=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;i=i.length>100?`${i.slice(0,100)}...`:i;const n={reason:t.statusText,url:t.url,response:t};try{const s=t.headers.get("Content-Type");n.reason=s!=null&&s.includes("application/json")?await t.json():t.text()}catch{}return new NS(i,n)}async function jS(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const i=t.slice(0,5);return await new Promise(n=>{const s=new FileReader;s.onload=r=>{var o;return n((o=r==null?void 0:r.target)==null?void 0:o.result)},s.readAsDataURL(i)})}if(t instanceof ArrayBuffer){const i=t.slice(0,5);return`data:base64,${$S(i)}`}return null}function $S(t){let e="";const i=new Uint8Array(t);for(let n=0;n<i.byteLength;n++)e+=String.fromCharCode(i[n]);return btoa(e)}function HS(t){return!WS(t)&&!XS(t)}function WS(t){return t.startsWith("http:")||t.startsWith("https:")}function XS(t){return t.startsWith("data:")}async function Qp(t,e){var i,n;if(typeof t=="string"){const s=SS(t);return HS(s)&&(i=globalThis.loaders)!=null&&i.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(s,e):await fetch(s,e)}return await Ay(t)}const eg=new ko({id:"loaders.gl"});class qS{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class YS{constructor(){y(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const Ry={fetch:null,mimeType:void 0,nothrow:!1,log:new YS,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:py,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},KS={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function qf(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function Yf(){const t=qf();return t.globalOptions=t.globalOptions||{...Ry},t.globalOptions}function ZS(t){const e=qf(),i=Yf();e.globalOptions=Cy(i,t),ZE(t.modules)}function GS(t,e,i,n){return i=i||[],i=Array.isArray(i)?i:[i],JS(t,i),Cy(e,t,n)}function JS(t,e){tg(t,null,Ry,KS,e);for(const i of e){const n=t&&t[i.id]||{},s=i.options&&i.options[i.id]||{},r=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};tg(n,i.id,s,r,e)}}function tg(t,e,i,n,s){const r=e||"Top level",o=e?`${e}.`:"";for(const a in t){const c=!e&&Fo(t[a]),l=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in i)&&!l&&!u){if(a in n)eg.warn(`${r} loader option '${o}${a}' no longer supported, use '${n[a]}'`)();else if(!c){const h=QS(a,s);eg.warn(`${r} loader option '${o}${a}' not recognized. ${h}`)()}}}}function QS(t,e){const i=t.toLowerCase();let n="";for(const s of e)for(const r in s.options){if(t===r)return`Did you mean '${s.id}.${r}'?`;const o=r.toLowerCase();(i.startsWith(o)||o.startsWith(i))&&(n=n||`Did you mean '${s.id}.${r}'?`)}return n}function Cy(t,e,i){const s={...t.options||{}};return eA(s,i),s.log===null&&(s.log=new qS),ig(s,Yf()),ig(s,e),s}function ig(t,e){for(const i in e)if(i in e){const n=e[i];Zp(n)&&Zp(t[i])?t[i]={...t[i],...e[i]}:t[i]=e[i]}}function eA(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Kf(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function Zf(t){Up(t,"null loader"),Up(Kf(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const xy=()=>{const t=qf();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function Py(t){const e=xy();t=Array.isArray(t)?t:[t];for(const i of t){const n=Zf(i);e.find(s=>n===s)||e.unshift(n)}}function tA(){return xy()}const iA=new ko({id:"loaders.gl"}),nA=/\.([^.]+)$/;async function sA(t,e=[],i,n){if(!My(t))return null;let s=ng(t,e,{...i,nothrow:!0},n);if(s)return s;if(hs(t)&&(t=await t.slice(0,10).arrayBuffer(),s=ng(t,e,i,n)),!s&&!(i!=null&&i.nothrow))throw new Error(Iy(t));return s}function ng(t,e=[],i,n){if(!My(t))return null;if(e&&!Array.isArray(e))return Zf(e);let s=[];e&&(s=s.concat(e)),i!=null&&i.ignoreRegisteredLoaders||s.push(...tA()),oA(s);const r=rA(t,s,i,n);if(!r&&!(i!=null&&i.nothrow))throw new Error(Iy(t));return r}function rA(t,e,i,n){const s=fl(t),r=Xf(t),o=Wf(s)||(n==null?void 0:n.url);let a=null,c="";return i!=null&&i.mimeType&&(a=tu(e,i==null?void 0:i.mimeType),c=`match forced by supplied MIME type ${i==null?void 0:i.mimeType}`),a=a||aA(e,o),c=c||(a?`matched url ${o}`:""),a=a||tu(e,r),c=c||(a?`matched MIME type ${r}`:""),a=a||lA(e,t),c=c||(a?`matched initial data ${Oy(t)}`:""),i!=null&&i.fallbackMimeType&&(a=a||tu(e,i==null?void 0:i.fallbackMimeType),c=c||(a?`matched fallback MIME type ${r}`:"")),c&&iA.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${c}.`),a}function My(t){return!(t instanceof Response&&t.status===204)}function Iy(t){const e=fl(t),i=Xf(t);let n="No valid loader found (";n+=e?`${Ty(e)}, `:"no url provided, ",n+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const s=t?Oy(t):"";return n+=s?` first bytes: "${s}"`:"first bytes: not available",n+=")",n}function oA(t){for(const e of t)Zf(e)}function aA(t,e){const i=e&&nA.exec(e),n=i&&i[1];return n?cA(t,n):null}function cA(t,e){e=e.toLowerCase();for(const i of t)for(const n of i.extensions)if(n.toLowerCase()===e)return i;return null}function tu(t,e){var i;for(const n of t)if((i=n.mimeTypes)!=null&&i.some(s=>Gp(e,s))||Gp(e,`application/x.${n.id}`))return n;return null}function lA(t,e){if(!e)return null;for(const i of t)if(typeof e=="string"){if(uA(e,i))return i}else if(ArrayBuffer.isView(e)){if(sg(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer&&sg(e,0,i))return i;return null}function uA(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>t.startsWith(n))}function sg(t,e,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(s=>hA(t,e,i,s))}function hA(t,e,i,n){if(n instanceof ArrayBuffer)return fS(n,t,n.byteLength);switch(typeof n){case"function":return n(t);case"string":const s=Eh(t,e,n.length);return n===s;default:return!1}}function Oy(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Eh(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Eh(t,0,e):""}function Eh(t,e,i){if(t.byteLength<e+i)return"";const n=new DataView(t);let s="";for(let r=0;r<i;r++)s+=String.fromCharCode(n.getUint8(e+r));return s}const fA=256*1024;function*dA(t,e){const i=(e==null?void 0:e.chunkSize)||fA;let n=0;const s=new TextEncoder;for(;n<t.length;){const r=Math.min(t.length-n,i),o=t.slice(n,n+r);n+=r,yield s.encode(o)}}const pA=256*1024;function*gA(t,e={}){const{chunkSize:i=pA}=e;let n=0;for(;n<t.byteLength;){const s=Math.min(t.byteLength-n,i),r=new ArrayBuffer(s),o=new Uint8Array(t,n,s);new Uint8Array(r).set(o),n+=s,yield r}}const _A=1024*1024;async function*mA(t,e){const i=(e==null?void 0:e.chunkSize)||_A;let n=0;for(;n<t.size;){const s=n+i,r=await t.slice(n,s).arrayBuffer();n=s,yield r}}function rg(t,e){return py?yA(t,e):vA(t)}async function*yA(t,e){const i=t.getReader();let n;try{for(;;){const s=n||i.read();e!=null&&e._streamReadAhead&&(n=i.read());const{done:r,value:o}=await s;if(r)return;yield wy(o)}}catch{i.releaseLock()}}async function*vA(t,e){for await(const i of t)yield wy(i)}function bA(t,e){if(typeof t=="string")return dA(t,e);if(t instanceof ArrayBuffer)return gA(t,e);if(hs(t))return mA(t,e);if(Ey(t))return rg(t,e);if(us(t))return rg(t.body,e);throw new Error("makeIterator")}const Ny="Cannot convert supplied data type";function wA(t,e,i){if(e.text&&typeof t=="string")return t;if(MS(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+s)),n}throw new Error(Ny)}async function TA(t,e,i){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||n)return wA(t,e);if(hs(t)&&(t=await Ay(t)),us(t)){const s=t;return await zS(s),e.binary?await s.arrayBuffer():await s.text()}if(Ey(t)&&(t=bA(t,i)),xS(t)||PS(t))return gS(t);throw new Error(Ny)}function ky(t,e){const i=Yf(),n=t||i;return typeof n.fetch=="function"?n.fetch:Fo(n.fetch)?s=>Qp(s,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:Qp}function EA(t,e,i){if(i)return i;const n={fetch:ky(e,t),...t};if(n.url){const s=Wf(n.url);n.baseUrl=s,n.queryString=LS(n.url),n.filename=Ty(s),n.baseUrl=RS(s)}return Array.isArray(n.loaders)||(n.loaders=null),n}function SA(t,e){if(t&&!Array.isArray(t))return t;let i;if(t&&(i=Array.isArray(t)?t:[t]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...n]:n}return i&&i.length?i:void 0}async function ac(t,e,i,n){e&&!Array.isArray(e)&&!Kf(e)&&(n=void 0,i=e,e=void 0),t=await t,i=i||{};const s=fl(t),o=SA(e,n),a=await sA(t,o,i);return a?(i=GS(i,a,o,s),n=EA({url:s,_parse:ac,loaders:o},i,n||null),await AA(a,t,i,n)):null}async function AA(t,e,i,n){if(cS(t),i=KE(t.options,i),us(e)){const r=e,{ok:o,redirected:a,status:c,statusText:l,type:u,url:h}=r,f=Object.fromEntries(r.headers.entries());n.response={headers:f,ok:o,redirected:a,status:c,statusText:l,type:u,url:h}}e=await TA(e,t,i);const s=t;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,i,n);if(lS(t,i))return await uS(t,e,i,n,ac);if(s.parseText&&typeof e=="string")return await s.parseText(e,i,n);if(s.parse)return await s.parse(e,i,n);throw pn(!s.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function Hn(t,e,i,n){let s,r;!Array.isArray(e)&&!Kf(e)?(s=[],r=e):(s=e,r=i);const o=ky(r);let a=t;return typeof t=="string"&&(a=await o(t)),hs(t)&&(a=await o(t)),Array.isArray(s)?await ac(a,s,r):await ac(a,s,r)}const RA="4.2.0";function Dy(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const CA=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),og=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);og&&parseFloat(og[1]);var Im;const xA=(Im=globalThis.loaders)==null?void 0:Im.parseImageNode,Sh=typeof Image<"u",Ah=typeof ImageBitmap<"u",PA=!!xA,Rh=CA?!0:PA;function MA(t){switch(t){case"auto":return Ah||Sh||Rh;case"imagebitmap":return Ah;case"image":return Sh;case"data":return Rh;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function IA(){if(Ah)return"imagebitmap";if(Sh)return"image";if(Rh)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function OA(t){const e=kA(t);if(!e)throw new Error("Not an image");return e}function NA(t){switch(OA(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function kA(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const DA=/^data:image\/svg\+xml/,FA=/\.svg((\?|#).*)?$/;function Gf(t){return t&&(DA.test(t)||FA.test(t))}function LA(t,e){if(Gf(e)){let n=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(r){throw new Error(r.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return Fy(t,e)}function Fy(t,e){if(Gf(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Ly(t,e,i){const n=LA(t,i),s=self.URL||self.webkitURL,r=typeof n!="string"&&s.createObjectURL(n);try{return await BA(r||n,e)}finally{r&&s.revokeObjectURL(r)}}async function BA(t,e){const i=new Image;return i.src=t,e.image&&e.image.decode&&i.decode?(await i.decode(),i):await new Promise((n,s)=>{try{i.onload=()=>n(i),i.onerror=r=>{const o=r instanceof Error?r.message:"error";s(new Error(o))}}catch(r){s(r)}})}const UA={};let ag=!0;async function zA(t,e,i){let n;Gf(i)?n=await Ly(t,e,i):n=Fy(t,i);const s=e&&e.imagebitmap;return await VA(n,s)}async function VA(t,e=null){if((jA(e)||!ag)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(i){console.warn(i),ag=!1}return await createImageBitmap(t)}function jA(t){for(const e in t||UA)return!1;return!0}function $A(t){return!qA(t,"ftyp",4)||!(t[8]&96)?null:HA(t)}function HA(t){switch(WA(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function WA(t,e,i){return String.fromCharCode(...t.slice(e,i))}function XA(t){return[...t].map(e=>e.charCodeAt(0))}function qA(t,e,i=0){const n=XA(e);for(let s=0;s<n.length;++s)if(n[s]!==t[s+i])return!1;return!0}const Ri=!1,eo=!0;function By(t){const e=Lo(t);return KA(e)||JA(e)||ZA(e)||GA(e)||YA(e)}function YA(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),i=$A(e);return i?{mimeType:i.mimeType,width:0,height:0}:null}function KA(t){const e=Lo(t);return e.byteLength>=24&&e.getUint32(0,Ri)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Ri),height:e.getUint32(20,Ri)}:null}function ZA(t){const e=Lo(t);return e.byteLength>=10&&e.getUint32(0,Ri)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,eo),height:e.getUint16(8,eo)}:null}function GA(t){const e=Lo(t);return e.byteLength>=14&&e.getUint16(0,Ri)===16973&&e.getUint32(2,eo)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,eo),height:e.getUint32(22,eo)}:null}function JA(t){const e=Lo(t);if(!(e.byteLength>=3&&e.getUint16(0,Ri)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:s}=QA();let r=2;for(;r+9<e.byteLength;){const o=e.getUint16(r,Ri);if(s.has(o))return{mimeType:"image/jpeg",height:e.getUint16(r+5,Ri),width:e.getUint16(r+7,Ri)};if(!n.has(o))return null;r+=2,r+=e.getUint16(r,Ri)}return null}function QA(){const t=new Set([65499,65476,65484,65501,65534]);for(let i=65504;i<65520;++i)t.add(i);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Lo(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function e2(t,e){var s;const{mimeType:i}=By(t)||{},n=(s=globalThis.loaders)==null?void 0:s.parseImageNode;return Dy(n),await n(t,i)}async function t2(t,e,i){e=e||{};const s=(e.image||{}).type||"auto",{url:r}=i||{},o=i2(s);let a;switch(o){case"imagebitmap":a=await zA(t,e,r);break;case"image":a=await Ly(t,e,r);break;case"data":a=await e2(t);break;default:Dy(!1)}return s==="data"&&(a=NA(a)),a}function i2(t){switch(t){case"auto":case"data":return IA();default:return MA(t),t}}const n2=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],s2=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],r2={image:{type:"auto",decode:!0}},o2={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:RA,mimeTypes:s2,extensions:n2,parse:t2,tests:[t=>!!By(new DataView(t))],options:r2},fe=new ko({id:"deck"});let Ch={};function a2(t){Ch=t}function Tt(t,e,i,n){fe.level>0&&Ch[t]&&Ch[t].call(null,e,i,n)}function c2(t){const e=t[0],i=t[t.length-1];return e==="{"&&i==="}"||e==="["&&i==="]"}const l2={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:c2,parseTextSync:JSON.parse};function u2(){const t="9.0.9",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(fe.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:fe,_registerLoggers:a2},Py([l2,[o2,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const h2=u2();function Un(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const iu={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function f2(t){const e={};for(const[i,n]of Object.entries(t))e[i]=p2(n);return e}function d2(t,e,i){const n={};for(const[s,r]of Object.entries(e))t&&s in t&&!r.private?(r.validate&&Un(r.validate(t[s],r),`${i}: invalid ${s}`),n[s]=t[s]):n[s]=r.value;return n}function p2(t){let e=cg(t);if(e!=="object")return{value:t,...iu[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...iu[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=cg(t.value),{...t,...iu[e],type:e}):{type:"object",value:null};throw new Error("props")}function cg(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const g2=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,_2=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,m2={vertex:g2,fragment:_2},lg=/void\s+main\s*\([^)]*\)\s*\{\n?/,ug=/}\n?[^{}]*$/,nu=[],Fa="__LUMA_INJECT_DECLARATIONS__";function y2(t){const e={vertex:{},fragment:{}};for(const i in t){let n=t[i];const s=v2(i);typeof n=="string"&&(n={order:0,injection:n}),e[s][i]=n}return e}function v2(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function cc(t,e,i,n=!1){const s=e==="vertex";for(const r in i){const o=i[r];o.sort((c,l)=>c.order-l.order),nu.length=o.length;for(let c=0,l=o.length;c<l;++c)nu[c]=o[c].injection;const a=`${nu.join(`
`)}
`;switch(r){case"vs:#decl":s&&(t=t.replace(Fa,a));break;case"vs:#main-start":s&&(t=t.replace(lg,c=>c+a));break;case"vs:#main-end":s&&(t=t.replace(ug,c=>a+c));break;case"fs:#decl":s||(t=t.replace(Fa,a));break;case"fs:#main-start":s||(t=t.replace(lg,c=>c+a));break;case"fs:#main-end":s||(t=t.replace(ug,c=>a+c));break;default:t=t.replace(r,c=>c+a)}}return t=t.replace(Fa,""),n&&(t=t.replace(/\}\s*$/,r=>r+m2[e])),t}let b2=1;class zn{constructor(e){y(this,"name");y(this,"vs");y(this,"fs");y(this,"getModuleUniforms");y(this,"dependencies");y(this,"deprecations");y(this,"defines");y(this,"injections");y(this,"uniforms",{});y(this,"uniformTypes",{});const{name:i,vs:n,fs:s,dependencies:r=[],uniformPropTypes:o={},getUniforms:a,deprecations:c=[],defines:l={},inject:u={}}=e;Un(typeof i=="string"),this.name=i,this.vs=n,this.fs=s,this.getModuleUniforms=a,this.dependencies=zn.instantiateModules(r),this.deprecations=this._parseDeprecationDefinitions(c),this.defines=l,this.injections=y2(u),o&&(this.uniforms=f2(o))}static instantiateModules(e){return e.map(i=>{if(i instanceof zn)return i;Un(typeof i!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(i)}' and use it directly.`),i.name||(console.warn("shader module has no name"),i.name=`shader-module-${b2++}`);const n=new zn(i);return n.dependencies=zn.instantiateModules(i.dependencies||[]),n})}getModuleSource(e){let i;switch(e){case"vertex":i=this.vs||"";break;case"fragment":i=this.fs||"";break;default:Un(!1)}const n=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${n}
${i}

`}getUniforms(e,i){return this.getModuleUniforms?this.getModuleUniforms(e,i):d2(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,i){this.deprecations.forEach(n=>{var s;(s=n.regex)!=null&&s.test(e)&&(n.deprecated?i.deprecated(n.old,n.new)():i.removed(n.old,n.new)())})}_parseDeprecationDefinitions(e){return e.forEach(i=>{switch(i.type){case"function":i.regex=new RegExp(`\\b${i.old}\\(`);break;default:i.regex=new RegExp(`${i.type} ${i.old};`)}}),e}_defaultGetUniforms(e={}){const i={},n=this.uniforms;for(const s in n){const r=n[s];s in e&&!r.private?(r.validate&&Un(r.validate(e[s],r),`${this.name}: invalid ${s}`),i[s]=e[s]):i[s]=r.value}return i}}function hg(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=fg(t.platformInfo,t.vs);let i;return t.fs&&(i=fg(t.platformInfo,t.fs)),{...t,vs:e,fs:i}}function fg(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function dl(t){const e=zn.instantiateModules(t);return w2(e)}function w2(t){const e={},i={};return Uy({modules:t,level:0,moduleMap:e,moduleDepth:i}),Object.keys(i).sort((n,s)=>i[s]-i[n]).map(n=>e[n])}function Uy(t){const{modules:e,level:i,moduleMap:n,moduleDepth:s}=t;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const r of e)n[r.name]=r,(s[r.name]===void 0||s[r.name]<i)&&(s[r.name]=i);for(const r of e)r.dependencies&&Uy({modules:r.dependencies,level:i+1,moduleMap:n,moduleDepth:s})}function T2(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function E2(t,e){var n;if(Number(((n=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:n[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=dg(t,S2),t;case"fragment":return t=dg(t,A2),t;default:throw new Error(e)}}const zy=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],S2=[...zy,[xh("attribute"),"in $1"],[xh("varying"),"out $1"]],A2=[...zy,[xh("varying"),"in $1"]];function dg(t,e){for(const[i,n]of e)t=t.replace(i,n);return t}function xh(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Vy(t,e){let i="";for(const n in t){const s=t[n];if(i+=`void ${s.signature} {
`,s.header&&(i+=`  ${s.header}`),e[n]){const r=e[n];r.sort((o,a)=>o.order-a.order);for(const o of r)i+=`  ${o.injection}
`}s.footer&&(i+=`  ${s.footer}`),i+=`}
`}return i}function jy(t){const e={vertex:{},fragment:{}};for(const i of t){let n,s;typeof i!="string"?(n=i,s=n.hook):(n={},s=i),s=s.trim();const[r,o]=s.split(":"),a=s.replace(/\(.+/,""),c=Object.assign(n,{signature:o});switch(r){case"vs":e.vertex[a]=c;break;case"fs":e.fragment[a]=c;break;default:throw new Error(r)}}return e}function R2(t,e){return{name:C2(t,e),language:"glsl",version:x2(t)}}function C2(t,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return n?n[1]:e}function x2(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const n=parseInt(i[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const $y=`

${Fa}
`,P2=`precision highp float;
`;function M2(t){const e=dl(t.modules||[]);return{source:Ph(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:Jf(e)}}function I2(t){const e=dl(t.modules||[]);return{vs:Ph(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:Ph(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:Jf(e)}}function O2(t){const{vs:e,fs:i}=t,n=dl(t.modules||[]);return{vs:pg(t.platformInfo,{...t,source:e,stage:"vertex",modules:n}),fs:pg(t.platformInfo,{...t,source:i,stage:"fragment",modules:n}),getUniforms:Jf(n)}}function Ph(t,e){const{source:i,stage:n,modules:s,hookFunctions:r=[],inject:o={},log:a}=e;Un(typeof i=="string","shader source must be a string");const c=i;let l="";const u=jy(r),h={},f={},d={};for(const g in o){const _=typeof o[g]=="string"?{injection:o[g],order:0}:o[g],b=/^(v|f)s:(#)?([\w-]+)$/.exec(g);if(b){const T=b[2],v=b[3];T?v==="decl"?f[g]=[_]:d[g]=[_]:h[g]=[_]}else d[g]=[_]}const p=t.type!=="webgpu"?s:[];for(const g of p){a&&g.checkDeprecations(c,a);const _=g.getModuleSource(n,"wgsl");l+=_;const b=g.injections[n];for(const T in b){const v=/^(v|f)s:#([\w-]+)$/.exec(T);if(v){const R=v[2]==="decl"?f:d;R[T]=R[T]||[],R[T].push(b[T])}else h[T]=h[T]||[],h[T].push(b[T])}}return l+=$y,l=cc(l,n,f),l+=Vy(u[n],h),l+=c,l=cc(l,n,d),l}function pg(t,e){const{id:i,source:n,stage:s,language:r="glsl",modules:o,defines:a={},hookFunctions:c=[],inject:l={},prologue:u=!0,log:h}=e;Un(typeof n=="string","shader source must be a string");const f=r==="glsl"?R2(n).version:-1,d=t.shaderLanguageVersion,p=f===100?"#version 100":"#version 300 es",_=n.split(`
`).slice(1).join(`
`),b={};o.forEach(M=>{Object.assign(b,M.getDefines())}),Object.assign(b,a);let T="";switch(r){case"wgsl":break;case"glsl":T=u?`${p}

// ----- PROLOGUE -------------------------
${N2({id:i,source:n,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}
${T2(t)}
${s==="fragment"?P2:""}

// ----- APPLICATION DEFINES -------------------------

${k2(b)}

`:`${p}
`;break}const v=jy(c),E={},R={},P={};for(const M in l){const U=typeof l[M]=="string"?{injection:l[M],order:0}:l[M],O=/^(v|f)s:(#)?([\w-]+)$/.exec(M);if(O){const D=O[2],I=O[3];D?I==="decl"?R[M]=[U]:P[M]=[U]:E[M]=[U]}else P[M]=[U]}for(const M of o){h&&M.checkDeprecations(_,h);const U=M.getModuleSource(s);T+=U;const O=M.injections[s];for(const D in O){const I=/^(v|f)s:#([\w-]+)$/.exec(D);if(I){const k=I[2]==="decl"?R:P;k[D]=k[D]||[],k[D].push(O[D])}else E[D]=E[D]||[],E[D].push(O[D])}}return T+="// ----- MAIN SHADER SOURCE -------------------------",T+=$y,T=cc(T,s,R),T+=Vy(v[s],E),T+=_,T=cc(T,s,P),r==="glsl"&&f!==d&&(T=E2(T,s)),T.trim()}function Jf(t){return function(i){const n={};for(const s of t){const r=s.getUniforms(i,n);Object.assign(n,r)}return n}}function N2(t){const{id:e,source:i,stage:n}=t;return e&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}

`:""}function k2(t={}){let e="";for(const i in t){const n=t[i];(n||Number.isFinite(n))&&(e+=`#define ${i.toUpperCase()} ${t[i]}
`)}return e}const Dn=class Dn{constructor(){y(this,"_hookFunctions",[]);y(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Dn.defaultShaderAssembler=Dn.defaultShaderAssembler||new Dn,Dn.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(i=>i.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const i=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==i)}addShaderHook(e,i){i&&(e=Object.assign(i,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const i=this._getModuleList(e.modules),n=this._hookFunctions,s=hg(e);return{...M2({platformInfo:e.platformInfo,...s,modules:i,hookFunctions:n}),modules:i}}assembleShaderPair(e){const i=hg(e),n=this._getModuleList(e.modules),s=this._hookFunctions,{platformInfo:r}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?I2({platformInfo:r,...i,modules:n,hookFunctions:s}):O2({platformInfo:r,...i,modules:n,hookFunctions:s}),modules:n}}_getModuleList(e=[]){const i=new Array(this._defaultModules.length+e.length),n={};let s=0;for(let r=0,o=this._defaultModules.length;r<o;++r){const a=this._defaultModules[r],c=a.name;i[s++]=a,n[c]=!0}for(let r=0,o=e.length;r<o;++r){const a=e[r],c=a.name;n[c]||(i[s++]=a,n[c]=!0)}return i.length=s,zn.instantiateModules(i)}};y(Dn,"defaultShaderAssembler");let lc=Dn;const D2=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,F2=`#version 300 es
${D2}`;function L2(t){const{input:e,inputChannels:i,output:n}=t||{};if(!e)return F2;if(!i)throw new Error("inputChannels");const s=B2(i),r=U2(e,i);return`#version 300 es
in ${s} ${e};
out vec4 ${n};
void main() {
  ${n} = ${r};
}`}function B2(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function U2(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const Y=new ko({id:"luma.gl"});class z2{constructor(){y(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Do({id:e})),this.stats.get(e)}}const Qf=new z2;function V2(){const t="9.0.11",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(Tn()&&Y.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:Y,stats:Qf}),t}const j2=V2();function $2(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function Eo(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:$2(t)}const su={};function fs(t="id"){su[t]=su[t]||1;const e=su[t]++;return`${t}-${e}`}function uc(t){let e=!0;for(const i in t){e=!1;break}return e}var Zu;let Oe=(Zu=class{constructor(e,i,n){y(this,"id");y(this,"props");y(this,"userData",{});y(this,"_device");y(this,"destroyed",!1);y(this,"allocatedBytes",0);y(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=H2(i,n);const s=this.props.id!=="undefined"?this.props.id:fs(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get(`${i}s Active`).decrementCount()}trackAllocatedMemory(e,i=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${i} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").subtractCount(this.allocatedBytes),i.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${i}s Created`).incrementCount(),e.get(`${i}s Active`).incrementCount()}},y(Zu,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Zu);function H2(t,e){const i={...e};for(const n in t)t[n]!==void 0&&(i[n]=t[n]);return i}const gt=class gt extends Oe{constructor(i,n){const s={...n};(n.usage||0)&gt.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?s.indexType="uint32":n.data instanceof Uint16Array&&(s.indexType="uint16"));super(i,s,gt.defaultProps);y(this,"usage");y(this,"indexType");y(this,"updateTimestamp");y(this,"debugData",new ArrayBuffer(0));this.usage=n.usage||0,this.indexType=s.indexType,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(i,n){throw new Error("not implemented")}_setDebugData(i,n,s){const r=ArrayBuffer.isView(i)?i.buffer:i,o=Math.min(i?i.byteLength:s,gt.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(o):n===0&&s===i.byteLength?this.debugData=r.slice(0,o):this.debugData=r.slice(n,n+o)}};y(gt,"defaultProps",{...Oe.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),y(gt,"MAP_READ",1),y(gt,"MAP_WRITE",2),y(gt,"COPY_SRC",4),y(gt,"COPY_DST",8),y(gt,"INDEX",16),y(gt,"VERTEX",32),y(gt,"UNIFORM",64),y(gt,"STORAGE",128),y(gt,"INDIRECT",256),y(gt,"QUERY_RESOLVE",512),y(gt,"DEBUG_DATA_MAX_LENGTH",32);let qe=gt;function Hy(t){const e=gg[t],i=W2(e),n=t.includes("norm"),s=!n&&!t.startsWith("float"),r=t.startsWith("s");return{dataType:gg[t],byteLength:i,integer:s,signed:r,normalized:n}}function W2(t){return X2[t]}const gg={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},X2={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},q2=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Y2=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function K2(t){return q2.some(e=>t.startsWith(e))}function Wy(t){const e=Y2.exec(t);if(e){const[,i,n,s,r,o]=e;if(i){const a=`${s}${n}`,c=Hy(a);return{format:i,components:i.length,srgb:r==="-srgb",unsized:o==="-unsized",webgl:o==="-webgl",...c}}}return G2(t)}const Z2={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function G2(t){var i;const e=Z2[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((i=e.format)==null?void 0:i.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class J2{}class Q2{constructor(e=[],i){y(this,"features");y(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=i||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const uo=class uo{constructor(e){y(this,"id");y(this,"props");y(this,"userData",{});y(this,"statsManager",Qf);y(this,"_lumaData",{});y(this,"timestamp",0);this.props={...uo.defaultProps,...e},this.id=this.props.id||fs(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return K2(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,i){throw new Error("not implemented")}readPixelsToBufferWebGL(e,i){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,i){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const i={...e};return(e.usage||0)&qe.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?i.indexType="uint32":e.data instanceof Uint16Array?i.indexType="uint16":Y.warn("indices buffer content must be of integer type")()),i}};y(uo,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Y.get("debug"),spector:!!Y.get("spector"),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>Y.error(e.message)}),y(uo,"VERSION",j2);let Wn=uo;function ze(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const Ir=new Map;class Xn{static registerDevices(e){for(const i of e)ze(i.type&&i.isSupported&&i.create),Ir.set(i.type,i)}static getAvailableDevices(){return Array.from(Ir).map(e=>e.type)}static getSupportedDevices(){return Array.from(Ir).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(Wn.defaultProps,e)}static async attachDevice(e){const i=_g(e.devices)||Ir;if(e.handle instanceof WebGL2RenderingContext){const n=i.get("webgl");if(n)return await n.attach(e.handle)}if(e.handle===null){const n=i.get("unknown");if(n)return await n.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var n,s;e={...Wn.defaultProps,...e},e.gl&&(e.type="webgl");const i=_g(e.devices)||Ir;switch(e.type){case"webgpu":let r=i.get("webgpu");if(r)return await r.create(e);break;case"webgl":let o=i.get("webgl");if(o)return await o.create(e);break;case"unknown":const a=i.get("unknown");if(a)return await a.create(e);break;case"best-available":if(r=i.get("webgpu"),(n=r==null?void 0:r.isSupported)!=null&&n.call(r))return await r.create(e);if(o=i.get("webgl"),(s=o==null?void 0:o.isSupported)!=null&&s.call(o))return await o.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const i=HTMLCanvasElement.prototype;if(!e&&i.originalGetContext){i.getContext=i.originalGetContext,i.originalGetContext=void 0;return}i.originalGetContext=i.getContext,i.getContext=function(n,s){return n==="webgl"||n==="experimental-webgl"?this.originalGetContext("webgl2",s):this.originalGetContext(n,s)}}}y(Xn,"defaultProps",{...Wn.defaultProps,type:"best-available",devices:void 0}),y(Xn,"stats",Qf),y(Xn,"log",Y);function _g(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const i of t)e.set(i.type,i);return e}const e3=Tn()&&typeof document<"u",pl=()=>e3&&document.readyState==="complete",t3={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class ed{constructor(e){y(this,"id");y(this,"props");y(this,"canvas");y(this,"htmlCanvas");y(this,"offscreenCanvas");y(this,"type");y(this,"width",1);y(this,"height",1);y(this,"resizeObserver");y(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...t3,...e},e=this.props,!Tn()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=s3(e.canvas):this.canvas=e.canvas;else{const i=r3(e),n=n3((e==null?void 0:e.container)||null);n.insertBefore(i,n.firstChild),this.canvas=i,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(i=>{for(const n of i)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return pl()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),i=this.canvas;return i.parentElement?[i.clientWidth*e,i.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,i]=this.getPixelSize();return e/i}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:i}=this._canvasSizeInfo;return i?e/i:1}catch{return 1}}cssToDevicePixels(e,i=!0){const n=this.cssToDeviceRatio(),[s,r]=this.getDrawingBufferSize();return o3(e,n,s,r,i)}setDevicePixelRatio(e,i={}){if(!this.htmlCanvas)return;let n="width"in i?i.width:this.htmlCanvas.clientWidth,s="height"in i?i.height:this.htmlCanvas.clientHeight;(!n||!s)&&(Y.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const r=this._canvasSizeInfo;if(r.clientWidth!==n||r.clientHeight!==s||r.devicePixelRatio!==e){let o=e;const a=Math.floor(n*o),c=Math.floor(s*o);this.htmlCanvas.width=a,this.htmlCanvas.height=c;const[l,u]=this.getDrawingBufferSize();(l!==a||u!==c)&&(o=Math.min(l/n,u/s),this.htmlCanvas.width=Math.floor(n*o),this.htmlCanvas.height=Math.floor(s*o),Y.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var i;((i=this.htmlCanvas)==null?void 0:i.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}y(ed,"pageLoaded",i3());function i3(){return pl()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function n3(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!pl())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function s3(t){const e=document.getElementById(t);if(!e&&!pl())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function r3(t){const{width:e,height:i}=t,n=document.createElement("canvas");return n.id="lumagl-auto-created-canvas",n.width=e||1,n.height=i||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(i)?`${i}px`:"100%",n}function o3(t,e,i,n,s){const r=t,o=mg(r[0],e,i);let a=yg(r[1],e,n,s),c=mg(r[0]+1,e,i);const l=c===i-1?c:c-1;c=yg(r[1]+1,e,n,s);let u;return s?(c=c===0?c:c+1,u=a,a=c):u=c===n-1?c:c-1,{x:o,y:a,width:Math.max(l-o+1,1),height:Math.max(u-a+1,1)}}function mg(t,e,i){return Math.min(Math.round(t*e),i-1)}function yg(t,e,i,n){return n?Math.max(0,i-1-Math.round(t*e)):Math.min(Math.round(t*e),i-1)}const Fi=class Fi extends Oe{constructor(i,n,s=Fi.defaultProps){super(i,n,s);y(this,"dimension");y(this,"format");y(this,"width");y(this,"height");y(this,"depth");y(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};y(Fi,"defaultProps",{...Oe.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),y(Fi,"COPY_SRC",1),y(Fi,"COPY_DST",2),y(Fi,"TEXTURE_BINDING",4),y(Fi,"STORAGE_BINDING",8),y(Fi,"RENDER_ATTACHMENT",16);let Xt=Fi;const Nc=class Nc extends Oe{get[Symbol.toStringTag](){return"TextureView"}constructor(e,i){super(e,i,Nc.defaultProps)}};y(Nc,"defaultProps",{...Oe.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let hc=Nc;function a3(t,e,i){let n="";const s=e.split(/\r?\n/),r=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((i==null?void 0:i.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=s.length;a++)for(n+=Xy(s[a-1],a,i);r.length>o&&r[o].lineNum===a;){const c=r[o++];n+=vg(c,s,c.lineNum,{...i,inlineSource:!1})}return n;case"issues":case"no":for(const a of t)n+=vg(a,s,a.lineNum,{inlineSource:(i==null?void 0:i.showSourceCode)!=="no"});return n}}function vg(t,e,i,n){if(n!=null&&n.inlineSource){const s=c3(e,i),r=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${r}${t.type.toUpperCase()}: ${t.message}

`}return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function c3(t,e,i){let n="";for(let s=e-2;s<=e;s++){const r=t[s-1];r!==void 0&&(n+=Xy(r,e,i))}return n}function Xy(t,e,i){const n=i!=null&&i.html?u3(t):t;return`${l3(String(e),4)}: ${n}${i!=null&&i.html?"<br/>":`
`}`}function l3(t,e){let i="";for(let n=t.length;n<e;++n)i+=" ";return i+t}function u3(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function qy(t,e){return{name:h3(t,e),language:"glsl",version:f3(t)}}function h3(t,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return n?n[1]:e}function f3(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const n=parseInt(i[1],10);Number.isFinite(n)&&(e=n)}return e}const kc=class kc extends Oe{constructor(i,n){super(i,{id:d3(n),...n},kc.defaultProps);y(this,"stage");y(this,"source");y(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(i=this.props.debug){switch(i){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();this.props.debug==="warnings"&&(n==null?void 0:n.length)===0||this._displayShaderLog(n)}_displayShaderLog(i){var l;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=qy(this.source).name,s=`${this.stage} ${n}`;let r=a3(i,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(r+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${r}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const c=document.getElementsByClassName("luma-compiler-log-error");(l=c[0])!=null&&l.scrollIntoView&&c[0].scrollIntoView(),a.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}};y(kc,"defaultProps",{...Oe.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let fc=kc;function d3(t){return qy(t.source).name||t.id||fs(`unnamed ${t.stage}-shader`)}const Dc=class Dc extends Oe{get[Symbol.toStringTag](){return"Sampler"}constructor(e,i){super(e,i,Dc.defaultProps)}};y(Dc,"defaultProps",{...Oe.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let dc=Dc;const Fc=class Fc extends Oe{constructor(i,n={}){super(i,n,Fc.defaultProps);y(this,"width");y(this,"height");y(this,"colorAttachments",[]);y(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(i){let n=!i;if(i){const[s,r]=Array.isArray(i)?i:[i.width,i.height];n=n||r!==this.height||s!==this.width,this.width=s,this.height=r}n&&(Y.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(n=>{if(typeof n=="string"){const s=this.createColorTexture(n);return this.attachResource(s),s.view}return n instanceof Xt?n.view:n});const i=this.props.depthStencilAttachment;if(i)if(typeof i=="string"){const n=this.createDepthStencilTexture(i);this.attachResource(n),this.depthStencilAttachment=n.view}else i instanceof Xt?this.depthStencilAttachment=i.view:this.depthStencilAttachment=i}createColorTexture(i){return this.device.createTexture({id:"color-attachment",usage:Xt.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}createDepthStencilTexture(i){return this.device.createTexture({id:"depth-stencil-attachment",usage:Xt.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}resizeAttachments(i,n){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const r=this.device._createTexture({...this.colorAttachments[s].props,width:i,height:n});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=r.view,this.attachResource(r.view)}if(this.depthStencilAttachment){const s=this.device._createTexture({...this.depthStencilAttachment.props,width:i,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}}};y(Fc,"defaultProps",{...Oe.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let pc=Fc;const Lc=class Lc extends Oe{constructor(i,n){super(i,n,Lc.defaultProps);y(this,"shaderLayout");y(this,"bufferLayout");y(this,"linkStatus","pending");y(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(i){throw new Error("Use uniform blocks")}};y(Lc,"defaultProps",{...Oe.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let ur=Lc;const Bc=class Bc extends Oe{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,i){super(e,i,Bc.defaultProps)}};y(Bc,"defaultProps",{...Oe.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Mh=Bc;const Uc=class Uc extends Oe{constructor(i,n){super(i,n,Uc.defaultProps);y(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};y(Uc,"defaultProps",{...Oe.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let gc=Uc;const zc=class zc extends Oe{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,i){super(e,i,zc.defaultProps)}};y(zc,"defaultProps",{...Oe.defaultProps,measureExecutionTime:void 0});let Ih=zc;const Vc=class Vc extends Oe{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,i){super(e,i,Vc.defaultProps)}};y(Vc,"defaultProps",{...Oe.defaultProps});let Oh=Vc;function p3(t){const[e,i]=_3[t],n=e==="i32"||e==="u32",s=e!=="u32",r=m3[e]*i,o=g3(e,i);return{dataType:e,components:i,defaultVertexFormat:o,byteLength:r,integer:n,signed:s}}function g3(t,e){let i;switch(t){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?i:`${i}x${e}`}const _3={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},m3={f32:4,f16:2,i32:4,u32:4};function Yy(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[i,n]=t.split("x"),s=i,r=n?parseInt(n):1,o=Hy(s),a={type:s,components:r,byteLength:o.byteLength*r,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function Ky(t,e){const i={};for(const n of t.attributes)i[n.name]=v3(t,e,n.name);return i}function y3(t,e,i=16){const n=Ky(t,e),s=new Array(i).fill(null);for(const r of Object.values(n))s[r.location]=r;return s}function v3(t,e,i){const n=b3(t,i),s=w3(e,i);if(!n)return null;const r=p3(n.type),o=(s==null?void 0:s.vertexFormat)||r.defaultVertexFormat,a=Yy(o);return{attributeName:(s==null?void 0:s.attributeName)||n.name,bufferName:(s==null?void 0:s.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:r.dataType,shaderComponents:r.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:r.integer,stepMode:(s==null?void 0:s.stepMode)||n.stepMode,byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function b3(t,e){const i=t.attributes.find(n=>n.name===e);return i||Y.warn(`shader layout attribute "${e}" not present in shader`),i||null}function w3(t,e){T3(t);let i=E3(t,e);return i||(i=S3(t,e),i)?i:(Y.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function T3(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Y.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function E3(t,e){for(const i of t)if(i.format&&i.name===e)return{attributeName:i.name,bufferName:e,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}function S3(t,e){var i;for(const n of t){let s=n.byteStride;if(typeof n.byteStride!="number")for(const o of n.attributes||[]){const a=Yy(o.format);s+=a.byteLength}const r=(i=n.attributes)==null?void 0:i.find(o=>o.attribute===e);if(r)return{attributeName:r.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:s}}return null}function A3(t,e){const i={...t,attributes:t.attributes.map(n=>({...n}))};for(const n of(e==null?void 0:e.attributes)||[]){const s=i.attributes.find(r=>r.name===n.name);s?(s.type=n.type||s.type,s.stepMode=n.stepMode||s.stepMode):Y.warn(`shader layout attribute ${n.name} not present in shader`)}return i}const jc=class jc extends Oe{constructor(i,n){super(i,n,jc.defaultProps);y(this,"maxVertexAttributes");y(this,"attributeInfos");y(this,"indexBuffer",null);y(this,"attributes");this.maxVertexAttributes=i.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=y3(n.renderPipeline.shaderLayout,n.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(i,n){throw new Error("constant attributes not supported")}};y(jc,"defaultProps",{...Oe.defaultProps,renderPipeline:null});let Nh=jc;const $c=class $c extends Oe{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,i){super(e,i,$c.defaultProps)}};y($c,"defaultProps",{...Oe.defaultProps,layout:void 0,buffers:{}});let kh=$c;const Hc=class Hc extends Oe{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,i){super(e,i,Hc.defaultProps)}};y(Hc,"defaultProps",{...Oe.defaultProps,type:void 0,count:void 0});let Dh=Hc;const R3={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function C3(t){const e=R3[t];return ze(t),e}function x3(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let sa;function Zy(t){return(!sa||sa.byteLength<t)&&(sa=new ArrayBuffer(t)),sa}function P3(t,e){const i=Zy(t.BYTES_PER_ELEMENT*e);return new t(i,0,e)}function M3(t){const{target:e,source:i,start:n=0,count:s=1}=t,r=i.length,o=s*r;let a=0;for(let c=n;a<r;a++)e[c++]=i[a];for(;a<o;)a<o-a?(e.copyWithin(n+a,n,n+a),a*=2):(e.copyWithin(n+a,n,n+o-a),a=o);return t.target}const bg=1024;class I3{constructor(e){y(this,"layout",{});y(this,"byteLength");let i=0;for(const[s,r]of Object.entries(e)){const o=C3(r),{type:a,components:c}=o;i=x3(i,c);const l=i;i+=c,this.layout[s]={type:a,size:c,offset:l}}i+=(4-i%4)%4;const n=i*4;this.byteLength=Math.max(n,bg)}getData(e){const i=Math.max(this.byteLength,bg),n=Zy(i),s={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[r,o]of Object.entries(e)){const a=this.layout[r];if(!a){Y.warn(`Supplied uniform value ${r} not present in uniform block layout`)();continue}const{type:c,size:l,offset:u}=a,h=s[c];if(l===1){if(typeof o!="number"&&typeof o!="boolean"){Y.warn(`Supplied value for single component uniform ${r} is not a number: ${o}`)();continue}h[u]=Number(o)}else{const f=Eo(o);if(!f){Y.warn(`Supplied value for multi component / array uniform ${r} is not a numeric array: ${o}`)();continue}h.set(f,u)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function O3(t,e,i=16){if(t!==e)return!1;const n=Eo(t);if(!n)return!1;const s=Eo(e);if(s&&n.length===s.length){for(let r=0;r<n.length;++r)if(s[r]!==n[r])return!1}return!0}function N3(t){const e=Eo(t);return e?e.slice():t}class k3{constructor(e){y(this,"name");y(this,"uniforms",{});y(this,"modifiedUniforms",{});y(this,"modified",!0);y(this,"bindingLayout",{});y(this,"needsRedraw","initialized");var i;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const n=(i=e==null?void 0:e.shaderLayout.bindings)==null?void 0:i.find(r=>r.type==="uniform"&&r.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const s=n;for(const r of s.uniforms||[])this.bindingLayout[r.name]=r}}setUniforms(e){for(const[i,n]of Object.entries(e))this._setUniform(i,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${i}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,i){O3(this.uniforms[e],i)||(this.uniforms[e]=N3(i),this.modifiedUniforms[e]=!0,this.modified=!0)}}class D3{constructor(e){y(this,"uniformBlocks",new Map);y(this,"uniformBufferLayouts",new Map);y(this,"uniformBuffers",new Map);for(const[i,n]of Object.entries(e)){const s=i,r=new I3(n.uniformTypes||{});this.uniformBufferLayouts.set(s,r);const o=new k3({name:i});o.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(s,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[i,n]of Object.entries(e))this.uniformBlocks.get(i).setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const i=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(i)}createUniformBuffer(e,i,n){n&&this.setUniforms(n);const s=this.getUniformBufferByteLength(i),r=e.createBuffer({usage:qe.UNIFORM|qe.COPY_DST,byteLength:s}),o=this.getUniformBufferData(i);return r.write(o),r}getManagedUniformBuffer(e,i){if(!this.uniformBuffers.get(i)){const n=this.getUniformBufferByteLength(i),s=e.createBuffer({usage:qe.UNIFORM|qe.COPY_DST,byteLength:n});this.uniformBuffers.set(i,s)}return this.uniformBuffers.get(i)}updateUniformBuffers(){let e=!1;for(const i of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(i);e||(e=n)}return e&&Y.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const i=this.uniformBlocks.get(e),n=this.uniformBuffers.get(e);let s=!1;if(n&&i.needsRedraw){s||(s=i.needsRedraw);const r=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(r);const a=this.uniformBlocks.get(e).getAllUniforms();Y.log(4,`Writing to uniform buffer ${String(e)}`,r,a)()}return s}}function Gy(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function Jy(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function F3(t,e,i){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let s=Gy(t);if(s==="uint8"||s==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return i&&(s=s.replace("int","norm")),`${s}x${n}`}if(s==="uint16"||s==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return i&&(s=s.replace("int","norm")),`${s}x${n}`}return n===1?s:`${s}x${n}`}function L3(t){return Eo(t)!==null||typeof t=="number"||typeof t=="boolean"}function Qy(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(i=>{const n=t[i];L3(n)?e.uniforms[i]=n:e.bindings[i]=n}),e}function B3(t,e,i){const{removedProps:n={},deprecatedProps:s={},replacedProps:r={}}=i;for(const a in n)if(a in e){const l=n[a]?`${t}.${n[a]}`:"N/A";Y.removed(`${t}.${a}`,l)()}for(const a in s)if(a in e){const c=s[a];Y.deprecated(`${t}.${a}`,`${t}.${c}`)()}let o=null;for(const[a,c]of Object.entries(r))a in e&&(Y.deprecated(`${t}.${a}`,`${t}.${c}`)(),o=o||Object.assign({},e),o[c]=e[a],delete o[a]);return o||e}let U3="";async function z3(t,e){return await new Promise((i,n)=>{try{const s=new Image;s.onload=()=>i(s),s.onerror=()=>n(new Error(`Could not load image ${t}.`)),s.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",s.src=t.startsWith("http")?t:U3+t}catch(s){n(s)}})}async function e1(t,e){const i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",t),e&&(n.id=e),new Promise((s,r)=>{n.onload=s,n.onerror=o=>r(new Error(`Unable to load script '${t}': ${o}`)),i.appendChild(n)})}function Fh(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Fh(t[n],e[n],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!Fh(t[r],e[r],i-1))return!1;return!0}return!1}function V3(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function j3(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class $3{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class ds{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}}class nt extends ds{constructor(){super()}}let t1=class extends nt{constructor(e,i,n,s){super(),this.name=e,this.args=i,this.returnType=n,this.body=s}get astNodeType(){return"function"}};class H3 extends nt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}}class W3 extends nt{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"while"}}class X3 extends nt{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}}class q3 extends nt{constructor(e,i,n,s){super(),this.init=e,this.condition=i,this.increment=n,this.body=s}get astNodeType(){return"for"}}class Bs extends nt{constructor(e,i,n,s,r){super(),this.name=e,this.type=i,this.storage=n,this.access=s,this.value=r}get astNodeType(){return"var"}}class i1 extends nt{constructor(e,i,n){super(),this.name=e,this.type=i,this.value=n}get astNodeType(){return"override"}}class wg extends nt{constructor(e,i,n,s,r){super(),this.name=e,this.type=i,this.storage=n,this.access=s,this.value=r}get astNodeType(){return"let"}}class Tg extends nt{constructor(e,i,n,s,r){super(),this.name=e,this.type=i,this.storage=n,this.access=s,this.value=r}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}}var hr;(function(t){t.increment="++",t.decrement="--"})(hr||(hr={}));(function(t){function e(i){const n=i;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}t.parse=e})(hr||(hr={}));class Y3 extends nt{constructor(e,i){super(),this.operator=e,this.variable=i}get astNodeType(){return"increment"}}var So;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(So||(So={}));(function(t){function e(i){const n=i;if(n=="parse")throw new Error("Invalid value for AssignOperator");return t[n]}t.parse=e})(So||(So={}));class K3 extends nt{constructor(e,i,n){super(),this.operator=e,this.variable=i,this.value=n}get astNodeType(){return"assign"}}class Z3 extends nt{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"call"}}class G3 extends nt{constructor(e,i){super(),this.body=e,this.continuing=i}get astNodeType(){return"loop"}}class J3 extends nt{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"body"}}class Q3 extends nt{constructor(e,i,n,s){super(),this.condition=e,this.body=i,this.elseif=n,this.else=s}get astNodeType(){return"if"}}class eR extends nt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}}class tR extends nt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class n1 extends nt{constructor(e,i){super(),this.name=e,this.type=i}get astNodeType(){return"alias"}}class iR extends nt{constructor(){super()}get astNodeType(){return"discard"}}class nR extends nt{constructor(){super()}get astNodeType(){return"break"}}class sR extends nt{constructor(){super()}get astNodeType(){return"continue"}}class ps extends nt{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class In extends ps{constructor(e,i){super(e),this.members=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let i=0;i<this.members.length;i++)if(this.members[i].name==e)return i;return-1}}class s1 extends ps{constructor(e,i,n){super(e),this.format=i,this.access=n}get astNodeType(){return"template"}}class rR extends ps{constructor(e,i,n,s){super(e),this.storage=i,this.type=n,this.access=s}get astNodeType(){return"pointer"}}class r1 extends ps{constructor(e,i,n,s){super(e),this.attributes=i,this.format=n,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class Xr extends ps{constructor(e,i,n){super(e),this.format=i,this.access=n}get astNodeType(){return"sampler"}}class Mi extends ds{constructor(){super()}}class Eg extends Mi{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class qr extends Mi{constructor(e,i){super(),this.type=e,this.args=i}get astNodeType(){return"createExpr"}}class oR extends Mi{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}}class aR extends Mi{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}}class Sg extends Mi{constructor(e,i){super(),this.name=e,this.initializer=i}get astNodeType(){return"constExpr"}evaluate(e){var i,n;if(this.initializer instanceof qr){const s=(i=this.postfix)===null||i===void 0?void 0:i.evaluateString(e),r=(n=this.initializer.type)===null||n===void 0?void 0:n.name,o=e.structs.get(r),a=o==null?void 0:o.getMemberIndex(s);if(a!=-1)return this.initializer.args[a].evaluate(e);console.log(a)}return this.initializer.evaluate(e)}}class Ag extends Mi{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class cR extends Mi{constructor(e,i){super(),this.type=e,this.value=i}get astNodeType(){return"bitcastExpr"}}class lR extends Mi{constructor(e,i){super(),this.type=e,this.args=i}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}}class Rg extends Mi{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}}class o1 extends Mi{constructor(){super()}}class uR extends o1{constructor(e,i){super(),this.operator=e,this.right=i}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}}class yi extends o1{constructor(e,i,n){super(),this.operator=e,this.left=i,this.right=n}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}}class a1 extends ds{constructor(){super()}}class hR extends a1{constructor(e,i){super(),this.selector=e,this.body=i}get astNodeType(){return"case"}}class fR extends a1{constructor(e){super(),this.body=e}get astNodeType(){return"default"}}class dR extends ds{constructor(e,i,n){super(),this.name=e,this.type=i,this.attributes=n}get astNodeType(){return"argument"}}class pR extends ds{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"elseif"}}class gR extends ds{constructor(e,i,n){super(),this.name=e,this.type=i,this.attributes=n}get astNodeType(){return"member"}}let Cg=class extends ds{constructor(e,i){super(),this.name=e,this.value=i}get astNodeType(){return"attribute"}};var z,C;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(C||(C={}));class x{constructor(e,i,n){this.name=e,this.type=i,this.rule=n}toString(){return this.name}}class S{}z=S;S.none=new x("",C.reserved,"");S.eof=new x("EOF",C.token,"");S.reserved={asm:new x("asm",C.reserved,"asm"),bf16:new x("bf16",C.reserved,"bf16"),do:new x("do",C.reserved,"do"),enum:new x("enum",C.reserved,"enum"),f16:new x("f16",C.reserved,"f16"),f64:new x("f64",C.reserved,"f64"),handle:new x("handle",C.reserved,"handle"),i8:new x("i8",C.reserved,"i8"),i16:new x("i16",C.reserved,"i16"),i64:new x("i64",C.reserved,"i64"),mat:new x("mat",C.reserved,"mat"),premerge:new x("premerge",C.reserved,"premerge"),regardless:new x("regardless",C.reserved,"regardless"),typedef:new x("typedef",C.reserved,"typedef"),u8:new x("u8",C.reserved,"u8"),u16:new x("u16",C.reserved,"u16"),u64:new x("u64",C.reserved,"u64"),unless:new x("unless",C.reserved,"unless"),using:new x("using",C.reserved,"using"),vec:new x("vec",C.reserved,"vec"),void:new x("void",C.reserved,"void")};S.keywords={array:new x("array",C.keyword,"array"),atomic:new x("atomic",C.keyword,"atomic"),bool:new x("bool",C.keyword,"bool"),f32:new x("f32",C.keyword,"f32"),i32:new x("i32",C.keyword,"i32"),mat2x2:new x("mat2x2",C.keyword,"mat2x2"),mat2x3:new x("mat2x3",C.keyword,"mat2x3"),mat2x4:new x("mat2x4",C.keyword,"mat2x4"),mat3x2:new x("mat3x2",C.keyword,"mat3x2"),mat3x3:new x("mat3x3",C.keyword,"mat3x3"),mat3x4:new x("mat3x4",C.keyword,"mat3x4"),mat4x2:new x("mat4x2",C.keyword,"mat4x2"),mat4x3:new x("mat4x3",C.keyword,"mat4x3"),mat4x4:new x("mat4x4",C.keyword,"mat4x4"),ptr:new x("ptr",C.keyword,"ptr"),sampler:new x("sampler",C.keyword,"sampler"),sampler_comparison:new x("sampler_comparison",C.keyword,"sampler_comparison"),struct:new x("struct",C.keyword,"struct"),texture_1d:new x("texture_1d",C.keyword,"texture_1d"),texture_2d:new x("texture_2d",C.keyword,"texture_2d"),texture_2d_array:new x("texture_2d_array",C.keyword,"texture_2d_array"),texture_3d:new x("texture_3d",C.keyword,"texture_3d"),texture_cube:new x("texture_cube",C.keyword,"texture_cube"),texture_cube_array:new x("texture_cube_array",C.keyword,"texture_cube_array"),texture_multisampled_2d:new x("texture_multisampled_2d",C.keyword,"texture_multisampled_2d"),texture_storage_1d:new x("texture_storage_1d",C.keyword,"texture_storage_1d"),texture_storage_2d:new x("texture_storage_2d",C.keyword,"texture_storage_2d"),texture_storage_2d_array:new x("texture_storage_2d_array",C.keyword,"texture_storage_2d_array"),texture_storage_3d:new x("texture_storage_3d",C.keyword,"texture_storage_3d"),texture_depth_2d:new x("texture_depth_2d",C.keyword,"texture_depth_2d"),texture_depth_2d_array:new x("texture_depth_2d_array",C.keyword,"texture_depth_2d_array"),texture_depth_cube:new x("texture_depth_cube",C.keyword,"texture_depth_cube"),texture_depth_cube_array:new x("texture_depth_cube_array",C.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new x("texture_depth_multisampled_2d",C.keyword,"texture_depth_multisampled_2d"),texture_external:new x("texture_external",C.keyword,"texture_external"),u32:new x("u32",C.keyword,"u32"),vec2:new x("vec2",C.keyword,"vec2"),vec3:new x("vec3",C.keyword,"vec3"),vec4:new x("vec4",C.keyword,"vec4"),bitcast:new x("bitcast",C.keyword,"bitcast"),block:new x("block",C.keyword,"block"),break:new x("break",C.keyword,"break"),case:new x("case",C.keyword,"case"),continue:new x("continue",C.keyword,"continue"),continuing:new x("continuing",C.keyword,"continuing"),default:new x("default",C.keyword,"default"),discard:new x("discard",C.keyword,"discard"),else:new x("else",C.keyword,"else"),enable:new x("enable",C.keyword,"enable"),fallthrough:new x("fallthrough",C.keyword,"fallthrough"),false:new x("false",C.keyword,"false"),fn:new x("fn",C.keyword,"fn"),for:new x("for",C.keyword,"for"),function:new x("function",C.keyword,"function"),if:new x("if",C.keyword,"if"),let:new x("let",C.keyword,"let"),const:new x("const",C.keyword,"const"),loop:new x("loop",C.keyword,"loop"),while:new x("while",C.keyword,"while"),private:new x("private",C.keyword,"private"),read:new x("read",C.keyword,"read"),read_write:new x("read_write",C.keyword,"read_write"),return:new x("return",C.keyword,"return"),storage:new x("storage",C.keyword,"storage"),switch:new x("switch",C.keyword,"switch"),true:new x("true",C.keyword,"true"),alias:new x("alias",C.keyword,"alias"),type:new x("type",C.keyword,"type"),uniform:new x("uniform",C.keyword,"uniform"),var:new x("var",C.keyword,"var"),override:new x("override",C.keyword,"override"),workgroup:new x("workgroup",C.keyword,"workgroup"),write:new x("write",C.keyword,"write"),r8unorm:new x("r8unorm",C.keyword,"r8unorm"),r8snorm:new x("r8snorm",C.keyword,"r8snorm"),r8uint:new x("r8uint",C.keyword,"r8uint"),r8sint:new x("r8sint",C.keyword,"r8sint"),r16uint:new x("r16uint",C.keyword,"r16uint"),r16sint:new x("r16sint",C.keyword,"r16sint"),r16float:new x("r16float",C.keyword,"r16float"),rg8unorm:new x("rg8unorm",C.keyword,"rg8unorm"),rg8snorm:new x("rg8snorm",C.keyword,"rg8snorm"),rg8uint:new x("rg8uint",C.keyword,"rg8uint"),rg8sint:new x("rg8sint",C.keyword,"rg8sint"),r32uint:new x("r32uint",C.keyword,"r32uint"),r32sint:new x("r32sint",C.keyword,"r32sint"),r32float:new x("r32float",C.keyword,"r32float"),rg16uint:new x("rg16uint",C.keyword,"rg16uint"),rg16sint:new x("rg16sint",C.keyword,"rg16sint"),rg16float:new x("rg16float",C.keyword,"rg16float"),rgba8unorm:new x("rgba8unorm",C.keyword,"rgba8unorm"),rgba8unorm_srgb:new x("rgba8unorm_srgb",C.keyword,"rgba8unorm_srgb"),rgba8snorm:new x("rgba8snorm",C.keyword,"rgba8snorm"),rgba8uint:new x("rgba8uint",C.keyword,"rgba8uint"),rgba8sint:new x("rgba8sint",C.keyword,"rgba8sint"),bgra8unorm:new x("bgra8unorm",C.keyword,"bgra8unorm"),bgra8unorm_srgb:new x("bgra8unorm_srgb",C.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new x("rgb10a2unorm",C.keyword,"rgb10a2unorm"),rg11b10float:new x("rg11b10float",C.keyword,"rg11b10float"),rg32uint:new x("rg32uint",C.keyword,"rg32uint"),rg32sint:new x("rg32sint",C.keyword,"rg32sint"),rg32float:new x("rg32float",C.keyword,"rg32float"),rgba16uint:new x("rgba16uint",C.keyword,"rgba16uint"),rgba16sint:new x("rgba16sint",C.keyword,"rgba16sint"),rgba16float:new x("rgba16float",C.keyword,"rgba16float"),rgba32uint:new x("rgba32uint",C.keyword,"rgba32uint"),rgba32sint:new x("rgba32sint",C.keyword,"rgba32sint"),rgba32float:new x("rgba32float",C.keyword,"rgba32float"),static_assert:new x("static_assert",C.keyword,"static_assert")};S.tokens={decimal_float_literal:new x("decimal_float_literal",C.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new x("hex_float_literal",C.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new x("int_literal",C.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new x("uint_literal",C.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new x("ident",C.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new x("and",C.token,"&"),and_and:new x("and_and",C.token,"&&"),arrow:new x("arrow ",C.token,"->"),attr:new x("attr",C.token,"@"),attr_left:new x("attr_left",C.token,"[["),attr_right:new x("attr_right",C.token,"]]"),forward_slash:new x("forward_slash",C.token,"/"),bang:new x("bang",C.token,"!"),bracket_left:new x("bracket_left",C.token,"["),bracket_right:new x("bracket_right",C.token,"]"),brace_left:new x("brace_left",C.token,"{"),brace_right:new x("brace_right",C.token,"}"),colon:new x("colon",C.token,":"),comma:new x("comma",C.token,","),equal:new x("equal",C.token,"="),equal_equal:new x("equal_equal",C.token,"=="),not_equal:new x("not_equal",C.token,"!="),greater_than:new x("greater_than",C.token,">"),greater_than_equal:new x("greater_than_equal",C.token,">="),shift_right:new x("shift_right",C.token,">>"),less_than:new x("less_than",C.token,"<"),less_than_equal:new x("less_than_equal",C.token,"<="),shift_left:new x("shift_left",C.token,"<<"),modulo:new x("modulo",C.token,"%"),minus:new x("minus",C.token,"-"),minus_minus:new x("minus_minus",C.token,"--"),period:new x("period",C.token,"."),plus:new x("plus",C.token,"+"),plus_plus:new x("plus_plus",C.token,"++"),or:new x("or",C.token,"|"),or_or:new x("or_or",C.token,"||"),paren_left:new x("paren_left",C.token,"("),paren_right:new x("paren_right",C.token,")"),semicolon:new x("semicolon",C.token,";"),star:new x("star",C.token,"*"),tilde:new x("tilde",C.token,"~"),underscore:new x("underscore",C.token,"_"),xor:new x("xor",C.token,"^"),plus_equal:new x("plus_equal",C.token,"+="),minus_equal:new x("minus_equal",C.token,"-="),times_equal:new x("times_equal",C.token,"*="),division_equal:new x("division_equal",C.token,"/="),modulo_equal:new x("modulo_equal",C.token,"%="),and_equal:new x("and_equal",C.token,"&="),or_equal:new x("or_equal",C.token,"|="),xor_equal:new x("xor_equal",C.token,"^="),shift_right_equal:new x("shift_right_equal",C.token,">>="),shift_left_equal:new x("shift_left_equal",C.token,"<<=")};S.storage_class=[z.keywords.function,z.keywords.private,z.keywords.workgroup,z.keywords.uniform,z.keywords.storage];S.access_mode=[z.keywords.read,z.keywords.write,z.keywords.read_write];S.sampler_type=[z.keywords.sampler,z.keywords.sampler_comparison];S.sampled_texture_type=[z.keywords.texture_1d,z.keywords.texture_2d,z.keywords.texture_2d_array,z.keywords.texture_3d,z.keywords.texture_cube,z.keywords.texture_cube_array];S.multisampled_texture_type=[z.keywords.texture_multisampled_2d];S.storage_texture_type=[z.keywords.texture_storage_1d,z.keywords.texture_storage_2d,z.keywords.texture_storage_2d_array,z.keywords.texture_storage_3d];S.depth_texture_type=[z.keywords.texture_depth_2d,z.keywords.texture_depth_2d_array,z.keywords.texture_depth_cube,z.keywords.texture_depth_cube_array,z.keywords.texture_depth_multisampled_2d];S.texture_external_type=[z.keywords.texture_external];S.any_texture_type=[...z.sampled_texture_type,...z.multisampled_texture_type,...z.storage_texture_type,...z.depth_texture_type,...z.texture_external_type];S.texel_format=[z.keywords.r8unorm,z.keywords.r8snorm,z.keywords.r8uint,z.keywords.r8sint,z.keywords.r16uint,z.keywords.r16sint,z.keywords.r16float,z.keywords.rg8unorm,z.keywords.rg8snorm,z.keywords.rg8uint,z.keywords.rg8sint,z.keywords.r32uint,z.keywords.r32sint,z.keywords.r32float,z.keywords.rg16uint,z.keywords.rg16sint,z.keywords.rg16float,z.keywords.rgba8unorm,z.keywords.rgba8unorm_srgb,z.keywords.rgba8snorm,z.keywords.rgba8uint,z.keywords.rgba8sint,z.keywords.bgra8unorm,z.keywords.bgra8unorm_srgb,z.keywords.rgb10a2unorm,z.keywords.rg11b10float,z.keywords.rg32uint,z.keywords.rg32sint,z.keywords.rg32float,z.keywords.rgba16uint,z.keywords.rgba16sint,z.keywords.rgba16float,z.keywords.rgba32uint,z.keywords.rgba32sint,z.keywords.rgba32float];S.const_literal=[z.tokens.int_literal,z.tokens.uint_literal,z.tokens.decimal_float_literal,z.tokens.hex_float_literal,z.keywords.true,z.keywords.false];S.literal_or_ident=[z.tokens.ident,z.tokens.int_literal,z.tokens.uint_literal,z.tokens.decimal_float_literal,z.tokens.hex_float_literal];S.element_count_expression=[z.tokens.int_literal,z.tokens.uint_literal,z.tokens.ident];S.template_types=[z.keywords.vec2,z.keywords.vec3,z.keywords.vec4,z.keywords.mat2x2,z.keywords.mat2x3,z.keywords.mat2x4,z.keywords.mat3x2,z.keywords.mat3x3,z.keywords.mat3x4,z.keywords.mat4x2,z.keywords.mat4x3,z.keywords.mat4x4,z.keywords.atomic,z.keywords.bitcast,...z.any_texture_type];S.attribute_name=[z.tokens.ident,z.keywords.block];S.assignment_operators=[z.tokens.equal,z.tokens.plus_equal,z.tokens.minus_equal,z.tokens.times_equal,z.tokens.division_equal,z.tokens.modulo_equal,z.tokens.and_equal,z.tokens.or_equal,z.tokens.xor_equal,z.tokens.shift_right_equal,z.tokens.shift_left_equal];S.increment_operators=[z.tokens.plus_plus,z.tokens.minus_minus];class xg{constructor(e,i,n){this.type=e,this.lexeme=i,this.line=n}toString(){return this.lexeme}isTemplateType(){return S.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==S.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class _R{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new xg(S.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let n=1;for(;n>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),n--,n==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),n++)}return!0}}let i=S.none;for(;;){let n=this._findType(e);const s=this._peekAhead();if(e==">"&&(s==">"||s=="=")){let r=!1,o=this._tokens.length-1;for(let a=0;a<5&&o>=0;++a,--o)if(this._tokens[o].type===S.tokens.less_than){o>0&&this._tokens[o-1].isArrayOrTemplateType()&&(r=!0);break}if(r)return this._addToken(n),!0}if(n===S.none){let r=e,o=0;const a=2;for(let c=0;c<a;++c)if(r+=this._peekAhead(c),n=this._findType(r),n!==S.none){o=c;break}if(n===S.none)return i===S.none?!1:(this._current--,this._addToken(i),!0);e=r,this._current+=o+1}if(i=n,this._isAtEnd())break;e+=this._advance()}return i===S.none?!1:(this._addToken(i),!0)}_findType(e){for(const i in S.keywords){const n=S.keywords[i];if(this._match(e,n.rule))return n}for(const i in S.tokens){const n=S.tokens[i];if(this._match(e,n.rule))return n}return S.none}_match(e,i){if(typeof i=="string"){if(i==e)return!0}else{const n=i.exec(e);if(n&&n.index==0&&n[0]==e)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let i=this._source[this._current];return e=e||0,e++,this._current+=e,i}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const i=this._source.substring(this._start,this._current);this._tokens.push(new xg(e,i,this._line))}}class mR{constructor(){this._tokens=[],this._current=0,this._context=new $3}parse(e){this._initialize(e);let i=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;i.push(n)}return i}_initialize(e){if(e)if(typeof e=="string"){const i=new _R(e);this._tokens=i.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,i){return console.error(e,i),{token:e,message:i,toString:function(){return`${i}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==S.eof}_match(e){if(e instanceof x)return this._check(e)?(this._advance(),!0):!1;for(let i=0,n=e.length;i<n;++i){const s=e[i];if(this._check(s))return this._advance(),!0}return!1}_consume(e,i){if(this._check(e))return this._advance();throw this._error(this._peek(),i)}_check(e){if(this._isAtEnd())return!1;const i=this._peek();if(e instanceof Array){let n=i.type;return e.indexOf(n)!=-1}return i.type==e}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._match(S.keywords.alias)){const i=this._type_alias();return this._consume(S.tokens.semicolon,"Expected ';'"),i}if(this._match(S.keywords.enable)){const i=this._enable_directive();return this._consume(S.tokens.semicolon,"Expected ';'"),i}const e=this._attribute();if(this._check(S.keywords.var)){const i=this._global_variable_decl();return i!=null&&(i.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),i}if(this._check(S.keywords.override)){const i=this._override_variable_decl();return i!=null&&(i.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),i}if(this._check(S.keywords.let)){const i=this._global_let_decl();return i!=null&&(i.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),i}if(this._check(S.keywords.const)){const i=this._global_const_decl();return i!=null&&(i.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),i}if(this._check(S.keywords.struct)){const i=this._struct_decl();return i!=null&&(i.attributes=e),i}if(this._check(S.keywords.fn)){const i=this._function_decl();return i!=null&&(i.attributes=e),i}return null}_function_decl(){if(!this._match(S.keywords.fn))return null;const e=this._consume(S.tokens.ident,"Expected function name.").toString();this._consume(S.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(S.tokens.paren_right))do{if(this._check(S.tokens.paren_right))break;const r=this._attribute(),o=this._consume(S.tokens.ident,"Expected argument name.").toString();this._consume(S.tokens.colon,"Expected ':' for argument type.");const a=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=a,i.push(new dR(o,c,r)))}while(this._match(S.tokens.comma));this._consume(S.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(S.tokens.arrow)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}const s=this._compound_statement();return new t1(e,i,n,s)}_compound_statement(){const e=[];for(this._consume(S.tokens.brace_left,"Expected '{' for block.");!this._check(S.tokens.brace_right);){const i=this._statement();i!==null&&e.push(i)}return this._consume(S.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._check(S.keywords.if))return this._if_statement();if(this._check(S.keywords.switch))return this._switch_statement();if(this._check(S.keywords.loop))return this._loop_statement();if(this._check(S.keywords.for))return this._for_statement();if(this._check(S.keywords.while))return this._while_statement();if(this._check(S.keywords.continuing))return this._continuing_statement();if(this._check(S.keywords.static_assert))return this._static_assert_statement();if(this._check(S.tokens.brace_left))return this._compound_statement();let e=null;return this._check(S.keywords.return)?e=this._return_statement():this._check([S.keywords.var,S.keywords.let,S.keywords.const])?e=this._variable_statement():this._match(S.keywords.discard)?e=new iR:this._match(S.keywords.break)?e=new nR:this._match(S.keywords.continue)?e=new sR:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(S.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(S.keywords.static_assert))return null;let e=this._optional_paren_expression();return new H3(e)}_while_statement(){if(!this._match(S.keywords.while))return null;let e=this._optional_paren_expression();const i=this._compound_statement();return new W3(e,i)}_continuing_statement(){if(!this._match(S.keywords.continuing))return null;const e=this._compound_statement();return new X3(e)}_for_statement(){if(!this._match(S.keywords.for))return null;this._consume(S.tokens.paren_left,"Expected '('.");const e=this._check(S.tokens.semicolon)?null:this._for_init();this._consume(S.tokens.semicolon,"Expected ';'.");const i=this._check(S.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(S.tokens.semicolon,"Expected ';'.");const n=this._check(S.tokens.paren_right)?null:this._for_increment();this._consume(S.tokens.paren_right,"Expected ')'.");const s=this._compound_statement();return new q3(e,i,n,s)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(S.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let i=null;return this._match(S.tokens.equal)&&(i=this._short_circuit_or_expression()),new Bs(e.name,e.type,e.storage,e.access,i)}if(this._match(S.keywords.let)){const e=this._consume(S.tokens.ident,"Expected name for let.").toString();let i=null;if(this._match(S.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}this._consume(S.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new wg(e,i,null,null,n)}if(this._match(S.keywords.const)){const e=this._consume(S.tokens.ident,"Expected name for const.").toString();let i=null;if(this._match(S.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}this._consume(S.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new Tg(e,i,null,null,n)}return null}_increment_decrement_statement(){const e=this._current,i=this._unary_expression();if(i==null)return null;if(!this._check(S.increment_operators))return this._current=e,null;const n=this._consume(S.increment_operators,"Expected increment operator");return new Y3(n.type===S.tokens.plus_plus?hr.increment:hr.decrement,i)}_assignment_statement(){let e=null;if(this._check(S.tokens.brace_right))return null;let i=this._match(S.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const n=this._consume(S.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return new K3(So.parse(n.lexeme),e,s)}_func_call_statement(){if(!this._check(S.tokens.ident))return null;const e=this._current,i=this._consume(S.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=e,null):new Z3(i.lexeme,n)}_loop_statement(){if(!this._match(S.keywords.loop))return null;this._consume(S.tokens.brace_left,"Expected '{' for loop.");const e=[];let i=this._statement();for(;i!==null;){if(Array.isArray(i))for(let s of i)e.push(s);else e.push(i);i=this._statement()}let n=null;return this._match(S.keywords.continuing)&&(n=this._compound_statement()),this._consume(S.tokens.brace_right,"Expected '}' for loop."),new G3(e,n)}_switch_statement(){if(!this._match(S.keywords.switch))return null;const e=this._optional_paren_expression();this._consume(S.tokens.brace_left,"Expected '{' for switch.");const i=this._switch_body();if(i==null||i.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(S.tokens.brace_right,"Expected '}' for switch."),new J3(e,i)}_switch_body(){const e=[];if(this._match(S.keywords.case)){const i=this._case_selectors();this._match(S.tokens.colon),this._consume(S.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch case."),e.push(new hR(i,n))}if(this._match(S.keywords.default)){this._match(S.tokens.colon),this._consume(S.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch default."),e.push(new fR(i))}if(this._check([S.keywords.default,S.keywords.case])){const i=this._switch_body();e.push(i[0])}return e}_case_selectors(){var e,i,n,s;const r=[(i=(e=this._shift_expression())===null||e===void 0?void 0:e.evaluate(this._context).toString())!==null&&i!==void 0?i:""];for(;this._match(S.tokens.comma);)r.push((s=(n=this._shift_expression())===null||n===void 0?void 0:n.evaluate(this._context).toString())!==null&&s!==void 0?s:"");return r}_case_body(){if(this._match(S.keywords.fallthrough))return this._consume(S.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const i=this._case_body();return i.length==0?e:[...e,i[0]]}_if_statement(){if(!this._match(S.keywords.if))return null;const e=this._optional_paren_expression(),i=this._compound_statement();let n=[];this._match_elseif()&&(n=this._elseif_statement(n));let s=null;return this._match(S.keywords.else)&&(s=this._compound_statement()),new Q3(e,i,n,s)}_match_elseif(){return this._tokens[this._current].type===S.keywords.else&&this._tokens[this._current+1].type===S.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const i=this._optional_paren_expression(),n=this._compound_statement();return e.push(new pR(i,n)),this._match_elseif()&&this._elseif_statement(e),e}_return_statement(){if(!this._match(S.keywords.return))return null;const e=this._short_circuit_or_expression();return new eR(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(S.tokens.or_or);)e=new yi(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(S.tokens.and_and);)e=new yi(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(S.tokens.or);)e=new yi(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(S.tokens.xor);)e=new yi(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(S.tokens.and);)e=new yi(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([S.tokens.equal_equal,S.tokens.not_equal])?new yi(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([S.tokens.less_than,S.tokens.greater_than,S.tokens.less_than_equal,S.tokens.greater_than_equal]);)e=new yi(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([S.tokens.shift_left,S.tokens.shift_right]);)e=new yi(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([S.tokens.plus,S.tokens.minus]);)e=new yi(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([S.tokens.star,S.tokens.forward_slash,S.tokens.modulo]);)e=new yi(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([S.tokens.minus,S.tokens.bang,S.tokens.tilde,S.tokens.star,S.tokens.and])?new uR(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),i=this._postfix_expression();return i&&(e.postfix=i),e}_postfix_expression(){if(this._match(S.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(S.tokens.bracket_right,"Expected ']'.");const i=this._postfix_expression();return i&&(e.postfix=i),e}if(this._match(S.tokens.period)){const e=this._consume(S.tokens.ident,"Expected member name."),i=this._postfix_expression(),n=new Eg(e.lexeme);return i&&(n.postfix=i),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(S.tokens.ident)){const n=this._previous().toString();if(this._check(S.tokens.paren_left)){const s=this._argument_expression_list(),r=this._getStruct(n);return r!=null?new qr(r,s):new oR(n,s)}if(this._context.constants.has(n)){const s=this._context.constants.get(n);return new Sg(n,s.value)}return new aR(n)}if(this._match(S.const_literal))return new Ag(parseFloat(this._previous().toString()));if(this._check(S.tokens.paren_left))return this._paren_expression();if(this._match(S.keywords.bitcast)){this._consume(S.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(S.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return new cR(n,s)}const e=this._type_decl(),i=this._argument_expression_list();return new lR(e,i)}_argument_expression_list(){if(!this._match(S.tokens.paren_left))return null;const e=[];do{if(this._check(S.tokens.paren_right))break;const i=this._short_circuit_or_expression();e.push(i)}while(this._match(S.tokens.comma));return this._consume(S.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(S.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(S.tokens.paren_right),new Rg([e])}_paren_expression(){this._consume(S.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(S.tokens.paren_right,"Expected ')'."),new Rg([e])}_struct_decl(){if(!this._match(S.keywords.struct))return null;const e=this._consume(S.tokens.ident,"Expected name for struct.").toString();this._consume(S.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(S.tokens.brace_right);){const s=this._attribute(),r=this._consume(S.tokens.ident,"Expected variable name.").toString();this._consume(S.tokens.colon,"Expected ':' for struct member type.");const o=this._attribute(),a=this._type_decl();a!=null&&(a.attributes=o),this._check(S.tokens.brace_right)?this._match(S.tokens.comma):this._consume(S.tokens.comma,"Expected ',' for struct member."),i.push(new gR(r,a,s))}this._consume(S.tokens.brace_right,"Expected '}' after struct body.");const n=new In(e,i);return this._context.structs.set(e,n),n}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(S.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(S.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(S.keywords.const))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let i=null;if(this._match(S.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}let n=null;if(this._match(S.tokens.equal)){const r=this._short_circuit_or_expression();if(r instanceof qr)n=r;else if(r instanceof Sg&&r.initializer instanceof qr)n=r.initializer;else try{const o=r.evaluate(this._context);n=new Ag(o)}catch{n=r}}const s=new Tg(e.toString(),i,"","",n);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(S.keywords.let))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let i=null;if(this._match(S.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}let n=null;return this._match(S.tokens.equal)&&(n=this._const_expression()),new wg(e.toString(),i,"","",n)}_const_expression(){if(this._match(S.const_literal))return new Eg(this._previous().toString());const e=this._type_decl();this._consume(S.tokens.paren_left,"Expected '('.");let i=[];for(;!this._check(S.tokens.paren_right)&&(i.push(this._const_expression()),!!this._check(S.tokens.comma));)this._advance();return this._consume(S.tokens.paren_right,"Expected ')'."),new qr(e,i)}_variable_decl(){if(!this._match(S.keywords.var))return null;let e="",i="";this._match(S.tokens.less_than)&&(e=this._consume(S.storage_class,"Expected storage_class.").toString(),this._match(S.tokens.comma)&&(i=this._consume(S.access_mode,"Expected access_mode.").toString()),this._consume(S.tokens.greater_than,"Expected '>'."));const n=this._consume(S.tokens.ident,"Expected variable name");let s=null;if(this._match(S.tokens.colon)){const r=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=r)}return new Bs(n.toString(),s,e,i,null)}_override_decl(){if(!this._match(S.keywords.override))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let i=null;if(this._match(S.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}return new i1(e.toString(),i,null)}_enable_directive(){const e=this._consume(S.tokens.ident,"identity expected.");return new tR(e.toString())}_type_alias(){const e=this._consume(S.tokens.ident,"identity expected.");this._consume(S.tokens.equal,"Expected '=' for type alias.");let i=this._type_decl();if(i===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);const n=new n1(e.toString(),i);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([S.tokens.ident,...S.texel_format,S.keywords.bool,S.keywords.f32,S.keywords.i32,S.keywords.u32])){const n=this._advance(),s=n.toString();return this._context.structs.has(s)?this._context.structs.get(s):this._context.aliases.has(s)?this._context.aliases.get(s).type:new ps(n.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(S.template_types)){let n=this._advance().toString(),s=null,r=null;return this._match(S.tokens.less_than)&&(s=this._type_decl(),r=null,this._match(S.tokens.comma)&&(r=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for type.")),new s1(n,s,r)}if(this._match(S.keywords.ptr)){let n=this._previous().toString();this._consume(S.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(S.storage_class,"Expected storage_class for pointer");this._consume(S.tokens.comma,"Expected ',' for pointer.");const r=this._type_decl();let o=null;return this._match(S.tokens.comma)&&(o=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for pointer."),new rR(n,s.toString(),r,o)}const i=this._attribute();if(this._match(S.keywords.array)){let n=null,s=-1;const r=this._previous();if(this._match(S.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let o="";this._match(S.tokens.comma)&&(o=this._shift_expression().evaluate(this._context).toString()),this._consume(S.tokens.greater_than,"Expected '>' for array."),s=o?parseInt(o):0}return new r1(r.toString(),i,n,s)}return null}_texture_sampler_types(){if(this._match(S.sampler_type))return new Xr(this._previous().toString(),null,null);if(this._match(S.depth_texture_type))return new Xr(this._previous().toString(),null,null);if(this._match(S.sampled_texture_type)||this._match(S.multisampled_texture_type)){const e=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");const i=this._type_decl();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),new Xr(e.toString(),i,null)}if(this._match(S.storage_texture_type)){const e=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");const i=this._consume(S.texel_format,"Invalid texel format.").toString();this._consume(S.tokens.comma,"Expected ',' after texel format.");const n=this._consume(S.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),new Xr(e.toString(),i,n)}return null}_attribute(){let e=[];for(;this._match(S.tokens.attr);){const i=this._consume(S.attribute_name,"Expected attribute name"),n=new Cg(i.toString(),null);if(this._match(S.tokens.paren_left)){if(n.value=this._consume(S.literal_or_ident,"Expected attribute value").toString(),this._check(S.tokens.comma)){this._advance();do{const s=this._consume(S.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(s)}while(this._match(S.tokens.comma))}this._consume(S.tokens.paren_right,"Expected ')'")}e.push(n)}for(;this._match(S.tokens.attr_left);){if(!this._check(S.tokens.attr_right))do{const i=this._consume(S.attribute_name,"Expected attribute name"),n=new Cg(i.toString(),null);if(this._match(S.tokens.paren_left)){if(n.value=[this._consume(S.literal_or_ident,"Expected attribute value").toString()],this._check(S.tokens.comma)){this._advance();do{const s=this._consume(S.literal_or_ident,"Expected attribute value").toString();n.value.push(s)}while(this._match(S.tokens.comma))}this._consume(S.tokens.paren_right,"Expected ')'")}e.push(n)}while(this._match(S.tokens.comma));this._consume(S.tokens.attr_right,"Expected ']]' after attribute declarations")}return e.length==0?null:e}}class Zs{constructor(e,i){this.name=e,this.attributes=i,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Pg{constructor(e,i,n){this.name=e,this.type=i,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ra extends Zs{constructor(e,i){super(e,i),this.members=[],this.align=0}get isStruct(){return!0}}class ru extends Zs{constructor(e,i){super(e,i),this.count=0,this.stride=0}get isArray(){return!0}}class Mg extends Zs{constructor(e,i,n,s){super(e,n),this.format=i,this.access=s}get isTemplate(){return!0}}var tn;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(tn||(tn={}));class oa{constructor(e,i,n,s,r,o,a){this.name=e,this.type=i,this.group=n,this.binding=s,this.attributes=r,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class yR{constructor(e,i){this.name=e,this.type=i}}class aa{constructor(e,i){this.align=e,this.size=i}}class vR{constructor(e,i,n,s){this.name=e,this.type=i,this.locationType=n,this.location=s,this.interpolation=null}}class Ig{constructor(e,i,n,s){this.name=e,this.type=i,this.locationType=n,this.location=s}}class bR{constructor(e,i=null){this.stage=null,this.inputs=[],this.outputs=[],this.name=e,this.stage=i}}class wR{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class TR{constructor(e,i,n,s){this.name=e,this.type=i,this.attributes=n,this.id=s}}class Bi{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new wR,this._types=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const n=new mR().parse(e);for(const s of n){if(s instanceof In){const r=this._getTypeInfo(s,null);r instanceof ra&&this.structs.push(r);continue}if(s instanceof n1){this.aliases.push(this._getAliasInfo(s));continue}if(s instanceof i1){const r=s,o=this._getAttributeNum(r.attributes,"id",0),a=r.type!=null?this._getTypeInfo(r.type,r.attributes):null;this.overrides.push(new TR(r.name,a,r.attributes,o));continue}if(this._isUniformVar(s)){const r=s,o=this._getAttributeNum(r.attributes,"group",0),a=this._getAttributeNum(r.attributes,"binding",0),c=this._getTypeInfo(r.type,r.attributes),l=new oa(r.name,c,o,a,r.attributes,tn.Uniform,r.access);this.uniforms.push(l);continue}if(this._isStorageVar(s)){const r=s,o=this._getAttributeNum(r.attributes,"group",0),a=this._getAttributeNum(r.attributes,"binding",0),c=this._getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(c),u=new oa(r.name,c,o,a,r.attributes,l?tn.StorageTexture:tn.Storage,r.access);this.storage.push(u);continue}if(this._isTextureVar(s)){const r=s,o=this._getAttributeNum(r.attributes,"group",0),a=this._getAttributeNum(r.attributes,"binding",0),c=this._getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(c),u=new oa(r.name,c,o,a,r.attributes,l?tn.StorageTexture:tn.Texture,r.access);l?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(s)){const r=s,o=this._getAttributeNum(r.attributes,"group",0),a=this._getAttributeNum(r.attributes,"binding",0),c=this._getTypeInfo(r.type,r.attributes),l=new oa(r.name,c,o,a,r.attributes,tn.Sampler,r.access);this.samplers.push(l);continue}if(s instanceof t1){const r=this._getAttribute(s,"vertex"),o=this._getAttribute(s,"fragment"),a=this._getAttribute(s,"compute"),c=r||o||a;if(c){const l=new bR(s.name,c.name);l.inputs=this._getInputs(s.args),l.outputs=this._getOutputs(s.returnType),this.entry[c.name].push(l)}continue}}}getBindGroups(){const e=[];function i(n,s){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),s>=e[n].length&&(e[n].length=s+1)}for(const n of this.uniforms){i(n.group,n.binding);const s=e[n.group];s[n.binding]=n}for(const n of this.storage){i(n.group,n.binding);const s=e[n.group];s[n.binding]=n}for(const n of this.textures){i(n.group,n.binding);const s=e[n.group];s[n.binding]=n}for(const n of this.samplers){i(n.group,n.binding);const s=e[n.group];s[n.binding]=n}return e}_getOutputs(e,i=void 0){if(i===void 0&&(i=[]),e instanceof In)this._getStructOutputs(e,i);else{const n=this._getOutputInfo(e);n!==null&&i.push(n)}return i}_getStructOutputs(e,i){for(const n of e.members)if(n.type instanceof In)this._getStructOutputs(n.type,i);else{const s=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(s!==null){const r=this._getTypeInfo(n.type,n.type.attributes),o=this._parseInt(s.value),a=new Ig(n.name,r,s.name,o);i.push(a)}}}_getOutputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const n=this._getTypeInfo(e,e.attributes),s=this._parseInt(i.value);return new Ig("",n,i.name,s)}return null}_getInputs(e,i=void 0){i===void 0&&(i=[]);for(const n of e)if(n.type instanceof In)this._getStructInputs(n.type,i);else{const s=this._getInputInfo(n);s!==null&&i.push(s)}return i}_getStructInputs(e,i){for(const n of e.members)if(n.type instanceof In)this._getStructInputs(n.type,i);else{const s=this._getInputInfo(n);s!==null&&i.push(s)}}_getInputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const n=this._getAttribute(e,"interpolation"),s=this._getTypeInfo(e.type,e.attributes),r=this._parseInt(i.value),o=new vR(e.name,s,i.name,r);return n!==null&&(o.interpolation=this._parseString(n.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const i=parseInt(e);return isNaN(i)?e:i}_getAlias(e){for(const i of this.aliases)if(i.name==e)return i.type;return null}_getAliasInfo(e){return new yR(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,i){if(this._types.has(e))return this._types.get(e);if(e instanceof r1){const s=e,r=this._getTypeInfo(s.format,s.attributes),o=new ru(s.name,i);return o.format=r,o.count=s.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof In){const s=e,r=new ra(s.name,i);for(const o of s.members){const a=this._getTypeInfo(o.type,o.attributes);r.members.push(new Pg(o.name,a,o.attributes))}return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof Xr){const s=e,r=s.format instanceof ps,o=s.format?r?this._getTypeInfo(s.format,null):new Zs(s.format,null):null,a=new Mg(s.name,o,i,s.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof s1){const s=e,r=s.format?this._getTypeInfo(s.format,null):null,o=new Mg(s.name,r,i,s.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const n=new Zs(e.name,i);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var i,n;const s=this._getTypeSize(e);if(e.size=(i=s==null?void 0:s.size)!==null&&i!==void 0?i:0,e instanceof ru){const r=this._getTypeSize(e.format);e.stride=(n=r==null?void 0:r.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(e.format)}e instanceof ra&&this._updateStructInfo(e)}_updateStructInfo(e){var i;let n=0,s=0,r=0,o=0;for(let a=0,c=e.members.length;a<c;++a){const l=e.members[a],u=this._getTypeSize(l);if(!u)continue;(i=this._getAlias(l.type.name))!==null&&i!==void 0||l.type;const h=u.align,f=u.size;n=this._roundUp(h,n+s),s=f,r=n,o=Math.max(o,h),l.offset=n,l.size=f,this._updateTypeInfo(l.type)}e.size=this._roundUp(o,r+s),e.align=o}_getTypeSize(e){var i;if(e==null)return null;const n=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Pg&&(e=e.type),e instanceof Zs){const r=this._getAlias(e.name);r!==null&&(e=r)}{const r=Bi._typeInfo[e.name];if(r!==void 0){const o=e.format==="f16"?2:1;return new aa(Math.max(s,r.align/o),Math.max(n,r.size/o))}}{const r=Bi._typeInfo[e.name.substring(0,e.name.length-1)];if(r){const o=e.name[e.name.length-1]==="h"?2:1;return new aa(Math.max(s,r.align/o),Math.max(n,r.size/o))}}if(e instanceof ru){let r=e,o=8,a=8;const c=this._getTypeSize(r.format);c!==null&&(a=c.size,o=c.align);const l=r.count,u=this._getAttributeNum((i=e==null?void 0:e.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(o,a));return a=l*u,n&&(a=n),new aa(Math.max(s,o),Math.max(n,a))}if(e instanceof ra){let r=0,o=0,a=0,c=0,l=0;for(const u of e.members){const h=this._getTypeSize(u.type);h!==null&&(r=Math.max(h.align,r),a=this._roundUp(h.align,a+c),c=h.size,l=a)}return o=this._roundUp(r,l+c),new aa(Math.max(s,r),Math.max(n,o))}return null}_isUniformVar(e){return e instanceof Bs&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Bs&&e.storage=="storage"}_isTextureVar(e){return e instanceof Bs&&e.type!==null&&Bi._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Bs&&e.type!==null&&Bi._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,i){const n=e;if(!n||!n.attributes)return null;const s=n.attributes;for(let r of s)if(r.name==i)return r;return null}_getAttributeNum(e,i,n){if(e===null)return n;for(let s of e)if(s.name==i){let r=s!==null&&s.value!==null?s.value:n;return r instanceof Array&&(r=r[0]),typeof r=="number"?r:typeof r=="string"?parseInt(r):n}return n}_roundUp(e,i){return Math.ceil(i/e)*e}}Bi._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};Bi._textureTypes=S.any_texture_type.map(t=>t.name);Bi._samplerTypes=S.sampler_type.map(t=>t.name);function ER(t){const e={attributes:[],bindings:[]};let i;try{i=SR(t)}catch(r){return Y.error(r.message)(),e}for(const r of i.uniforms){const o=[];for(const a of r.type.members)o.push({name:a.name,type:Og(a.type)});e.bindings.push({type:"uniform",name:r.name,location:r.binding,group:r.group,members:o})}const n=i.entry.vertex[0],s=(n==null?void 0:n.inputs.length)||0;for(let r=0;r<s;r++){const o=n.inputs[r];if(o.locationType==="location"){const a=Og(o.type);e.attributes.push({name:o.name,location:o.location,type:a})}}return e}function Og(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function SR(t){try{return new Bi(t)}catch(e){if(e instanceof Error)throw e;let i="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(i+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(i+=e.token.line||""),new Error(i,{cause:e})}}const AR=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,RR={name:"fp32",vs:AR},CR=new Float32Array([0,1,1,1]),xR=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,PR=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,Ng={name:"picking",vs:xR,fs:PR,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:new Float32Array([0,0,0]),highlightColor:CR},getUniforms:MR};function MR(t={},e){const i={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)i.isHighlightActive=!1;else{i.isHighlightActive=!0;const n=t.highlightedObjectColor.slice(0,3);i.highlightedObjectColor=n}if(t.highlightColor){const n=Array.from(t.highlightColor,s=>s/255);Number.isFinite(n[3])||(n[3]=1),i.highlightColor=n}return t.isActive!==void 0&&(i.isActive=!!t.isActive,i.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(i.useFloatColors=!!t.useFloatColors),i}const IR={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...IR}};const xt=globalThis.mathgl.config;function OR(t,{precision:e=xt.precision}={}){return t=NR(t),`${parseFloat(t.toPrecision(e))}`}function rs(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function dt(t,e,i){return DR(t,n=>Math.max(e,Math.min(i,n)))}function qn(t,e,i){return rs(t)?t.map((n,s)=>qn(n,e[s],i)):i*e+(1-i)*t}function zi(t,e,i){const n=xt.EPSILON;i&&(xt.EPSILON=i);try{if(t===e)return!0;if(rs(t)&&rs(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!zi(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=xt.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{xt.EPSILON=n}}function NR(t){return Math.round(t/xt.EPSILON)*xt.EPSILON}function kR(t){return t.clone?t.clone():new Array(t.length)}function DR(t,e,i){if(rs(t)){const n=t;i=i||kR(n);for(let s=0;s<i.length&&s<n.length;++s){const r=typeof t=="number"?t:t[s];i[s]=e(r,s,i)}return i}return e(t)}class td extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,i=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+i];return this.check()}toArray(e=[],i=0){for(let n=0;n<this.ELEMENTS;++n)e[i+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:rs(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(xt)}formatString(e){let i="";for(let n=0;n<this.ELEMENTS;++n)i+=(n>0?", ":"")+OR(this[n],e);return`${e.printTypes?this.constructor.name:""}[${i}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!zi(this[i],e[i]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==e[i])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,i,n){if(n===void 0)return this.lerp(this,e,i);for(let s=0;s<this.ELEMENTS;++s){const r=e[s],o=typeof i=="number"?i:i[s];this[s]=r+n*(o-r)}return this.check()}min(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(e[i],this[i]);return this.check()}max(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(e[i],this[i]);return this.check()}clamp(e,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),i[n]);return this.check()}add(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=i[n];return this.check()}subtract(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=i[n];return this.check()}scale(e){if(typeof e=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;else for(let i=0;i<this.ELEMENTS&&i<e.length;++i)this[i]*=e[i];return this.check()}multiplyByScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}check(){if(xt.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)e=e&&Number.isFinite(this[i]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=e;return this.check()}addScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),i);return this.check()}get elements(){return this}}function FR(t,e){if(t.length!==e)return!1;for(let i=0;i<t.length;++i)if(!Number.isFinite(t[i]))return!1;return!0}function Le(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function to(t,e,i=""){if(xt.debug&&!FR(t,e))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return t}function Ao(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class c1 extends td{get x(){return this[0]}set x(e){this[0]=Le(e)}get y(){return this[1]}set y(e){this[1]=Le(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*this[i];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let i=0;for(let n=0;n<this.ELEMENTS;++n){const s=this[n]-e[n];i+=s*s}return Le(i)}dot(e){let i=0;for(let n=0;n<this.ELEMENTS;++n)i+=this[n]*e[n];return Le(i)}normalize(){const e=this.magnitude();if(e!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e;return this.check()}multiply(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=i[n];return this.check()}divide(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=i[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Ao(e>=0&&e<this.ELEMENTS,"index is out of range"),Le(this[e])}setComponent(e,i){return Ao(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=i,this.check()}addVectors(e,i){return this.copy(e).add(i)}subVectors(e,i){return this.copy(e).subtract(i)}multiplyVectors(e,i){return this.copy(e).multiply(i)}addScaledVector(e,i){return this.add(new this.constructor(e).multiplyScalar(i))}}const io=1e-6;let fi=typeof Float32Array<"u"?Float32Array:Array;function LR(){const t=new fi(2);return fi!=Float32Array&&(t[0]=0,t[1]=0),t}function _c(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function l1(t,e){return t[0]=-e[0],t[1]=-e[1],t}function u1(t,e,i,n){const s=e[0],r=e[1];return t[0]=s+n*(i[0]-s),t[1]=r+n*(i[1]-r),t}function BR(t,e,i){const n=e[0],s=e[1];return t[0]=i[0]*n+i[3]*s+i[6],t[1]=i[1]*n+i[4]*s+i[7],t}function UR(t,e,i){const n=e[0],s=e[1];return t[0]=i[0]*n+i[4]*s+i[12],t[1]=i[1]*n+i[5]*s+i[13],t}(function(){const t=LR();return function(e,i,n,s,r,o){let a,c;for(i||(i=2),n||(n=0),s?c=Math.min(s*i+n,e.length):c=e.length,a=n;a<c;a+=i)t[0]=e[a],t[1]=e[a+1],r(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function zR(t,e,i){const n=e[0],s=e[1],r=i[3]*n+i[7]*s||1;return t[0]=(i[0]*n+i[4]*s)/r,t[1]=(i[1]*n+i[5]*s)/r,t}function h1(t,e,i){const n=e[0],s=e[1],r=e[2],o=i[3]*n+i[7]*s+i[11]*r||1;return t[0]=(i[0]*n+i[4]*s+i[8]*r)/o,t[1]=(i[1]*n+i[5]*s+i[9]*r)/o,t[2]=(i[2]*n+i[6]*s+i[10]*r)/o,t}function VR(t,e,i){const n=e[0],s=e[1];return t[0]=i[0]*n+i[2]*s,t[1]=i[1]*n+i[3]*s,t[2]=e[2],t}function jR(t,e,i){const n=e[0],s=e[1];return t[0]=i[0]*n+i[2]*s,t[1]=i[1]*n+i[3]*s,t[2]=e[2],t[3]=e[3],t}function f1(t,e,i){const n=e[0],s=e[1],r=e[2];return t[0]=i[0]*n+i[3]*s+i[6]*r,t[1]=i[1]*n+i[4]*s+i[7]*r,t[2]=i[2]*n+i[5]*s+i[8]*r,t[3]=e[3],t}function d1(){const t=new fi(3);return fi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function $R(t){const e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)}function kg(t,e,i){const n=new fi(3);return n[0]=t,n[1]=e,n[2]=i,n}function HR(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function WR(t){const e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n}function XR(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function qR(t,e){const i=e[0],n=e[1],s=e[2];let r=i*i+n*n+s*s;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function p1(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function La(t,e,i){const n=e[0],s=e[1],r=e[2],o=i[0],a=i[1],c=i[2];return t[0]=s*c-r*a,t[1]=r*o-n*c,t[2]=n*a-s*o,t}function YR(t,e,i,n){const s=e[0],r=e[1],o=e[2];return t[0]=s+n*(i[0]-s),t[1]=r+n*(i[1]-r),t[2]=o+n*(i[2]-o),t}function id(t,e,i){const n=e[0],s=e[1],r=e[2];let o=i[3]*n+i[7]*s+i[11]*r+i[15];return o=o||1,t[0]=(i[0]*n+i[4]*s+i[8]*r+i[12])/o,t[1]=(i[1]*n+i[5]*s+i[9]*r+i[13])/o,t[2]=(i[2]*n+i[6]*s+i[10]*r+i[14])/o,t}function g1(t,e,i){const n=e[0],s=e[1],r=e[2];return t[0]=n*i[0]+s*i[3]+r*i[6],t[1]=n*i[1]+s*i[4]+r*i[7],t[2]=n*i[2]+s*i[5]+r*i[8],t}function _1(t,e,i){const n=i[0],s=i[1],r=i[2],o=i[3],a=e[0],c=e[1],l=e[2];let u=s*l-r*c,h=r*a-n*l,f=n*c-s*a,d=s*f-r*h,p=r*u-n*f,g=n*h-s*u;const _=o*2;return u*=_,h*=_,f*=_,d*=2,p*=2,g*=2,t[0]=a+u+d,t[1]=c+h+p,t[2]=l+f+g,t}function KR(t,e,i,n){const s=[],r=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],r[0]=s[0],r[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),r[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t}function ZR(t,e,i,n){const s=[],r=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],r[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),r[1]=s[1],r[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t}function GR(t,e,i,n){const s=[],r=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],r[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),r[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),r[2]=s[2],t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t}function JR(t,e){const i=t[0],n=t[1],s=t[2],r=e[0],o=e[1],a=e[2],c=Math.sqrt((i*i+n*n+s*s)*(r*r+o*o+a*a)),l=c&&p1(t,e)/c;return Math.acos(Math.min(Math.max(l,-1),1))}const m1=HR,y1=$R,ou=WR;(function(){const t=d1();return function(e,i,n,s,r,o){let a,c;for(i||(i=3),n||(n=0),s?c=Math.min(s*i+n,e.length):c=e.length,a=n;a<c;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],r(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const au=[0,0,0];let ca;class J extends c1{static get ZERO(){return ca||(ca=new J(0,0,0),Object.freeze(ca)),ca}constructor(e=0,i=0,n=0){super(-0,-0,-0),arguments.length===1&&rs(e)?this.copy(e):(xt.debug&&(Le(e),Le(i),Le(n)),this[0]=e,this[1]=i,this[2]=n)}set(e,i,n){return this[0]=e,this[1]=i,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return xt.debug&&(Le(e.x),Le(e.y),Le(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Le(e)}angle(e){return JR(this,e)}cross(e){return La(this,this,e),this.check()}rotateX({radians:e,origin:i=au}){return KR(this,this,i,e),this.check()}rotateY({radians:e,origin:i=au}){return ZR(this,this,i,e),this.check()}rotateZ({radians:e,origin:i=au}){return GR(this,this,i,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return id(this,this,e),this.check()}transformAsVector(e){return h1(this,this,e),this.check()}transformByMatrix3(e){return g1(this,this,e),this.check()}transformByMatrix2(e){return VR(this,this,e),this.check()}transformByQuaternion(e){return _1(this,this,e),this.check()}}let la;class nd extends c1{static get ZERO(){return la||(la=new nd(0,0,0,0),Object.freeze(la)),la}constructor(e=0,i=0,n=0,s=0){super(-0,-0,-0,-0),rs(e)&&arguments.length===1?this.copy(e):(xt.debug&&(Le(e),Le(i),Le(n),Le(s)),this[0]=e,this[1]=i,this[2]=n,this[3]=s)}set(e,i,n,s){return this[0]=e,this[1]=i,this[2]=n,this[3]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return xt.debug&&(Le(e.x),Le(e.y),Le(e.z),Le(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Le(e)}get w(){return this[3]}set w(e){this[3]=Le(e)}transform(e){return id(this,this,e),this.check()}transformByMatrix3(e){return f1(this,this,e),this.check()}transformByMatrix2(e){return jR(this,this,e),this.check()}transformByQuaternion(e){return _1(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class v1 extends td{toString(){let e="[";if(xt.printRowMajor){e+="row-major:";for(let i=0;i<this.RANK;++i)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+i]}`}else{e+="column-major:";for(let i=0;i<this.ELEMENTS;++i)e+=` ${this[i]}`}return e+="]",e}getElementIndex(e,i){return i*this.RANK+e}getElement(e,i){return this[i*this.RANK+e]}setElement(e,i,n){return this[i*this.RANK+e]=Le(n),this}getColumn(e,i=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let s=0;s<this.RANK;++s)i[s]=this[n+s];return i}setColumn(e,i){const n=e*this.RANK;for(let s=0;s<this.RANK;++s)this[n+s]=i[s];return this}}function QR(){const t=new fi(9);return fi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function eC(t,e){if(t===e){const i=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function tC(t,e){const i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,f=-u*r+a*c,d=l*r-o*c;let p=i*h+n*f+s*d;return p?(p=1/p,t[0]=h*p,t[1]=(-u*n+s*l)*p,t[2]=(a*n-s*o)*p,t[3]=f*p,t[4]=(u*i-s*c)*p,t[5]=(-a*i+s*r)*p,t[6]=d*p,t[7]=(-l*i+n*c)*p,t[8]=(o*i-n*r)*p,t):null}function iC(t){const e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],c=t[7],l=t[8];return e*(l*r-o*c)+i*(-l*s+o*a)+n*(c*s-r*a)}function Dg(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=i[0],d=i[1],p=i[2],g=i[3],_=i[4],b=i[5],T=i[6],v=i[7],E=i[8];return t[0]=f*n+d*o+p*l,t[1]=f*s+d*a+p*u,t[2]=f*r+d*c+p*h,t[3]=g*n+_*o+b*l,t[4]=g*s+_*a+b*u,t[5]=g*r+_*c+b*h,t[6]=T*n+v*o+E*l,t[7]=T*s+v*a+E*u,t[8]=T*r+v*c+E*h,t}function nC(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=i[0],d=i[1];return t[0]=n,t[1]=s,t[2]=r,t[3]=o,t[4]=a,t[5]=c,t[6]=f*n+d*o+l,t[7]=f*s+d*a+u,t[8]=f*r+d*c+h,t}function sC(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=Math.sin(i),d=Math.cos(i);return t[0]=d*n+f*o,t[1]=d*s+f*a,t[2]=d*r+f*c,t[3]=d*o-f*n,t[4]=d*a-f*s,t[5]=d*c-f*r,t[6]=l,t[7]=u,t[8]=h,t}function Fg(t,e,i){const n=i[0],s=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function rC(t,e){const i=e[0],n=e[1],s=e[2],r=e[3],o=i+i,a=n+n,c=s+s,l=i*o,u=n*o,h=n*a,f=s*o,d=s*a,p=s*c,g=r*o,_=r*a,b=r*c;return t[0]=1-h-p,t[3]=u-b,t[6]=f+_,t[1]=u+b,t[4]=1-l-p,t[7]=d-g,t[2]=f-_,t[5]=d+g,t[8]=1-l-h,t}var Lh;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(Lh||(Lh={}));const oC=Object.freeze([1,0,0,0,1,0,0,0,1]);class mt extends v1{static get IDENTITY(){return cC()}static get ZERO(){return aC()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Lh}constructor(e,...i){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):i.length>0?this.copy([e,...i]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(oC)}fromObject(e){return this.check()}fromQuaternion(e){return rC(this,e),this.check()}set(e,i,n,s,r,o,a,c,l){return this[0]=e,this[1]=i,this[2]=n,this[3]=s,this[4]=r,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(e,i,n,s,r,o,a,c,l){return this[0]=e,this[1]=s,this[2]=a,this[3]=i,this[4]=r,this[5]=c,this[6]=n,this[7]=o,this[8]=l,this.check()}determinant(){return iC(this)}transpose(){return eC(this,this),this.check()}invert(){return tC(this,this),this.check()}multiplyLeft(e){return Dg(this,e,this),this.check()}multiplyRight(e){return Dg(this,this,e),this.check()}rotate(e){return sC(this,this,e),this.check()}scale(e){return Array.isArray(e)?Fg(this,this,e):Fg(this,this,[e,e]),this.check()}translate(e){return nC(this,this,e),this.check()}transform(e,i){let n;switch(e.length){case 2:n=BR(i||[-0,-0],e,this);break;case 3:n=g1(i||[-0,-0,-0],e,this);break;case 4:n=f1(i||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return to(n,e.length),n}transformVector(e,i){return this.transform(e,i)}transformVector2(e,i){return this.transform(e,i)}transformVector3(e,i){return this.transform(e,i)}}let ua,ha=null;function aC(){return ua||(ua=new mt([0,0,0,0,0,0,0,0,0]),Object.freeze(ua)),ua}function cC(){return ha||(ha=new mt,Object.freeze(ha)),ha}function lC(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function uC(t,e){if(t===e){const i=e[1],n=e[2],s=e[3],r=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=r,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Bh(t,e){const i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],f=e[10],d=e[11],p=e[12],g=e[13],_=e[14],b=e[15],T=i*a-n*o,v=i*c-s*o,E=i*l-r*o,R=n*c-s*a,P=n*l-r*a,M=s*l-r*c,U=u*g-h*p,O=u*_-f*p,D=u*b-d*p,I=h*_-f*g,V=h*b-d*g,k=f*b-d*_;let B=T*k-v*V+E*I+R*D-P*O+M*U;return B?(B=1/B,t[0]=(a*k-c*V+l*I)*B,t[1]=(s*V-n*k-r*I)*B,t[2]=(g*M-_*P+b*R)*B,t[3]=(f*P-h*M-d*R)*B,t[4]=(c*D-o*k-l*O)*B,t[5]=(i*k-s*D+r*O)*B,t[6]=(_*E-p*M-b*v)*B,t[7]=(u*M-f*E+d*v)*B,t[8]=(o*V-a*D+l*U)*B,t[9]=(n*D-i*V-r*U)*B,t[10]=(p*P-g*E+b*T)*B,t[11]=(h*E-u*P-d*T)*B,t[12]=(a*O-o*I-c*U)*B,t[13]=(i*I-n*O+s*U)*B,t[14]=(g*v-p*R-_*T)*B,t[15]=(u*R-h*v+f*T)*B,t):null}function hC(t){const e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],c=t[7],l=t[8],u=t[9],h=t[10],f=t[11],d=t[12],p=t[13],g=t[14],_=t[15],b=e*o-i*r,T=e*a-n*r,v=i*a-n*o,E=l*p-u*d,R=l*g-h*d,P=u*g-h*p,M=e*P-i*R+n*E,U=r*P-o*R+a*E,O=l*v-u*T+h*b,D=d*v-p*T+g*b;return c*M-s*U+_*O-f*D}function Yn(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=e[9],d=e[10],p=e[11],g=e[12],_=e[13],b=e[14],T=e[15];let v=i[0],E=i[1],R=i[2],P=i[3];return t[0]=v*n+E*a+R*h+P*g,t[1]=v*s+E*c+R*f+P*_,t[2]=v*r+E*l+R*d+P*b,t[3]=v*o+E*u+R*p+P*T,v=i[4],E=i[5],R=i[6],P=i[7],t[4]=v*n+E*a+R*h+P*g,t[5]=v*s+E*c+R*f+P*_,t[6]=v*r+E*l+R*d+P*b,t[7]=v*o+E*u+R*p+P*T,v=i[8],E=i[9],R=i[10],P=i[11],t[8]=v*n+E*a+R*h+P*g,t[9]=v*s+E*c+R*f+P*_,t[10]=v*r+E*l+R*d+P*b,t[11]=v*o+E*u+R*p+P*T,v=i[12],E=i[13],R=i[14],P=i[15],t[12]=v*n+E*a+R*h+P*g,t[13]=v*s+E*c+R*f+P*_,t[14]=v*r+E*l+R*d+P*b,t[15]=v*o+E*u+R*p+P*T,t}function mc(t,e,i){const n=i[0],s=i[1],r=i[2];let o,a,c,l,u,h,f,d,p,g,_,b;return e===t?(t[12]=e[0]*n+e[4]*s+e[8]*r+e[12],t[13]=e[1]*n+e[5]*s+e[9]*r+e[13],t[14]=e[2]*n+e[6]*s+e[10]*r+e[14],t[15]=e[3]*n+e[7]*s+e[11]*r+e[15]):(o=e[0],a=e[1],c=e[2],l=e[3],u=e[4],h=e[5],f=e[6],d=e[7],p=e[8],g=e[9],_=e[10],b=e[11],t[0]=o,t[1]=a,t[2]=c,t[3]=l,t[4]=u,t[5]=h,t[6]=f,t[7]=d,t[8]=p,t[9]=g,t[10]=_,t[11]=b,t[12]=o*n+u*s+p*r+e[12],t[13]=a*n+h*s+g*r+e[13],t[14]=c*n+f*s+_*r+e[14],t[15]=l*n+d*s+b*r+e[15]),t}function sd(t,e,i){const n=i[0],s=i[1],r=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function fC(t,e,i,n){let s=n[0],r=n[1],o=n[2],a=Math.sqrt(s*s+r*r+o*o),c,l,u,h,f,d,p,g,_,b,T,v,E,R,P,M,U,O,D,I,V,k,B,F;return a<io?null:(a=1/a,s*=a,r*=a,o*=a,l=Math.sin(i),c=Math.cos(i),u=1-c,h=e[0],f=e[1],d=e[2],p=e[3],g=e[4],_=e[5],b=e[6],T=e[7],v=e[8],E=e[9],R=e[10],P=e[11],M=s*s*u+c,U=r*s*u+o*l,O=o*s*u-r*l,D=s*r*u-o*l,I=r*r*u+c,V=o*r*u+s*l,k=s*o*u+r*l,B=r*o*u-s*l,F=o*o*u+c,t[0]=h*M+g*U+v*O,t[1]=f*M+_*U+E*O,t[2]=d*M+b*U+R*O,t[3]=p*M+T*U+P*O,t[4]=h*D+g*I+v*V,t[5]=f*D+_*I+E*V,t[6]=d*D+b*I+R*V,t[7]=p*D+T*I+P*V,t[8]=h*k+g*B+v*F,t[9]=f*k+_*B+E*F,t[10]=d*k+b*B+R*F,t[11]=p*k+T*B+P*F,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function b1(t,e,i){const n=Math.sin(i),s=Math.cos(i),r=e[4],o=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*s+l*n,t[5]=o*s+u*n,t[6]=a*s+h*n,t[7]=c*s+f*n,t[8]=l*s-r*n,t[9]=u*s-o*n,t[10]=h*s-a*n,t[11]=f*s-c*n,t}function dC(t,e,i){const n=Math.sin(i),s=Math.cos(i),r=e[0],o=e[1],a=e[2],c=e[3],l=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*s-l*n,t[1]=o*s-u*n,t[2]=a*s-h*n,t[3]=c*s-f*n,t[8]=r*n+l*s,t[9]=o*n+u*s,t[10]=a*n+h*s,t[11]=c*n+f*s,t}function w1(t,e,i){const n=Math.sin(i),s=Math.cos(i),r=e[0],o=e[1],a=e[2],c=e[3],l=e[4],u=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*s+l*n,t[1]=o*s+u*n,t[2]=a*s+h*n,t[3]=c*s+f*n,t[4]=l*s-r*n,t[5]=u*s-o*n,t[6]=h*s-a*n,t[7]=f*s-c*n,t}function pC(t,e){const i=e[0],n=e[1],s=e[2],r=e[4],o=e[5],a=e[6],c=e[8],l=e[9],u=e[10];return t[0]=Math.sqrt(i*i+n*n+s*s),t[1]=Math.sqrt(r*r+o*o+a*a),t[2]=Math.sqrt(c*c+l*l+u*u),t}function gC(t,e){const i=e[0],n=e[1],s=e[2],r=e[3],o=i+i,a=n+n,c=s+s,l=i*o,u=n*o,h=n*a,f=s*o,d=s*a,p=s*c,g=r*o,_=r*a,b=r*c;return t[0]=1-h-p,t[1]=u+b,t[2]=f-_,t[3]=0,t[4]=u-b,t[5]=1-l-p,t[6]=d+g,t[7]=0,t[8]=f+_,t[9]=d-g,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _C(t,e,i,n,s,r,o){const a=1/(i-e),c=1/(s-n),l=1/(r-o);return t[0]=r*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r*2*c,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+n)*c,t[10]=(o+r)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*r*2*l,t[15]=0,t}function mC(t,e,i,n,s){const r=1/Math.tan(e/2);if(t[0]=r/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0){const o=1/(n-s);t[10]=(s+n)*o,t[14]=2*s*n*o}else t[10]=-1,t[14]=-2*n;return t}const yC=mC;function vC(t,e,i,n,s,r,o){const a=1/(e-i),c=1/(n-s),l=1/(r-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+i)*a,t[13]=(s+n)*c,t[14]=(o+r)*l,t[15]=1,t}const bC=vC;function wC(t,e,i,n){let s,r,o,a,c,l,u,h,f,d;const p=e[0],g=e[1],_=e[2],b=n[0],T=n[1],v=n[2],E=i[0],R=i[1],P=i[2];return Math.abs(p-E)<io&&Math.abs(g-R)<io&&Math.abs(_-P)<io?lC(t):(h=p-E,f=g-R,d=_-P,s=1/Math.sqrt(h*h+f*f+d*d),h*=s,f*=s,d*=s,r=T*d-v*f,o=v*h-b*d,a=b*f-T*h,s=Math.sqrt(r*r+o*o+a*a),s?(s=1/s,r*=s,o*=s,a*=s):(r=0,o=0,a=0),c=f*a-d*o,l=d*r-h*a,u=h*o-f*r,s=Math.sqrt(c*c+l*l+u*u),s?(s=1/s,c*=s,l*=s,u*=s):(c=0,l=0,u=0),t[0]=r,t[1]=c,t[2]=h,t[3]=0,t[4]=o,t[5]=l,t[6]=f,t[7]=0,t[8]=a,t[9]=u,t[10]=d,t[11]=0,t[12]=-(r*p+o*g+a*_),t[13]=-(c*p+l*g+u*_),t[14]=-(h*p+f*g+d*_),t[15]=1,t)}function TC(){const t=new fi(4);return fi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function EC(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function rd(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function SC(t){const e=t[0],i=t[1],n=t[2],s=t[3];return Math.sqrt(e*e+i*i+n*n+s*s)}function AC(t){const e=t[0],i=t[1],n=t[2],s=t[3];return e*e+i*i+n*n+s*s}function RC(t,e){const i=e[0],n=e[1],s=e[2],r=e[3];let o=i*i+n*n+s*s+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=i*o,t[1]=n*o,t[2]=s*o,t[3]=r*o,t}function CC(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function xC(t,e,i,n){const s=e[0],r=e[1],o=e[2],a=e[3];return t[0]=s+n*(i[0]-s),t[1]=r+n*(i[1]-r),t[2]=o+n*(i[2]-o),t[3]=a+n*(i[3]-a),t}function wr(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3];return t[0]=i[0]*n+i[4]*s+i[8]*r+i[12]*o,t[1]=i[1]*n+i[5]*s+i[9]*r+i[13]*o,t[2]=i[2]*n+i[6]*s+i[10]*r+i[14]*o,t[3]=i[3]*n+i[7]*s+i[11]*r+i[15]*o,t}function PC(t,e,i){const n=e[0],s=e[1],r=e[2],o=i[0],a=i[1],c=i[2],l=i[3],u=l*n+a*r-c*s,h=l*s+c*n-o*r,f=l*r+o*s-a*n,d=-o*n-a*s-c*r;return t[0]=u*l+d*-o+h*-c-f*-a,t[1]=h*l+d*-a+f*-o-u*-c,t[2]=f*l+d*-c+u*-a-h*-o,t[3]=e[3],t}(function(){const t=TC();return function(e,i,n,s,r,o){let a,c;for(i||(i=4),n||(n=0),s?c=Math.min(s*i+n,e.length):c=e.length,a=n;a<c;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],r(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Uh;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Uh||(Uh={}));const MC=45*Math.PI/180,IC=1,cu=.1,lu=500,OC=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class yt extends v1{static get IDENTITY(){return kC()}static get ZERO(){return NC()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Uh}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,i,n,s,r,o,a,c,l,u,h,f,d,p,g,_){return this[0]=e,this[1]=i,this[2]=n,this[3]=s,this[4]=r,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=u,this[10]=h,this[11]=f,this[12]=d,this[13]=p,this[14]=g,this[15]=_,this.check()}setRowMajor(e,i,n,s,r,o,a,c,l,u,h,f,d,p,g,_){return this[0]=e,this[1]=r,this[2]=l,this[3]=d,this[4]=i,this[5]=o,this[6]=u,this[7]=p,this[8]=n,this[9]=a,this[10]=h,this[11]=g,this[12]=s,this[13]=c,this[14]=f,this[15]=_,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(OC)}fromObject(e){return this.check()}fromQuaternion(e){return gC(this,e),this.check()}frustum(e){const{left:i,right:n,bottom:s,top:r,near:o=cu,far:a=lu}=e;return a===1/0?DC(this,i,n,s,r,o):_C(this,i,n,s,r,o,a),this.check()}lookAt(e){const{eye:i,center:n=[0,0,0],up:s=[0,1,0]}=e;return wC(this,i,n,s),this.check()}ortho(e){const{left:i,right:n,bottom:s,top:r,near:o=cu,far:a=lu}=e;return bC(this,i,n,s,r,o,a),this.check()}orthographic(e){const{fovy:i=MC,aspect:n=IC,focalDistance:s=1,near:r=cu,far:o=lu}=e;Lg(i);const a=i/2,c=s*Math.tan(a),l=c*n;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:r,far:o})}perspective(e){const{fovy:i=45*Math.PI/180,aspect:n=1,near:s=.1,far:r=500}=e;return Lg(i),yC(this,i,n,s,r),this.check()}determinant(){return hC(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),s=1/n[0],r=1/n[1],o=1/n[2];return e[0]=this[0]*s,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*r,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*r,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),s=1/n[0],r=1/n[1],o=1/n[2];return e[0]=this[0]*s,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=this[4]*s,e[4]=this[5]*r,e[5]=this[6]*o,e[6]=this[8]*s,e[7]=this[9]*r,e[8]=this[10]*o,e}transpose(){return uC(this,this),this.check()}invert(){return Bh(this,this),this.check()}multiplyLeft(e){return Yn(this,e,this),this.check()}multiplyRight(e){return Yn(this,this,e),this.check()}rotateX(e){return b1(this,this,e),this.check()}rotateY(e){return dC(this,this,e),this.check()}rotateZ(e){return w1(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,i){return fC(this,this,e,i),this.check()}scale(e){return sd(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return mc(this,this,e),this.check()}transform(e,i){return e.length===4?(i=wr(i||[-0,-0,-0,-0],e,this),to(i,4),i):this.transformAsPoint(e,i)}transformAsPoint(e,i){const{length:n}=e;let s;switch(n){case 2:s=UR(i||[-0,-0],e,this);break;case 3:s=id(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return to(s,e.length),s}transformAsVector(e,i){let n;switch(e.length){case 2:n=zR(i||[-0,-0],e,this);break;case 3:n=h1(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return to(n,e.length),n}transformPoint(e,i){return this.transformAsPoint(e,i)}transformVector(e,i){return this.transformAsPoint(e,i)}transformDirection(e,i){return this.transformAsVector(e,i)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,i,n){return this.identity().translate([e,i,n])}}let fa,da;function NC(){return fa||(fa=new yt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(fa)),fa}function kC(){return da||(da=new yt,Object.freeze(da)),da}function Lg(t){if(t>Math.PI*2)throw Error("expected radians")}function DC(t,e,i,n,s,r){const o=2*r/(i-e),a=2*r/(s-n),c=(i+e)/(i-e),l=(s+n)/(s-n),u=-1,h=-1,f=-2*r;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=c,t[9]=l,t[10]=u,t[11]=h,t[12]=0,t[13]=0,t[14]=f,t[15]=0,t}function Bg(){const t=new fi(4);return fi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function FC(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function T1(t,e,i){i=i*.5;const n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function Ug(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3],a=i[0],c=i[1],l=i[2],u=i[3];return t[0]=n*u+o*a+s*l-r*c,t[1]=s*u+o*c+r*a-n*l,t[2]=r*u+o*l+n*c-s*a,t[3]=o*u-n*a-s*c-r*l,t}function LC(t,e,i){i*=.5;const n=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(i),c=Math.cos(i);return t[0]=n*c+o*a,t[1]=s*c+r*a,t[2]=r*c-s*a,t[3]=o*c-n*a,t}function BC(t,e,i){i*=.5;const n=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(i),c=Math.cos(i);return t[0]=n*c-r*a,t[1]=s*c+o*a,t[2]=r*c+n*a,t[3]=o*c-s*a,t}function UC(t,e,i){i*=.5;const n=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(i),c=Math.cos(i);return t[0]=n*c+s*a,t[1]=s*c-n*a,t[2]=r*c+o*a,t[3]=o*c-r*a,t}function zC(t,e){const i=e[0],n=e[1],s=e[2];return t[0]=i,t[1]=n,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-s*s)),t}function Ba(t,e,i,n){const s=e[0],r=e[1],o=e[2],a=e[3];let c=i[0],l=i[1],u=i[2],h=i[3],f,d,p,g,_;return f=s*c+r*l+o*u+a*h,f<0&&(f=-f,c=-c,l=-l,u=-u,h=-h),1-f>io?(d=Math.acos(f),_=Math.sin(d),p=Math.sin((1-n)*d)/_,g=Math.sin(n*d)/_):(p=1-n,g=n),t[0]=p*s+g*c,t[1]=p*r+g*l,t[2]=p*o+g*u,t[3]=p*a+g*h,t}function VC(t,e){const i=e[0],n=e[1],s=e[2],r=e[3],o=i*i+n*n+s*s+r*r,a=o?1/o:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-s*a,t[3]=r*a,t}function jC(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function E1(t,e){const i=e[0]+e[4]+e[8];let n;if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);const r=(s+1)%3,o=(s+2)%3;n=Math.sqrt(e[s*3+s]-e[r*3+r]-e[o*3+o]+1),t[s]=.5*n,n=.5/n,t[3]=(e[r*3+o]-e[o*3+r])*n,t[r]=(e[r*3+s]+e[s*3+r])*n,t[o]=(e[o*3+s]+e[s*3+o])*n}return t}const $C=EC,HC=rd,WC=CC,XC=xC,qC=SC,YC=AC,S1=RC,KC=function(){const t=d1(),e=kg(1,0,0),i=kg(0,1,0);return function(n,s,r){const o=p1(s,r);return o<-.999999?(La(t,e,s),y1(t)<1e-6&&La(t,i,s),qR(t,t),T1(n,t,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(La(t,s,r),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+o,S1(n,n))}}();(function(){const t=Bg(),e=Bg();return function(i,n,s,r,o,a){return Ba(t,n,o,a),Ba(e,s,r,a),Ba(i,t,e,2*a*(1-a)),i}})();(function(){const t=QR();return function(e,i,n,s){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],S1(e,E1(e,t))}})();const ZC=[0,0,0,1];class zg extends td{constructor(e=0,i=0,n=0,s=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,i,n,s)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,i,n,s){return this[0]=e,this[1]=i,this[2]=n,this[3]=s,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return E1(this,e),this.check()}fromAxisRotation(e,i){return T1(this,e,i),this.check()}identity(){return FC(this),this.check()}setAxisAngle(e,i){return this.fromAxisRotation(e,i)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Le(e)}get y(){return this[1]}set y(e){this[1]=Le(e)}get z(){return this[2]}set z(e){this[2]=Le(e)}get w(){return this[3]}set w(e){this[3]=Le(e)}len(){return qC(this)}lengthSquared(){return YC(this)}dot(e){return WC(this,e)}rotationTo(e,i){return KC(this,e,i),this.check()}add(e){return $C(this,this,e),this.check()}calculateW(){return zC(this,this),this.check()}conjugate(){return jC(this,this),this.check()}invert(){return VC(this,this),this.check()}lerp(e,i,n){return n===void 0?this.lerp(this,e,i):(XC(this,e,i,n),this.check())}multiplyRight(e){return Ug(this,this,e),this.check()}multiplyLeft(e){return Ug(this,e,this),this.check()}normalize(){const e=this.len(),i=e>0?1/e:0;return this[0]=this[0]*i,this[1]=this[1]*i,this[2]=this[2]*i,this[3]=this[3]*i,e===0&&(this[3]=1),this.check()}rotateX(e){return LC(this,this,e),this.check()}rotateY(e){return BC(this,this,e),this.check()}rotateZ(e){return UC(this,this,e),this.check()}scale(e){return HC(this,this,e),this.check()}slerp(e,i,n){let s,r,o;switch(arguments.length){case 1:({start:s=ZC,target:r,ratio:o}=e);break;case 2:s=this,r=e,o=i;break;default:s=e,r=i,o=n}return Ba(this,s,r,o),this.check()}transformVector4(e,i=new nd){return PC(i,e,this),to(i,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,i){return this.setAxisAngle(e,i)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const GC=1e-15,JC=1e-20,Vg=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,QC={lightSources:{}};function uu(t={}){const{color:e=[0,0,0],intensity:i=1}=t;return e.map(n=>n*i/255)}function ex({ambientLight:t,pointLights:e=[],directionalLights:i=[]}){const n={};return t?n["lighting_uAmbientLight.color"]=uu(t):n["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((s,r)=>{n[`lighting_uPointLight[${r}].color`]=uu(s),n[`lighting_uPointLight[${r}].position`]=s.position,n[`lighting_uPointLight[${r}].attenuation`]=s.attenuation||[1,0,0]}),n.lighting_uPointLightCount=e.length,i.forEach((s,r)=>{n[`lighting_uDirectionalLight[${r}].color`]=uu(s),n[`lighting_uDirectionalLight[${r}].direction`]=s.direction}),n.lighting_uDirectionalLightCount=i.length,n}function A1(t=QC){var e,i;if("lightSources"in t){const{ambientLight:n,pointLights:s,directionalLights:r}=t.lightSources||{};return n||s&&s.length>0||r&&r.length>0?Object.assign({},ex({ambientLight:n,pointLights:s,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const n={pointLights:[],directionalLights:[]};for(const s of t.lights||[])switch(s.type){case"ambient":n.ambientLight=s;break;case"directional":(e=n.directionalLights)==null||e.push(s);break;case"point":(i=n.pointLights)==null||i.push(s);break}return A1({lightSources:n})}return{}}const tx={name:"lights",vs:Vg,fs:Vg,getUniforms:A1,defines:{MAX_LIGHTS:3}},ix=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,nx={};function sx(t){const{ambient:e=.35,diffuse:i=.6,shininess:n=32,specularColor:s=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:n,lighting_uSpecularColor:s.map(r=>r/255)}}function rx(t=nx){if(!("material"in t))return{};const{material:e}=t;return e?sx(e):{lighting_uEnabled:!1}}const ox={name:"gouraud-lighting",dependencies:[tx],vs:ix,defines:{LIGHTING_VERTEX:1},getUniforms:rx},R1="#define SMOOTH_EDGE_RADIUS 0.5",ax=`
${R1}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,cx=`
${R1}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,lx={name:"geometry",vs:ax,fs:cx},ge={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ge,"IDENTITY",{get:()=>(fe.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ai={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},os={common:0,meters:1,pixels:2},zh={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},ux=Object.keys(ge).map(t=>`const int COORDINATE_SYSTEM_${t} = ${ge[t]};`).join(""),hx=Object.keys(ai).map(t=>`const int PROJECTION_MODE_${t} = ${ai[t]};`).join(""),fx=Object.keys(os).map(t=>`const int UNIT_${t.toUpperCase()} = ${os[t]};`).join(""),dx=`${ux}
${hx}
${fx}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function px(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}return!1}function Bo(t){let e={},i;return n=>{for(const s in n)if(!px(n[s],e[s])){i=t(n),e=n;break}return i}}const jg=[0,0,0,0],gx=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],C1=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_x=[0,0,0],x1=[0,0,0],mx=Bo(bx);function P1(t,e,i=x1){i.length<3&&(i=[i[0],i[1],0]);let n=i,s,r=!0;switch(e===ge.LNGLAT_OFFSETS||e===ge.METER_OFFSETS?s=i:s=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case ai.WEB_MERCATOR:(e===ge.LNGLAT||e===ge.CARTESIAN)&&(s=[0,0,0],r=!1);break;case ai.WEB_MERCATOR_AUTO_OFFSET:e===ge.LNGLAT?n=s:e===ge.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],s=t.unprojectPosition(n),n[0]-=i[0],n[1]-=i[1],n[2]-=i[2]);break;case ai.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case ai.GLOBE:r=!1,s=null;break;default:r=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:n,offsetMode:r}}function yx(t,e,i){const{viewMatrixUncentered:n,projectionMatrix:s}=t;let{viewMatrix:r,viewProjectionMatrix:o}=t,a=jg,c=jg,l=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:f}=P1(t,e,i);return f&&(c=t.projectPosition(u||h),l=[l[0]-c[0],l[1]-c[1],l[2]-c[2]],c[3]=1,a=wr([],c,o),r=n||r,o=Yn([],s,r),o=Yn([],o,gx)),{viewMatrix:r,viewProjectionMatrix:o,projectionCenter:a,originCommon:c,cameraPosCommon:l,shaderCoordinateOrigin:h,geospatialOrigin:u}}function vx({viewport:t,devicePixelRatio:e=1,modelMatrix:i=null,coordinateSystem:n=ge.DEFAULT,coordinateOrigin:s=x1,autoWrapLongitude:r=!1}){n===ge.DEFAULT&&(n=t.isGeospatial?ge.LNGLAT:ge.CARTESIAN);const o=mx({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:s});return o.project_uWrapLongitude=r,o.project_uModelMatrix=i||C1,o}function bx({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:n}){const{projectionCenter:s,viewProjectionMatrix:r,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:c,geospatialOrigin:l}=yx(t,i,n),u=t.getDistanceScales(),h=[t.width*e,t.height*e],f=wr([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,d={project_uCoordinateSystem:i,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:c,project_uCommonOrigin:o.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:h,project_uDevicePixelRatio:e,project_uFocalDistance:f,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:_x,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:r,project_uModelMatrix:C1,project_uCameraPosition:a};if(l){const p=t.getDistanceScales(l);switch(i){case ge.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=p.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case ge.LNGLAT:case ge.LNGLAT_OFFSETS:t._pseudoMeters||(d.project_uCommonUnitsPerMeter=p.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=p.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case ge.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break}}return d}const wx={};function Tx(t=wx){return"viewport"in t?vx(t):{}}const od={name:"project",dependencies:[RR,lx],vs:dx,getUniforms:Tx},Ex=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Tr={name:"project32",dependencies:[od],vs:Ex};function Sx(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Gs(t,e){const i=wr([],e,t);return rd(i,i,1/i[3]),i}function $g(t,e){const i=t%e;return i<0?e+i:i}function Vh(t,e,i){return t<e?e:t>i?i:t}function Ax(t){return Math.log(t)*Math.LOG2E}const ad=Math.log2||Ax;function Vi(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const ci=Math.PI,M1=ci/4,qt=ci/180,jh=180/ci,fr=512,yc=4003e4,pa=85.051129,Rx=1.5;function Cx(t){return ad(t)}function gn(t){const[e,i]=t;Vi(Number.isFinite(e)),Vi(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const n=e*qt,s=i*qt,r=fr*(n+ci)/(2*ci),o=fr*(ci+Math.log(Math.tan(M1+s*.5)))/(2*ci);return[r,o]}function dr(t){const[e,i]=t,n=e/fr*(2*ci)-ci,s=2*(Math.atan(Math.exp(i/fr*(2*ci)-ci))-M1);return[n*jh,s*jh]}function xx(t){const{latitude:e}=t;Vi(Number.isFinite(e));const i=Math.cos(e*qt);return Cx(yc*i)-9}function hu(t){const e=Math.cos(t*qt);return fr/yc/e}function $h(t){const{latitude:e,longitude:i,highPrecision:n=!1}=t;Vi(Number.isFinite(e)&&Number.isFinite(i));const s=fr,r=Math.cos(e*qt),o=s/360,a=o/r,c=s/yc/r,l={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[o,a,c],degreesPerUnit:[1/o,1/a,1/c]};if(n){const u=qt*Math.tan(e*qt)/r,h=o*u/2,f=s/yc*u,d=f/a*c;l.unitsPerDegree2=[0,h,f],l.unitsPerMeter2=[d,0,d]}return l}function I1(t,e){const[i,n,s]=t,[r,o,a]=e,{unitsPerMeter:c,unitsPerMeter2:l}=$h({longitude:i,latitude:n,highPrecision:!0}),u=gn(t);u[0]+=r*(c[0]+l[0]*o),u[1]+=o*(c[1]+l[1]*o);const h=dr(u),f=(s||0)+(a||0);return Number.isFinite(s)||Number.isFinite(a)?[h[0],h[1],f]:h}function Px(t){const{height:e,pitch:i,bearing:n,altitude:s,scale:r,center:o}=t,a=Sx();mc(a,a,[0,0,-s]),b1(a,a,-i*qt),w1(a,a,n*qt);const c=r/e;return sd(a,a,[c,c,c]),o&&mc(a,a,XR([],o)),a}function Mx(t){const{width:e,height:i,altitude:n,pitch:s=0,offset:r,center:o,scale:a,nearZMultiplier:c=1,farZMultiplier:l=1}=t;let{fovy:u=vc(Rx)}=t;n!==void 0&&(u=vc(n));const h=u*qt,f=s*qt,d=O1(u);let p=d;o&&(p+=o[2]*a/Math.cos(f)/i);const g=h*(.5+(r?r[1]:0)/i),_=Math.sin(g)*p/Math.sin(Vh(Math.PI/2-f-g,.01,Math.PI-.01)),b=Math.sin(f)*_+p,T=p*10,v=Math.min(b*l,T);return{fov:h,aspect:e/i,focalDistance:d,near:c,far:v}}function vc(t){return 2*Math.atan(.5/t)*jh}function O1(t){return .5/Math.tan(.5*t*qt)}function N1(t,e){const[i,n,s=0]=t;return Vi(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(s)),Gs(e,[i,n,s,1])}function gl(t,e,i=0){const[n,s,r]=t;if(Vi(Number.isFinite(n)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(r))return Gs(e,[n,s,r,1]);const o=Gs(e,[n,s,0,1]),a=Gs(e,[n,s,1,1]),c=o[2],l=a[2],u=c===l?0:((i||0)-c)/(l-c);return u1([],o,a,u)}function Ix(t){const{width:e,height:i,bounds:n,minExtent:s=0,maxZoom:r=24,offset:o=[0,0]}=t,[[a,c],[l,u]]=n,h=Ox(t.padding),f=gn([a,Vh(u,-pa,pa)]),d=gn([l,Vh(c,-pa,pa)]),p=[Math.max(Math.abs(d[0]-f[0]),s),Math.max(Math.abs(d[1]-f[1]),s)],g=[e-h.left-h.right-Math.abs(o[0])*2,i-h.top-h.bottom-Math.abs(o[1])*2];Vi(g[0]>0&&g[1]>0);const _=g[0]/p[0],b=g[1]/p[1],T=(h.right-h.left)/2/_,v=(h.top-h.bottom)/2/b,E=[(d[0]+f[0])/2+T,(d[1]+f[1])/2+v],R=dr(E),P=Math.min(r,ad(Math.abs(Math.min(_,b))));return Vi(Number.isFinite(P)),{longitude:R[0],latitude:R[1],zoom:P}}function Ox(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Vi(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const Hg=Math.PI/180;function Nx(t,e=0){const{width:i,height:n,unproject:s}=t,r={targetZ:e},o=s([0,n],r),a=s([i,n],r);let c,l;const u=t.fovy?.5*t.fovy*Hg:Math.atan(.5/t.altitude),h=(90-t.pitch)*Hg;return u>h-.01?(c=Wg(t,0,e),l=Wg(t,i,e)):(c=s([0,0],r),l=s([i,0],r)),[o,a,l,c]}function Wg(t,e,i){const{pixelUnprojectionMatrix:n}=t,s=Gs(n,[e,0,1,1]),r=Gs(n,[e,t.height,1,1]),a=(i*t.distanceScales.unitsPerMeter[2]-s[2])/(r[2]-s[2]),c=u1([],s,r,a),l=dr(c);return l.push(i),l}const Xg=512;function kx(t){const{width:e,height:i,pitch:n=0}=t;let{longitude:s,latitude:r,zoom:o,bearing:a=0}=t;(s<-180||s>180)&&(s=$g(s+180,360)-180),(a<-180||a>180)&&(a=$g(a+180,360)-180);const c=ad(i/Xg);if(o<=c)o=c,r=0;else{const l=i/2/Math.pow(2,o),u=dr([0,l])[1];if(r<u)r=u;else{const h=dr([0,Xg-l])[1];r>h&&(r=h)}}return{width:e,height:i,longitude:s,latitude:r,zoom:o,pitch:n,bearing:a}}const Dx=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Fx=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Lx=Bo(jx),Bx=Bo($x),Ux=[0,0,0,1],zx=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Vx(t,e){const[i,n,s]=t,r=gl([i,n,s],e);return Number.isFinite(s)?r:[r[0],r[1],0]}function jx({viewport:t,center:e}){return new yt(t.viewProjectionMatrix).invert().transform(e)}function $x({viewport:t,shadowMatrices:e}){const i=[],n=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,r=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>Vx(o,n));for(const o of e){const a=o.clone().translate(new J(t.center).negate()),c=r.map(u=>a.transform(u)),l=new yt().ortho({left:Math.min(...c.map(u=>u[0])),right:Math.max(...c.map(u=>u[0])),bottom:Math.min(...c.map(u=>u[1])),top:Math.max(...c.map(u=>u[1])),near:Math.min(...c.map(u=>-u[2])),far:Math.max(...c.map(u=>-u[2]))});i.push(l.multiplyRight(o))}return i}function Hx(t,e){const{shadowEnabled:i=!0}=t;if(!i||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const n={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||Ux,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},s=Lx({viewport:t.viewport,center:e.project_uCenter}),r=[],o=Bx({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const c=o[a],l=c.clone().translate(new J(t.viewport.center).negate());e.project_uCoordinateSystem===ge.LNGLAT&&e.project_uProjectionMode===ai.WEB_MERCATOR?(o[a]=l,r[a]=s):(o[a]=c.clone().multiplyRight(zx),r[a]=l.transform(s))}for(let a=0;a<o.length;a++)n[`shadow_uViewProjectionMatrices[${a}]`]=o[a],n[`shadow_uProjectCenters[${a}]`]=r[a];for(let a=0;a<2;a++)n[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return n}const qg={name:"shadow",dependencies:[od],vs:Dx,fs:Fx,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?Hx(t,e):{}},Er={...Ng,defaultUniforms:{...Ng.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},Wx=[od],Xx=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function qx(){const t=lc.getDefaultShaderAssembler();for(const e of Wx)t.addDefaultModule(e);for(const e of Xx)t.addShaderHook(e);return t}const Yx=[255,255,255],Kx=1;let Zx=0;class Gx{constructor(e={}){this.type="ambient";const{color:i=Yx}=e,{intensity:n=Kx}=e;this.id=e.id||`ambient-${Zx++}`,this.color=i,this.intensity=n}}const Jx=[255,255,255],Qx=1,eP=[0,0,-1];let tP=0;class Yg{constructor(e={}){this.type="directional";const{color:i=Jx}=e,{intensity:n=Qx}=e,{direction:s=eP}=e,{_shadow:r=!1}=e;this.id=e.id||`directional-${tP++}`,this.color=i,this.intensity=n,this.type="directional",this.direction=new J(s).normalize().toArray(),this.shadow=r}getProjectedLight(e){return this}}class iP{constructor(e,i={id:"pass"}){const{id:n}=i;this.id=n,this.device=e,this.props={...i}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class cd extends iP{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[i,n]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,r=e.clearColor??(s?[0,0,0,0]:!1),o=s?1:!1,a=e.colorMask??15,c={viewport:[0,0,i,n]};e.colorMask&&(c.colorMask=a),e.scissorRect&&(c.scissorRect=e.scissorRect);const l=this.device.beginRenderPass({framebuffer:e.target,parameters:c,clearColor:r,clearDepth:o});try{return this._drawLayers(l,e)}finally{l.end()}}_drawLayers(e,i){const{target:n,moduleParameters:s,viewports:r,views:o,onViewportActive:a,clearStack:c=!0}=i;i.pass=i.pass||"unknown",c&&(this._lastRenderIndex=-1);const l=[];for(const u of r){const h=o&&o[u.id];a==null||a(u);const f=this._getDrawLayerParams(u,i),d=u.subViewports||[u];for(const p of d){const g=this._drawLayersInViewport(e,{target:n,moduleParameters:s,viewport:p,view:h,pass:i.pass,layers:i.layers},f);l.push(g)}}return l}_getDrawLayerParams(e,{layers:i,pass:n,isPicking:s=!1,layerFilter:r,cullRect:o,effects:a,moduleParameters:c},l=!1){var p;const u=[],h=k1(this._lastRenderIndex+1),f={layer:i[0],viewport:e,isPicking:s,renderPass:n,cullRect:o},d={};for(let g=0;g<i.length;g++){const _=i[g],b=this._shouldDrawLayer(_,f,r,d),T={shouldDrawLayer:b};b&&!l&&(T.layerRenderIndex=h(_,b),T.moduleParameters=this._getModuleParameters(_,a,n,c),T.layerParameters={...(p=_.context.deck)==null?void 0:p.props.parameters,...this.getLayerParameters(_,g,e)}),u[g]=T}return u}_drawLayersInViewport(e,{layers:i,moduleParameters:n,pass:s,target:r,viewport:o,view:a},c){const l=nP(this.device,{moduleParameters:n,target:r,viewport:o});if(a&&a.props.clear){const h=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:l},()=>this.device.clearWebGL(h))}const u={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let h=0;h<i.length;h++){const f=i[h],{shouldDrawLayer:d,layerRenderIndex:p,moduleParameters:g,layerParameters:_}=c[h];if(d&&f.props.pickable&&u.pickableCount++,f.isComposite)u.compositeCount++;else if(d){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,p),g.viewport=o,f.context.renderPass=e;try{f._drawLayer({renderPass:e,moduleParameters:g,uniforms:{layerIndex:p},parameters:_})}catch(b){f.raiseError(b,`drawing ${f} to ${s}`)}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,i){return null}getLayerParameters(e,i,n){return e.props.parameters}_shouldDrawLayer(e,i,n,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;i.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(i))return!1;i.layer=o,o=o.parent}if(n){const a=i.layer.id;if(a in s||(s[a]=n(i)),!s[a])return!1}return e.activateViewport(i.viewport),!0}_getModuleParameters(e,i,n,s){var a,c;const r=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:r});if(i)for(const l of i)Object.assign(o,(c=l.getModuleParameters)==null?void 0:c.call(l,e));return Object.assign(o,this.getModuleParameters(e,i),s)}}function k1(t=0,e={}){const i={},n=(s,r)=>{const o=s.props._offset,a=s.id,c=s.parent&&s.parent.id;let l;if(c&&!(c in e)&&n(s.parent,!1),c in i){const u=i[c]=i[c]||k1(e[c],e);l=u(s,r),i[a]=u}else Number.isFinite(o)?(l=o+(e[c]||0),i[a]=null):l=t;return r&&l>=t&&(t=l+1),e[a]=l,l};return n}function nP(t,{moduleParameters:e,target:i,viewport:n}){const s=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,r]=t.canvasContext.getDrawingBufferSize(),o=i?i.height:r,a=n;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}class sP extends cd{constructor(e,i){super(e,i),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const i=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],r=s.width*n,o=s.height*n,a=[1,1,1,1];(r!==i.width||o!==i.height)&&i.resize({width:r,height:o}),super.render({...e,clearColor:a,target:i,pass:"shadow"})}getLayerParameters(e,i,n){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const rP={color:[255,255,255],intensity:1},Kg=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],oP=[0,0,0,200/255];class D1{constructor(e={}){this.id="lighting-effect",this.shadowColor=oP,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:i,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(i),n._addDefaultShaderModule(qg),this.dummyShadowMap=i.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const i in e){const n=e[i];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:i,viewports:n,onViewportActive:s,views:r}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:i,viewports:n,onViewportActive:s,views:r,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const i=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return i.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(n=>n.getProjectedLight({layer:e})),pointLights:this.pointLights.map(n=>n.getProjectedLight({layer:e}))},i}cleanup(e){for(const i of this.shadowPasses)i.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(qg))}_calculateMatrices(){const e=[];for(const i of this.directionalLights){const n=new yt().lookAt({eye:new J(i.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let i=0;i<this.directionalLights.length;i++){const n=new sP(e);this.shadowPasses[i]=n,this.shadowMaps[i]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:i,directionalLights:n}=this;!e&&i.length===0&&n.length===0&&(this.ambientLight=new Gx(rP),this.directionalLights.push(new Yg(Kg[0]),new Yg(Kg[1])))}}class aP{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,i,{size:n=1,type:s,padding:r=0,copy:o=!1,initialize:a=!1,maxCount:c}){const l=s||e&&e.constructor||Float32Array,u=i*n+r;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,u)}let h=1/0;c&&(h=c*n+r);const f=this._allocate(l,u,a,h);return e&&o?f.set(e):a||f.fill(0,0,4),this._release(e),f}release(e){this._release(e)}_allocate(e,i,n,s){let r=Math.max(Math.ceil(i*this.opts.overAlloc),1);r>s&&(r=s);const o=this._pool,a=e.BYTES_PER_ELEMENT*r,c=o.findIndex(l=>l.byteLength>=a);if(c>=0){const l=new e(o.splice(c,1)[0],0,r);return n&&l.fill(0),l}return new e(r)}_release(e){if(!ArrayBuffer.isView(e))return;const i=this._pool,{buffer:n}=e,{byteLength:s}=n,r=i.findIndex(o=>o.byteLength>=s);r<0?i.push(n):(r>0||i.length<this.opts.poolSize)&&i.splice(r,0,n),i.length>this.opts.poolSize&&i.shift()}}const pr=new aP;function Yr(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function cP(t,e){const i=t%e;return i<0?e+i:i}function lP(t){return[t[12],t[13],t[14]]}function uP(t){return{left:As(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:As(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:As(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:As(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:As(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:As(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const Zg=new J;function As(t,e,i,n){Zg.set(t,e,i);const s=Zg.len();return{distance:n/s,normal:new J(-t/s,-e/s,-i/s)}}function hP(t){return t-Math.fround(t)}let Or;function fu(t,e){const{size:i=1,startIndex:n=0}=e,s=e.endIndex!==void 0?e.endIndex:t.length,r=(s-n)/i;Or=pr.allocate(Or,r,{type:Float32Array,size:i*2});let o=n,a=0;for(;o<s;){for(let c=0;c<i;c++){const l=t[o++];Or[a+c]=l,Or[a+c+i]=hP(l)}a+=i*2}return Or.subarray(0,r*i*2)}function fP(t){let e=null,i=!1;for(const n of t)n&&(e?(i||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],i=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const dP=Math.PI/180,pP=Yr(),Gg=[0,0,0],gP={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function _P({width:t,height:e,orthographic:i,fovyRadians:n,focalDistance:s,padding:r,near:o,far:a}){const c=t/e,l=i?new yt().orthographic({fovy:n,aspect:c,focalDistance:s,near:o,far:a}):new yt().perspective({fovy:n,aspect:c,near:o,far:a});if(r){const{left:u=0,right:h=0,top:f=0,bottom:d=0}=r,p=dt((u+t-h)/2,0,t)-t/2,g=dt((f+e-d)/2,0,e)-e/2;l[8]-=p*2/t,l[9]+=g*2/e}return l}const Wc=class Wc{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||gP,this.focalDistance=e.focalDistance||1,this.position=e.position||Gg,this.modelMatrix=e.modelMatrix||null;const{longitude:i,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(i),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ai.WEB_MERCATOR:ai.WEB_MERCATOR_AUTO_OFFSET:ai.IDENTITY}equals(e){return e instanceof Wc?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&zi(e.projectionMatrix,this.projectionMatrix)&&zi(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:i=!0}={}){const n=this.projectPosition(e),s=N1(n,this.pixelProjectionMatrix),[r,o]=s,a=i?o:this.height-o;return e.length===2?[r,a]:[r,a,s[2]]}unproject(e,{topLeft:i=!0,targetZ:n}={}){const[s,r,o]=e,a=i?r:this.height-r,c=n&&n*this.distanceScales.unitsPerMeter[2],l=gl([s,a,o],this.pixelUnprojectionMatrix,c),[u,h,f]=this.unprojectPosition(l);return Number.isFinite(o)?[u,h,f]:Number.isFinite(n)?[u,h,n]:[u,h]}projectPosition(e){const[i,n]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,n,s]}unprojectPosition(e){const[i,n]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[i,n,s]}projectFlat(e){if(this.isGeospatial){const i=gn(e);return i[1]=dt(i[1],-318,830),i}return e}unprojectFlat(e){return this.isGeospatial?dr(e):e}getBounds(e={}){const i={targetZ:e.z||0},n=this.unproject([0,0],i),s=this.unproject([this.width,0],i),r=this.unproject([0,this.height],i),o=this.unproject([this.width,this.height],i);return[Math.min(n[0],s[0],r[0],o[0]),Math.min(n[1],s[1],r[1],o[1]),Math.max(n[0],s[0],r[0],o[0]),Math.max(n[1],s[1],r[1],o[1])]}getDistanceScales(e){return e?$h({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:i,width:n=1,height:s=1}){return e<this.x+this.width&&this.x<e+n&&i<this.y+this.height&&this.y<i+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,uP(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,i){return null}_initProps(e){const i=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=xx({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||$h({latitude:n,longitude:i}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:r,modelMatrix:o}=e;let a=Gg;if(r&&(a=o?new yt(o).transformAsVector(r,[]):r),this.isGeospatial){const c=this.projectPosition([i,n,0]);this.center=new J(a).scale(this.distanceScales.unitsPerMeter).add(c)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:i=pP,projectionMatrix:n=null,orthographic:s=!1,fovyRadians:r,fovy:o=75,near:a=.1,far:c=1e3,padding:l=null,focalDistance:u=1}=e;this.viewMatrixUncentered=i,this.viewMatrix=new yt().multiplyRight(i).translate(new J(this.center).negate()),this.projectionMatrix=n||_P({width:this.width,height:this.height,orthographic:s,fovyRadians:r||o*dP,focalDistance:u,padding:l,near:a,far:c});const h=Yr();Yn(h,h,this.projectionMatrix),Yn(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=Bh([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=lP(this.viewMatrixInverse);const f=Yr(),d=Yr();sd(f,f,[this.width/2,-this.height/2,1]),mc(f,f,[1,-1,0]),Yn(d,f,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=Bh(Yr(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||fe.warn("Pixel project matrix not invertible")()}};Wc.displayName="Viewport";let gr=Wc;const ho=class ho extends gr{constructor(e={}){const{latitude:i=0,longitude:n=0,zoom:s=0,pitch:r=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:c=1.01,nearZ:l,farZ:u,orthographic:h=!1,projectionMatrix:f,repeat:d=!1,worldOffset:p=0,position:g,padding:_,legacyMeterSizes:b=!1}=e;let{width:T,height:v,altitude:E=1.5}=e;const R=Math.pow(2,s);T=T||1,v=v||1;let P,M=null;if(f)E=f[5]/2,P=vc(E);else{e.fovy?(P=e.fovy,E=O1(P)):P=vc(E);let O;if(_){const{top:D=0,bottom:I=0}=_;O=[0,dt((D+v-I)/2,0,v)-v/2]}M=Mx({width:T,height:v,scale:R,center:g&&[0,0,g[2]*hu(i)],offset:O,pitch:r,fovy:P,nearZMultiplier:a,farZMultiplier:c}),Number.isFinite(l)&&(M.near=l),Number.isFinite(u)&&(M.far=u)}let U=Px({height:v,pitch:r,bearing:o,scale:R,altitude:E});p&&(U=new yt().translate([512*p,0,0]).multiplyLeft(U)),super({...e,width:T,height:v,viewMatrix:U,longitude:n,latitude:i,zoom:s,...M,fovy:P,focalDistance:E}),this.latitude=i,this.longitude=n,this.zoom=s,this.pitch=r,this.bearing=o,this.altitude=E,this.fovy=P,this.orthographic=h,this._subViewports=d?[]:null,this._pseudoMeters=b,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),i=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let s=i;s<=n;s++){const r=s?new ho({...this,worldOffset:s}):this;this._subViewports.push(r)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[i,n]=this.projectFlat(e),s=(e[2]||0)*hu(e[1]);return[i,n,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[i,n]=this.unprojectFlat(e),s=(e[2]||0)/hu(n);return[i,n,s]}addMetersToLngLat(e,i){return I1(e,i)}panByPosition(e,i){const n=gl(i,this.pixelUnprojectionMatrix),s=this.projectFlat(e),r=_c([],s,l1([],n)),o=_c([],this.center,r),[a,c]=this.unprojectFlat(o);return{longitude:a,latitude:c}}getBounds(e={}){const i=Nx(this,e.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(e,i={}){const{width:n,height:s}=this,{longitude:r,latitude:o,zoom:a}=Ix({width:n,height:s,bounds:e,...i});return new ho({width:n,height:s,longitude:r,latitude:o,zoom:a})}};ho.displayName="WebMercatorViewport";let _r=ho;const Jg=[0,0,0];function du(t,e,i=!1){const n=e.projectPosition(t);if(i&&e instanceof _r){const[s,r,o=0]=t,a=e.getDistanceScales([s,r]);n[2]=o*a.unitsPerMeter[2]}return n}function mP(t){const{viewport:e,modelMatrix:i,coordinateOrigin:n}=t;let{coordinateSystem:s,fromCoordinateSystem:r,fromCoordinateOrigin:o}=t;return s===ge.DEFAULT&&(s=e.isGeospatial?ge.LNGLAT:ge.CARTESIAN),r===void 0&&(r=s),o===void 0&&(o=n),{viewport:e,coordinateSystem:s,coordinateOrigin:n,modelMatrix:i,fromCoordinateSystem:r,fromCoordinateOrigin:o}}function F1(t,{viewport:e,modelMatrix:i,coordinateSystem:n,coordinateOrigin:s,offsetMode:r}){let[o,a,c=0]=t;switch(i&&([o,a,c]=wr([],[o,a,c,1],i)),n){case ge.LNGLAT:return du([o,a,c],e,r);case ge.LNGLAT_OFFSETS:return du([o+s[0],a+s[1],c+(s[2]||0)],e,r);case ge.METER_OFFSETS:return du(I1(s,[o,a,c]),e,r);case ge.CARTESIAN:default:return e.isGeospatial?[o+s[0],a+s[1],c+s[2]]:e.projectPosition([o,a,c])}}function yP(t,e){const{viewport:i,coordinateSystem:n,coordinateOrigin:s,modelMatrix:r,fromCoordinateSystem:o,fromCoordinateOrigin:a}=mP(e),{autoOffset:c=!0}=e,{geospatialOrigin:l=Jg,shaderCoordinateOrigin:u=Jg,offsetMode:h=!1}=c?P1(i,n,s):{},f=F1(t,{viewport:i,modelMatrix:r,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});if(h){const d=i.projectPosition(l||u);m1(f,f,d)}return f}let vP=1,bP=1;class L1{constructor(){y(this,"time",0);y(this,"channels",new Map);y(this,"animations",new Map);y(this,"playing",!1);y(this,"lastEngineTime",-1)}addChannel(e){const{delay:i=0,duration:n=Number.POSITIVE_INFINITY,rate:s=1,repeat:r=1}=e,o=vP++,a={time:0,delay:i,duration:n,rate:s,repeat:r};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[i,n]of this.animations)n.channel===e&&this.detachAnimation(i)}isFinished(e){const i=this.channels.get(e);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(e){if(e===void 0)return this.time;const i=this.channels.get(e);return i===void 0?-1:i.time}setTime(e){this.time=Math.max(0,e);const i=this.channels.values();for(const s of i)this._setChannelTime(s,this.time);const n=this.animations.values();for(const s of n){const{animation:r,channel:o}=s;r.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,i){const n=bP++;return this.animations.set(n,{animation:e,channel:i}),e.setTime(this.getTime(i)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,i){const n=i-e.delay,s=e.duration*e.repeat;n>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}let wP=0;const TP={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Xn.stats.get(`animation-loop-${wP++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class EP{constructor(e){y(this,"device",null);y(this,"canvas",null);y(this,"props");y(this,"animationProps",null);y(this,"timeline",null);y(this,"stats");y(this,"cpuTime");y(this,"gpuTime");y(this,"frameRate");y(this,"display");y(this,"needsRedraw","initialized");y(this,"_initialized",!1);y(this,"_running",!1);y(this,"_animationFrameId",null);y(this,"_nextFramePromise",null);y(this,"_resolveNextFrame",null);y(this,"_cpuStartTime",0);if(this.props={...TP,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:i=!0}=this.props;this.stats=e.stats||new Do({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:i}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const i=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(i),i}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=V3(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(j3(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,i;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(i=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:i.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:i,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=i,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(i);const n=this.props.onAddHTML(i);n&&(i.innerHTML=n)}}_getSizeAndAspect(){var r,o,a,c;if(!this.device)return{width:1,height:1,aspect:1};const[e,i]=((o=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let n=1;const s=(c=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:c.canvas;return s&&s.clientHeight?n=s.clientWidth/s.clientHeight:e>0&&i>0&&(n=e/i),{width:e,height:i,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,i;this.props.autoResizeDrawingBuffer&&((i=(e=this.device)==null?void 0:e.canvasContext)==null||i.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class Qg{constructor(e){y(this,"id");y(this,"userData",{});y(this,"topology");y(this,"bufferLayout",[]);y(this,"vertexCount");y(this,"indices");y(this,"attributes");this.id=e.id||fs("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&ze(this.indices.usage===qe.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const i of Object.values(this.attributes))i.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function SP(t,e){if(e instanceof Qg)return e;const i=AP(t,e),{attributes:n,bufferLayout:s}=RP(t,e);return new Qg({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:i,attributes:n})}function AP(t,e){if(!e.indices)return;const i=e.indices.value;return t.createBuffer({usage:qe.INDEX,data:i})}function RP(t,e){const i=[],n={};for(const[r,o]of Object.entries(e.attributes)){let a=r;switch(r){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}n[a]=t.createBuffer({data:o.value,id:`${r}-buffer`});const{value:c,size:l,normalized:u}=o;i.push({name:a,format:F3(c,l,u)})}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:i,vertexCount:s}}class CP{constructor(e){y(this,"modules");y(this,"moduleUniforms");y(this,"moduleBindings");y(this,"moduleUniformsChanged");const i=dl(Object.values(e));Y.log(1,"Creating ShaderInputs with modules",i.map(n=>n.name))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[n,s]of Object.entries(e)){const r=n;this.moduleUniforms[r]=s.defaultUniforms||{},this.moduleBindings[r]={}}}destroy(){}setProps(e){var i;for(const n of Object.keys(e)){const s=n,r=e[s],o=this.modules[s];if(!o){Y.warn(`Module ${n} not found`)();continue}const a=this.moduleUniforms[s],c=((i=o.getUniforms)==null?void 0:i.call(o,r,this.moduleUniforms[s]))||r;this.moduleUniforms[s]={...a,...c}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const i of Object.values(this.moduleBindings))Object.assign(e,i);return e}getDebugTable(){var i;const e={};for(const[n,s]of Object.entries(this.moduleUniforms))for(const[r,o]of Object.entries(s))e[`${n}.${r}`]={type:(i=this.modules[n].uniformTypes)==null?void 0:i[r],value:String(o)};return e}}const Xc=class Xc{constructor(e){y(this,"device");y(this,"_hashCounter",0);y(this,"_hashes",{});y(this,"_renderPipelineCache",{});y(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Xc(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const i={...ur.defaultProps,...e},n=this._hashRenderPipeline(i);if(!this._renderPipelineCache[n]){const s=this.device.createRenderPipeline({...i,id:i.id?`${i.id}-cached`:void 0});s.hash=n,this._renderPipelineCache[n]={pipeline:s,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const i={...gc.defaultProps,...e},n=this._hashComputePipeline(i);if(!this._computePipelineCache[n]){const s=this.device.createComputePipeline({...i,id:i.id?`${i.id}-cached`:void 0});s.hash=n,this._computePipelineCache[n]={pipeline:s,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const i=e.hash,n=e instanceof gc?this._computePipelineCache:this._renderPipelineCache;n[i].useCount--,n[i].useCount===0&&(n[i].pipeline.destroy(),delete n[i])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const i=this._getHash(e.vs.source),n=e.fs?this._getHash(e.fs.source):0,s="-",r=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${i}/${n}V${s}BL${r}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${i}/${n}V${s}T${e.topology}P${o}BL${r}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};y(Xc,"defaultProps",{...ur.defaultProps});let Hh=Xc;const qc=class qc{constructor(e){y(this,"device");y(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var i;return(i=e._lumaData).defaultShaderFactory||(i.defaultShaderFactory=new qc(e)),e._lumaData.defaultShaderFactory}createShader(e){const i=this._hashShader(e);let n=this._cache[i];if(!n){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[i]=n={shader:s,useCount:0}}return n.useCount++,n.shader}release(e){const i=this._hashShader(e),n=this._cache[i];n&&(n.useCount--,n.useCount===0&&(delete this._cache[i],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};y(qc,"defaultProps",{...fc.defaultProps});let Wh=qc;function xP(t,e){var s;const i={},n="Values";if(t.attributes.length===0&&!((s=t.varyings)!=null&&s.length))return{"No attributes or varyings":{[n]:"N/A"}};for(const r of t.attributes)if(r){const o=`${r.location} ${r.name}: ${r.type}`;i[`in ${o}`]={[n]:r.stepMode||"vertex"}}for(const r of t.varyings||[]){const o=`${r.location} ${r.name}`;i[`out ${o}`]={[n]:JSON.stringify(r.accessor)}}return i}let ft=null,pu=null;function PP(t,{id:e,minimap:i,opaque:n,top:s="0",left:r="0",rgbaScale:o=1}){ft||(ft=document.createElement("canvas"),ft.id=e,ft.title=e,ft.style.zIndex="100",ft.style.position="absolute",ft.style.top=s,ft.style.left=r,ft.style.border="blue 1px solid",ft.style.transform="scaleY(-1)",document.body.appendChild(ft),pu=ft.getContext("2d")),(ft.width!==t.width||ft.height!==t.height)&&(ft.width=t.width/2,ft.height=t.height/2,ft.style.width="400px",ft.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),c=pu.createImageData(t.width,t.height),l=0;for(let u=0;u<a.length;u+=4)c.data[l+u+0]=a[u+0]*o,c.data[l+u+1]=a[u+1]*o,c.data[l+u+2]=a[u+2]*o,c.data[l+u+3]=n?255:a[u+3]*o;pu.putImageData(c,0,0)}const Rs=2,MP=1e4,Yc=class Yc{constructor(e,i){y(this,"device");y(this,"id");y(this,"source");y(this,"vs");y(this,"fs");y(this,"pipelineFactory");y(this,"shaderFactory");y(this,"userData",{});y(this,"parameters");y(this,"topology");y(this,"bufferLayout");y(this,"isInstanced");y(this,"instanceCount",0);y(this,"vertexCount");y(this,"indexBuffer",null);y(this,"bufferAttributes",{});y(this,"constantAttributes",{});y(this,"bindings",{});y(this,"uniforms",{});y(this,"vertexArray");y(this,"transformFeedback",null);y(this,"pipeline");y(this,"shaderInputs");y(this,"_uniformStore");y(this,"_attributeInfos",{});y(this,"_gpuGeometry",null);y(this,"_getModuleUniforms");y(this,"props");y(this,"_pipelineNeedsUpdate","newly created");y(this,"_needsRedraw","initializing");y(this,"_destroyed",!1);y(this,"_lastDrawTimestamp",-1);y(this,"_lastLogTime",0);y(this,"_logOpen",!1);y(this,"_drawCount",0);var a,c,l,u;this.props={...Yc.defaultProps,...i},i=this.props,this.id=i.id||fs("model"),this.device=e,Object.assign(this.userData,i.userData);const n=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(h=>[h.name,h]))||[]);this.setShaderInputs(i.shaderInputs||new CP(n));const s=IP(e),r=(((c=this.props.modules)==null?void 0:c.length)>0?this.props.modules:(l=this.shaderInputs)==null?void 0:l.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(u=this.props).shaderLayout||(u.shaderLayout=ER(this.props.source));const{source:h,getUniforms:f}=this.props.shaderAssembler.assembleShader({platformInfo:s,...this.props,modules:r});this.source=h,this._getModuleUniforms=f}else{const{vs:h,fs:f,getUniforms:d}=this.props.shaderAssembler.assembleShaderPair({platformInfo:s,...this.props,modules:r});this.vs=h,this.fs=f,this._getModuleUniforms=d}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,i.geometry&&this.setGeometry(i.geometry),this.pipelineFactory=i.pipelineFactory||Hh.getDefaultPipelineFactory(this.device),this.shaderFactory=i.shaderFactory||Wh.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in i&&(this.isInstanced=i.isInstanced),i.instanceCount&&this.setInstanceCount(i.instanceCount),i.vertexCount&&this.setVertexCount(i.vertexCount),i.indexBuffer&&this.setIndexBuffer(i.indexBuffer),i.attributes&&this.setAttributes(i.attributes),i.constantAttributes&&this.setConstantAttributes(i.constantAttributes),i.bindings&&this.setBindings(i.bindings),i.uniforms&&this.setUniforms(i.uniforms),i.moduleSettings&&this.updateModuleSettings(i.moduleSettings),i.transformFeedback&&(this.transformFeedback=i.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let i;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),uc(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:n}=this.vertexArray,s=n?n.byteLength/(n.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){var n;(n=this._gpuGeometry)==null||n.destroy();const i=e&&SP(this.device,e);i&&(this.setTopology(i.topology||"triangle-list"),this.bufferLayout=e_(i.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(i)),this._gpuGeometry=i}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?e_(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Fh(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new D3(this.shaderInputs.modules);for(const i of Object.keys(this.shaderInputs.modules)){const n=this._uniformStore.getManagedUniformBuffer(this.device,i);this.bindings[`${i}Uniforms`]=n}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,i){e.indices&&Y.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[n,s]of Object.entries(e)){const r=this.bufferLayout.find(c=>t_(c).includes(n));if(!r){Y.warn(`Model(${this.id}): Missing layout for buffer "${n}".`)();continue}const o=t_(r);let a=!1;for(const c of o){const l=this._attributeInfos[c];l&&(this.vertexArray.setBuffer(l.location,s),a=!0)}!a&&!((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)&&Y.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${n}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,i){for(const[n,s]of Object.entries(e)){const r=this._attributeInfos[n];r?this.vertexArray.setConstantWebGL(r.location,s):((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)||Y.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){uc(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:i,uniforms:n}=Qy(this._getModuleUniforms(e));Object.assign(this.bindings,i),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const i of Object.values(this.bindings))i instanceof hc?e=Math.max(e,i.texture.updateTimestamp):i instanceof qe||i instanceof Xt?e=Math.max(e,i.updateTimestamp):i instanceof dc||(e=Math.max(e,i.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const i={...e.attributes};for(const[n]of Object.entries(i))!this.pipeline.shaderLayout.attributes.find(s=>s.name===n)&&n!=="positions"&&delete i[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(i,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,i=null;this.pipeline&&(Y.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,i=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let s=null;this.source?s=n:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:n,fs:s}),this._attributeInfos=Ky(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),i&&this.shaderFactory.release(i)}return this.pipeline}_logDrawCallStart(){const e=Y.level>3?0:MP;Y.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Y.group(Rs,`>>> DRAWING MODEL ${this.id}`,{collapsed:Y.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=xP(this.pipeline.shaderLayout,this.id);Y.table(Rs,e)();const i=this.shaderInputs.getDebugTable();for(const[s,r]of Object.entries(this.uniforms))i[s]={value:r};Y.table(Rs,i)();const n=this._getAttributeDebugTable();Y.table(Rs,this._attributeInfos)(),Y.table(Rs,n)(),Y.groupEnd(Rs)(),this._logOpen=!1}}_logFramebuffer(e){const i=Y.get("framebuffer");if(this._drawCount++,!i||this._drawCount++>3&&this._drawCount%60)return;const n=e.props.framebuffer;n&&PP(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[i,n]of Object.entries(this._attributeInfos))e[n.location]={name:i,type:n.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[n.location],n.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:i}=this.vertexArray,n=i.indexType==="uint32"?new Uint32Array(i.debugData):new Uint16Array(i.debugData);e.indices={name:"indices",type:i.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,i){const n=Jy(i);return(e instanceof qe?new n(e.debugData):e).toString()}};y(Yc,"defaultProps",{...ur.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:lc.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Yt=Yc;function e_(t,e){const i=[...t];for(const n of e){const s=i.findIndex(r=>r.name===n.name);s<0?i.push(n):i[s]=n}return i}function IP(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function t_(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(i=>i.attribute):[t.name]}class _l{constructor(e,i=Yt.defaultProps){y(this,"device");y(this,"model");y(this,"transformFeedback");ze(_l.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new Yt(this.device,{id:i.id||"buffer-transform-model",fs:i.fs||L2(),topology:i.topology||"point-list",...i}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:i.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var i;return((i=e==null?void 0:e.info)==null?void 0:i.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const i=this.device.beginRenderPass(e);this.model.draw(i),i.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const i=this.getBuffer(e);if(i instanceof qe)return i.readAsync();const{buffer:n,byteOffset:s=0,byteLength:r=n.byteLength}=i;return n.readAsync(s,r)}}class mr{constructor(e){y(this,"id");y(this,"topology");y(this,"vertexCount");y(this,"indices");y(this,"attributes");y(this,"userData",{});const{attributes:i={},indices:n=null,vertexCount:s=null}=e;this.id=e.id||fs("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[r,o]of Object.entries(i)){const a=ArrayBuffer.isView(o)?{value:o}:o;ze(ArrayBuffer.isView(a.value),`${this._print(r)}: must be typed array or object with value as typed array`),(r==="POSITION"||r==="positions")&&!a.size&&(a.size=3),r==="indices"?(ze(!this.indices),this.indices=a):this.attributes[r]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,i){return this}_calculateVertexCount(e,i){if(i)return i.value.length;let n=1/0;for(const s of Object.values(e)){const{value:r,size:o,constant:a}=s;!a&&r&&o>=1&&(n=Math.min(n,r.length/o))}return ze(Number.isFinite(n)),n}}const OP={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class B1 extends cd{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:i,views:n,viewports:s,onViewportActive:r,pickingFBO:o,deviceRect:{x:a,y:c,width:l,height:u},cullRect:h,effects:f,pass:d="picking",pickZ:p,moduleParameters:g}){this.pickZ=p;const _=this._resetColorEncoder(p),b=[a,c,l,u],T=super.render({target:o,layers:e,layerFilter:i,views:n,viewports:s,onViewportActive:r,cullRect:h,effects:f==null?void 0:f.filter(E=>E.useInPicking),pass:d,isPicking:!0,moduleParameters:g,clearColor:[0,0,0,0],colorMask:15,scissorRect:b});return this._colorEncoderState=null,{decodePickingColor:_&&kP.bind(null,_),stats:T}}shouldDrawLayer(e){const{pickable:i,operation:n}=e.props;return i&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,i,n){const s={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:r,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?s.blend=!1:r&&o.includes("draw")&&(Object.assign(s,OP),s.blend=!0,s.blendColor=NP(this._colorEncoderState,e,n)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function NP(t,e,i){const{byLayer:n,byAlpha:s}=t;let r,o=n.get(e);return o?(o.viewports.push(i),r=o.a):(r=n.size+1,r<=255?(o={a:r,layer:e,viewports:[i]},n.set(e,o),s[r]=o):(fe.warn("Too many pickable layers, only picking the first 255")(),r=0)),[0,0,0,r/255]}function kP(t,e){const i=t.byAlpha[e[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(e)}}const Ns={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},bc=Symbol.for("component"),hn=Symbol.for("propTypes"),gu=Symbol.for("deprecatedProps"),Js=Symbol.for("asyncPropDefaults"),as=Symbol.for("asyncPropOriginal"),an=Symbol.for("asyncPropResolved");function ml(t,e=()=>!0){return Array.isArray(t)?U1(t,e,[]):e(t)?[t]:[]}function U1(t,e,i){let n=-1;for(;++n<t.length;){const s=t[n];Array.isArray(s)?U1(s,e,i):e(s)&&i.push(s)}return i}function DP({target:t,source:e,start:i=0,count:n=1}){const s=e.length,r=n*s;let o=0;for(let a=i;o<s;o++)t[a++]=e[o];for(;o<r;)o<r-o?(t.copyWithin(i+o,i,i+o),o*=2):(t.copyWithin(i+o,i,i+r-o),o=r);return t}class FP{constructor(e,i,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(i)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,i){if(e===this._data&&!i)return;this._data=e;const n=++this._loadCount;let s=e;typeof e=="string"&&(s=Hn(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(r=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=r)}).catch(r=>{this._loadCount===n&&(this.isLoaded=!0,this._error=r||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const r of this._subscribers)r.onChange(this.getData())}}class LP{constructor(e){var i;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(i=e.device)==null?void 0:i.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:i,forceUpdate:n=!1,persistent:s=!0}){let r=this._resources[e];r?r.setData(i,n):(r=new FP(e,i,this._context),this._resources[e]=r),r.persistent=s}remove(e){const i=this._resources[e];i&&(i.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const i=this._consumers[e];if(i){for(const n in i){const s=i[n],r=this._resources[s.resourceId];r&&r.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:i,consumerId:n,requestId:s="default"}){const{_resources:r,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),r[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=r[e];if(this._track(n,s,a,i),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,i,n,s){const r=this._consumers,o=r[e]=r[e]||{};let a=o[i];const c=a&&a.resourceId&&this._resources[a.resourceId];c&&(c.unsubscribe(a),this.prune()),n&&(a?(a.onChange=s,a.resourceId=n.id):a={onChange:s,resourceId:n.id},o[i]=a,n.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const i=this._resources[e];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[e])}}}const BP="layerManager.setLayers",UP="layerManager.activateViewport";class zP{constructor(e,i){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Tt(UP,this,a),a&&(this.context.viewport=a)};const{deck:n,stats:s,viewport:r,timeline:o}=i||{};this.layers=[],this.resourceManager=new LP({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:n,shaderAssembler:qx(),defaultShaderModules:[],renderPass:void 0,stats:s||new Do({id:"deck.gl"}),viewport:r||new gr({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new L1,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const s=n.getNeedsRedraw(e);i=i||s}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(i=>e.find(n=>i.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,i){Tt(BP,this,i,e),this._lastRenderedLayers=e;const n=ml(e,Boolean);for(const s of n)s.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:i}=this.context;i.find(n=>n.name===e.name)||(i.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:i}=this.context,n=i.findIndex(s=>s.name===e.name);n>=0&&(i.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,i,n){n.raiseError(i,`${e} of ${n}`)}_updateLayers(e,i){const n={};for(const o of e)n[o.id]?fe.warn(`Multiple old layers with same id ${o.id}`)():n[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(i,n,s),this._finalizeOldLayers(n);let r=!1;for(const o of s)if(o.hasUniformTransition()){r=`Uniform transition in ${o}`;break}this._needsUpdate=r,this.layers=s}_updateSublayersRecursively(e,i,n){for(const s of e){s.context=this.context;const r=i[s.id];r===null&&fe.warn(`Multiple new layers with same id ${s.id}`)(),i[s.id]=null;let o=null;try{this._debug&&r!==s&&s.validateProps(),r?(this._transferLayerState(r,s),this._updateLayer(s)):this._initializeLayer(s),n.push(s),o=s.isComposite?s.getSubLayers():null}catch(a){this._handleError("matching",a,s)}o&&this._updateSublayersRecursively(o,i,n)}}_finalizeOldLayers(e){for(const i in e){const n=e[i];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Ns.INITIALIZED}catch(i){this._handleError("initialization",i,e)}}_transferLayerState(e,i){i._transferState(e),i.lifecycle=Ns.MATCHED,i!==e&&(e.lifecycle=Ns.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(i){this._handleError("update",i,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Ns.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Ns.FINALIZED}catch(i){this._handleError("finalization",i,e)}}}function li(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!li(t[n],e[n],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!li(t[r],e[r],i-1))return!1;return!0}return!1}class VP{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const i=this.controllers[e];i&&i.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const i=this.controllers[e];i&&i.updateTransition()}}getViewports(e){return e?this._viewports.filter(i=>i.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(i=>{e[i.id]=i}),e}getView(e){return this.views.find(i=>i.id===e)}getViewState(e){const i=typeof e=="string"?this.getView(e):e,n=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,i){const n=this.getViewports(),s={x:e[0],y:e[1]};for(let r=n.length-1;r>=0;--r){const o=n[r];if(o.containsPixel(s)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,i)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,i){(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(e){e=ml(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!li(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):fe.warn("missing `viewState` or `initialViewState`")()}_createController(e,i){const n=i.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:r=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:r,width:this.width,height:this.height})}})}_updateController(e,i,n,s){const r=e.controller;if(r&&n){const o={...i,...r,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!s||s.constructor!==r.type)&&(s=this._createController(e,o)),s&&s.setProps(o),s}return null}_rebuildViewports(){const{views:e}=this,i=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let s=e.length;s--;){const r=e[s],o=this.getViewState(r),a=r.makeViewport({viewState:o,width:this.width,height:this.height});let c=i[r.id];const l=!!r.controller;l&&!c&&(n=!0),(n||!l)&&c&&(c.finalize(),c=null),this.controllers[r.id]=this._updateController(r,o,a,c),a&&this._viewports.unshift(a)}for(const s in i){const r=i[s];r&&!this.controllers[s]&&r.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,i){return e.length!==i.length?!0:e.some((n,s)=>!e[s].equals(i[s]))}}const jP=/([0-9]+\.?[0-9]*)(%|px)/;function Yi(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=jP.exec(t);if(e&&e.length>=3){const i=e[2]==="%",n=parseFloat(e[1]);return{position:i?n/100:n,relative:i}}default:throw new Error(`Could not parse position string ${t}`)}}function Ki(t,e){return t.relative?Math.round(t.position*e):t.position}class z1{constructor(e){const{id:i,x:n=0,y:s=0,width:r="100%",height:o="100%",padding:a=null}=e;this.id=i||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Yi(n),this._y=Yi(s),this._width=Yi(r),this._height=Yi(o),this._padding=a&&{left:Yi(a.left||0),right:Yi(a.right||0),top:Yi(a.top||0),bottom:Yi(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&li(this.props,e.props,2)}makeViewport({width:e,height:i,viewState:n}){n=this.filterViewState(n);const s=this.getDimensions({width:e,height:i});return!s.height||!s.width?null:new this.ViewportType({...n,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...e};for(const n in this.props.viewState)n!=="id"&&(i[n]=this.props.viewState[n]);return i}return e}getDimensions({width:e,height:i}){const n={x:Ki(this._x,e),y:Ki(this._y,i),width:Ki(this._width,e),height:Ki(this._height,i)};return this._padding&&(n.padding={left:Ki(this._padding.left,e),top:Ki(this._padding.top,i),right:Ki(this._padding.right,e),bottom:Ki(this._padding.bottom,i)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class yl{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var i,n;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)==null||n.call(i,this)}end(){var e,i;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(i=(e=this.settings).onEnd)==null||i.call(e,this))}cancel(){var e,i;this._inProgress&&((i=(e=this.settings).onInterrupt)==null||i.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:s}=this;this._handle=n.addChannel({delay:n.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(i=(e=this.settings).onUpdate)==null||i.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const i_=()=>{},Xh={BREAK:1,SNAP_TO_END:2,IGNORE:3},$P=t=>t,HP=Xh.BREAK;class WP{constructor(e){this._onTransitionUpdate=i=>{const{time:n,settings:{interpolator:s,startProps:r,endProps:o,duration:a,easing:c}}=i,l=c(n/a),u=s.interpolateProps(r,o,l);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new yl(e.timeline),this.onViewStateChange=e.onViewStateChange||i_,this.onStateChange=e.onStateChange||i_}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let i=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let s=n;if(this.transition.inProgress){const{interruption:r,endProps:o}=this.transition.settings;s={...n,...r===Xh.SNAP_TO_END?o:this.propsInTransition||n}}this._triggerTransition(s,e),i=!0}else this.transition.cancel();return i}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:i,transitionInterpolator:n}=e;return(i>0||i==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,i){return this.transition.inProgress?this.transition.settings.interruption===Xh.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(e,i):!0}_triggerTransition(e,i){const n=this.getControllerState(e),s=this.getControllerState(i).shortestPathFrom(n),r=i.transitionInterpolator,o=r.getDuration?r.getDuration(e,i):i.transitionDuration;if(o===0)return;const a=r.initializeProps(e,s);this.propsInTransition={};const c={duration:o,easing:i.transitionEasing||$P,interpolator:r,interruption:i.transitionInterruption||HP,startProps:a.start,endProps:a.end,onStart:i.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(i.onTransitionInterrupt),onEnd:this._onTransitionEnd(i.onTransitionEnd)};this.transition.start(c),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return i=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(i)}}}function _t(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class XP{constructor(e){const{compare:i,extract:n,required:s}=e;this._propsToCompare=i,this._propsToExtract=n||i,this._requiredProps=s}arePropsEqual(e,i){for(const n of this._propsToCompare)if(!(n in e)||!(n in i)||!zi(e[n],i[n]))return!1;return!0}initializeProps(e,i){const n={},s={};for(const r of this._propsToExtract)(r in e||r in i)&&(n[r]=e[r],s[r]=i[r]);return this._checkRequiredProps(n),this._checkRequiredProps(s),{start:n,end:s}}getDuration(e,i){return i.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(i=>{const n=e[i];_t(Number.isFinite(n)||Array.isArray(n),`${i} is required for transition`)})}}const qP=["longitude","latitude","zoom","bearing","pitch"],YP=["longitude","latitude","zoom"];class Ro extends XP{constructor(e={}){const i=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(i)?{compare:i,required:i}:i||{compare:qP,required:YP},super(n.transitionProps),this.opts=n}initializeProps(e,i){const n=super.initializeProps(e,i),{makeViewport:s,around:r}=this.opts;if(s&&r){const o=s(e),a=s(i),c=o.unproject(r);n.start.around=r,Object.assign(n.end,{around:a.project(c),aroundPosition:c,width:i.width,height:i.height})}return n}interpolateProps(e,i,n){const s={};for(const r of this._propsToExtract)s[r]=qn(e[r]||0,i[r]||0,n);if(i.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...i,...s});Object.assign(s,r.panByPosition(i.aroundPosition,qn(e.around,i.around,n)))}return s}}const Zi={transitionDuration:0},KP=300,ga=t=>1-(1-t)*(1-t),Cs={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Cn={};class V1{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new WP({...e,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const i in this._events)this._events[i]&&((e=this.eventManager)==null||e.off(i,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return i?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:i,y:n}=this.props,{offsetCenter:s}=e;return[s.x-i,s.y-n]}isPointInBounds(e,i){const{width:n,height:s}=this.props;if(i&&i.handled)return!1;const r=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=s;return r&&i&&i.stopPropagation(),r}isFunctionKeyPressed(e){const{srcEvent:i}=e;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=i}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:i}=e;this.inertia=Number.isFinite(i)?i:i===!0?KP:0;const{scrollZoom:n=!0,dragPan:s=!0,dragRotate:r=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:c=!1,keyboard:l=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(Cs.WHEEL,u&&n),this.toggleEvents(Cs.PAN,u),this.toggleEvents(Cs.PINCH,u&&(a||c)),this.toggleEvents(Cs.TRIPLE_PAN,u&&c),this.toggleEvents(Cs.DOUBLE_TAP,u&&o),this.toggleEvents(Cs.KEYBOARD,u&&l),this.scrollZoom=n,this.dragPan=s,this.dragRotate=r,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=c,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,i){this.eventManager&&e.forEach(n=>{this._events[n]!==i&&(this._events[n]=i,i?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,i=null,n={}){const s={...e.getViewportProps(),...i},r=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),r){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const s=this.controllerState[n?"panStart":"rotateStart"]({pos:i});return this._panMove=n,this.updateViewport(s,Zi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const i=this.getCenter(e),n=this.controllerState.pan({pos:i});return this.updateViewport(n,Zi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:i}=this;if(this.dragPan&&i&&e.velocity){const n=this.getCenter(e),s=[n[0]+e.velocityX*i/2,n[1]+e.velocityY*i/2],r=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:ga},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const i=this.getCenter(e),n=this.controllerState.rotate({pos:i});return this.updateViewport(n,Zi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:i}=this;if(this.dragRotate&&i&&e.velocity){const n=this.getCenter(e),s=[n[0]+e.velocityX*i/2,n[1]+e.velocityY*i/2],r=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:ga},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:r}=e;let o=2/(1+Math.exp(-Math.abs(r*n)));r<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:i,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:i}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.controllerState.rotateStart({pos:i});return this.updateViewport(n,Zi,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(e);i[0]-=e.deltaX;const n=this.controllerState.rotate({pos:i});return this.updateViewport(n,Zi,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&e.velocityY){const n=this.getCenter(e),s=[n[0],n[1]+=e.velocityY*i/2],r=this.controllerState.rotate({pos:s});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:ga},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return Cn._startPinchRotation=e.rotation,Cn._lastPinchEvent=e,this.updateViewport(n,Zi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:n}=e,s=this.getCenter(e);i=i.zoom({pos:s,scale:n})}if(this.touchRotate){const{rotation:n}=e;i=i.rotate({deltaAngleX:Cn._startPinchRotation-n})}return this.updateViewport(i,Zi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Cn._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:n}=Cn;if(this.touchZoom&&i&&n&&e.scale!==n.scale){const s=this.getCenter(e);let r=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),c=Math.pow(2,o+a*i/2);r=r.zoom({pos:s,scale:c}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:s}),transitionDuration:i,transitionEasing:ga},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Cn._startPinchRotation=null,Cn._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:i,scale:n?.5:2});return this.updateViewport(s,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:s,rotateSpeedX:r,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let c;const l={};switch(e.srcEvent.code){case"Minus":c=i?a.zoomOut(n).zoomOut(n):a.zoomOut(n),l.isZooming=!0;break;case"Equal":c=i?a.zoomIn(n).zoomIn(n):a.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":i?(c=a.rotateLeft(r),l.isRotating=!0):(c=a.moveLeft(s),l.isPanning=!0);break;case"ArrowRight":i?(c=a.rotateRight(r),l.isRotating=!0):(c=a.moveRight(s),l.isPanning=!0);break;case"ArrowUp":i?(c=a.rotateUp(o),l.isRotating=!0):(c=a.moveUp(s),l.isPanning=!0);break;case"ArrowDown":i?(c=a.rotateDown(o),l.isRotating=!0):(c=a.moveDown(s),l.isPanning=!0);break;default:return!1}return this.updateViewport(c,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:i}=this;return!i||!i.transitionInterpolator?Zi:e?{...i,transitionInterpolator:new Ro({...e,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class j1{constructor(e,i){this._viewportProps=this.applyConstraints(e),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const n_=5,ZP=1.2;class GP extends j1{constructor(e){const{width:i,height:n,latitude:s,longitude:r,zoom:o,bearing:a=0,pitch:c=0,altitude:l=1.5,position:u=[0,0,0],maxZoom:h=20,minZoom:f=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:g,startZoomLngLat:_,startRotatePos:b,startBearing:T,startPitch:v,startZoom:E,normalize:R=!0}=e;_t(Number.isFinite(r)),_t(Number.isFinite(s)),_t(Number.isFinite(o)),super({width:i,height:n,latitude:s,longitude:r,zoom:o,bearing:a,pitch:c,altitude:l,maxZoom:h,minZoom:f,maxPitch:d,minPitch:p,normalize:R,position:u},{startPanLngLat:g,startZoomLngLat:_,startRotatePos:b,startBearing:T,startPitch:v,startZoom:E}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:i}){const n=this.getState().startPanLngLat||this._unproject(i);if(!n)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:n=0}){const{startRotatePos:s,startBearing:r,startPitch:o}=this.getState();if(!s||r===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,s,o,r):a={bearing:r+i,pitch:o+n},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:n}){let{startZoom:s,startZoomLngLat:r}=this.getState();if(r||(s=this.getViewportProps().zoom,r=this._unproject(i)||this._unproject(e)),!r)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let c=s+Math.log2(n);c=dt(c,a,o);const l=this.makeViewport({...this.getViewportProps(),zoom:c});return this._getUpdatedState({zoom:c,...l.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const i=e.getViewportProps(),n={...this.getViewportProps()},{bearing:s,longitude:r}=n;return Math.abs(s-i.bearing)>180&&(n.bearing=s<0?s+360:s-360),Math.abs(r-i.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}applyConstraints(e){const{maxZoom:i,minZoom:n,zoom:s}=e;e.zoom=dt(s,n,i);const{maxPitch:r,minPitch:o,pitch:a}=e;e.pitch=dt(a,o,r);const{normalize:c=!0}=e;return c&&Object.assign(e,kx(e)),e}_zoomFromCenter(e){const{width:i,height:n}=this.getViewportProps();return this.zoom({pos:[i/2,n/2],scale:e})}_panFromCenter(e){const{width:i,height:n}=this.getViewportProps();return this.pan({startPos:[i/2,n/2],pos:[i/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_getNewRotation(e,i,n,s){const r=e[0]-i[0],o=e[1]-i[1],a=e[1],c=i[1],{width:l,height:u}=this.getViewportProps(),h=r/l;let f=0;o>0?Math.abs(u-c)>n_&&(f=o/(c-u)*ZP):o<0&&c>n_&&(f=1-a/c),f=dt(f,-1,1);const{minPitch:d,maxPitch:p}=this.getViewportProps(),g=s+180*h;let _=n;return f>0?_=n+f*(p-n):f<0&&(_=n-f*(d-n)),{pitch:_,bearing:g}}}class JP extends V1{constructor(){super(...arguments),this.ControllerState=GP,this.transition={transitionDuration:300,transitionInterpolator:new Ro({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const i=this.props;super.setProps(e),(!i||i.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}const Nd=class Nd extends z1{constructor(e={}){super(e)}get ViewportType(){return _r}get ControllerType(){return JP}};Nd.displayName="MapView";let qh=Nd;const QP=new D1;function eM(t,e){const i=t.order??1/0,n=e.order??1/0;return i-n}class tM{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const i=this._defaultEffects;if(!i.find(n=>n.id===e.id)){const n=i.findIndex(s=>eM(s,e)>0);n<0?i.push(e):i.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(li(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(e){const i={};for(const s of this.effects)i[s.id]=s;const n=[];for(const s of e){const r=i[s.id];let o=s;r&&r!==s?r.setProps?(r.setProps(s.props),o=r):r.cleanup(this._context):r||s.setup(this._context),n.push(o),delete i[s.id]}for(const s in i)i[s].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(s=>s instanceof D1)||this._resolvedEffects.push(QP),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class iM extends cd{shouldDrawLayer(e){const{operation:i}=e.props;return i.includes("draw")||i.includes("terrain")}}const nM="deckRenderer.renderLayers";class sM{constructor(e){this.device=e,this.gl=e.gl,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new iM(e),this.pickLayersPass=new B1(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const s=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const r=i.render({...n,target:s});n.effects&&this._postRender(n.effects,n),this.renderCount++,Tt(nM,this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:e}=this;for(const i of e)i.delete();e.length=0}_preRender(e,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const n of e)i.preRenderStats[n.id]=n.preRender(i),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,i=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[s]}))});for(const n of e)n.resize(i)}_postRender(e,i){const{renderBuffers:n}=this,s={...i,inputBuffer:n[0],swapBuffer:n[1]};for(const r of e)if(r.postRender){s.target=r.id===this.lastPostProcessEffect?i.target:void 0;const o=r.postRender(s);s.inputBuffer=o,s.swapBuffer=o===n[0]?n[1]:n[0]}}}const rM={pickedColor:null,pickedObjectIndex:-1};function oM({pickedColors:t,decodePickingColor:e,deviceX:i,deviceY:n,deviceRadius:s,deviceRect:r}){const{x:o,y:a,width:c,height:l}=r;let u=s*s,h=-1,f=0;for(let d=0;d<l;d++){const p=d+a-n,g=p*p;if(g>u)f+=4*c;else for(let _=0;_<c;_++){if(t[f+3]-1>=0){const T=_+o-i,v=T*T+g;v<=u&&(u=v,h=f)}f+=4}}if(h>=0){const d=t.slice(h,h+4),p=e(d);if(p){const g=Math.floor(h/4/c),_=h/4-g*c;return{...p,pickedColor:d,pickedX:o+_,pickedY:a+g}}fe.error("Picked non-existent layer. Is picking buffer corrupt?")()}return rM}function aM({pickedColors:t,decodePickingColor:e}){const i=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const r=t.slice(n,n+4),o=r.join(",");if(!i.has(o)){const a=e(r);a?i.set(o,{...a,color:r}):fe.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function $1({pickInfo:t,viewports:e,pixelRatio:i,x:n,y:s,z:r}){let o=e[0];e.length>1&&(o=lM((t==null?void 0:t.pickedViewports)||e,{x:n,y:s}));let a;if(o){const c=[n-o.x,s-o.y];r!==void 0&&(c[2]=r),a=o.unproject(c)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:n,y:s,pixel:[n,s],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:i}}function cM(t){const{pickInfo:e,lastPickedInfo:i,mode:n,layers:s}=t,{pickedColor:r,pickedLayer:o,pickedObjectIndex:a}=e,c=o?[o]:[];if(n==="hover"){const h=i.index,f=i.layerId,d=o?o.props.id:null;if(d!==f||a!==h){if(d!==f){const p=s.find(g=>g.props.id===f);p&&c.unshift(p)}i.layerId=d,i.index=a,i.info=null}}const l=$1(t),u=new Map;return u.set(null,l),c.forEach(h=>{let f={...l};h===o&&(f.color=r,f.index=a,f.picked=!0),f=H1({layer:h,info:f,mode:n});const d=f.layer;h===o&&n==="hover"&&(i.info=f),u.set(d.id,f),n==="hover"&&d.updateAutoHighlight(f)}),u}function H1({layer:t,info:e,mode:i}){for(;t&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=t,e=t.getPickingInfo({info:e,mode:i,sourceLayer:n}),t=t.parent}return e}function lM(t,e){for(let i=t.length-1;i>=0;i--){const n=t[i];if(n.containsPixel(e))return n}return t[0]}class uM{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new B1(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:i,layers:n,viewports:s},r=this.lastPickedInfo.info){const o=r&&r.layer&&r.layer.id,a=r&&r.viewport&&r.viewport.id,c=o?n.find(f=>f.id===o):null,l=a&&s.find(f=>f.id===a)||s[0],u=l&&l.unproject([e-l.x,i-l.y]);return{...r,...{x:e,y:i,viewport:l,coordinate:u,layer:c}}}_resizeBuffer(){var i,n;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const e=this.device.gl;(i=this.pickingFBO)==null||i.resize({width:e.canvas.width,height:e.canvas.height}),(n=this.depthFBO)==null||n.resize({width:e.canvas.width,height:e.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const i=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return i.length?i:null}_pickClosestObject({layers:e,views:i,viewports:n,x:s,y:r,radius:o=0,depth:a=1,mode:c="query",unproject3D:l,onViewportActive:u,effects:h}){const f=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||n.length===0)return{result:[],emptyInfo:$1({viewports:n,x:s,y:r,pixelRatio:f})};this._resizeBuffer();const p=this.device.canvasContext.cssToDevicePixels([s,r],!0),g=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],_=Math.round(o*f),{width:b,height:T}=this.pickingFBO,v=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:_,deviceWidth:b,deviceHeight:T}),E={x:s-o,y:r-o,width:o*2+1,height:o*2+1};let R;const P=[],M=new Set;for(let U=0;U<a;U++){let O;if(v){const I=this._drawAndSample({layers:d,views:i,viewports:n,onViewportActive:u,deviceRect:v,cullRect:E,effects:h,pass:`picking:${c}`});O=oM({...I,deviceX:g[0],deviceY:g[1],deviceRadius:_,deviceRect:v})}else O={pickedColor:null,pickedObjectIndex:-1};let D;if(O.pickedLayer&&l&&this.depthFBO){const{pickedColors:I}=this._drawAndSample({layers:[O.pickedLayer],views:i,viewports:n,onViewportActive:u,deviceRect:{x:O.pickedX,y:O.pickedY,width:1,height:1},cullRect:E,effects:h,pass:`picking:${c}:z`},!0);I[3]&&(D=I[0])}O.pickedLayer&&U+1<a&&(M.add(O.pickedLayer),O.pickedLayer.disablePickingIndex(O.pickedObjectIndex)),R=cM({pickInfo:O,lastPickedInfo:this.lastPickedInfo,mode:c,layers:d,viewports:n,x:s,y:r,z:D,pixelRatio:f});for(const I of R.values())I.layer&&P.push(I);if(!O.pickedColor)break}for(const U of M)U.restorePickingColors();return{result:P,emptyInfo:R.get(null)}}_pickVisibleObjects({layers:e,views:i,viewports:n,x:s,y:r,width:o=1,height:a=1,mode:c="query",maxObjects:l=null,onViewportActive:u,effects:h}){const f=this._getPickable(e);if(!f||n.length===0)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),p=this.device.canvasContext.cssToDevicePixels([s,r],!0),g=p.x,_=p.y+p.height,b=this.device.canvasContext.cssToDevicePixels([s+o,r+a],!0),T=b.x+b.width,v=b.y,E={x:g,y:v,width:T-g,height:_-v},R=this._drawAndSample({layers:f,views:i,viewports:n,onViewportActive:u,deviceRect:E,cullRect:{x:s,y:r,width:o,height:a},effects:h,pass:`picking:${c}`}),P=aM(R),M=new Map,U=[],O=Number.isFinite(l);for(let D=0;D<P.length&&!(O&&U.length>=l);D++){const I=P[D];let V={color:I.pickedColor,layer:null,index:I.pickedObjectIndex,picked:!0,x:s,y:r,pixelRatio:d};V=H1({layer:I.pickedLayer,info:V,mode:c});const k=V.layer.id;M.has(k)||M.set(k,new Set);const B=M.get(k),F=V.object??V.index;B.has(F)||(B.add(F),U.push(V))}return U}_drawAndSample({layers:e,views:i,viewports:n,onViewportActive:s,deviceRect:r,cullRect:o,effects:a,pass:c},l=!1){const u=l?this.depthFBO:this.pickingFBO,h={layers:e,layerFilter:this.layerFilter,views:i,viewports:n,onViewportActive:s,pickingFBO:u,deviceRect:r,cullRect:o,effects:a,pass:c,pickZ:l,preRenderStats:{}};for(const T of a)T.useInPicking&&(h.preRenderStats[T.id]=T.preRender(h));const{decodePickingColor:f}=this.pickLayersPass.render(h),{x:d,y:p,width:g,height:_}=r,b=new(l?Float32Array:Uint8Array)(g*_*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:p,sourceWidth:g,sourceHeight:_,target:b}),{pickedColors:b,decodePickingColor:f}}_getPickingRect({deviceX:e,deviceY:i,deviceRadius:n,deviceWidth:s,deviceHeight:r}){const o=Math.max(0,e-n),a=Math.max(0,i-n),c=Math.min(s,e+n+1)-o,l=Math.min(r,i+n+1)-a;return c<=0||l<=0?null:{x:o,y:a,width:c,height:l}}}const hM={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},fM="top-left",s_="__root";class dM{constructor({deck:e,parentElement:i}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!li(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(i=>i.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const i={};for(const n of this.resolvedWidgets)i[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)i[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const s=i[n.id];s?s.viewId!==n.viewId||s.placement!==n.placement?(this._remove(s),this._add(n)):n!==s&&(s.setProps(n.props),n=s):this._add(n),i[n.id]=null,this.resolvedWidgets.push(n)}for(const n in i){const s=i[n];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:i=null,placement:n=fM}=e,s=e.onAdd({deck:this.deck,viewId:i});s&&this._getContainer(i,n).append(s),e._element=s}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,i){var o;const n=e||s_;let s=this.containers[n];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(o=this.parentElement)==null||o.append(s),this.containers[n]=s);let r=s.querySelector(`.${i}`);return r||(r=document.createElement("div"),r.className=i,r.style.position="absolute",Object.assign(r.style,hM[i]),s.append(r)),r}_updateContainers(){const e=this.deck.width,i=this.deck.height;for(const n in this.containers){const s=this.lastViewports[n]||null,r=n===s_||s,o=this.containers[n];r?(o.style.display="block",o.style.left=`${s?s.x:0}px`,o.style.top=`${s?s.y:0}px`,o.style.width=`${s?s.width:e}px`,o.style.height=`${s?s.height:i}px`):o.style.display="none"}}onRedraw({viewports:e,layers:i}){var r,o;const n=e.reduce((a,c)=>(a[c.id]=c,a),{}),{lastViewports:s}=this;for(const a of this.getWidgets()){const{viewId:c}=a;if(c){const l=n[c];l&&(a.onViewportChange&&!l.equals(s[c])&&a.onViewportChange(l),(r=a.onRedraw)==null||r.call(a,{viewports:[l],layers:i}))}else{if(a.onViewportChange)for(const l of e)l.equals(s[l.id])||a.onViewportChange(l);(o=a.onRedraw)==null||o.call(a,{viewports:e,layers:i})}}this.lastViewports=n,this._updateContainers()}onHover(e,i){var n,s;for(const r of this.getWidgets()){const{viewId:o}=r;(!o||o===((n=e.viewport)==null?void 0:n.id))&&((s=r.onHover)==null||s.call(r,e,i))}}onEvent(e,i){var s,r;const n=zh[i.type];if(n)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((s=e.viewport)==null?void 0:s.id))&&((r=o[n.handler])==null||r.call(o,e,i))}}}const pM={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class gM{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,pM),this.deck=e,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var i;this.isVisible&&e.id===((i=this.lastViewport)==null?void 0:i.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:i}=this,n=i&&i.props.getTooltip;if(!n)return;const s=n(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,i,n){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${i}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var Us;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Us||(Us={}));const ld={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},rt=(t,e,i)=>e?t.enable(i):t.disable(i),r_=(t,e,i)=>t.hint(i,e),Lt=(t,e,i)=>t.pixelStorei(i,e),o_=(t,e,i)=>{const n=i===36006?36009:36008;return t.bindFramebuffer(n,e)},Nr=(t,e,i)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];t.bindBuffer(s,e)};function _u(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const _M={3042:rt,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:rt,2885:(t,e)=>t.cullFace(e),2929:rt,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:rt,35723:r_,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var i;return(i=t.bindTransformFeedback)==null?void 0:i.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:o_,36010:o_,34964:Nr,36662:Nr,36663:Nr,35053:Nr,35055:Nr,2886:(t,e)=>t.frontFace(e),33170:r_,2849:(t,e)=>t.lineWidth(e),32823:rt,32824:"polygonOffset",10752:"polygonOffset",35977:rt,32926:rt,32928:rt,32938:"sampleCoverage",32939:"sampleCoverage",3089:rt,3088:(t,e)=>t.scissor(...e),2960:rt,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:rt,10754:rt,12288:rt,12289:rt,12290:rt,12291:rt,12292:rt,12293:rt,12294:rt,12295:rt,3333:Lt,3317:Lt,37440:Lt,37441:Lt,37443:Lt,3330:Lt,3332:Lt,3331:Lt,3314:Lt,32878:Lt,3316:Lt,3315:Lt,32877:Lt,framebuffer:(t,e)=>{const i=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,i)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const i=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...i)},blendFunc:(t,e)=>{const i=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...i)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=_u(e)?e:[e,e];const[i,n]=e;t.stencilMaskSeparate(1028,i),t.stencilMaskSeparate(1029,n)},stencilFunc:(t,e)=>{e=_u(e)&&e.length===3?[...e,...e]:e;const[i,n,s,r,o,a]=e;t.stencilFuncSeparate(1028,i,n,s),t.stencilFuncSeparate(1029,r,o,a)},stencilOp:(t,e)=>{e=_u(e)&&e.length===3?[...e,...e]:e;const[i,n,s,r,o,a]=e;t.stencilOpSeparate(1028,i,n,s),t.stencilOpSeparate(1029,r,o,a)},viewport:(t,e)=>t.viewport(...e)};function it(t,e,i){return e[t]!==void 0?e[t]:i[t]}const mM={blendEquation:(t,e,i)=>t.blendEquationSeparate(it(32777,e,i),it(34877,e,i)),blendFunc:(t,e,i)=>t.blendFuncSeparate(it(32969,e,i),it(32968,e,i),it(32971,e,i),it(32970,e,i)),polygonOffset:(t,e,i)=>t.polygonOffset(it(32824,e,i),it(10752,e,i)),sampleCoverage:(t,e,i)=>t.sampleCoverage(it(32938,e,i),it(32939,e,i)),stencilFuncFront:(t,e,i)=>t.stencilFuncSeparate(1028,it(2962,e,i),it(2967,e,i),it(2963,e,i)),stencilFuncBack:(t,e,i)=>t.stencilFuncSeparate(1029,it(34816,e,i),it(36003,e,i),it(36004,e,i)),stencilOpFront:(t,e,i)=>t.stencilOpSeparate(1028,it(2964,e,i),it(2965,e,i),it(2966,e,i)),stencilOpBack:(t,e,i)=>t.stencilOpSeparate(1029,it(34817,e,i),it(34818,e,i),it(34819,e,i))},a_={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,i)=>t({[e]:i}),hint:(t,e,i)=>t({[e]:i}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,i)=>t({36007:i}),bindTransformFeedback:(t,e,i)=>t({36389:i}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,i)=>{switch(e){case 36160:return t({36006:i,36010:i});case 36009:return t({36006:i});case 36008:return t({36010:i});default:return null}},bindBuffer:(t,e,i)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?t({[n]:i}):{valueChanged:!0}},blendColor:(t,e,i,n,s)=>t({32773:new Float32Array([e,i,n,s])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,i)=>t({32777:e,34877:i}),blendFunc:(t,e,i)=>t({32969:e,32968:i,32971:e,32970:i}),blendFuncSeparate:(t,e,i,n,s)=>t({32969:e,32968:i,32971:n,32970:s}),clearColor:(t,e,i,n,s)=>t({3106:new Float32Array([e,i,n,s])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,i,n,s)=>t({3107:[e,i,n,s]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,i)=>t({2928:new Float32Array([e,i])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,i)=>t({32824:e,10752:i}),sampleCoverage:(t,e,i)=>t({32938:e,32939:i}),scissor:(t,e,i,n,s)=>t({3088:new Int32Array([e,i,n,s])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,i)=>t({[e===1028?2968:36005]:i}),stencilFunc:(t,e,i,n)=>t({2962:e,2967:i,2963:n,34816:e,36003:i,36004:n}),stencilFuncSeparate:(t,e,i,n,s)=>t({[e===1028?2962:34816]:i,[e===1028?2967:36003]:n,[e===1028?2963:36004]:s}),stencilOp:(t,e,i,n)=>t({2964:e,2965:i,2966:n,34817:e,34818:i,34819:n}),stencilOpSeparate:(t,e,i,n,s)=>t({[e===1028?2964:34817]:i,[e===1028?2965:34818]:n,[e===1028?2966:34819]:s}),viewport:(t,e,i,n,s)=>t({2978:[e,i,n,s]})},vi=(t,e)=>t.isEnabled(e),c_={3042:vi,2884:vi,2929:vi,3024:vi,32823:vi,32926:vi,32928:vi,3089:vi,2960:vi,35977:vi},yM=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Sr(t,e){if(bM(e))return;const i={};for(const s in e){const r=Number(s),o=_M[s];o&&(typeof o=="string"?i[o]=!0:o(t,e[s],r))}const n=t.state&&t.state.cache;if(n)for(const s in i){const r=mM[s];r(t,e,n)}}function W1(t,e=ld){if(typeof e=="number"){const s=e,r=c_[s];return r?r(t,s):t.getParameter(s)}const i=Array.isArray(e)?e:Object.keys(e),n={};for(const s of i){const r=c_[s];n[s]=r?r(t,Number(s)):t.getParameter(Number(s))}return n}function vM(t){Sr(t,ld)}function bM(t){for(const e in t)return!1;return!0}function wM(t,e){if(t===e)return!0;const i=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(e)||ArrayBuffer.isView(e);if(i&&n&&t.length===e.length){for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}return!1}class TM{constructor(e,{copyState:i=!1,log:n=()=>{}}={}){y(this,"gl");y(this,"program",null);y(this,"stateStack",[]);y(this,"enable",!0);y(this,"cache");y(this,"log");this.gl=e,this.cache=i?W1(e):Object.assign({},ld),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){ze(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Sr(this.gl,e),this.stateStack.pop()}_updateCache(e){let i=!1,n;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in e){ze(r!==void 0);const o=e[r],a=this.cache[r];wM(o,a)||(i=!0,n=a,s&&!(r in s)&&(s[r]=a),this.cache[r]=o)}return{valueChanged:i,oldValue:n}}}function cs(t){return t.state}function X1(t,e){const{enable:i=!0,copyState:n}=e;if(ze(n!==void 0),!t.state){t.state=new TM(t,{copyState:n}),SM(t);for(const r in a_){const o=a_[r];EM(t,r,o)}l_(t,"getParameter"),l_(t,"isEnabled")}const s=cs(t);return s.enable=i,t}function vl(t){let e=cs(t);e||(X1(t,{copyState:!1}),e=cs(t)),e.push()}function Co(t){const e=cs(t);ze(e),e.pop()}function l_(t,e){const i=t[e].bind(t);t[e]=function(s){if(s===void 0||yM.has(s))return i(s);const r=cs(t);return s in r.cache||(r.cache[s]=i(s)),r.enable?r.cache[s]:i(s)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function EM(t,e,i){if(!t[e])return;const n=t[e].bind(t);t[e]=function(...r){const o=cs(t),{valueChanged:a,oldValue:c}=i(o._updateCache,...r);return a&&n(...r),c},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function SM(t){const e=t.useProgram.bind(t);t.useProgram=function(n){const s=cs(t);s.program!==n&&(e(n),s.program=n)}}const AM={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function RM(t,e){e={...AM,...e};let i=null;const n=r=>i=r.statusMessage||i;t.addEventListener("webglcontextcreationerror",n,!1);let s=null;if(s||(s=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",n,!1),!s)throw new Error(`Failed to create WebGL context: ${i||"Unknown error"}`);if(e.onContextLost){const{onContextLost:r}=e;t.addEventListener("webglcontextlost",o=>r(o),!1)}if(e.onContextRestored){const{onContextRestored:r}=e;t.addEventListener("webglcontextrestored",o=>r(o),!1)}return s}function _n(t,e,i){return i[e]===void 0&&(i[e]=t.getExtension(e)||null),i[e]}function CM(t,e){const i=t.getParameter(7936),n=t.getParameter(7937);_n(t,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,r=t.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),a=r||i,c=o||n,l=t.getParameter(7938),u=q1(a,c),h=xM(a,c),f=PM(a,c);return{type:"webgl",gpu:u,gpuType:f,gpuBackend:h,vendor:a,renderer:c,version:l,shadingLanguage:"glsl",shadingLanguageVersion:300}}function q1(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function xM(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function PM(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(q1(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function Y1(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const bt="texture-compression-bc",Me="texture-compression-astc",bi="texture-compression-etc2",MM="texture-compression-etc1-webgl",_a="texture-compression-pvrtc-webgl",mu="texture-compression-atc-webgl",kr="float32-renderable-webgl",yu="float16-renderable-webgl",IM="rgb9e5ufloat_renderable-webgl",vu="snorm8-renderable-webgl",Dr="norm16-renderable-webgl",bu="snorm16-renderable-webgl",ma="float32-filterable",u_="float16-filterable-webgl",Kr="WEBGL_compressed_texture_s3tc",Zr="WEBGL_compressed_texture_s3tc_srgb",zs="EXT_texture_compression_rgtc",Vs="EXT_texture_compression_bptc",OM="WEBGL_compressed_texture_etc",NM="WEBGL_compressed_texture_astc",kM="WEBGL_compressed_texture_etc1",DM="WEBGL_compressed_texture_pvrtc",FM="WEBGL_compressed_texture_atc",h_="EXT_texture_norm16",f_="EXT_render_snorm",LM="EXT_color_buffer_float",ud={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[f_],"norm16-renderable-webgl":[h_],"snorm16-renderable-webgl":[h_,f_],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Kr,Zr,zs,Vs],"texture-compression-bc5-webgl":[zs],"texture-compression-bc7-webgl":[Vs],"texture-compression-etc2":[OM],"texture-compression-astc":[NM],"texture-compression-etc1-webgl":[kM],"texture-compression-pvrtc-webgl":[DM],"texture-compression-atc-webgl":[FM]};function BM(t){return t in ud}function UM(t,e,i){return(ud[e]||[]).every(s=>_n(t,s,i))}const bl={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:vu},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:vu},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:yu,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:Dr,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:bu},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:vu},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:yu,filter:u_,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:Dr},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:bu},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:kr,filter:ma},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:IM},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:kr,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:Dr},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:Dr},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:kr,filter:ma,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:yu,filter:u_},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:Dr,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:bu},"rgb32float-webgl":{gl:34837,render:kr,filter:ma,gl2ext:LM,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:kr,filter:ma,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Kr,f:bt},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Zr,f:bt},"bc1-rgba-unorm":{gl:33777,x:Kr,f:bt},"bc1-rgba-unorm-srgb":{gl:35916,x:Zr,f:bt},"bc2-rgba-unorm":{gl:33778,x:Kr,f:bt},"bc2-rgba-unorm-srgb":{gl:35918,x:Zr,f:bt},"bc3-rgba-unorm":{gl:33779,x:Kr,f:bt},"bc3-rgba-unorm-srgb":{gl:35919,x:Zr,f:bt},"bc4-r-unorm":{gl:36283,x:zs,f:bt},"bc4-r-snorm":{gl:36284,x:zs,f:bt},"bc5-rg-unorm":{gl:36285,x:zs,f:bt},"bc5-rg-snorm":{gl:36286,x:zs,f:bt},"bc6h-rgb-ufloat":{gl:36495,x:Vs,f:bt},"bc6h-rgb-float":{gl:36494,x:Vs,f:bt},"bc7-rgba-unorm":{gl:36492,x:Vs,f:bt},"bc7-rgba-unorm-srgb":{gl:36493,x:Vs,f:bt},"etc2-rgb8unorm":{gl:37492,f:bi},"etc2-rgb8unorm-srgb":{gl:37494,f:bi},"etc2-rgb8a1unorm":{gl:37496,f:bi},"etc2-rgb8a1unorm-srgb":{gl:37497,f:bi},"etc2-rgba8unorm":{gl:37493,f:bi},"etc2-rgba8unorm-srgb":{gl:37495,f:bi},"eac-r11unorm":{gl:37488,f:bi},"eac-r11snorm":{gl:37489,f:bi},"eac-rg11unorm":{gl:37490,f:bi},"eac-rg11snorm":{gl:37491,f:bi},"astc-4x4-unorm":{gl:37808,f:Me},"astc-4x4-unorm-srgb":{gl:37840,f:Me},"astc-5x4-unorm":{gl:37809,f:Me},"astc-5x4-unorm-srgb":{gl:37841,f:Me},"astc-5x5-unorm":{gl:37810,f:Me},"astc-5x5-unorm-srgb":{gl:37842,f:Me},"astc-6x5-unorm":{gl:37811,f:Me},"astc-6x5-unorm-srgb":{gl:37843,f:Me},"astc-6x6-unorm":{gl:37812,f:Me},"astc-6x6-unorm-srgb":{gl:37844,f:Me},"astc-8x5-unorm":{gl:37813,f:Me},"astc-8x5-unorm-srgb":{gl:37845,f:Me},"astc-8x6-unorm":{gl:37814,f:Me},"astc-8x6-unorm-srgb":{gl:37846,f:Me},"astc-8x8-unorm":{gl:37815,f:Me},"astc-8x8-unorm-srgb":{gl:37847,f:Me},"astc-10x5-unorm":{gl:37819,f:Me},"astc-10x5-unorm-srgb":{gl:37851,f:Me},"astc-10x6-unorm":{gl:37817,f:Me},"astc-10x6-unorm-srgb":{gl:37849,f:Me},"astc-10x8-unorm":{gl:37818,f:Me},"astc-10x8-unorm-srgb":{gl:37850,f:Me},"astc-10x10-unorm":{gl:37819,f:Me},"astc-10x10-unorm-srgb":{gl:37851,f:Me},"astc-12x10-unorm":{gl:37820,f:Me},"astc-12x10-unorm-srgb":{gl:37852,f:Me},"astc-12x12-unorm":{gl:37821,f:Me},"astc-12x12-unorm-srgb":{gl:37853,f:Me},"pvrtc-rgb4unorm-webgl":{gl:35840,f:_a},"pvrtc-rgba4unorm-webgl":{gl:35842,f:_a},"pvrtc-rbg2unorm-webgl":{gl:35841,f:_a},"pvrtc-rgba2unorm-webgl":{gl:35843,f:_a},"etc1-rbg-unorm-webgl":{gl:36196,f:MM},"atc-rgb-unorm-webgl":{gl:35986,f:mu},"atc-rgba-unorm-webgl":{gl:35986,f:mu},"atc-rgbai-unorm-webgl":{gl:34798,f:mu}},zM={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},VM={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function hd(t,e,i){const n=bl[e];if(!n||n.gl===void 0)return!1;const s=n.x||n.gl2ext;return s?!!_n(t,s,i):!0}function K1(t){const e=bl[t],i=e==null?void 0:e.gl;if(i===void 0)throw new Error(`Unsupported texture format ${t}`);return i}function jM(t,e,i){if(!hd(t,e,i)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(Wy(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!_n(t,"OES_texture_float_linear, extensions",i):e.endsWith("16float")?!!_n(t,"OES_texture_half_float_linear, extensions",i):!0}function $M(t,e,i){return!(!hd(t,e,i)||typeof e=="number")}function wc(t){var s;const e=bl[t],i=K1(t),n=Wy(t);return{format:i,dataFormat:(e==null?void 0:e.dataFormat)||WM(n.format,n.integer,n.normalized,i),type:n.dataType?Y1(n.dataType):((s=e==null?void 0:e.types)==null?void 0:s[0])||5121,compressed:n.compressed}}function HM(t){const e=bl[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function d_(t){const e=wc(t),i=zM[e.dataFormat]||4,n=VM[e.type]||1;return i*n}function WM(t,e,i,n){if(n===6408||n===6407)return n;switch(t){case"r":return e&&!i?36244:6403;case"rg":return e&&!i?33320:33319;case"rgb":return e&&!i?36248:6407;case"rgba":return e&&!i?36249:6408;default:return 6408}}const p_={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class XM extends Q2{constructor(i,n,s){super([],s);y(this,"gl");y(this,"extensions");y(this,"testedFeatures",new Set);this.gl=i,this.extensions=n,_n(i,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const i=this.getFeatures();for(const n of i)this.has(n)&&(yield n);return[]}has(i){return this.disabledFeatures[i]?!1:(this.testedFeatures.has(i)||(this.testedFeatures.add(i),BM(i)&&UM(this.gl,i,this.extensions)&&this.features.add(i),this.getWebGLFeature(i)&&this.features.add(i)),this.features.has(i))}initializeFeatures(){const i=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of i)this.has(n)}getFeatures(){return[...Object.keys(p_),...Object.keys(ud)]}getWebGLFeature(i){const n=p_[i];return typeof n=="string"?!!_n(this.gl,n,this.extensions):!!n}}class qM extends J2{constructor(i){super();y(this,"gl");y(this,"limits",{});this.gl=i}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(i){return this.limits[i]===void 0&&(this.limits[i]=this.gl.getParameter(i)),this.limits[i]}}function cn(t,e,i){if(YM(e))return i(t);const{nocatch:n=!0}=e;vl(t),Sr(t,e);let s;if(n)s=i(t),Co(t);else try{s=i(t)}finally{Co(t)}return s}function YM(t){for(const e in t)return!1;return!0}function KM(t,e,i,n){if(uc(e))return n(t);const s=t;vl(s.gl);try{return ZM(t,e),Sr(s.gl,i),n(t)}finally{Co(s.gl)}}function ZM(t,e){const i=t,{gl:n}=i;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(Kn("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const r=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=Kn("provokingVertex",e.provokingVertex,{first:36429,last:36430});r==null||r.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const r=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=Kn("polygonMode",e.polygonMode,{fill:6914,line:6913});r==null||r.polygonModeWEBGL(1028,o),r==null||r.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&n.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(JM("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(Yh("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;n.stencilMaskSeparate(1028,s),n.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&Y.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,r=Yh("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,r,0,s),n.stencilFuncSeparate(1029,r,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=wu("stencilPassOperation",e.stencilPassOperation),r=wu("stencilFailOperation",e.stencilFailOperation),o=wu("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,r,o,s),n.stencilOpSeparate(1029,r,o,s)}if(e.blendColorOperation||e.blendAlphaOperation){n.enable(3042);const s=g_("blendColorOperation",e.blendColorOperation||"add"),r=g_("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(s,r);const o=ya("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=ya("blendColorDstFactor",e.blendColorDstFactor||"zero"),c=ya("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),l=ya("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(o,a,c,l)}}function Yh(t,e){return Kn(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function wu(t,e){return Kn(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function g_(t,e){return Kn(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function ya(t,e){return Kn(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function GM(t,e){return`Illegal parameter ${e} for ${t}`}function Kn(t,e,i){if(!(e in i))throw new Error(GM(t,e));return i[e]}function JM(t,e){return e}function Z1(t){const e={};return t.addressModeU&&(e[10242]=Tu(t.addressModeU)),t.addressModeV&&(e[10243]=Tu(t.addressModeV)),t.addressModeW&&(e[32882]=Tu(t.addressModeW)),t.magFilter&&(e[10240]=G1(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=QM(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Yh("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function Tu(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function G1(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function QM(t,e){if(!e)return G1(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class fn extends qe{constructor(i,n={}){super(i,n);y(this,"device");y(this,"gl");y(this,"handle");y(this,"glTarget");y(this,"glUsage");y(this,"glIndexType",5123);y(this,"byteLength");y(this,"bytesUsed");this.device=i,this.gl=this.device.gl;const s=typeof n=="object"?n.handle:void 0;this.handle=s||this.gl.createBuffer(),i.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=eI(this.props.usage),this.glUsage=tI(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(i,n=0,s=i.byteLength+n){const r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,s,this.glUsage),this.gl.bufferSubData(r,n,i),this.gl.bindBuffer(r,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(i,n,s),this.trackAllocatedMemory(s)}_initWithByteLength(i){ze(i>=0);let n=i;i===0&&(n=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,n,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(null,0,i),this.trackAllocatedMemory(i),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(i,n=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,n,i),this.gl.bindBuffer(36663,null),this._setDebugData(i,n,i.byteLength)}async readAsync(i=0,n){return this.readSyncWebGL(i,n)}readSyncWebGL(i=0,n){n=n??this.byteLength-i;const s=new Uint8Array(n),r=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,s,r,n),this.gl.bindBuffer(36662,null),this._setDebugData(s,i,n),s}}function eI(t){return t&qe.INDEX?34963:t&qe.VERTEX?34962:t&qe.UNIFORM?35345:34962}function tI(t){return t&qe.INDEX||t&qe.VERTEX?35044:t&qe.UNIFORM?35048:35044}class Kh extends dc{constructor(i,n){super(i,n);y(this,"device");y(this,"handle");y(this,"parameters");this.device=i,this.parameters=Z1(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(i){for(const[n,s]of Object.entries(i)){const r=Number(n);switch(r){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,r,s);break;default:this.device.gl.samplerParameteri(this.handle,r,s);break}}}}class js extends hc{constructor(i,n){super(i,{...Xt.defaultProps,...n});y(this,"device");y(this,"gl");y(this,"handle");y(this,"texture");this.device=i,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const iI={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},fo=class fo extends Xt{constructor(i,n){var s;super(i,{...iI,format:"rgba8unorm",...n});y(this,"MAX_ATTRIBUTES");y(this,"device");y(this,"gl");y(this,"handle");y(this,"sampler");y(this,"view");y(this,"glFormat");y(this,"type");y(this,"dataFormat");y(this,"mipmaps");y(this,"target");y(this,"textureUnit");y(this,"loaded",!1);y(this,"_video");this.device=i,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=nI(this.props),this.loaded=!1,typeof((s=this.props)==null?void 0:s.data)=="string"&&Object.assign(this.props,{data:z3(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(i){return new js(this.device,{...i,texture:this})}initialize(i={}){if(this.props.dimension==="cube")return this.initializeCube(i);let n=i.data;if(n instanceof Promise)return n.then(b=>this.initialize(Object.assign({},i,{pixels:b,data:b}))),this;const s=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(s&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(i)),this;const{parameters:r={}}=i,{pixels:o=null,pixelStore:a={},textureUnit:c=void 0,mipmaps:l=!0}=i;n||(n=o);let{width:u,height:h,dataFormat:f,type:d,compressed:p=!1}=i;const{depth:g=0}=i,_=K1(i.format);return{width:u,height:h,compressed:p,dataFormat:f,type:d}=this._deduceParameters({format:i.format,type:d,dataFormat:f,compressed:p,data:n,width:u,height:h}),this.width=u,this.height=h,this.glFormat=_,this.type=d,this.dataFormat=f,this.textureUnit=c,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=l,this.setImageData({data:n,width:u,height:h,depth:g,format:_,type:d,dataFormat:f,parameters:a,compressed:p}),this.setSampler(i.sampler),this._setSamplerParameters(r),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),l&&this.device.isTextureFormatFilterable(i.format)&&this.generateMipmap(),s&&(this._video={video:n,parameters:r,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}initializeCube(i){const{mipmaps:n=!0,parameters:s={}}=i;return this.setCubeMapImageData(i).then(()=>{this.loaded=!0,n&&this.generateMipmap(i),this.setSampler(i.sampler),this._setSamplerParameters(s)}),this}setSampler(i={}){let n;i instanceof Kh?(this.sampler=i,n=i.props):(this.sampler=new Kh(this.device,i),n=i);const s=Z1(n);return this._setSamplerParameters(s),this}resize(i){const{height:n,width:s,mipmaps:r=!1}=i;return s!==this.width||n!==this.height?this.initialize({width:s,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:r}):this}update(){if(this._video){const{video:i,parameters:n,lastTime:s}=this._video;if(s===i.currentTime||i.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:i,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=i.currentTime}}generateMipmap(i={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),cn(this.gl,i,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(i){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(i);this.trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:s=null,level:r=0,glFormat:o=this.glFormat,offset:a=0,parameters:c={}}=i;let{data:l=null,type:u=this.type,width:h=this.width,height:f=this.height,dataFormat:d=this.dataFormat,compressed:p=!1}=i;l||(l=s),{type:u,dataFormat:d,compressed:p,width:h,height:f}=this._deduceParameters({format:this.props.format,type:u,dataFormat:d,compressed:p,data:l,width:h,height:f});const{gl:g}=this;g.bindTexture(this.target,this.handle);let _=null;if({data:l,dataType:_}=this._getDataType({data:l,compressed:p}),cn(this.gl,c,()=>{switch(_){case"null":g.texImage2D(n,r,o,h,f,0,d,u,l);break;case"typed-array":g.texImage2D(n,r,o,h,f,0,d,u,l,a);break;case"buffer":this.device.gl.bindBuffer(35052,l.handle||l),this.device.gl.texImage2D(n,r,o,h,f,0,d,u,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":g.texImage2D(n,r,o,h,f,0,d,u,l);break;case"compressed":for(const[b,T]of l.entries())g.compressedTexImage2D(n,b,T.format,T.width,T.height,0,T.data);break;default:ze(!1,"Unknown image data type")}}),l&&l.byteLength)this.trackAllocatedMemory(l.byteLength,"Texture");else{const b=d_(this.props.format);this.trackAllocatedMemory(this.width*this.height*b,"Texture")}return this.loaded=!0,this}setSubImageData({target:i=this.target,pixels:n=null,data:s=null,x:r=0,y:o=0,width:a=this.width,height:c=this.height,level:l=0,glFormat:u=this.glFormat,type:h=this.type,dataFormat:f=this.dataFormat,compressed:d=!1,offset:p=0,parameters:g={}}){if({type:h,dataFormat:f,compressed:d,width:a,height:c}=this._deduceParameters({format:this.props.format,type:h,dataFormat:f,compressed:d,data:s,width:a,height:c}),ze(this.depth===1,"texSubImage not supported for 3D textures"),s||(s=n),s&&s.data){const _=s;s=_.data,a=_.shape[0],c=_.shape[1]}s instanceof fn&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),cn(this.gl,g,()=>{d?this.gl.compressedTexSubImage2D(i,l,r,o,a,c,u,s):s===null?this.gl.texSubImage2D(i,l,r,o,a,c,f,h,null):ArrayBuffer.isView(s)?this.gl.texSubImage2D(i,l,r,o,a,c,f,h,s,p):typeof WebGLBuffer<"u"&&s instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,s),this.device.gl.texSubImage2D(i,l,r,o,a,c,f,h,p),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(i,l,r,o,a,c,f,h,s)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(i={}){return Y.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(i=this.textureUnit){const{gl:n}=this;return i!==void 0&&(this.textureUnit=i,n.activeTexture(33984+i)),n.bindTexture(this.target,this.handle),i}unbind(i=this.textureUnit){const{gl:n}=this;return i!==void 0&&(this.textureUnit=i,n.activeTexture(33984+i)),n.bindTexture(this.target,null),i}_getDataType({data:i,compressed:n=!1}){return n?{data:i,dataType:"compressed"}:i===null?{data:i,dataType:"null"}:ArrayBuffer.isView(i)?{data:i,dataType:"typed-array"}:i instanceof fn?{data:i.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?{data:i,dataType:"buffer"}:{data:i,dataType:"browser-object"}}_deduceParameters(i){const{format:n,data:s}=i;let{width:r,height:o,dataFormat:a,type:c,compressed:l}=i;const u=wc(n);return a=a||u.dataFormat,c=c||u.type,l=l||u.compressed,{width:r,height:o}=this._deduceImageSize(s,r,o),{dataFormat:a,type:c,compressed:l,width:r,height:o,format:n,data:s}}_deduceImageSize(i,n,s){let r;return typeof ImageData<"u"&&i instanceof ImageData?r={width:i.width,height:i.height}:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement?r={width:i.naturalWidth,height:i.naturalHeight}:typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement?r={width:i.width,height:i.height}:typeof ImageBitmap<"u"&&i instanceof ImageBitmap?r={width:i.width,height:i.height}:typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement?r={width:i.videoWidth,height:i.videoHeight}:i?r={width:n,height:s}:r={width:n>=0?n:1,height:s>=0?s:1},ze(r,"Could not deduced texture size"),ze(n===void 0||r.width===n,"Deduced texture width does not match supplied width"),ze(s===void 0||r.height===s,"Deduced texture height does not match supplied height"),r}async setCubeMapImageData(i){const{gl:n}=this,{width:s,height:r,pixels:o,data:a,format:c=6408,type:l=5121}=i,u=o||a,h=await Promise.all(fo.FACES.map(f=>{const d=u[f];return Promise.all(Array.isArray(d)?d:[d])}));this.bind(),fo.FACES.forEach((f,d)=>{h[d].length>1&&this.props.mipmaps!==!1&&Y.warn(`${this.id} has mipmap and multiple LODs.`)(),h[d].forEach((p,g)=>{s&&r?n.texImage2D(f,g,c,s,r,0,c,l,p):n.texImage2D(f,g,c,c,l,p)})}),this.unbind()}setImageDataForFace(i){const{face:n,width:s,height:r,pixels:o,data:a,format:c=6408,type:l=5121}=i,{gl:u}=this,h=o||a;return this.bind(),h instanceof Promise?h.then(f=>this.setImageDataForFace(Object.assign({},i,{face:n,data:f,pixels:f}))):this.width||this.height?u.texImage2D(n,0,c,s,r,0,c,l,h):u.texImage2D(n,0,c,c,l,h),this}setImageData3D(i){const{level:n=0,dataFormat:s,format:r,type:o,width:a,height:c,depth:l=1,offset:u=0,data:h,parameters:f={}}=i;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const d=wc(r);if(cn(this.gl,f,()=>{ArrayBuffer.isView(h)&&this.gl.texImage3D(this.target,n,d.format,a,c,l,0,d.dataFormat,d.type,h),h instanceof fn&&(this.gl.bindBuffer(35052,h.handle),this.gl.texImage3D(this.target,n,s,a,c,l,0,r,o,u))}),h&&h.byteLength)this.trackAllocatedMemory(h.byteLength,"Texture");else{const p=d_(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*p,"Texture")}return this.loaded=!0,this}_setSamplerParameters(i){if(!uc(i)){sI(i),this.gl.bindTexture(this.target,this.handle);for(const[n,s]of Object.entries(i)){const r=Number(n),o=s;switch(r){case 33082:case 33083:this.gl.texParameterf(this.target,r,o);break;default:this.gl.texParameteri(this.target,r,o);break}}this.gl.bindTexture(this.target,null)}}};y(fo,"FACES",[34069,34070,34071,34072,34073,34074]);let Ci=fo;function nI(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function sI(t){Y.log(1,"texture sampler parameters",t)()}class no extends pc{constructor(i,n){super(i,n);y(this,"device");y(this,"gl");y(this,"handle");const s=n.handle===null;if(this.device=i,this.gl=i.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),!s){i.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const r=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){const a=this.colorAttachments[o],c=36064+o;a&&this._attachOne(c,a)}if(this.depthStencilAttachment&&this._attachOne(HM(this.depthStencilAttachment.props.format),this.depthStencilAttachment),n.check!==!1){const o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${oI(o)}`)}this.gl.bindFramebuffer(36160,r)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(i){return new Ci(this.device,{id:`${this.id}-depth-stencil`,format:i,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(i,n){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;i===void 0&&(i=this.gl.drawingBufferWidth),n===void 0&&(n=this.gl.drawingBufferHeight);for(const s of this.colorAttachments)s.texture.resize({width:i,height:n});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:i,height:n}),this}_attachOne(i,n){if(Array.isArray(n)){const[s,r=0,o=0]=n;return this._attachTexture(i,s,r,o),s}if(n instanceof Ci)return this._attachTexture(i,n,0,0),n;if(n instanceof js){const s=n;return this._attachTexture(i,s.texture,s.props.baseMipLevel,s.props.baseArrayLayer),n.texture}throw new Error("attach")}_attachTexture(i,n,s,r){const{gl:o}=this.device;switch(o.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:o.framebufferTextureLayer(36160,i,n.target,r,s);break;case 34067:const a=rI(s);o.framebufferTexture2D(36160,i,a,n.handle,r);break;case 3553:o.framebufferTexture2D(36160,i,3553,n.handle,r);break;default:ze(!1,"Illegal texture type")}o.bindTexture(n.target,null)}}function rI(t){return t<34069?t+34069:t}function oI(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class aI extends ed{constructor(i,n){super(n);y(this,"device");y(this,"presentationSize");y(this,"_framebuffer",null);this.device=i,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new no(this.device,{handle:null}),this._framebuffer}update(){const i=this.getPixelSize();(i[0]!==this.presentationSize[0]||i[1]!==this.presentationSize[1])&&(this.presentationSize=i,this.resize())}resize(i){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(i==null?void 0:i.useDevicePixels);this.setDevicePixelRatio(n,i);return}}commit(){}}const cI={spector:Y.get("spector")||Y.get("inspect")},lI="https://spectorcdn.babylonjs.com/spector.bundle.js",uI=1;let Ie=null,__=!1;async function hI(t){if(!globalThis.SPECTOR)try{await e1(lI)}catch(e){Y.warn(String(e))}}function fI(t){if(t={...cI,...t},!(t!=null&&t.spector)||(!Ie&&globalThis.SPECTOR&&(Y.probe(uI,"SPECTOR found and initialized")(),Ie=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=Ie)),!Ie))return null;if(__||(__=!0,Ie.spyCanvases(),Ie==null||Ie.onCaptureStarted.add(e=>Y.info("Spector capture started:",e)()),Ie==null||Ie.onCapture.add(e=>{Y.info("Spector capture complete:",e)(),Ie==null||Ie.getResultUI(),Ie==null||Ie.resultView.display(),Ie==null||Ie.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return Ie;Ie==null||Ie.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{Y.info("Spector capture stopped after 2 seconds")(),Ie==null||Ie.stopCapture()})}return Ie}const dI="https://unpkg.com/webgl-debug@2.0.1/index.js";function J1(t){return t.luma=t.luma||{},t.luma}async function pI(){Tn()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await e1(dI))}function gI(t,e={}){return t?e.debug?mI(t,e):_I(t):null}function _I(t){const e=J1(t);return e.realContext?e.realContext:t}function mI(t,e){if(!globalThis.WebGLDebugUtils)return Y.warn("webgl-debug not loaded")(),t;const i=J1(t);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...Us,...t});const n=globalThis.WebGLDebugUtils.makeDebugContext(t,yI.bind(null,e),vI.bind(null,e));for(const o in Us)!(o in n)&&typeof Us[o]=="number"&&(n[o]=Us[o]);class s{}Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.setPrototypeOf(s,n);const r=Object.create(s);return i.realContext=t,i.debugContext=r,r.debug=!0,r}function Eu(t,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${t}(${i})`}function yI(t,e,i,n){n=Array.from(n).map(a=>a===void 0?"undefined":a);const s=globalThis.WebGLDebugUtils.glEnumToString(e),r=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,n),o=`${s} in gl.${i}(${r})`;Y.error(o)();debugger;if(t.throwOnError)throw new Error(o)}function vI(t,e,i){let n="";if(Y.level>=1&&(n=Eu(e,i),Y.log(1,n)()),t.break&&t.break.length>0&&(n=n||Eu(e,i),t.break.every(r=>n.indexOf(r)!==-1)))debugger;for(const s of i)if(s===void 0){if(n=n||Eu(e,i),t.throwOnError)throw new Error(`Undefined argument: ${n}`);Y.error(`Undefined argument: ${n}`)();debugger}}function bI(t){const e=t.split(/\r?\n/),i=[];for(const n of e){if(n.length<=1)continue;const s=n.split(":");if(s.length===2){const[h,f]=s;i.push({message:f.trim(),type:m_(h),lineNum:0,linePos:0});continue}const[r,o,a,...c]=s;let l=parseInt(a,10);isNaN(l)&&(l=0);let u=parseInt(o,10);isNaN(u)&&(u=0),i.push({message:c.join(":").trim(),type:m_(r),lineNum:l,linePos:u})}return i}function m_(t){const e=["warning","error","info"],i=t.toLowerCase();return e.includes(i)?i:"info"}class wI extends fc{constructor(i,n){super(i,n);y(this,"device");y(this,"handle");switch(this.device=i,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const i=this.device.gl.getShaderInfoLog(this.handle);return bI(i)}getTranslatedSource(){const n=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return n==null?void 0:n.getTranslatedShaderSource(this.handle)}async _compile(i){i=(r=>r.startsWith("#version ")?r:`#version 100
${r}`)(i);const{gl:s}=this.device;if(s.shaderSource(this.handle,i),s.compileShader(this.handle),Y.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Y.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Y.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const i=async r=>await new Promise(o=>setTimeout(o,r));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await i(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const TI=256,EI=1024,SI=16384,Su=6144,AI=[1,2,4,8];class RI extends Mh{constructor(i,n){super(i,n);y(this,"device");y(this,"glParameters");this.device=i,vl(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){Co(this.device.gl)}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}setParameters(i={}){const n={...this.glParameters};this.props.framebuffer&&(n.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,i.viewport&&(i.viewport.length>=6?(n.viewport=i.viewport.slice(0,4),n.depthRange=[i.viewport[4],i.viewport[5]]):n.viewport=i.viewport),i.scissorRect&&(n.scissorTest=!0,n.scissor=i.scissorRect),i.blendConstant&&(n.blendColor=i.blendConstant),i.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),i[2967]=i.stencilReference),i.colorMask&&(n.colorMask=AI.map(s=>!!(s&i.colorMask))),this.glParameters=n,Sr(this.device.gl,n)}beginOcclusionQuery(i){const n=this.props.occlusionQuerySet;n==null||n.beginOcclusionQuery()}endOcclusionQuery(){const i=this.props.occlusionQuerySet;i==null||i.endOcclusionQuery()}clear(){const i={...this.glParameters};let n=0;this.props.clearColor!==!1&&(n|=SI,i.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=TI,i.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=EI,i.clearStencil=this.props.clearStencil),n!==0&&cn(this.device.gl,i,()=>{this.device.gl.clear(n)})}clearColorBuffer(i=0,n=[0,0,0,0]){cn(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int32Array:this.device.gl.clearBufferiv(Su,i,n);break;case Uint32Array:this.device.gl.clearBufferuiv(Su,i,n);break;case Float32Array:default:this.device.gl.clearBufferfv(Su,i,n);break}})}}const CI="Failed to deduce GL constant from typed array";function xI(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(CI)}}function Zh(t,e){const{clamped:i=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const PI={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},MI={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class so{constructor(...e){y(this,"offset");y(this,"stride");y(this,"type");y(this,"size");y(this,"divisor");y(this,"normalized");y(this,"integer");y(this,"buffer");y(this,"index");e.forEach(i=>this._assign(i)),Object.freeze(this)}static getBytesPerElement(e){return Zh(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return ze(e.size),Zh(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new so(PI,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return so.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return so.getBytesPerVertex(this)}_assign(e={}){return e=B3("Accessor",e,MI),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function II(t){return OI.includes(t)}const OI=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Q1={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function ev(t){const e=Q1[t];if(!e)throw new Error("uniform");const[i,n,,s]=e;return{format:s,components:n,glType:i}}function NI(t){const e=Q1[t];if(!e)throw new Error("attribute");const[,i,,n,s]=e;return{attributeType:n,vertexFormat:s,components:i}}function kI(t,e){const i={attributes:[],bindings:[]};i.attributes=DI(t,e);const n=BI(t,e);for(const a of n){const c=a.uniforms.map(l=>({name:l.name,format:l.format,byteOffset:l.byteOffset,byteStride:l.byteStride,arrayLength:l.arrayLength}));i.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:c})}const s=LI(t,e);let r=0;for(const a of s)if(II(a.type)){const{viewDimension:c,sampleType:l}=zI(a.type);i.bindings.push({type:"texture",name:a.name,location:r,viewDimension:c,sampleType:l}),a.textureUnit=r,r+=1}s.length&&(i.uniforms=s);const o=FI(t,e);return o!=null&&o.length&&(i.varyings=o),i}function DI(t,e){const i=[],n=t.getProgramParameter(e,35721);for(let s=0;s<n;s++){const r=t.getActiveAttrib(e,s);if(!r)throw new Error("activeInfo");const{name:o,type:a}=r,c=t.getAttribLocation(e,o);if(c>=0){const{attributeType:l}=NI(a),u=/instance/i.test(o)?"instance":"vertex";i.push({name:o,location:c,stepMode:u,type:l})}}return i.sort((s,r)=>s.location-r.location),i}function FI(t,e){const i=[],n=t.getProgramParameter(e,35971);for(let s=0;s<n;s++){const r=t.getTransformFeedbackVarying(e,s);if(!r)throw new Error("activeInfo");const{name:o,type:a,size:c}=r,{glType:l,components:u}=ev(a),h=new so({type:l,size:c*u}),f={location:s,name:o,accessor:h};i.push(f)}return i.sort((s,r)=>s.location-r.location),i}function LI(t,e){const i=[],n=t.getProgramParameter(e,35718);for(let s=0;s<n;s++){const r=t.getActiveUniform(e,s);if(!r)throw new Error("activeInfo");const{name:o,size:a,type:c}=r,{name:l,isArray:u}=VI(o);let h=t.getUniformLocation(e,l);const f={location:h,name:l,size:a,type:c,isArray:u};if(i.push(f),f.size>1)for(let d=0;d<f.size;d++){const p=`${l}[${d}]`;h=t.getUniformLocation(e,p);const g={...f,name:p,location:h};i.push(g)}}return i}function BI(t,e){const i=(r,o)=>t.getActiveUniformBlockParameter(e,r,o),n=[],s=t.getProgramParameter(e,35382);for(let r=0;r<s;r++){const o={name:t.getActiveUniformBlockName(e,r)||"",location:i(r,35391),byteLength:i(r,35392),vertex:i(r,35396),fragment:i(r,35398),uniformCount:i(r,35394),uniforms:[]},a=i(r,35395)||[],c=t.getActiveUniforms(e,a,35383),l=t.getActiveUniforms(e,a,35384),u=t.getActiveUniforms(e,a,35387),h=t.getActiveUniforms(e,a,35388);for(let f=0;f<o.uniformCount;++f){const d=t.getActiveUniform(e,a[f]);if(!d)throw new Error("activeInfo");o.uniforms.push({name:d.name,format:ev(c[f]).format,type:c[f],arrayLength:l[f],byteOffset:u[f],byteStride:h[f]})}n.push(o)}return n.sort((r,o)=>r.location-o.location),n}const UI={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function zI(t){const e=UI[t];if(!e)throw new Error("sampler");const[i,n]=e;return{viewDimension:i,sampleType:n}}function VI(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const i=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!i||i.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:i[1],length:i[2]?1:0,isArray:!!i[2]}}function jI(t,e,i,n){const s=t;let r=n;r===!0&&(r=1),r===!1&&(r=0);const o=typeof r=="number"?[r]:r;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,n);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return s.uniform1uiv(e,o,1);case 36294:return s.uniform2uiv(e,o,2);case 36295:return s.uniform3uiv(e,o,3);case 36296:return s.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return s.uniformMatrix2x3fv(e,!1,o);case 35686:return s.uniformMatrix2x4fv(e,!1,o);case 35687:return s.uniformMatrix3x2fv(e,!1,o);case 35688:return s.uniformMatrix3x4fv(e,!1,o);case 35689:return s.uniformMatrix4x2fv(e,!1,o);case 35690:return s.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function $I(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function HI(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const y_=4;class WI extends ur{constructor(i,n){super(i,n);y(this,"device");y(this,"handle");y(this,"vs");y(this,"fs");y(this,"introspectedLayout");y(this,"uniforms",{});y(this,"bindings",{});y(this,"varyings",null);y(this,"_uniformCount",0);y(this,"_uniformSetters",{});this.device=i,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:s,bufferMode:r=35981}=n;switch(s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,r)),this._linkShaders(),Y.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=kI(this.device.gl,this.handle),Y.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=A3(this.introspectedLayout,n.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Y.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(i,n){for(const[s,r]of Object.entries(i)){const o=this.shaderLayout.bindings.find(a=>a.name===s)||this.shaderLayout.bindings.find(a=>a.name===`${s}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(c=>`"${c.name}"`).join(", ");n!=null&&n.disableWarnings||Y.warn(`Unknown binding "${s}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(r||Y.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(r instanceof fn)&&!(r.buffer instanceof fn))throw new Error("buffer value");break;case"texture":if(!(r instanceof js||r instanceof Ci||r instanceof no))throw new Error("texture value");break;case"sampler":Y.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(o.type)}this.bindings[s]=r}}draw(i){var _;const{renderPass:n,parameters:s=this.props.parameters,topology:r=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:c,isInstanced:l=!1,firstVertex:u=0,transformFeedback:h}=i,f=$I(r),d=!!o.indexBuffer,p=(_=o.indexBuffer)==null?void 0:_.glIndexType;if(this.linkStatus!=="success")return Y.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return Y.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return Y.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(n),h&&h.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const g=n;return KM(this.device,s,g.glParameters,()=>{d&&l?this.device.gl.drawElementsInstanced(f,a||0,p,u,c||0):d?this.device.gl.drawElements(f,a||0,p,u):l?this.device.gl.drawArraysInstanced(f,u,a||0,c||0):this.device.gl.drawArrays(f,u,a||0),h&&h.end()}),o.unbindAfterRender(n),!0}setUniformsWebGL(i){const{bindings:n}=Qy(i);Object.keys(n).forEach(s=>{Y.warn(`Unsupported value "${JSON.stringify(n[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,i)}async _linkShaders(){const{gl:i}=this.device;if(i.attachShader(this.handle,this.vs.handle),i.attachShader(this.handle,this.fs.handle),Y.time(y_,`linkProgram for ${this.id}`)(),i.linkProgram(this.handle),Y.timeEnd(y_,`linkProgram for ${this.id}`)(),Y.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}Y.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Y.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}_reportLinkStatus(i){var n;switch(i){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((n=this.fs)==null?void 0:n.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${i}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:i}=this.device;return i.getProgramParameter(this.handle,35714)?(i.validateProgram(this.handle),i.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const i=async r=>await new Promise(o=>setTimeout(o,r));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await i(10)}}_areTexturesRenderable(){let i=!0;for(const[,n]of Object.entries(this.bindings))n instanceof Ci&&(n.update(),i=i&&n.loaded);return i}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:i}=this.device;i.useProgram(this.handle);let n=0,s=0;for(const r of this.shaderLayout.bindings){const o=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${r.name} in ${this.id}`);switch(r.type){case"uniform":const{name:a}=r,c=i.getUniformBlockIndex(this.handle,a);if(c===4294967295)throw new Error(`Invalid uniform block name ${a}`);i.uniformBlockBinding(this.handle,s,c),o instanceof fn?i.bindBufferBase(35345,s,o.handle):i.bindBufferRange(35345,s,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),s+=1;break;case"texture":if(!(o instanceof js||o instanceof Ci||o instanceof no))throw new Error("texture");let l;if(o instanceof js)l=o.texture;else if(o instanceof Ci)l=o;else if(o instanceof no&&o.colorAttachments[0]instanceof js)Y.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),l=o.colorAttachments[0].texture;else throw new Error("No texture");i.activeTexture(33984+n),i.bindTexture(l.target,l.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${r.type}' not supported in WebGL`)}}}_applyUniforms(){for(const i of this.shaderLayout.uniforms||[]){const{name:n,location:s,type:r,textureUnit:o}=i,a=this.uniforms[n]??o;a!==void 0&&jI(this.device.gl,s,r,a)}}}class XI extends Oh{constructor(i){super(i,{});y(this,"device");y(this,"commands",[]);this.device=i}submitCommands(i=this.commands){for(const n of i)switch(n.name){case"copy-buffer-to-buffer":qI(this.device,n.options);break;case"copy-buffer-to-texture":YI(this.device,n.options);break;case"copy-texture-to-buffer":KI(this.device,n.options);break;case"copy-texture-to-texture":ZI(this.device,n.options);break}}}function qI(t,e){const i=e.source,n=e.destination;t.gl.bindBuffer(36662,i.handle),t.gl.bindBuffer(36663,n.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function YI(t,e){throw new Error("Not implemented")}function KI(t,e){const{source:i,mipLevel:n=0,aspect:s="all",width:r=e.source.width,height:o=e.source.height,depthOrArrayLayers:a=0,origin:c=[0,0],destination:l,byteOffset:u=0,bytesPerRow:h,rowsPerImage:f}=e;if(s!=="all")throw new Error("not supported");if(n!==0||a!==0||h||f)throw new Error("not implemented");const{framebuffer:d,destroyFramebuffer:p}=tv(i);let g;try{const _=l,b=r||d.width,T=o||d.height,v=wc(d.texture.props.format),E=v.dataFormat,R=v.type;t.gl.bindBuffer(35051,_.handle),g=t.gl.bindFramebuffer(36160,d.handle),t.gl.readPixels(c[0],c[1],b,T,E,R,u)}finally{t.gl.bindBuffer(35051,null),g!==void 0&&t.gl.bindFramebuffer(36160,g),p&&d.destroy()}}function ZI(t,e){const{source:i,destinationMipLevel:n=0,origin:s=[0,0],destinationOrigin:r=[0,0],destination:o}=e;let{width:a=e.destination.width,height:c=e.destination.height}=e;const{framebuffer:l,destroyFramebuffer:u}=tv(i),[h,f]=s,[d,p,g]=r,_=t.gl.bindFramebuffer(36160,l.handle);let b=null,T;if(o instanceof Ci)b=o,a=Number.isFinite(a)?a:b.width,c=Number.isFinite(c)?c:b.height,b.bind(0),T=b.target;else throw new Error("invalid destination");switch(T){case 3553:case 34067:t.gl.copyTexSubImage2D(T,n,d,p,h,f,a,c);break;case 35866:case 32879:t.gl.copyTexSubImage3D(T,n,d,p,g,h,f,a,c);break}b&&b.unbind(),t.gl.bindFramebuffer(36160,_),u&&l.destroy()}function tv(t){if(t instanceof Xt){const{width:e,height:i,id:n}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:i,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class GI extends Ih{constructor(i,n){super(i,n);y(this,"device");y(this,"commandBuffer");this.device=i,this.commandBuffer=new XI(i)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(i){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:i})}copyBufferToTexture(i){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:i})}copyTextureToBuffer(i){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:i})}copyTextureToTexture(i){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:i})}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}resolveQuerySet(i,n,s){}}class fd extends Nh{constructor(i,n){super(i,n);y(this,"device");y(this,"handle");y(this,"buffer",null);y(this,"bufferValue",null);this.device=i,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(i){return BE()==="Chrome"}destroy(){var i;super.destroy(),this.buffer&&((i=this.buffer)==null||i.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(i){const n=i;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(i,n){const s=n;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:r,type:o,stride:a,offset:c,normalized:l,integer:u,divisor:h}=this._getAccessor(i);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),u?this.device.gl.vertexAttribIPointer(i,r,o,a,c):this.device.gl.vertexAttribPointer(i,r,o,l,a,c),this.device.gl.enableVertexAttribArray(i),this.device.gl.vertexAttribDivisor(i,h||0),this.attributes[i]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(i,n){this._enable(i,!1),this.attributes[i]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let i=0;i<this.maxVertexAttributes;++i){const n=this.attributes[i];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(i,n)}}_getAccessor(i){const n=this.attributeInfos[i];if(!n)throw new Error(`Unknown attribute location ${i}`);const s=Y1(n.bufferDataType);return{size:n.bufferComponents,type:s,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(i,n=!0){const r=fd.isConstantAttributeZeroSupported(this.device)||i!==0;(n||r)&&(i=Number(i),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(i):this.device.gl.disableVertexAttribArray(i),this.device.gl.bindVertexArray(null))}getConstantBuffer(i,n){const s=JI(n),r=s.byteLength*i,o=s.length*i;if(this.buffer&&r!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${r} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),a=a||!QI(s,this.bufferValue),a){const c=P3(n.constructor,o);M3({target:c,source:s,start:0,count:o}),this.buffer.write(c),this.bufferValue=n}return this.buffer}}function JI(t){return Array.isArray(t)?new Float32Array(t):t}function QI(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}class eO extends kh{constructor(i,n){super(i,n);y(this,"device");y(this,"gl");y(this,"handle");y(this,"layout");y(this,"buffers",{});y(this,"unusedBuffers",{});y(this,"bindOnUse",!0);y(this,"_bound",!1);this.device=i,this.gl=i.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(i="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(HI(i))}end(){this.gl.endTransformFeedback(),this.bindOnUse||this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(i){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in i)this.setBuffer(n,i[n])})}setBuffer(i,n){const s=this._getVaryingIndex(i),{buffer:r,byteLength:o,byteOffset:a}=this._getBufferRange(n);if(s<0){this.unusedBuffers[i]=r,Y.warn(`${this.id} unusedBuffers varying buffer ${i}`)();return}this.buffers[s]={buffer:r,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(s,r,a,o)}getBuffer(i){if(v_(i))return this.buffers[i]||null;const n=this._getVaryingIndex(i);return n>=0?this.buffers[n]:null}bind(i=this.handle){if(typeof i!="function")return this.gl.bindTransformFeedback(36386,i),this;let n;return this._bound?n=i():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=i(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(i){if(i instanceof fn)return{buffer:i,byteOffset:0,byteLength:i.byteLength};const{buffer:n,byteOffset:s=0,byteLength:r=i.buffer.byteLength}=i;return{buffer:n,byteOffset:s,byteLength:r}}_getVaryingIndex(i){if(v_(i))return Number(i);for(const n of this.layout.varyings)if(i===n.name)return n.location;return-1}_bindBuffers(){for(const i in this.buffers){const{buffer:n,byteLength:s,byteOffset:r}=this._getBufferRange(this.buffers[i]);this._bindBuffer(Number(i),n,r,s)}}_unbindBuffers(){for(const i in this.buffers)this.gl.bindBufferBase(35982,Number(i),null)}_bindBuffer(i,n,s=0,r){const o=n&&n.handle;!o||r===void 0?this.gl.bindBufferBase(35982,i,o):this.gl.bindBufferRange(35982,i,o,s,r)}}function v_(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class tO extends Dh{constructor(i,n){super(i,n);y(this,"device");y(this,"handle");y(this,"target",null);y(this,"_queryPending",!1);y(this,"_pollingPromise",null);if(this.device=i,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(i){return this._begin(i!=null&&i.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(i){this._queryPending||(this.target=i,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const i=this.device.gl.getQueryParameter(this.handle,34919);return i&&(this._queryPending=!1),i}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(i=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((s,r)=>{const o=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):n++>i?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function iv(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ze(!1),0}}function iO(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return ze(!1),0}}function nO(t,e){var _,b;const{sourceX:i=0,sourceY:n=0,sourceFormat:s=6408,sourceAttachment:r=36064}=e||{};let{target:o=null,sourceWidth:a,sourceHeight:c,sourceType:l}=e||{};const{framebuffer:u,deleteFramebuffer:h}=nv(t);ze(u);const{gl:f,handle:d}=u;a=a||u.width,c=c||u.height;const p=r-36064;l=l||((b=(_=u.colorAttachments[p])==null?void 0:_.texture)==null?void 0:b.type)||5121,o=oO(o,l,s,a,c),l=l||xI(o);const g=f.bindFramebuffer(36160,d);return f.readPixels(i,n,a,c,s,l,o),f.bindFramebuffer(36160,g||null),h&&u.destroy(),o}function sO(t,e){const{target:i,sourceX:n=0,sourceY:s=0,sourceFormat:r=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:c,sourceType:l}=e||{};const{framebuffer:u,deleteFramebuffer:h}=nv(t);ze(u),a=a||u.width,c=c||u.height;const f=u;l=l||5121;let d=i;if(!d){const g=iv(r),_=iO(l),b=o+a*c*g*_;d=f.device.createBuffer({byteLength:b})}const p=t.device.createCommandEncoder();return p.copyTextureToBuffer({source:t,width:a,height:c,origin:[n,s],destination:d,byteOffset:o}),p.destroy(),h&&u.destroy(),d}function nv(t){return t instanceof pc?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:rO(t),deleteFramebuffer:!0}}function rO(t,e){const{device:i,width:n,height:s,id:r}=t;return i.createFramebuffer({...e,id:`framebuffer-for-${r}`,width:n,height:s,colorAttachments:[t]})}function oO(t,e,i,n,s){if(t)return t;e=e||5121;const r=Zh(e,{clamped:!1}),o=iv(i);return new r(n*s*o)}const aO=256,cO=1024,lO=16384,uO="clear: bad arguments";function hO(t,e){const{framebuffer:i=null,color:n=null,depth:s=null,stencil:r=null}=e||{},o={};i&&(o.framebuffer=i);let a=0;n&&(a|=lO,n!==!0&&(o.clearColor=n)),s&&(a|=aO,s!==!0&&(o.clearDepth=s)),r&&(a|=cO,s!==!0&&(o.clearStencil=s)),ze(a!==0,uO);const c=t.gl;cn(c,o,()=>{c.clear(a)})}const Fr=1,Fn=class Fn extends Wn{constructor(i){var c,l;super({...i,id:i.id||fs("webgl-device")});y(this,"type","webgl");y(this,"handle");y(this,"features");y(this,"limits");y(this,"info");y(this,"canvasContext");y(this,"lost");y(this,"_resolveContextLost");y(this,"renderPass",null);y(this,"gl");y(this,"debug",!1);y(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});y(this,"_extensions",{});y(this,"_polyfilled",!1);y(this,"spectorJS");y(this,"_constants");const n=(c=i.gl)==null?void 0:c.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);const s=((l=i.gl)==null?void 0:l.canvas)||i.canvas;this.canvasContext=new aI(this,{...i,canvas:s}),this.lost=new Promise(u=>{this._resolveContextLost=u});let r=i.gl||null;if(r||(r=RM(this.canvasContext.canvas,{...i,onContextLost:u=>{var h;return(h=this._resolveContextLost)==null?void 0:h.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!r)throw new Error("WebGL context creation failed");this.handle=r,this.gl=r,this.gl.device=this,this.gl._version=2,this.info=CM(this.gl,this._extensions),this.limits=new qM(this.gl),this.features=new XM(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:o=!0,copyState:a=!1}=i;X1(this.gl,{enable:o,copyState:a,log:(...u)=>Y.log(1,...u)()}),i.debug&&(this.gl=gI(this.gl,{...i,throwOnError:!0}),this.debug=!0,Y.level=Math.max(Y.level,1),Y.warn("WebGL debug mode activated. Performance reduced.")()),i.spector&&(this.spectorJS=fI({...this.props,canvas:this.handle.canvas}))}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(i){if(i instanceof Fn)return i;if((i==null?void 0:i.device)instanceof Wn)return i.device;if(!fO(i))throw new Error("Invalid WebGL2RenderingContext");return new Fn({gl:i})}static async create(i={}){var a;Y.groupCollapsed(Fr,"WebGLDevice created")();const n=[];i.debug&&n.push(pI()),i.spector&&n.push(hI()),typeof i.canvas=="string"&&n.push(ed.pageLoaded);const s=await Promise.allSettled(n);for(const c of s)c.status==="rejected"&&Y.error(`Failed to initialize debug libraries ${c.reason}`)();if(Y.probe(Fr+1,"DOM is loaded")(),(a=i.gl)!=null&&a.device)return Y.warn("reattaching existing device")(),Fn.attach(i.gl);const r=new Fn(i),o=`Created ${r.type}${r.debug?" debug":""} context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return Y.probe(Fr,o)(),Y.table(Fr,r.info)(),Y.groupEnd(Fr)(),r}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(i){return hd(this.gl,i,this._extensions)}isTextureFormatFilterable(i){return jM(this.gl,i,this._extensions)}isTextureFormatRenderable(i){return $M(this.gl,i,this._extensions)}createCanvasContext(i){throw new Error("WebGL only supports a single canvas")}createBuffer(i){const n=this._getBufferProps(i);return new fn(this,n)}_createTexture(i){return new Ci(this,i)}createExternalTexture(i){throw new Error("createExternalTexture() not implemented")}createSampler(i){return new Kh(this,i)}createShader(i){return new wI(this,i)}createFramebuffer(i){return new no(this,i)}createVertexArray(i){return new fd(this,i)}createTransformFeedback(i){return new eO(this,i)}createQuerySet(i){return new tO(this,i)}createRenderPipeline(i){return new WI(this,i)}beginRenderPass(i){return new RI(this,i)}createComputePipeline(i){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(i){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(i){return new GI(this,i)}submit(){var i;(i=this.renderPass)==null||i.end(),this.renderPass=null}readPixelsToArrayWebGL(i,n){return nO(i,n)}readPixelsToBufferWebGL(i,n){return sO(i,n)}setParametersWebGL(i){Sr(this.gl,i)}getParametersWebGL(i){return W1(this.gl,i)}withParametersWebGL(i,n){return cn(this.gl,i,n)}clearWebGL(i){hO(this,i)}resetWebGL(){Y.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),vM(this.gl)}loseDevice(){var r;let i=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(i=!0,s.loseContext()),(r=this._resolveContextLost)==null||r.call(this,{reason:"destroyed",message:"Application triggered context loss"}),i}pushState(){vl(this.gl)}popState(){Co(this.gl)}setSpectorMetadata(i,n){i.__SPECTOR_Metadata=n}getGLKey(i,n){n=n||this.gl2||this.gl;const s=Number(i);for(const r in n)if(n[r]===s)return`GL.${r}`;return String(i)}setConstantAttributeWebGL(i,n){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const r=this._constants[i];switch(r&&_O(r,n)&&Y.info(1,`setConstantAttributeWebGL(${i}) could have been skipped, value unchanged`)(),this._constants[i]=n,n.constructor){case Float32Array:dO(this,i,n);break;case Int32Array:pO(this,i,n);break;case Uint32Array:gO(this,i,n);break;default:ze(!1)}}getExtension(i){return _n(this.gl,i,this._extensions),this._extensions}};y(Fn,"type","webgl");let ro=Fn;function fO(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function dO(t,e,i){switch(i.length){case 1:t.gl.vertexAttrib1fv(e,i);break;case 2:t.gl.vertexAttrib2fv(e,i);break;case 3:t.gl.vertexAttrib3fv(e,i);break;case 4:t.gl.vertexAttrib4fv(e,i);break;default:ze(!1)}}function pO(t,e,i){t.gl.vertexAttribI4iv(e,i)}function gO(t,e,i){t.gl.vertexAttribI4uiv(e,i)}function _O(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}var sv={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,i,n,s){var r=["","webkit","Moz","MS","ms","o"],o=i.createElement("div"),a="function",c=Math.round,l=Math.abs,u=Date.now;function h(m,w,A){return setTimeout(v(m,A),w)}function f(m,w,A){return Array.isArray(m)?(d(m,A[w],A),!0):!1}function d(m,w,A){var N;if(m)if(m.forEach)m.forEach(w,A);else if(m.length!==s)for(N=0;N<m.length;)w.call(A,m[N],N,m),N++;else for(N in m)m.hasOwnProperty(N)&&w.call(A,m[N],N,m)}function p(m,w,A){var N="DEPRECATED METHOD: "+w+`
`+A+` AT 
`;return function(){var $=new Error("get-stack-trace"),G=$&&$.stack?$.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ce=e.console&&(e.console.warn||e.console.log);return ce&&ce.call(e.console,N,G),m.apply(this,arguments)}}var g;typeof Object.assign!="function"?g=function(w){if(w===s||w===null)throw new TypeError("Cannot convert undefined or null to object");for(var A=Object(w),N=1;N<arguments.length;N++){var $=arguments[N];if($!==s&&$!==null)for(var G in $)$.hasOwnProperty(G)&&(A[G]=$[G])}return A}:g=Object.assign;var _=p(function(w,A,N){for(var $=Object.keys(A),G=0;G<$.length;)(!N||N&&w[$[G]]===s)&&(w[$[G]]=A[$[G]]),G++;return w},"extend","Use `assign`."),b=p(function(w,A){return _(w,A,!0)},"merge","Use `assign`.");function T(m,w,A){var N=w.prototype,$;$=m.prototype=Object.create(N),$.constructor=m,$._super=N,A&&g($,A)}function v(m,w){return function(){return m.apply(w,arguments)}}function E(m,w){return typeof m==a?m.apply(w&&w[0]||s,w):m}function R(m,w){return m===s?w:m}function P(m,w,A){d(D(w),function(N){m.addEventListener(N,A,!1)})}function M(m,w,A){d(D(w),function(N){m.removeEventListener(N,A,!1)})}function U(m,w){for(;m;){if(m==w)return!0;m=m.parentNode}return!1}function O(m,w){return m.indexOf(w)>-1}function D(m){return m.trim().split(/\s+/g)}function I(m,w,A){if(m.indexOf&&!A)return m.indexOf(w);for(var N=0;N<m.length;){if(A&&m[N][A]==w||!A&&m[N]===w)return N;N++}return-1}function V(m){return Array.prototype.slice.call(m,0)}function k(m,w,A){for(var N=[],$=[],G=0;G<m.length;){var ce=w?m[G][w]:m[G];I($,ce)<0&&N.push(m[G]),$[G]=ce,G++}return A&&(w?N=N.sort(function(pt,Ct){return pt[w]>Ct[w]}):N=N.sort()),N}function B(m,w){for(var A,N,$=w[0].toUpperCase()+w.slice(1),G=0;G<r.length;){if(A=r[G],N=A?A+$:w,N in m)return N;G++}return s}var F=1;function ee(){return F++}function _e(m){var w=m.ownerDocument||m;return w.defaultView||w.parentWindow||e}var ae=/mobile|tablet|ip(ad|hone|od)|android/i,Ee="ontouchstart"in e,vt=B(e,"PointerEvent")!==s,ke=Ee&&ae.test(navigator.userAgent),Je="touch",Qe="pen",je="mouse",et="kinect",Zt=25,Ye=1,at=2,be=4,me=8,Ft=1,di=2,Re=4,Ce=8,ye=16,we=di|Re,Te=Ce|ye,$e=we|Te,Pt=["x","y"],He=["clientX","clientY"];function De(m,w){var A=this;this.manager=m,this.callback=w,this.element=m.element,this.target=m.options.inputTarget,this.domHandler=function(N){E(m.options.enable,[m])&&A.handler(N)},this.init()}De.prototype={handler:function(){},init:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P(_e(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M(_e(this.element),this.evWin,this.domHandler)}};function st(m){var w,A=m.options.inputClass;return A?w=A:vt?w=ms:ke?w=ys:Ee?w=W:w=Qt,new w(m,ct)}function ct(m,w,A){var N=A.pointers.length,$=A.changedPointers.length,G=w&Ye&&N-$===0,ce=w&(be|me)&&N-$===0;A.isFirst=!!G,A.isFinal=!!ce,G&&(m.session={}),A.eventType=w,q(m,A),m.emit("hammer.input",A),m.recognize(A),m.session.prevInput=A}function q(m,w){var A=m.session,N=w.pointers,$=N.length;A.firstInput||(A.firstInput=Gt(w)),$>1&&!A.firstMultiple?A.firstMultiple=Gt(w):$===1&&(A.firstMultiple=!1);var G=A.firstInput,ce=A.firstMultiple,ht=ce?ce.center:G.center,pt=w.center=En(N);w.timeStamp=u(),w.deltaTime=w.timeStamp-G.timeStamp,w.angle=gi(ht,pt),w.distance=pi(ht,pt),te(A,w),w.offsetDirection=Rt(w.deltaX,w.deltaY);var Ct=Jt(w.deltaTime,w.deltaX,w.deltaY);w.overallVelocityX=Ct.x,w.overallVelocityY=Ct.y,w.overallVelocity=l(Ct.x)>l(Ct.y)?Ct.x:Ct.y,w.scale=ce?Xi(ce.pointers,N):1,w.rotation=ce?Wi(ce.pointers,N):0,w.maxPointers=A.prevInput?w.pointers.length>A.prevInput.maxPointers?w.pointers.length:A.prevInput.maxPointers:w.pointers.length,Fe(A,w);var mi=m.element;U(w.srcEvent.target,mi)&&(mi=w.srcEvent.target),w.target=mi}function te(m,w){var A=w.center,N=m.offsetDelta||{},$=m.prevDelta||{},G=m.prevInput||{};(w.eventType===Ye||G.eventType===be)&&($=m.prevDelta={x:G.deltaX||0,y:G.deltaY||0},N=m.offsetDelta={x:A.x,y:A.y}),w.deltaX=$.x+(A.x-N.x),w.deltaY=$.y+(A.y-N.y)}function Fe(m,w){var A=m.lastInterval||w,N=w.timeStamp-A.timeStamp,$,G,ce,ht;if(w.eventType!=me&&(N>Zt||A.velocity===s)){var pt=w.deltaX-A.deltaX,Ct=w.deltaY-A.deltaY,mi=Jt(N,pt,Ct);G=mi.x,ce=mi.y,$=l(mi.x)>l(mi.y)?mi.x:mi.y,ht=Rt(pt,Ct),m.lastInterval=w}else $=A.velocity,G=A.velocityX,ce=A.velocityY,ht=A.direction;w.velocity=$,w.velocityX=G,w.velocityY=ce,w.direction=ht}function Gt(m){for(var w=[],A=0;A<m.pointers.length;)w[A]={clientX:c(m.pointers[A].clientX),clientY:c(m.pointers[A].clientY)},A++;return{timeStamp:u(),pointers:w,center:En(w),deltaX:m.deltaX,deltaY:m.deltaY}}function En(m){var w=m.length;if(w===1)return{x:c(m[0].clientX),y:c(m[0].clientY)};for(var A=0,N=0,$=0;$<w;)A+=m[$].clientX,N+=m[$].clientY,$++;return{x:c(A/w),y:c(N/w)}}function Jt(m,w,A){return{x:w/m||0,y:A/m||0}}function Rt(m,w){return m===w?Ft:l(m)>=l(w)?m<0?di:Re:w<0?Ce:ye}function pi(m,w,A){A||(A=Pt);var N=w[A[0]]-m[A[0]],$=w[A[1]]-m[A[1]];return Math.sqrt(N*N+$*$)}function gi(m,w,A){A||(A=Pt);var N=w[A[0]]-m[A[0]],$=w[A[1]]-m[A[1]];return Math.atan2($,N)*180/Math.PI}function Wi(m,w){return gi(w[1],w[0],He)+gi(m[1],m[0],He)}function Xi(m,w){return pi(w[0],w[1],He)/pi(m[0],m[1],He)}var Sn={mousedown:Ye,mousemove:at,mouseup:be},Pl="mousedown",Ml="mousemove mouseup";function Qt(){this.evEl=Pl,this.evWin=Ml,this.pressed=!1,De.apply(this,arguments)}T(Qt,De,{handler:function(w){var A=Sn[w.type];A&Ye&&w.button===0&&(this.pressed=!0),A&at&&w.which!==1&&(A=be),this.pressed&&(A&be&&(this.pressed=!1),this.callback(this.manager,A,{pointers:[w],changedPointers:[w],pointerType:je,srcEvent:w}))}});var An={pointerdown:Ye,pointermove:at,pointerup:be,pointercancel:me,pointerout:me},ei={2:Je,3:Qe,4:je,5:et},_s="pointerdown",Cr="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(_s="MSPointerDown",Cr="MSPointerMove MSPointerUp MSPointerCancel");function ms(){this.evEl=_s,this.evWin=Cr,De.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}T(ms,De,{handler:function(w){var A=this.store,N=!1,$=w.type.toLowerCase().replace("ms",""),G=An[$],ce=ei[w.pointerType]||w.pointerType,ht=ce==Je,pt=I(A,w.pointerId,"pointerId");G&Ye&&(w.button===0||ht)?pt<0&&(A.push(w),pt=A.length-1):G&(be|me)&&(N=!0),!(pt<0)&&(A[pt]=w,this.callback(this.manager,G,{pointers:A,changedPointers:[w],pointerType:ce,srcEvent:w}),N&&A.splice(pt,1))}});var jo={touchstart:Ye,touchmove:at,touchend:be,touchcancel:me},Il="touchstart",Ol="touchstart touchmove touchend touchcancel";function $o(){this.evTarget=Il,this.evWin=Ol,this.started=!1,De.apply(this,arguments)}T($o,De,{handler:function(w){var A=jo[w.type];if(A===Ye&&(this.started=!0),!!this.started){var N=Nl.call(this,w,A);A&(be|me)&&N[0].length-N[1].length===0&&(this.started=!1),this.callback(this.manager,A,{pointers:N[0],changedPointers:N[1],pointerType:Je,srcEvent:w})}}});function Nl(m,w){var A=V(m.touches),N=V(m.changedTouches);return w&(be|me)&&(A=k(A.concat(N),"identifier",!0)),[A,N]}var kl={touchstart:Ye,touchmove:at,touchend:be,touchcancel:me},Dl="touchstart touchmove touchend touchcancel";function ys(){this.evTarget=Dl,this.targetIds={},De.apply(this,arguments)}T(ys,De,{handler:function(w){var A=kl[w.type],N=Fl.call(this,w,A);N&&this.callback(this.manager,A,{pointers:N[0],changedPointers:N[1],pointerType:Je,srcEvent:w})}});function Fl(m,w){var A=V(m.touches),N=this.targetIds;if(w&(Ye|at)&&A.length===1)return N[A[0].identifier]=!0,[A,A];var $,G,ce=V(m.changedTouches),ht=[],pt=this.target;if(G=A.filter(function(Ct){return U(Ct.target,pt)}),w===Ye)for($=0;$<G.length;)N[G[$].identifier]=!0,$++;for($=0;$<ce.length;)N[ce[$].identifier]&&ht.push(ce[$]),w&(be|me)&&delete N[ce[$].identifier],$++;if(ht.length)return[k(G.concat(ht),"identifier",!0),ht]}var Ll=2500,X=25;function W(){De.apply(this,arguments);var m=v(this.handler,this);this.touch=new ys(this.manager,m),this.mouse=new Qt(this.manager,m),this.primaryTouch=null,this.lastTouches=[]}T(W,De,{handler:function(w,A,N){var $=N.pointerType==Je,G=N.pointerType==je;if(!(G&&N.sourceCapabilities&&N.sourceCapabilities.firesTouchEvents)){if($)ie.call(this,A,N);else if(G&&Q.call(this,N))return;this.callback(w,A,N)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ie(m,w){m&Ye?(this.primaryTouch=w.changedPointers[0].identifier,ne.call(this,w)):m&(be|me)&&ne.call(this,w)}function ne(m){var w=m.changedPointers[0];if(w.identifier===this.primaryTouch){var A={x:w.clientX,y:w.clientY};this.lastTouches.push(A);var N=this.lastTouches,$=function(){var G=N.indexOf(A);G>-1&&N.splice(G,1)};setTimeout($,Ll)}}function Q(m){for(var w=m.srcEvent.clientX,A=m.srcEvent.clientY,N=0;N<this.lastTouches.length;N++){var $=this.lastTouches[N],G=Math.abs(w-$.x),ce=Math.abs(A-$.y);if(G<=X&&ce<=X)return!0}return!1}var Se=B(o.style,"touchAction"),xe=Se!==s,Pe="compute",lt="auto",ut="manipulation",tt="none",Mt="pan-x",Rn="pan-y",vs=Ub();function xr(m,w){this.manager=m,this.set(w)}xr.prototype={set:function(m){m==Pe&&(m=this.compute()),xe&&this.manager.element.style&&vs[m]&&(this.manager.element.style[Se]=m),this.actions=m.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var m=[];return d(this.manager.recognizers,function(w){E(w.options.enable,[w])&&(m=m.concat(w.getTouchAction()))}),Bb(m.join(" "))},preventDefaults:function(m){var w=m.srcEvent,A=m.offsetDirection;if(this.manager.session.prevented){w.preventDefault();return}var N=this.actions,$=O(N,tt)&&!vs[tt],G=O(N,Rn)&&!vs[Rn],ce=O(N,Mt)&&!vs[Mt];if($){var ht=m.pointers.length===1,pt=m.distance<2,Ct=m.deltaTime<250;if(ht&&pt&&Ct)return}if(!(ce&&G)&&($||G&&A&we||ce&&A&Te))return this.preventSrc(w)},preventSrc:function(m){this.manager.session.prevented=!0,m.preventDefault()}};function Bb(m){if(O(m,tt))return tt;var w=O(m,Mt),A=O(m,Rn);return w&&A?tt:w||A?w?Mt:Rn:O(m,ut)?ut:lt}function Ub(){if(!xe)return!1;var m={},w=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(A){m[A]=w?e.CSS.supports("touch-action",A):!0}),m}var Ho=1,Vt=2,bs=4,qi=8,Ii=qi,Pr=16,_i=32;function Oi(m){this.options=g({},this.defaults,m||{}),this.id=ee(),this.manager=null,this.options.enable=R(this.options.enable,!0),this.state=Ho,this.simultaneous={},this.requireFail=[]}Oi.prototype={defaults:{},set:function(m){return g(this.options,m),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(m){if(f(m,"recognizeWith",this))return this;var w=this.simultaneous;return m=Wo(m,this),w[m.id]||(w[m.id]=m,m.recognizeWith(this)),this},dropRecognizeWith:function(m){return f(m,"dropRecognizeWith",this)?this:(m=Wo(m,this),delete this.simultaneous[m.id],this)},requireFailure:function(m){if(f(m,"requireFailure",this))return this;var w=this.requireFail;return m=Wo(m,this),I(w,m)===-1&&(w.push(m),m.requireFailure(this)),this},dropRequireFailure:function(m){if(f(m,"dropRequireFailure",this))return this;m=Wo(m,this);var w=I(this.requireFail,m);return w>-1&&this.requireFail.splice(w,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(m){return!!this.simultaneous[m.id]},emit:function(m){var w=this,A=this.state;function N($){w.manager.emit($,m)}A<qi&&N(w.options.event+Fd(A)),N(w.options.event),m.additionalEvent&&N(m.additionalEvent),A>=qi&&N(w.options.event+Fd(A))},tryEmit:function(m){if(this.canEmit())return this.emit(m);this.state=_i},canEmit:function(){for(var m=0;m<this.requireFail.length;){if(!(this.requireFail[m].state&(_i|Ho)))return!1;m++}return!0},recognize:function(m){var w=g({},m);if(!E(this.options.enable,[this,w])){this.reset(),this.state=_i;return}this.state&(Ii|Pr|_i)&&(this.state=Ho),this.state=this.process(w),this.state&(Vt|bs|qi|Pr)&&this.tryEmit(w)},process:function(m){},getTouchAction:function(){},reset:function(){}};function Fd(m){return m&Pr?"cancel":m&qi?"end":m&bs?"move":m&Vt?"start":""}function Ld(m){return m==ye?"down":m==Ce?"up":m==di?"left":m==Re?"right":""}function Wo(m,w){var A=w.manager;return A?A.get(m):m}function ti(){Oi.apply(this,arguments)}T(ti,Oi,{defaults:{pointers:1},attrTest:function(m){var w=this.options.pointers;return w===0||m.pointers.length===w},process:function(m){var w=this.state,A=m.eventType,N=w&(Vt|bs),$=this.attrTest(m);return N&&(A&me||!$)?w|Pr:N||$?A&be?w|qi:w&Vt?w|bs:Vt:_i}});function Xo(){ti.apply(this,arguments),this.pX=null,this.pY=null}T(Xo,ti,{defaults:{event:"pan",threshold:10,pointers:1,direction:$e},getTouchAction:function(){var m=this.options.direction,w=[];return m&we&&w.push(Rn),m&Te&&w.push(Mt),w},directionTest:function(m){var w=this.options,A=!0,N=m.distance,$=m.direction,G=m.deltaX,ce=m.deltaY;return $&w.direction||(w.direction&we?($=G===0?Ft:G<0?di:Re,A=G!=this.pX,N=Math.abs(m.deltaX)):($=ce===0?Ft:ce<0?Ce:ye,A=ce!=this.pY,N=Math.abs(m.deltaY))),m.direction=$,A&&N>w.threshold&&$&w.direction},attrTest:function(m){return ti.prototype.attrTest.call(this,m)&&(this.state&Vt||!(this.state&Vt)&&this.directionTest(m))},emit:function(m){this.pX=m.deltaX,this.pY=m.deltaY;var w=Ld(m.direction);w&&(m.additionalEvent=this.options.event+w),this._super.emit.call(this,m)}});function Bl(){ti.apply(this,arguments)}T(Bl,ti,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[tt]},attrTest:function(m){return this._super.attrTest.call(this,m)&&(Math.abs(m.scale-1)>this.options.threshold||this.state&Vt)},emit:function(m){if(m.scale!==1){var w=m.scale<1?"in":"out";m.additionalEvent=this.options.event+w}this._super.emit.call(this,m)}});function Ul(){Oi.apply(this,arguments),this._timer=null,this._input=null}T(Ul,Oi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[lt]},process:function(m){var w=this.options,A=m.pointers.length===w.pointers,N=m.distance<w.threshold,$=m.deltaTime>w.time;if(this._input=m,!N||!A||m.eventType&(be|me)&&!$)this.reset();else if(m.eventType&Ye)this.reset(),this._timer=h(function(){this.state=Ii,this.tryEmit()},w.time,this);else if(m.eventType&be)return Ii;return _i},reset:function(){clearTimeout(this._timer)},emit:function(m){this.state===Ii&&(m&&m.eventType&be?this.manager.emit(this.options.event+"up",m):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function zl(){ti.apply(this,arguments)}T(zl,ti,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[tt]},attrTest:function(m){return this._super.attrTest.call(this,m)&&(Math.abs(m.rotation)>this.options.threshold||this.state&Vt)}});function Vl(){ti.apply(this,arguments)}T(Vl,ti,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:we|Te,pointers:1},getTouchAction:function(){return Xo.prototype.getTouchAction.call(this)},attrTest:function(m){var w=this.options.direction,A;return w&(we|Te)?A=m.overallVelocity:w&we?A=m.overallVelocityX:w&Te&&(A=m.overallVelocityY),this._super.attrTest.call(this,m)&&w&m.offsetDirection&&m.distance>this.options.threshold&&m.maxPointers==this.options.pointers&&l(A)>this.options.velocity&&m.eventType&be},emit:function(m){var w=Ld(m.offsetDirection);w&&this.manager.emit(this.options.event+w,m),this.manager.emit(this.options.event,m)}});function qo(){Oi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}T(qo,Oi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ut]},process:function(m){var w=this.options,A=m.pointers.length===w.pointers,N=m.distance<w.threshold,$=m.deltaTime<w.time;if(this.reset(),m.eventType&Ye&&this.count===0)return this.failTimeout();if(N&&$&&A){if(m.eventType!=be)return this.failTimeout();var G=this.pTime?m.timeStamp-this.pTime<w.interval:!0,ce=!this.pCenter||pi(this.pCenter,m.center)<w.posThreshold;this.pTime=m.timeStamp,this.pCenter=m.center,!ce||!G?this.count=1:this.count+=1,this._input=m;var ht=this.count%w.taps;if(ht===0)return this.hasRequireFailures()?(this._timer=h(function(){this.state=Ii,this.tryEmit()},w.interval,this),Vt):Ii}return _i},failTimeout:function(){return this._timer=h(function(){this.state=_i},this.options.interval,this),_i},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ii&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ni(m,w){return w=w||{},w.recognizers=R(w.recognizers,Ni.defaults.preset),new jl(m,w)}Ni.VERSION="2.0.7",Ni.defaults={domEvents:!1,touchAction:Pe,enable:!0,inputTarget:null,inputClass:null,preset:[[zl,{enable:!1}],[Bl,{enable:!1},["rotate"]],[Vl,{direction:we}],[Xo,{direction:we},["swipe"]],[qo],[qo,{event:"doubletap",taps:2},["tap"]],[Ul]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var zb=1,Bd=2;function jl(m,w){this.options=g({},Ni.defaults,w||{}),this.options.inputTarget=this.options.inputTarget||m,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=m,this.input=st(this),this.touchAction=new xr(this,this.options.touchAction),Ud(this,!0),d(this.options.recognizers,function(A){var N=this.add(new A[0](A[1]));A[2]&&N.recognizeWith(A[2]),A[3]&&N.requireFailure(A[3])},this)}jl.prototype={set:function(m){return g(this.options,m),m.touchAction&&this.touchAction.update(),m.inputTarget&&(this.input.destroy(),this.input.target=m.inputTarget,this.input.init()),this},stop:function(m){this.session.stopped=m?Bd:zb},recognize:function(m){var w=this.session;if(!w.stopped){this.touchAction.preventDefaults(m);var A,N=this.recognizers,$=w.curRecognizer;(!$||$&&$.state&Ii)&&($=w.curRecognizer=null);for(var G=0;G<N.length;)A=N[G],w.stopped!==Bd&&(!$||A==$||A.canRecognizeWith($))?A.recognize(m):A.reset(),!$&&A.state&(Vt|bs|qi)&&($=w.curRecognizer=A),G++}},get:function(m){if(m instanceof Oi)return m;for(var w=this.recognizers,A=0;A<w.length;A++)if(w[A].options.event==m)return w[A];return null},add:function(m){if(f(m,"add",this))return this;var w=this.get(m.options.event);return w&&this.remove(w),this.recognizers.push(m),m.manager=this,this.touchAction.update(),m},remove:function(m){if(f(m,"remove",this))return this;if(m=this.get(m),m){var w=this.recognizers,A=I(w,m);A!==-1&&(w.splice(A,1),this.touchAction.update())}return this},on:function(m,w){if(m!==s&&w!==s){var A=this.handlers;return d(D(m),function(N){A[N]=A[N]||[],A[N].push(w)}),this}},off:function(m,w){if(m!==s){var A=this.handlers;return d(D(m),function(N){w?A[N]&&A[N].splice(I(A[N],w),1):delete A[N]}),this}},emit:function(m,w){this.options.domEvents&&Vb(m,w);var A=this.handlers[m]&&this.handlers[m].slice();if(!(!A||!A.length)){w.type=m,w.preventDefault=function(){w.srcEvent.preventDefault()};for(var N=0;N<A.length;)A[N](w),N++}},destroy:function(){this.element&&Ud(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ud(m,w){var A=m.element;if(A.style){var N;d(m.options.cssProps,function($,G){N=B(A.style,G),w?(m.oldCssProps[N]=A.style[N],A.style[N]=$):A.style[N]=m.oldCssProps[N]||""}),w||(m.oldCssProps={})}}function Vb(m,w){var A=i.createEvent("Event");A.initEvent(m,!0,!0),A.gesture=w,w.target.dispatchEvent(A)}g(Ni,{INPUT_START:Ye,INPUT_MOVE:at,INPUT_END:be,INPUT_CANCEL:me,STATE_POSSIBLE:Ho,STATE_BEGAN:Vt,STATE_CHANGED:bs,STATE_ENDED:qi,STATE_RECOGNIZED:Ii,STATE_CANCELLED:Pr,STATE_FAILED:_i,DIRECTION_NONE:Ft,DIRECTION_LEFT:di,DIRECTION_RIGHT:Re,DIRECTION_UP:Ce,DIRECTION_DOWN:ye,DIRECTION_HORIZONTAL:we,DIRECTION_VERTICAL:Te,DIRECTION_ALL:$e,Manager:jl,Input:De,TouchAction:xr,TouchInput:ys,MouseInput:Qt,PointerEventInput:ms,TouchMouseInput:W,SingleTouchInput:$o,Recognizer:Oi,AttrRecognizer:ti,Tap:qo,Pan:Xo,Swipe:Vl,Pinch:Bl,Rotate:zl,Press:Ul,on:P,off:M,each:d,merge:b,extend:_,assign:g,inherit:T,bindFn:v,prefixed:B});var jb=typeof e<"u"?e:typeof self<"u"?self:{};jb.Hammer=Ni,typeof s=="function"&&s.amd?s(function(){return Ni}):t.exports?t.exports=Ni:e[n]=Ni})(window,document,"Hammer")})(sv);var Uo=sv.exports;const mO=kf(Uo),wi=iw({__proto__:null,default:mO},[Uo]),rv=1,ov=2,Gh=4,yO={mousedown:rv,mousemove:ov,mouseup:Gh};function vO(t,e){for(let i=0;i<t.length;i++)if(e(t[i]))return!0;return!1}function bO(t){const e=t.prototype.handler;t.prototype.handler=function(n){const s=this.store;n.button>0&&n.type==="pointerdown"&&(vO(s,r=>r.pointerId===n.pointerId)||s.push(n)),e.call(this,n)}}function wO(t){t.prototype.handler=function(i){let n=yO[i.type];n&rv&&i.button>=0&&(this.pressed=!0),n&ov&&i.which===0&&(n=Gh),this.pressed&&(n&Gh&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[i],changedPointers:[i],pointerType:"mouse",srcEvent:i}))}}bO(Uo.PointerEventInput);wO(Uo.MouseInput);const TO=Uo.Manager;class wl{constructor(e,i,n){this.element=e,this.callback=i,this.options={enable:!0,...n}}}const EO=wi?[[wi.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[wi.Rotate,{enable:!1}],[wi.Pinch,{enable:!1}],[wi.Swipe,{enable:!1}],[wi.Pan,{threshold:0,enable:!1}],[wi.Press,{enable:!1}],[wi.Tap,{event:"doubletap",taps:2,enable:!1}],[wi.Tap,{event:"anytap",enable:!1}],[wi.Tap,{enable:!1}]]:null,b_={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},SO={doubletap:["tap"]},AO={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},dd={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},RO={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},w_={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},CO=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",$s=typeof window<"u"?window:global;let Jh=!1;try{const t={get passive(){return Jh=!0,!0}};$s.addEventListener("test",null,t),$s.removeEventListener("test",null)}catch{Jh=!1}const xO=CO.indexOf("firefox")!==-1,{WHEEL_EVENTS:PO}=dd,T_="wheel",E_=4.000244140625,MO=40,IO=.25;class OO extends wl{constructor(e,i,n){super(e,i,n),this.handleEvent=s=>{if(!this.options.enable)return;let r=s.deltaY;$s.WheelEvent&&(xO&&s.deltaMode===$s.WheelEvent.DOM_DELTA_PIXEL&&(r/=$s.devicePixelRatio),s.deltaMode===$s.WheelEvent.DOM_DELTA_LINE&&(r*=MO)),r!==0&&r%E_===0&&(r=Math.floor(r/E_)),s.shiftKey&&r&&(r=r*IO),this.callback({type:T_,center:{x:s.clientX,y:s.clientY},delta:-r,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat(PO),this.events.forEach(s=>e.addEventListener(s,this.handleEvent,Jh?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===T_&&(this.options.enable=i)}}const{MOUSE_EVENTS:NO}=dd,S_="pointermove",A_="pointerover",R_="pointerout",C_="pointerenter",x_="pointerleave";class kO extends wl{constructor(e,i,n){super(e,i,n),this.handleEvent=r=>{this.handleOverEvent(r),this.handleOutEvent(r),this.handleEnterEvent(r),this.handleLeaveEvent(r),this.handleMoveEvent(r)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(NO),this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===S_&&(this.enableMoveEvent=i),e===A_&&(this.enableOverEvent=i),e===R_&&(this.enableOutEvent=i),e===C_&&(this.enableEnterEvent=i),e===x_&&(this.enableLeaveEvent=i)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(A_,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(R_,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(C_,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(x_,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(S_,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,i){this.callback({type:e,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const{KEY_EVENTS:DO}=dd,P_="keydown",M_="keyup";class FO extends wl{constructor(e,i,n){super(e,i,n),this.handleEvent=s=>{const r=s.target||s.srcElement;r.tagName==="INPUT"&&r.type==="text"||r.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:P_,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:M_,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(DO),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===P_&&(this.enableDownEvent=i),e===M_&&(this.enableUpEvent=i)}}const I_="contextmenu";class LO extends wl{constructor(e,i,n){super(e,i,n),this.handleEvent=s=>{this.options.enable&&this.callback({type:I_,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,i){e===I_&&(this.options.enable=i)}}const Qh=1,Tc=2,ef=4,BO={pointerdown:Qh,pointermove:Tc,pointerup:ef,mousedown:Qh,mousemove:Tc,mouseup:ef},UO=1,zO=2,VO=3,jO=0,$O=1,HO=2,WO=1,XO=2,qO=4;function YO(t){const e=BO[t.srcEvent.type];if(!e)return null;const{buttons:i,button:n,which:s}=t.srcEvent;let r=!1,o=!1,a=!1;return e===ef||e===Tc&&!Number.isFinite(i)?(r=s===UO,o=s===zO,a=s===VO):e===Tc?(r=!!(i&WO),o=!!(i&qO),a=!!(i&XO)):e===Qh&&(r=n===jO,o=n===$O,a=n===HO),{leftButton:r,middleButton:o,rightButton:a}}function KO(t,e){const i=t.center;if(!i)return null;const n=e.getBoundingClientRect(),s=n.width/e.offsetWidth||1,r=n.height/e.offsetHeight||1,o={x:(i.x-n.left-e.clientLeft)/s,y:(i.y-n.top-e.clientTop)/r};return{center:i,offsetCenter:o}}const Au={srcElement:"root",priority:0};class ZO{constructor(e){this.handleEvent=i=>{if(this.isEmpty())return;const n=this._normalizeEvent(i);let s=i.srcEvent.target;for(;s&&s!==n.rootElement;){if(this._emit(n,s),n.handled)return;s=s.parentNode}this._emit(n,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,i,n,s=!1,r=!1){const{handlers:o,handlersByElement:a}=this;let c=Au;typeof n=="string"||n&&n.addEventListener?c={...Au,srcElement:n}:n&&(c={...Au,...n});let l=a.get(c.srcElement);l||(l=[],a.set(c.srcElement,l));const u={type:e,handler:i,srcElement:c.srcElement,priority:c.priority};s&&(u.once=!0),r&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let h=l.length-1;for(;h>=0&&!(l[h].priority>=u.priority);)h--;l.splice(h+1,0,u)}remove(e,i){const{handlers:n,handlersByElement:s}=this;for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.type===e&&o.handler===i){n.splice(r,1);const a=s.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&s.delete(o.srcElement)}}this._active=n.some(r=>!r.passive)}_emit(e,i){const n=this.handlersByElement.get(i);if(n){let s=!1;const r=()=>{e.handled=!0},o=()=>{e.handled=!0,s=!0},a=[];for(let c=0;c<n.length;c++){const{type:l,handler:u,once:h}=n[c];if(u({...e,type:l,stopPropagation:r,stopImmediatePropagation:o}),h&&a.push(n[c]),s)break}for(let c=0;c<a.length;c++){const{type:l,handler:u}=a[c];this.remove(l,u)}}}_normalizeEvent(e){const i=this.eventManager.getElement();return{...e,...YO(e),...KO(e,i),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}const GO={events:null,recognizers:null,recognizerOptions:{},Manager:TO,touchAction:"none",tabIndex:0};class JO{constructor(e=null,i){this._onBasicInput=s=>{const{srcEvent:r}=s,o=AO[r.type];o&&this.manager.emit(o,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...GO,...i},this.events=new Map,this.setElement(e);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:i}=this,n=i.Manager;this.manager=new n(e,{touchAction:i.touchAction,recognizers:i.recognizers||EO}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(b_).forEach(s=>{const r=this.manager.get(s);r&&b_[s].forEach(o=>{r.recognizeWith(o)})});for(const s in i.recognizerOptions){const r=this.manager.get(s);if(r){const o=i.recognizerOptions[s];delete o.enable,r.set(o)}}this.wheelInput=new OO(e,this._onOtherEvent,{enable:!1}),this.moveInput=new kO(e,this._onOtherEvent,{enable:!1}),this.keyInput=new FO(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new LO(e,this._onOtherEvent,{enable:!1});for(const[s,r]of this.events)r.isEmpty()||(this._toggleRecognizer(r.recognizerName,!0),this.manager.on(s,r.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,i,n){this._addEventHandler(e,i,n,!1)}once(e,i,n){this._addEventHandler(e,i,n,!0)}watch(e,i,n){this._addEventHandler(e,i,n,!1,!0)}off(e,i){this._removeEventHandler(e,i)}_toggleRecognizer(e,i){const{manager:n}=this;if(!n)return;const s=n.get(e);if(s&&s.options.enable!==i){s.set({enable:i});const r=SO[e];r&&!this.options.recognizers&&r.forEach(o=>{const a=n.get(o);i?(a.requireFailure(e),s.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,i),this.moveInput.enableEventType(e,i),this.keyInput.enableEventType(e,i),this.contextmenuInput.enableEventType(e,i)}_addEventHandler(e,i,n,s,r){if(typeof e!="string"){n=i;for(const u in e)this._addEventHandler(u,e[u],n,s,r);return}const{manager:o,events:a}=this,c=w_[e]||e;let l=a.get(c);l||(l=new ZO(this),a.set(c,l),l.recognizerName=RO[c]||c,o&&o.on(c,l.handleEvent)),l.add(e,i,n,s,r),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(e,i){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:n}=this,s=w_[e]||e,r=n.get(s);if(r&&(r.remove(e,i),r.isEmpty())){const{recognizerName:o}=r;let a=!1;for(const c of n.values())if(c.recognizerName===o&&!c.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function Gi(){}const QO=({isDragging:t})=>t?"grabbing":"grab",O_={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Gi,onWebGLInitialized:Gi,onResize:Gi,onViewStateChange:Gi,onInteractionStateChange:Gi,onBeforeRender:Gi,onAfterRender:Gi,onLoad:Gi,onError:t=>fe.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:QO,getTooltip:null,debug:!1,drawPickingColors:!1},Kc=class Kc{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Do({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:s}=this;if(n.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(n.leftButton||n.rightButton)return;{const r=n.offsetCenter;if(!r)return;s.x=r.x,s.y=r.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=n},this._onEvent=n=>{const s=zh[n.type],r=n.offsetCenter;if(!s||!r||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:o,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:c}=a,l=c&&(c[s.handler]||c.props[s.handler]),u=this.props[s.handler];let h=!1;l&&(h=l.call(c,a,n)),h||(u==null||u(a,n),this.widgetManager.onEvent(a,n))},this._onPointerDown=n=>{const s=n.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo},this.props={...O_,...e},e=this.props,e.viewState&&e.initialViewState&&fe.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&fe.error("WebGL1 context not supported.")(),this.device=ro.attach(e.gl));let i=this.device;i||(Xn.registerDevices([ro]),i=Xn.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(i,e),this.setProps(e),e._typedArrayManagerProps&&pr.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,i,n,s,r,o,a,c,l,u;(e=this.animationLoop)==null||e.stop(),(i=this.animationLoop)==null||i.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(r=this.effectManager)==null||r.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(c=this.eventManager)==null||c.destroy(),this.eventManager=null,(l=this.widgetManager)==null||l.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((u=this.canvas.parentElement)==null||u.removeChild(this.canvas),this.canvas=null)}setProps(e){var n;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&fe.removed("onLayerHover","onHover")(),"onLayerClick"in e&&fe.removed("onLayerClick","onClick")(),e.initialViewState&&!li(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(n=this.animationLoop)==null||n.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i),this.widgetManager.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),r=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return i=i||n||s||r||o,i}redraw(e){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=e||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return _t(this.viewManager),this.viewManager.views}getViewports(e){return _t(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const i=this._pick("pickObject","pickObject Time",e).result;return i.length?i[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,i=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:i})}_removeResources(e){for(const i of e)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var i;(i=this.layerManager)==null||i.removeDefaultShaderModule(e)}_pick(e,i,n){_t(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(i).timeStart();const r=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return s.get(i).timeEnd(),r}_createCanvas(e){let i=e.canvas;return typeof i=="string"&&(i=document.getElementById(i),_t(i)),i||(i=document.createElement("canvas"),i.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(i)),Object.assign(i.style,e.style),i}_setCanvasSize(e){var s;if(!this.canvas)return;const{width:i,height:n}=e;if(i||i===0){const r=Number.isFinite(i)?`${i}px`:i;this.canvas.style.width=r}if(n||n===0){const r=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=((s=e.style)==null?void 0:s.position)||"absolute",this.canvas.style.height=r}}_updateCanvasSize(){var s,r;const{canvas:e}=this;if(!e)return;const i=e.clientWidth??e.width,n=e.clientHeight??e.height;(i!==this.width||n!==this.height)&&(this.width=i,this.height=n,(s=this.viewManager)==null||s.setProps({width:i,height:n}),(r=this.layerManager)==null||r.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:n}))}_createAnimationLoop(e,i){const{gl:n,onError:s,useDevicePixels:r}=i;return new EP({device:e,useDevicePixels:r,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,i=Array.isArray(e)?e:e?[e]:[new qh({id:"default-view"})];return i.length&&this.props.controller&&(i[0].props.controller=this.props.controller),i}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var i,n,s;const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let a=o,c=!1;for(const l of r)a=l,c=((i=l.layer)==null?void 0:i.onHover(l,e.event))||c;c||((s=(n=this.props).onHover)==null||s.call(n,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var s,r;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(s=this.device.canvasContext)==null?void 0:s.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof ro&&this.props.onWebGLInitialized(this.device.gl);const i=new L1;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new JO(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in zh)this.eventManager.on(o,this._onEvent);this.viewManager=new VP({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new zP(this.device,{deck:this,stats:this.stats,viewport:n,timeline:i}),this.effectManager=new tM({deck:this,device:this.device}),this.deckRenderer=new sM(this.device),this.deckPicker=new uM(this.device),this.widgetManager=new dM({deck:this,parentElement:(r=this.canvas)==null?void 0:r.parentElement}),this.widgetManager.addDefault(new gM),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,i){var o;const{device:n,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:s});const r={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i};(o=this.deckRenderer)==null||o.renderLayers(r),r.pass==="screen"&&this.widgetManager.onRedraw({viewports:r.viewports,layers:r.layers}),this.props.onAfterRender({device:n,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),fe.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const i=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const i=this.animationLoop.stats;e.get("GPU Time").addTime(i.get("GPU Time").lastTiming),e.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:i}=this;e.fps=i.get("frameRate").getHz(),e.setPropsTime=i.get("setProps Time").time,e.updateAttributesTime=i.get("Update Attributes").time,e.framesRedrawn=i.get("Redraw Count").count,e.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,e.pickCount=i.get("Pick Count").count,e.gpuTime=i.get("GPU Time").time,e.cpuTime=i.get("CPU Time").time,e.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const n=Xn.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}};Kc.defaultProps=O_,Kc.VERSION=h2;let tf=Kc;function eN(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Jy(t)}}const tN=Gy;function va(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Vn(t){return t.stride||t.size*t.bytesPerElement}function iN(t,e){return t.type===e.type&&t.size===e.size&&Vn(t)===Vn(e)&&(t.offset||0)===(e.offset||0)}function nf(t,e){e.offset&&fe.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=Vn(t),n=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,s=e.elementOffset||0,r=n*i+s*t.bytesPerElement+(t.offset||0);return{...e,offset:r,stride:i}}function nN(t,e){const i=nf(t,e);return{high:i,low:{...i,offset:i.offset+t.size*4}}}class sN{constructor(e,i,n){this._buffer=null,this.device=e,this.id=i.id||"",this.size=i.size||1;const s=i.logicalType||i.type,r=s==="float64";let{defaultValue:o}=i;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;r?a="float32":!s&&i.isIndexed?a="uint32":a=s||"float32";let c=eN(s||a);this.doublePrecision=r,r&&i.fp64===!1&&(c=Float32Array),this.value=null,this.settings={...i,defaultType:c,defaultValue:o,logicalType:s,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:c.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Vn(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),pr.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,i=null){const n={};if(this.state.constant){const s=this.value;if(i){const r=nf(this.getAccessor(),i),o=r.offset/s.BYTES_PER_ELEMENT,a=r.size||this.size;n[e]=s.subarray(o,o+a)}else n[e]=s}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}getBufferLayout(e=this.id,i=null){const n=this.getAccessor(),s=[],r={name:this.id,byteStride:Vn(n),attributes:s};if(this.doublePrecision){const o=nN(n,i||{});s.push(va(e,{...n,...o.high}),va(`${e}64Low`,{...n,...o.low}))}else if(i){const o=nf(n,i);s.push(va(e,{...n,...o}))}else s.push(va(e,n));return r}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const i=Array.from(this.value);e=[i,i]}else{const{value:i,numInstances:n,size:s}=this,r=n*s;if(i&&r&&i.length>=r){const o=new Array(s).fill(1/0),a=new Array(s).fill(-1/0);for(let c=0;c<r;)for(let l=0;l<s;l++){const u=i[c++];u<o[l]&&(o[l]=u),u>a[l]&&(a[l]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:i}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof qe?n={buffer:e}:n=e;const s={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)s.type="float32";else{const o=tN(n.value);s.type=s.normalized?o.replace("int","norm"):o}s.bytesPerElement=n.value.BYTES_PER_ELEMENT,s.stride=Vn(s)}if(i.bounds=null,n.constant){let r=n.value;if(r=this._normalizeValue(r,[],0),this.settings.normalized&&(r=this.normalizeConstant(r)),!(!i.constant||!this._areValuesEqual(r,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(r)?r:new Float32Array(r)}else if(n.buffer){const r=n.buffer;i.externalBuffer=r,i.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let r=n.value;i.externalBuffer=null,i.constant=!1,this.value=r;let{buffer:o}=this;const a=Vn(s),c=(s.vertexOffset||0)*a;if(this.doublePrecision&&r instanceof Float64Array&&(r=fu(r,s)),this.settings.isIndexed){const u=this.settings.defaultType;r.constructor!==u&&(r=new u(r))}const l=r.byteLength+c+a*2;(!o||o.byteLength<l)&&(o=this._createBuffer(l)),o.write(r,c)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const i=this.value,{startOffset:n=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&i instanceof Float64Array?fu(i,{size:this.size,startIndex:n,endIndex:s}):i.subarray(n,s),n*i.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,i=!1){const{state:n}=this,s=n.allocatedValue,r=pr.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=r;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<r.byteLength+o)&&(a=this._createBuffer(r.byteLength+o),i&&s&&a.write(s instanceof Float64Array?fu(s,this):s,o)),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:i}=e;if(!ArrayBuffer.isView(i))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=i.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${i.constructor.name}`);!(i instanceof n)&&this.settings.normalized&&!("normalized"in e)&&fe.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(i=>(i+128)/255*2-1);case"snorm16":return new Float32Array(e).map(i=>(i+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(i=>i/255);case"unorm16":return new Float32Array(e).map(i=>i/65535);default:return e}}_normalizeValue(e,i,n){const{defaultValue:s,size:r}=this.settings;if(Number.isFinite(e))return i[n]=e,i;if(!e){let o=r;for(;--o>=0;)i[n+o]=s[o];return i}switch(r){case 4:i[n+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:i[n+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:i[n+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:i[n+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let o=r;for(;--o>=0;)i[n+o]=Number.isFinite(e[o])?e[o]:s[o]}return i}_areValuesEqual(e,i){if(!e||!i)return!1;const{size:n}=this;for(let s=0;s<n;s++)if(e[s]!==i[s])return!1;return!0}_createBuffer(e){var s;this._buffer&&this._buffer.destroy();const{isIndexed:i,type:n}=this.settings;return this._buffer=this.device.createBuffer({...(s=this._buffer)==null?void 0:s.props,id:this.id,usage:i?qe.INDEX:qe.VERTEX,indexType:i?n:void 0,byteLength:e}),this._buffer}}const N_=[],k_=[];function Tl(t,e=0,i=1/0){let n=N_;const s={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&(k_.length=t.length,n=k_):n=N_,(e>0||Number.isFinite(i))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,i),s.index=e-1),{iterable:n,objectInfo:s}}function av(t){return t&&t[Symbol.asyncIterator]}function cv(t,e){const{size:i,stride:n,offset:s,startIndices:r,nested:o}=e,a=t.BYTES_PER_ELEMENT,c=n?n/a:i,l=s?s/a:0,u=Math.floor((t.length-l)/c);return(h,{index:f,target:d})=>{if(!r){const b=f*c+l;for(let T=0;T<i;T++)d[T]=t[b+T];return d}const p=r[f],g=r[f+1]||u;let _;if(o){_=new Array(g-p);for(let b=p;b<g;b++){const T=b*c+l;d=new Array(i);for(let v=0;v<i;v++)d[v]=t[T+v];_[b-p]=d}}else if(c===i)_=t.subarray(p*i+l,g*i+l);else{_=new t.constructor((g-p)*i);let b=0;for(let T=p;T<g;T++){const v=T*c+l;for(let E=0;E<i;E++)_[b++]=t[v+E]}}return _}}const rN=[],Ua=[[0,1/0]];function oN(t,e){if(t===Ua||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const i=[],n=t.length;let s=0;for(let r=0;r<n;r++){const o=t[r];o[1]<e[0]?(i.push(o),s=r+1):o[0]>e[1]?i.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return i.splice(s,0,e),i}const aN={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function lv(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const i=t.type||"interpolation";return{...aN[i],...e,...t,type:i}}class uv extends sN{constructor(e,i){super(e,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Ua}),this.constant=!1,this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!e,i}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var i;(i=this.state).layoutChanged||(i.layoutChanged=!iN(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:i}=this.settings,n=this.settings.transition,s=Array.isArray(i)?e[i.find(r=>e[r])]:e[i];return lv(s,n)}setNeedsUpdate(e=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),i){const{startRow:n=0,endRow:s=1/0}=i;this.state.updateRanges=oN(this.state.updateRanges,[n,s])}else this.state.updateRanges=Ua}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=rN}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:i,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,i.updateRanges!==Ua),!0):!1}updateBuffer({numInstances:e,data:i,props:n,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:o,noAlloc:a}}=this;let c=!0;if(o){for(const[l,u]of r)o.call(s,this,{data:i,startRow:l,endRow:u,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[l,u]of r){const h=Number.isFinite(l)?this.getVertexOffset(l):0,f=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:h,endOffset:f})}this._checkAttributeArray()}else c=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),c}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:i}=this;return e?(this.clearNeedsUpdate(),i.lastExternalBuffer===e||(i.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(e,i=null){const{state:n,settings:s}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),s.transform||i!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;_t(ArrayBuffer.isView(o.value),`invalid ${s.accessor}`);const a=!!o.size&&o.size!==this.size;return n.binaryAccessor=cv(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:i,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:i}=this;return(i?e<i.length?i[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,i=super.getValue();if(!e)return i;for(const n in e)Object.assign(i,super.getValue(n,e[n]));return i}getBufferLayout(){this.state.layoutChanged=!1;const e=this.settings.shaderAttributes,i=super.getBufferLayout();if(!e)return i;for(const n in e){const s=super.getBufferLayout(n,e[n]);i.attributes.push(...s.attributes)}return i}_autoUpdater(e,{data:i,startRow:n,endRow:s,props:r,numInstances:o}){if(e.constant)return;const{settings:a,state:c,value:l,size:u,startIndices:h}=e,{accessor:f,transform:d}=a,p=c.binaryAccessor||(typeof f=="function"?f:r[f]);_t(typeof p=="function",`accessor "${f}" is not a function`);let g=e.getVertexOffset(n);const{iterable:_,objectInfo:b}=Tl(i,n,s);for(const T of _){b.index++;let v=p(T,b);if(d&&(v=d.call(this,v)),h){const E=(b.index<h.length-1?h[b.index+1]:o)-h[b.index];if(v&&Array.isArray(v[0])){let R=g;for(const P of v)e._normalizeValue(P,l,R),R+=u}else v&&v.length>u?l.set(v,g):(e._normalizeValue(v,b.target,0),DP({target:l,source:b.target,start:g,count:E}));g+=E*u}else e._normalizeValue(v,l,g),g+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,i=Math.min(4,this.size);if(e&&e.length>=i){let n=!0;switch(i){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Ru(t){const{source:e,target:i,start:n=0,size:s,getData:r}=t,o=t.end||i.length,a=e.length,c=o-n;if(a>c){i.set(e.subarray(0,c),n);return}if(i.set(e,n),!r)return;let l=a;for(;l<c;){const u=r(l,e);for(let h=0;h<s;h++)i[n+l]=u[h]||0,l++}}function cN({source:t,target:e,size:i,getData:n,sourceStartIndices:s,targetStartIndices:r}){if(!s||!r)return Ru({source:t,target:e,size:i,getData:n}),e;let o=0,a=0;const c=n&&((u,h)=>n(u+a,h)),l=Math.min(s.length,r.length);for(let u=1;u<l;u++){const h=s[u]*i,f=r[u]*i;Ru({source:t.subarray(o,h),target:e,start:a,end:f,size:i,getData:c}),o=h,a=f}return a<e.length&&Ru({source:[],target:e,start:a,size:i,getData:c}),e}function lN(t){const{device:e,settings:i,value:n}=t,s=new uv(e,i);return s.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),s}function hv(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function fv(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function dv(t){t.push(t.shift())}function uN(t,e){const{doublePrecision:i,settings:n,value:s,size:r}=t,o=i&&s instanceof Float64Array?2:1;let a=0;const{shaderAttributes:c}=t.settings;if(c)for(const l of Object.values(c))a=Math.max(a,l.vertexOffset??0);return(n.noAlloc?s.length:(e+a)*r)*o}function pv({device:t,source:e,target:i}){return(!i||i.byteLength<e.byteLength)&&(i==null||i.destroy(),i=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),i}function gv({device:t,buffer:e,attribute:i,fromLength:n,toLength:s,fromStartIndices:r,getData:o=a=>a}){const a=i.doublePrecision&&i.value instanceof Float64Array?2:1,c=i.size*a,l=i.byteOffset,u=i.settings.bytesPerElement<4?l/i.settings.bytesPerElement*4:l,h=i.startIndices,f=r&&h,d=i.isConstant;if(!f&&e&&n>=s)return e;const p=i.value instanceof Float64Array?Float32Array:i.value.constructor,g=d?i.value:new p(i.getBuffer().readSyncWebGL(l,s*p.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!d){const v=o;o=(E,R)=>i.normalizeConstant(v(E,R))}const _=d?(v,E)=>o(g,E):(v,E)=>o(g.subarray(v+l,v+l+c),E),b=e?new Float32Array(e.readSyncWebGL(u,n*4).buffer):new Float32Array(0),T=new Float32Array(s);return cN({source:b,target:T,sourceStartIndices:r,targetStartIndices:h,size:c,getData:_}),(!e||e.byteLength<T.byteLength+u)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:T.byteLength+u,usage:35050})),e.write(T,u),e}class _v{constructor({device:e,attribute:i,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new yl(n),this.attribute=i,this.attributeInTransition=lN(i),this.currentStartIndices=i.startIndices}get inProgress(){return this.transition.inProgress}start(e,i,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=uN(this.attribute,i),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class hN extends _v{constructor({device:e,attribute:i,timeline:n}){super({device:e,attribute:i,timeline:n}),this.type="interpolation",this.transform=dN(e,i)}start(e,i){const n=this.currentLength,s=this.currentStartIndices;if(super.start(e,i,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:r,attribute:o}=this;dv(r),r[0]=gv({device:this.device,buffer:r[0],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),r[1]=pv({device:this.device,source:r[0],target:r[1]}),this.setBuffer(r[1]);const{transform:a}=this,c=a.model;c.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?(c.setAttributes({aFrom:r[0]}),c.setConstantAttributes({aTo:o.value})):c.setAttributes({aFrom:r[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:r[1]})}onUpdate(){const{duration:e,easing:i}=this.settings,{time:n}=this.transition;let s=n/e;i&&(s=i(s));const{model:r}=this.transform;r.setUniforms({time:s}),r.device.gl.bindBuffer(34962,null),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const fN=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function dN(t,e){const i=hv(e.size);return new _l(t,{vs:fN,bufferLayout:[{name:"aFrom",format:fv(e.size)},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"]})}class pN extends _v{constructor({device:e,attribute:i,timeline:n}){super({device:e,attribute:i,timeline:n}),this.type="spring",this.texture=yN(e),this.framebuffer=vN(e,this.texture),this.transform=mN(e,i)}start(e,i){const n=this.currentLength,s=this.currentStartIndices;super.start(e,i);const{buffers:r,attribute:o}=this;for(let c=0;c<2;c++)r[c]=gv({device:this.device,buffer:r[c],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});r[2]=pv({device:this.device,source:r[0],target:r[2]}),this.setBuffer(r[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:i,framebuffer:n,transition:s}=this,r=this.settings;i.model.setAttributes({aPrev:e[0],aCur:e[1]}),i.transformFeedback.setBuffers({vNext:e[2]}),i.model.setUniforms({stiffness:r.stiffness,damping:r.damping}),i.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),dv(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const gN=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,_N=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function mN(t,e){const i=hv(e.size),n=fv(e.size);return new _l(t,{vs:gN,fs:_N,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function yN(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function vN(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const bN={interpolation:hN,spring:pN};class wN{constructor(e,{id:i,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=i,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:i,numInstances:n}){this.numInstances=n||1;for(const s in e){const r=e[s],o=r.getTransitionSetting(i);o&&this._updateAttribute(s,r,o)}for(const s in this.transitions){const r=e[s];(!r||!r.getTransitionSetting(i))&&this._removeTransition(s)}}hasAttribute(e){const i=this.transitions[e];return i&&i.inProgress}getAttributes(){const e={};for(const i in this.transitions){const n=this.transitions[i];n.inProgress&&(e[i]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,i,n){const s=this.transitions[e];let r=!s||s.type!==n.type;if(r){s&&this._removeTransition(e);const o=bN[n.type];o?this.transitions[e]=new o({attribute:i,timeline:this.timeline,device:this.device}):(fe.error(`unsupported transition type '${n.type}'`)(),r=!1)}(r||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const D_="attributeManager.invalidate",TN="attributeManager.updateStart",EN="attributeManager.updateEnd",SN="attribute.updateStart",AN="attribute.allocate",RN="attribute.updateEnd";class CN{constructor(e,{id:i="attribute-manager",stats:n,timeline:s}={}){this.mergeBoundsMemoized=Bo(fP),this.id=i,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new wN(e,{id:`${i}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const i of e)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(e,i){const n=this._invalidateTrigger(e,i);Tt(D_,this,e,n)}invalidateAll(e){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,e);Tt(D_,this,"all")}update({data:e,numInstances:i,startIndices:n=null,transitions:s,props:r={},buffers:o={},context:a={}}){let c=!1;Tt(TN,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const l in this.attributes){const u=this.attributes[l],h=u.settings.accessor;u.startIndices=n,u.numInstances=i,r[l]&&fe.removed(`props.${l}`,`data.attributes.${l}`)(),u.setExternalBuffer(o[l])||u.setBinaryValue(typeof h=="string"?o[h]:void 0,e.startIndices)||typeof h=="string"&&!o[h]&&u.setConstantValue(r[h])||u.needsUpdate()&&(c=!0,this._updateAttribute({attribute:u,numInstances:i,data:e,props:r,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}c&&Tt(EN,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,i=e.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const i=e.map(n=>{var s;return(s=this.attributes[n])==null?void 0:s.getBounds()});return this.mergeBoundsMemoized(i)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:n}=this,s={...n.getAttributes()};for(const r in i){const o=i[r];o.needsRedraw(e)&&!n.hasAttribute(r)&&(s[r]=o)}return s}getBufferLayouts(e,i={}){e||(e=this.getAttributes());const n=[];for(const s in e)i[s]||n.push(e[s].getBufferLayout());return n}_add(e,i={}){for(const n in e){const s=e[n];this.attributes[n]=this._createAttribute(n,s,i)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,i,n){const s={...i,id:e,size:i.isIndexed&&1||i.size||1,divisor:n.instanced?1:i.divisor||0};return new uv(this.device,s)}_mapUpdateTriggersToAttributes(){const e={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(i)});this.updateTriggers=e}_invalidateTrigger(e,i){const{attributes:n,updateTriggers:s}=this,r=s[e];return r&&r.forEach(o=>{const a=n[o];a&&a.setNeedsUpdate(a.id,i)}),r}_updateAttribute(e){const{attribute:i,numInstances:n}=e;if(Tt(SN,i),i.constant){i.setConstantValue(i.value);return}i.allocate(n)&&Tt(AN,i,n),i.updateBuffer(e)&&(this.needsRedraw=!0,Tt(RN,i,n))}}class xN extends yl{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:i,toValue:n,duration:s,easing:r}}=this,o=r(e/s);this._value=qn(i,n,o)}}const F_=1e-5;function L_(t,e,i,n,s){const r=e-t,a=(i-e)*s,c=-r*n;return a+c+r+e}function PN(t,e,i,n,s){if(Array.isArray(i)){const r=[];for(let o=0;o<i.length;o++)r[o]=L_(t[o],e[o],i[o],n,s);return r}return L_(t,e,i,n,s)}function B_(t,e){if(Array.isArray(t)){let i=0;for(let n=0;n<t.length;n++){const s=t[n]-e[n];i+=s*s}return Math.sqrt(i)}return Math.abs(t-e)}class MN extends yl{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:i,damping:n,stiffness:s}=this.settings,{_prevValue:r=e,_currValue:o=e}=this;let a=PN(r,o,i,n,s);const c=B_(a,i),l=B_(a,o);c<F_&&l<F_&&(a=i,this.end()),this._prevValue=o,this._currValue=a}}const IN={interpolation:xN,spring:MN};class ON{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,i,n,s){const{transitions:r}=this;if(r.has(e)){const c=r.get(e),{value:l=c.settings.fromValue}=c;i=l,this.remove(e)}if(s=lv(s),!s)return;const o=IN[s.type];if(!o){fe.error(`unsupported transition type '${s.type}'`)();return}const a=new o(this.timeline);a.start({...s,fromValue:i,toValue:n}),r.set(e,a)}remove(e){const{transitions:i}=this;i.has(e)&&(i.get(e).cancel(),i.delete(e))}update(){const e={};for(const[i,n]of this.transitions)n.update(),e[i]=n.value,n.inProgress||this.remove(i);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function NN(t){const e=t[hn];for(const i in e){const n=e[i],{validate:s}=n;if(s&&!s(t[i],n))throw new Error(`Invalid prop ${i}: ${t[i]}`)}}function kN(t,e){const i=mv({newProps:t,oldProps:e,propTypes:t[hn],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=FN(t,e);let s=!1;return n||(s=LN(t,e)),{dataChanged:n,propsChanged:i,updateTriggersChanged:s,extensionsChanged:BN(t,e),transitionsChanged:DN(t,e)}}function DN(t,e){if(!t.transitions)return!1;const i={},n=t[hn];let s=!1;for(const r in t.transitions){const o=n[r],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&sf(t[r],e[r],o)&&(i[r]=!0,s=!0)}return s?i:!1}function mv({newProps:t,oldProps:e,ignoreProps:i={},propTypes:n={},triggerName:s="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const r of Object.keys(t))if(!(r in i)){if(!(r in e))return`${s}.${r} added`;const o=sf(t[r],e[r],n[r]);if(o)return`${s}.${r} ${o}`}for(const r of Object.keys(e))if(!(r in i)){if(!(r in t))return`${s}.${r} dropped`;if(!Object.hasOwnProperty.call(t,r)){const o=sf(t[r],e[r],n[r]);if(o)return`${s}.${r} ${o}`}}return!1}function sf(t,e,i){let n=i&&i.equal;return n&&!n(t,e,i)||!n&&(n=t&&e&&t.equals,n&&!n.call(t,e))?"changed deeply":!n&&e!==t?"changed shallowly":null}function FN(t,e){if(e===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:n,_dataDiff:s}=t;return n?n(t.data,e.data)||(i="Data comparator detected a change"):t.data!==e.data&&(i="A new data container was supplied"),i&&s&&(i=s(t.data,e.data)||i),i}function LN(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&U_(t,e,"all"))return{all:!0};const i={};let n=!1;for(const s in t.updateTriggers)s!=="all"&&U_(t,e,s)&&(i[s]=!0,n=!0);return n?i:!1}function BN(t,e){if(e===null)return!0;const i=e.extensions,{extensions:n}=t;if(n===i)return!1;if(!i||!n||n.length!==i.length)return!0;for(let s=0;s<n.length;s++)if(!n[s].equals(i[s]))return!0;return!1}function U_(t,e,i){let n=t.updateTriggers[i];n=n??{};let s=e.updateTriggers[i];return s=s??{},mv({oldProps:s,newProps:n,triggerName:i})}const UN="count(): argument not an object",zN="count(): argument not a container";function VN(t){if(!$N(t))throw new Error(UN);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(jN(t))return Object.keys(t).length;throw new Error(zN)}function jN(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function $N(t){return t!==null&&typeof t=="object"}function z_(t,e){if(!e)return t;const i={...t,...e};if("defines"in e&&(i.defines={...t.defines,...e.defines}),"modules"in e&&(i.modules=(t.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=i.modules.findIndex(s=>s.name==="project32");n>=0&&i.modules.splice(n,1)}if("inject"in e)if(!t.inject)i.inject=e.inject;else{const n={...t.inject};for(const s in e.inject)n[s]=(n[s]||"")+e.inject[s];i.inject=n}return i}const HN={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},rf={};function WN(t,e,i,n){if(i instanceof Xt)return i;i.constructor&&i.constructor.name!=="Object"&&(i={data:i});let s=null;i.compressed&&(s={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});const r=e.createTexture({...i,sampler:{...HN,...s,...n}});return rf[r.id]=t,r}function XN(t,e){!e||!(e instanceof Xt)||rf[e.id]===t&&(e.delete(),delete rf[e.id])}const qN={boolean:{validate(t,e){return!0},equal(t,e,i){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||of(t)&&(t.length===3||t.length===4)},equal(t,e,i){return li(t,e,1)}},accessor:{validate(t,e){const i=Ec(t);return i==="function"||i===Ec(e.value)},equal(t,e,i){return typeof e=="function"?!0:li(t,e,1)}},array:{validate(t,e){return e.optional&&!t||of(t)},equal(t,e,i){const{compare:n}=i,s=Number.isInteger(n)?n:n?1:0;return n?li(t,e,s):t===e}},object:{equal(t,e,i){if(i.ignore)return!0;const{compare:n}=i,s=Number.isInteger(n)?n:n?1:0;return n?li(t,e,s):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,i){return!i.compare&&i.ignore!==!1||t===e}},data:{transform:(t,e,i)=>{if(!t)return t;const{dataTransform:n}=i.props;return n?n(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,i)=>{const n=i.context;return!n||!n.device?null:WN(i.id,n.device,t,{...e.parameters,...i.props.textureParameters})},release:(t,e,i)=>{XN(i.id,t)}}};function YN(t){const e={},i={},n={};for(const[s,r]of Object.entries(t)){const o=r==null?void 0:r.deprecatedFor;if(o)n[s]=Array.isArray(o)?o:[o];else{const a=KN(s,r);e[s]=a,i[s]=a.value}}return{propTypes:e,defaultProps:i,deprecatedProps:n}}function KN(t,e){switch(Ec(e)){case"object":return Lr(t,e);case"array":return Lr(t,{type:"array",value:e,compare:!1});case"boolean":return Lr(t,{type:"boolean",value:e});case"number":return Lr(t,{type:"number",value:e});case"function":return Lr(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Lr(t,e){return"type"in e?{name:t,...qN[e.type],...e}:"value"in e?{name:t,type:Ec(e.value),...e}:{name:t,type:"object",value:e}}function of(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Ec(t){return of(t)?"array":t===null?"null":typeof t}function ZN(t,e){let i;for(let r=e.length-1;r>=0;r--){const o=e[r];"extensions"in o&&(i=o.extensions)}const n=af(t.constructor,i),s=Object.create(n);s[bc]=t,s[as]={},s[an]={};for(let r=0;r<e.length;++r){const o=e[r];for(const a in o)s[a]=o[a]}return Object.freeze(s),s}const GN="_mergedDefaultProps";function af(t,e){let i=GN;if(e)for(const s of e){const r=s.constructor;r&&(i+=`:${r.extensionName||r.name}`)}const n=yv(t,i);return n||(t[i]=JN(t,e||[]))}function JN(t,e){if(!t.prototype)return null;const n=Object.getPrototypeOf(t),s=af(n),r=yv(t,"defaultProps")||{},o=YN(r),a=Object.assign(Object.create(null),s,o.defaultProps),c=Object.assign(Object.create(null),s==null?void 0:s[hn],o.propTypes),l=Object.assign(Object.create(null),s==null?void 0:s[gu],o.deprecatedProps);for(const u of e){const h=af(u.constructor);h&&(Object.assign(a,h),Object.assign(c,h[hn]),Object.assign(l,h[gu]))}return QN(a,t),tk(a,c),ek(a,l),a[hn]=c,a[gu]=l,e.length===0&&!pd(t,"_propTypes")&&(t._propTypes=c),a}function QN(t,e){const i=nk(e);Object.defineProperties(t,{id:{writable:!0,value:i}})}function ek(t,e){for(const i in e)Object.defineProperty(t,i,{enumerable:!1,set(n){const s=`${this.id}: ${i}`;for(const r of e[i])pd(this,r)||(this[r]=n);fe.deprecated(s,e[i].join("/"))()}})}function tk(t,e){const i={},n={};for(const s in e){const r=e[s],{name:o,value:a}=r;r.async&&(i[o]=a,n[o]=ik(o))}t[Js]=i,t[as]={},Object.defineProperties(t,n)}function ik(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||av(e)?this[as][t]=e:this[an][t]=e},get(){if(this[an]){if(t in this[an])return this[an][t]||this[Js][t];if(t in this[as]){const e=this[bc]&&this[bc].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Js][t]}}return this[Js][t]}}}function pd(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function yv(t,e){return pd(t,e)&&t[e]}function nk(t){const e=t.componentName;return e||fe.warn(`${t.name}.componentName not specified`)(),e||t.name}let sk=0;const Zc=class Zc{constructor(...e){this.props=ZN(this,e),this.id=this.props.id,this.count=sk++}clone(e){const{props:i}=this,n={};for(const s in i[Js])s in i[an]?n[s]=i[an][s]:s in i[as]&&(n[s]=i[as][s]);return new this.constructor({...i,...n,...e})}};Zc.componentName="Component",Zc.defaultProps={};let cf=Zc;const rk=Object.freeze({});class ok{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const i=this.asyncProps[e];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||rk}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const i=this.asyncProps[e];return i&&i.resolvedValue}isAsyncPropLoading(e){if(e){const i=this.asyncProps[e];return!!(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(e,i){this._watchPromise(e,Promise.resolve(i))}setAsyncProps(e){this.component=e[bc]||this.component;const i=e[an]||{},n=e[as]||e,s=e[Js]||{};for(const r in i){const o=i[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,o),i[r]=this.getAsyncProp(r)}for(const r in n){const o=n[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,o)}}_fetch(e,i){return null}_onResolve(e,i){}_onError(e,i){}_updateAsyncProp(e,i){if(this._didAsyncInputValueChange(e,i)){if(typeof i=="string"&&(i=this._fetch(e,i)),i instanceof Promise){this._watchPromise(e,i);return}if(av(i)){this._resolveAsyncIterable(e,i);return}this._setPropValue(e,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,i){const n=this.asyncProps[e];return i===n.resolvedValue||i===n.lastValue?!1:(n.lastValue=i,!0)}_setPropValue(e,i){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(i=this._postProcessValue(n,i),n.resolvedValue=i,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,i,n){const s=this.asyncProps[e];s&&n>=s.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=i,s.resolvedLoadCount=n,this.onAsyncPropUpdated(e,i))}_watchPromise(e,i){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const s=n.pendingLoadCount;i.then(r=>{this.component&&(r=this._postProcessValue(n,r),this._setAsyncPropValue(e,r,s),this._onResolve(e,r))}).catch(r=>{this._onError(e,r)})}}async _resolveAsyncIterable(e,i){if(e!=="data"){this._setPropValue(e,i);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const s=n.pendingLoadCount;let r=[],o=0;for await(const a of i){if(!this.component)return;const{dataTransform:c}=this.component.props;c?r=c(a,r):r=r.concat(a),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:o,endRow:r.length}]}),o=r.length,this._setAsyncPropValue(e,r,s)}this._onResolve(e,r)}_postProcessValue(e,i){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(i,n,this.component):i}_createAsyncPropData(e,i){if(!this.asyncProps[e]){const s=this.component&&this.component.props[hn];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class ak extends ok{constructor({attributeManager:e,layer:i}){super(i),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,i){const n=this.layer,s=n==null?void 0:n.props.fetch;return s?s(i,{propName:e,layer:n}):super._fetch(e,i)}_onResolve(e,i){const n=this.layer;if(n){const s=n.props.onDataLoad;e==="data"&&s&&s(i,{propName:e,layer:n})}}_onError(e,i){const n=this.layer;n&&n.raiseError(i,`loading ${e} of ${this.layer}`)}}const ck="layer.changeFlag",lk="layer.initialize",uk="layer.update",hk="layer.finalize",fk="layer.matched",V_=2**24-1,dk=Object.freeze([]),pk=Bo(({oldViewport:t,viewport:e})=>t.equals(e));let Ti=new Uint8ClampedArray(0);const gk={data:{type:"data",value:dk,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:i,loaders:n,loadOptions:s,signal:r})=>{const{resourceManager:o}=i.context;s=s||i.getLoadOptions(),n=n||i.props.loaders,r&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:r}});let a=o.contains(t);return!a&&!s&&(o.add({resourceId:t,data:Hn(t,n),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:c=>{var l;return(l=i.internalState)==null?void 0:l.reloadAsyncProp(e,c)},consumerId:i.id,requestId:e}):Hn(t,n,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ge.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},Gc=class Gc extends cf{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Ns.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){_t(this.internalState);const i=this.internalState.viewport||this.context.viewport,n=F1(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,r,o]=N1(n,i.pixelProjectionMatrix);return e.length===2?[s,r]:[s,r,o]}unproject(e){return _t(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,i){_t(this.internalState);const n=this.internalState.viewport||this.context.viewport;return yP(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const i of this.getModels())i.updateModuleSettings(e)}setShaderModuleProps(...e){for(const i of this.getModels())i.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===ge.DEFAULT||e===ge.LNGLAT||e===ge.CARTESIAN}onHover(e,i){return this.props.onHover&&this.props.onHover(e,i)||!1}onClick(e,i){return this.props.onClick&&this.props.onClick(e,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,i=[]){return i[0]=e+1&255,i[1]=e+1>>8&255,i[2]=e+1>>8>>8&255,i}decodePickingColor(e){_t(e instanceof Uint8Array);const[i,n,s]=e;return i+n*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:VN(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=z_(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const i of this.props.extensions)e=z_(e,i.getShaders.call(this,i));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const i=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&i)if(Array.isArray(n))for(const s of n)i.invalidateAll(s);else i.invalidateAll();if(i){const{props:s}=e,r=this.internalState.hasPickingBuffer,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(r!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:c}=i.attributes,l=a||c;l&&(o&&l.constant&&(l.constant=!1,i.invalidate(l.id)),!l.value&&!o&&(l.constant=!0,l.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const i of this.getModels())i.draw(e)}getPickingInfo({info:e,mode:i,sourceLayer:n}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,i){var n,s,r,o;i&&(e=new Error(`${i}: ${e.message}`,{cause:e})),(s=(n=this.props).onError)!=null&&s.call(n,e)||(o=(r=this.context)==null?void 0:r.onError)==null||o.call(r,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=e,(!i||!pk({oldViewport:i,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const i=this.getAttributeManager();i&&(e==="all"?i.invalidateAll():i.invalidate(e))}updateAttributes(e){let i=!1;for(const n in e)e[n].layoutChanged()&&(i=!0);for(const n of this.getModels())this._setModelAttributes(n,e,i)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const i=this.props,n=this.getNumInstances(),s=this.getStartIndices();e.update({data:i.data,numInstances:n,startIndices:s,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const r=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const i=e.update(),n=Object.create(this.props);for(const s in i)Object.defineProperty(n,s,{value:i[s]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:i}){if(e.constant)return;const n=Math.floor(Ti.length/4);if(this.internalState.usesPickingColorCache=!0,n<i){i>V_&&fe.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ti=pr.allocate(Ti,i,{size:4,copy:!0,maxCount:Math.max(i,V_)});const s=Math.floor(Ti.length/4),r=[];for(let o=n;o<s;o++)this.encodePickingColor(o,r),Ti[o*4+0]=r[0],Ti[o*4+1]=r[1],Ti[o*4+2]=r[2]}e.value=Ti.subarray(0,i*4)}_setModelAttributes(e,i,n=!1){var a;if(!Object.keys(i).length)return;if(n){const c=this.getAttributeManager();e.setBufferLayout(c.getBufferLayouts()),i=c.getAttributes()}const s=((a=e.userData)==null?void 0:a.excludeAttributes)||{},r={},o={};for(const c in i){if(s[c])continue;const l=i[c].getValue();for(const u in l){const h=l[u];h instanceof qe?i[c].settings.isIndexed?e.setIndexBuffer(h):r[u]=h:h&&(o[u]=h)}}e.setAttributes(r),e.setConstantAttributes(o)}disablePickingIndex(e){const i=this.props.data;if(!("attributes"in i)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:s}=this.getAttributeManager().attributes,r=n||s,o=r&&i.attributes&&i.attributes[r.id];if(o&&o.value){const a=o.value,c=this.encodePickingColor(e);for(let l=0;l<i.length;l++){const u=r.getVertexOffset(l);a[u]===c[0]&&a[u+1]===c[1]&&a[u+2]===c[2]&&this._disablePickingIndex(l)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,s=i||n;if(!s)return;const r=s.getVertexOffset(e),o=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(o-r),r)}restorePickingColors(){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,n=e||i;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Ti.buffer&&(n.value=Ti.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){_t(!this.internalState),_t(Number.isFinite(this.props.coordinateSystem)),Tt(lk,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new ak({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(fe.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new ON(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Tt(fk,this,this===e);const{state:i,internalState:n}=e;this!==e&&(this.internalState=n,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Tt(uk,this,e),!e)return;const i=this.props,n=this.context,s=this.internalState,r=n.viewport,o=this._updateUniformTransition();s.propsInTransition=o,n.viewport=s.viewport||r,this.props=o;try{const a=this._getUpdateParams(),c=this.getModels();if(n.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const l=this.getModels()[0]!==c[0];this._postUpdate(a,l)}finally{n.viewport=r,this.props=i,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Tt(hk,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:i=null,uniforms:n={},parameters:s={}}){this._updateAttributeTransition();const r=this.props,o=this.context;this.props=this.internalState.propsInTransition||r;const a=this.props.opacity;n.opacity=Math.pow(a,1/2.2);try{if(i){const{isActive:u,isAttribute:h}=i.picking;this.setModuleParameters(i),this.setShaderModuleProps({picking:{isActive:u,isAttribute:h}})}const{getPolygonOffset:c}=this.props,l=c&&c(n)||[0,0];o.device.setParametersWebGL({polygonOffset:l});for(const u of this.getModels())u.setParameters(s);o.device.withParametersWebGL(s,()=>{const u={renderPass:e,moduleParameters:i,uniforms:n,parameters:s,context:o};for(const h of this.props.extensions)h.draw.call(this,u,h);this.draw(u)})}finally{this.props=r}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const s in e)if(e[s]){let r=!1;switch(s){case"dataChanged":const o=e[s],a=i[s];o&&Array.isArray(a)&&(i.dataChanged=Array.isArray(o)?a.concat(o):o,r=!0);default:i[s]||(i[s]=e[s],r=!0)}r&&Tt(ck,this,s,e)}const n=!!(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=n,i.somethingChanged=n||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,i){var s;const n=kN(e,i);if(n.updateTriggersChanged)for(const r in n.updateTriggersChanged)n.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(n.transitionsChanged)for(const r in n.transitionsChanged)this.internalState.uniformTransitions.add(r,i[r],e[r],(s=e.transitions)==null?void 0:s[r]);return this.setChangeFlags(n)}validateProps(){NN(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const i={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(i.highlightColor=n(e)),this.setShaderModuleProps({picking:i}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new CN(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,i){const{props:n,oldProps:s}=e;this.setNeedsRedraw(),this._updateAttributes();const r=this.state.model;r!=null&&r.isInstanced&&r.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:c}=n;if(i||s.autoHighlight!==o||s.highlightedObjectIndex!==a||s.highlightColor!==c){const l={};o||(l.highlightedObjectColor=null),Array.isArray(c)&&(l.highlightColor=c),(i||a!==s.highlightedObjectIndex)&&(l.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:l})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),s=n?n.getNeedsRedraw(e):!1;if(i=i||s,i)for(const r of this.props.extensions)r.onNeedsRedraw.call(this,r);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};Gc.defaultProps=gk,Gc.layerName="Layer";let ji=Gc;const _k="compositeLayer.renderLayers",kd=class kd extends ji{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:i}=e;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(e.object=i.__source.object,e.index=i.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,i){return i&&i.length}getSubLayerClass(e,i){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||i}getSubLayerRow(e,i,n){return e.__source={parent:this,object:i,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const i={index:-1,data:this.props.data,target:[]};return(n,s)=>n&&n.__source?(i.index=n.__source.index,e(n.__source.object,i)):e(n,s)}return e}getSubLayerProps(e={}){var M;const{opacity:i,pickable:n,visible:s,parameters:r,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:d,modelMatrix:p,extensions:g,fetch:_,operation:b,_subLayerProps:T}=this.props,v={id:"",updateTriggers:{},opacity:i,pickable:n,visible:s,parameters:r,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:d,modelMatrix:p,extensions:g,fetch:_,operation:b},E=T&&e.id&&T[e.id],R=E&&E.updateTriggers,P=e.id||"sublayer";if(E){const U=this.props[hn],O=e.type?e.type._propTypes:{};for(const D in E){const I=O[D]||U[D];I&&I.type==="accessor"&&(E[D]=this.getSubLayerAccessor(E[D]))}}Object.assign(v,e,E),v.id=`${this.props.id}-${P}`,v.updateTriggers={all:(M=this.props.updateTriggers)==null?void 0:M.all,...e.updateTriggers,...R};for(const U of g){const O=U.getSubLayerProps.call(this,U);O&&Object.assign(v,O,{updateTriggers:Object.assign(v.updateTriggers,O.updateTriggers)})}return v}_updateAutoHighlight(e){for(const i of this.getSubLayers())i.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,i){let n=this.internalState.subLayers;const s=!n||this.needsUpdate();if(s){const r=this.renderLayers();n=ml(r,Boolean),this.internalState.subLayers=n}Tt(_k,this,s,n);for(const r of n)r.parent=this}};kd.layerName="CompositeLayer";let xo=kd;const ba=Math.PI/180,j_=180/Math.PI,za=6370972,Hs=256;function mk(){const t=Hs/za,e=Math.PI/180*Hs;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class yk extends gr{constructor(e={}){const{latitude:i=0,longitude:n=0,zoom:s=0,nearZMultiplier:r=.1,farZMultiplier:o=2,resolution:a=10}=e;let{height:c,altitude:l=1.5}=e;c=c||1,l=Math.max(.75,l);const u=new yt().lookAt({eye:[0,-l,0],up:[0,0,1]}),h=Math.pow(2,s);u.rotateX(i*ba),u.rotateZ(-n*ba),u.scale(h/c);const f=Math.atan(.5/l),d=Hs*2*h/c;super({...e,height:c,viewMatrix:u,longitude:n,latitude:i,zoom:s,distanceScales:mk(),fovyRadians:f*2,focalDistance:l,near:r,far:Math.min(2,1/d+1)*l*o}),this.latitude=i,this.longitude=n,this.resolution=a}get projectionMode(){return ai.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const i={targetZ:e.z||0},n=this.unproject([0,this.height/2],i),s=this.unproject([this.width/2,0],i),r=this.unproject([this.width,this.height/2],i),o=this.unproject([this.width/2,this.height],i);return r[0]<this.longitude&&(r[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],r[0],s[0],o[0]),Math.min(n[1],r[1],s[1],o[1]),Math.max(n[0],r[0],s[0],o[0]),Math.max(n[1],r[1],s[1],o[1])]}unproject(e,{topLeft:i=!0,targetZ:n}={}){const[s,r,o]=e,a=i?r:this.height-r,{pixelUnprojectionMatrix:c}=this;let l;if(Number.isFinite(o))l=Cu(c,[s,a,o,1]);else{const d=Cu(c,[s,a,-1,1]),p=Cu(c,[s,a,1,1]),g=((n||0)/za+1)*Hs,_=ou(m1([],d,p)),b=ou(d),T=ou(p),E=4*((4*b*T-(_-b-T)**2)/16)/_,R=Math.sqrt(b-E),P=Math.sqrt(Math.max(0,g*g-E)),M=(R-P)/Math.sqrt(_);l=YR([],d,p,M)}const[u,h,f]=this.unprojectPosition(l);return Number.isFinite(o)?[u,h,f]:Number.isFinite(n)?[u,h,n]:[u,h]}projectPosition(e){const[i,n,s=0]=e,r=i*ba,o=n*ba,a=Math.cos(o),c=(s/za+1)*Hs;return[Math.sin(r)*a*c,-Math.cos(r)*a*c,Math.sin(o)*c]}unprojectPosition(e){const[i,n,s]=e,r=y1(e),o=Math.asin(s/r),c=Math.atan2(i,-n)*j_,l=o*j_,u=(r/Hs-1)*za;return[c,l,u]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,i){const n=this.unproject(i);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function Cu(t,e){const i=wr([],e,t);return rd(i,i,1/i[3]),i}const vk=new yt().lookAt({eye:[0,0,1]});function bk({width:t,height:e,near:i,far:n,padding:s}){let r=-t/2,o=t/2,a=-e/2,c=e/2;if(s){const{left:l=0,right:u=0,top:h=0,bottom:f=0}=s,d=dt((l+t-u)/2,0,t)-t/2,p=dt((h+e-f)/2,0,e)-e/2;r-=d,o-=d,a+=p,c+=p}return new yt().ortho({left:r,right:o,bottom:a,top:c,near:i,far:n})}class vv extends gr{constructor(e){const{width:i,height:n,near:s=.1,far:r=1e3,zoom:o=0,target:a=[0,0,0],padding:c=null,flipY:l=!0}=e,u=Array.isArray(o)?o[0]:o,h=Array.isArray(o)?o[1]:o,f=Math.min(u,h),d=Math.pow(2,f);let p;if(u!==h){const g=Math.pow(2,u),_=Math.pow(2,h);p={unitsPerMeter:[g/d,_/d,1],metersPerUnit:[d/g,d/_,1]}}super({...e,longitude:void 0,position:a,viewMatrix:vk.clone().scale([d,d*(l?-1:1),d]),projectionMatrix:bk({width:i||1,height:n||1,padding:c,near:s,far:r}),zoom:f,distanceScales:p})}projectFlat([e,i]){const{unitsPerMeter:n}=this.distanceScales;return[e*n[0],i*n[1]]}unprojectFlat([e,i]){const{metersPerUnit:n}=this.distanceScales;return[e*n[0],i*n[1]]}panByPosition(e,i){const n=gl(i,this.pixelUnprojectionMatrix),s=this.projectFlat(e),r=_c([],s,l1([],n)),o=_c([],this.center,r);return{target:this.unprojectFlat(o)}}}class wk extends j1{constructor(e){const{width:i,height:n,rotationX:s=0,rotationOrbit:r=0,target:o=[0,0,0],zoom:a=0,minRotationX:c=-90,maxRotationX:l=90,minZoom:u=-1/0,maxZoom:h=1/0,startPanPosition:f,startRotatePos:d,startRotationX:p,startRotationOrbit:g,startZoomPosition:_,startZoom:b}=e;super({width:i,height:n,rotationX:s,rotationOrbit:r,target:o,zoom:a,minRotationX:c,maxRotationX:l,minZoom:u,maxZoom:h},{startPanPosition:f,startRotatePos:d,startRotationX:p,startRotationOrbit:g,startZoomPosition:_,startZoom:b}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:i}){const n=this.getState().startPanPosition||i;if(!n)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:n=0}){const{startRotatePos:s,startRotationX:r,startRotationOrbit:o}=this.getState(),{width:a,height:c}=this.getViewportProps();if(!s||r===void 0||o===void 0)return this;let l;if(e){let u=(e[0]-s[0])/a;const h=(e[1]-s[1])/c;(r<-90||r>90)&&(u*=-1),l={rotationX:r+h*180,rotationOrbit:o+u*180}}else l={rotationX:r+n,rotationOrbit:o+i};return this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const i=e.getViewportProps(),n={...this.getViewportProps()},{rotationOrbit:s}=n;return Math.abs(s-i.rotationOrbit)>180&&(n.rotationOrbit=s<0?s+360:s-360),n}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:n}){let{startZoom:s,startZoomPosition:r}=this.getState();if(r||(s=this.getViewportProps().zoom,r=this._unproject(i)||this._unproject(e)),!r)return this;const o=this._calculateNewZoom({scale:n,startZoom:s}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_calculateNewZoom({scale:e,startZoom:i}){const{maxZoom:n,minZoom:s}=this.getViewportProps();i===void 0&&(i=this.getViewportProps().zoom);const r=i+Math.log2(e);return dt(r,s,n)}_panFromCenter(e){const{width:i,height:n,target:s}=this.getViewportProps();return this.pan({startPosition:s,pos:[i/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:i,minZoom:n,zoom:s,maxRotationX:r,minRotationX:o,rotationOrbit:a}=e;return e.zoom=Array.isArray(s)?[dt(s[0],n,i),dt(s[1],n,i)]:dt(s,n,i),e.rotationX=dt(e.rotationX,o,r),(a<-180||a>180)&&(e.rotationOrbit=cP(a+180,360)-180),e}}class Tk extends wk{constructor(e){super(e),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:i}){const{maxZoom:n,minZoom:s}=this.getViewportProps();i===void 0&&(i=this.getViewportProps().zoom);let r=Math.log2(e);if(Array.isArray(i)){let[o,a]=i;switch(this.zoomAxis){case"X":o=dt(o+r,s,n);break;case"Y":a=dt(a+r,s,n);break;default:let c=Math.min(o+r,a+r);c<s&&(r+=s-c),c=Math.max(o+r,a+r),c>n&&(r+=n-c),o+=r,a+=r}return[o,a]}return dt(i+r,s,n)}}class Ek extends V1{constructor(){super(...arguments),this.ControllerState=Tk,this.transition={transitionDuration:300,transitionInterpolator:new Ro(["target","zoom"])},this.dragMode="pan"}_onPanRotate(){return!1}}const Dd=class Dd extends z1{constructor(e={}){super(e)}get ViewportType(){return vv}get ControllerType(){return Ek}};Dd.displayName="OrthographicView";let Ws=Dd;class bv{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:i={}}=e;this.typedArrayManager=pr,this.attributes={},this._attributeDefs=i,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:i,buffers:n={},getGeometry:s,geometryBuffer:r,positionFormat:o,dataChanged:a,normalize:c=!0}=this.opts;if(this.data=i,this.getGeometry=s,this.positionSize=r&&r.size||(o==="XY"?2:3),this.buffers=n,this.normalize=c,r&&(_t(i.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),c||(n.vertexPositions=r)),this.geometryBuffer=n.vertexPositions,Array.isArray(a))for(const l of a)this._rebuildGeometry(l);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:i}){this._rebuildGeometry({startRow:e,endRow:i})}getGeometryFromBuffer(e){const i=e.value||e;return ArrayBuffer.isView(i)?cv(i,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,i){const{attributes:n,buffers:s,_attributeDefs:r,typedArrayManager:o}=this;for(const a in r)if(a in s)o.release(n[a]),n[a]=null;else{const c=r[a];c.copy=i,n[a]=o.allocate(n[a],e,c)}}_forEachGeometry(e,i,n){const{data:s,getGeometry:r}=this,{iterable:o,objectInfo:a}=Tl(s,i,n);for(const c of o){a.index++;const l=r?r(c,a):null;e(l,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:i,vertexStarts:n,instanceCount:s}=this;const{data:r,geometryBuffer:o}=this,{startRow:a=0,endRow:c=1/0}=e||{},l={};if(e||(i=[0],n=[0]),this.normalize||!o)this._forEachGeometry((h,f)=>{const d=h&&this.normalizeGeometry(h);l[f]=d,n[f+1]=n[f]+(d?this.getGeometrySize(d):0)},a,c),s=n[n.length-1];else if(n=r.startIndices,s=n[r.length]||0,ArrayBuffer.isView(o))s=s||o.length/this.positionSize;else if(o instanceof qe){const h=this.positionSize*4;s=s||o.byteLength/h}else if(o.buffer){const h=o.stride||this.positionSize*4;s=s||o.buffer.byteLength/h}else if(o.value){const h=o.value,f=o.stride/h.BYTES_PER_ELEMENT||this.positionSize;s=s||h.length/f}this._allocate(s,!!e),this.indexStarts=i,this.vertexStarts=n,this.instanceCount=s;const u={};this._forEachGeometry((h,f)=>{const d=l[f]||h;u.vertexStart=n[f],u.indexStart=i[f];const p=f<n.length-1?n[f+1]:s;u.geometrySize=p-n[f],u.geometryIndex=f,this.updateGeometryAttributes(d,u)},a,c),this.vertexCount=i[i.length-1]}}const Sk=new Uint32Array([0,2,1,0,3,2]),Ak=new Float32Array([0,1,0,0,1,0,1,1]);function Rk(t,e){if(!e)return Ck(t);const i=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),n=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),s=Math.ceil(i/e)+1,r=Math.ceil(n/e)+1,o=(s-1)*(r-1)*6,a=new Uint32Array(o),c=new Float32Array(s*r*2),l=new Float64Array(s*r*3);let u=0,h=0;for(let f=0;f<s;f++){const d=f/(s-1);for(let p=0;p<r;p++){const g=p/(r-1),_=xk(t,d,g);l[u*3+0]=_[0],l[u*3+1]=_[1],l[u*3+2]=_[2]||0,c[u*2+0]=d,c[u*2+1]=1-g,f>0&&p>0&&(a[h++]=u-r,a[h++]=u-r-1,a[h++]=u-1,a[h++]=u-r,a[h++]=u-1,a[h++]=u),u++}}return{vertexCount:o,positions:l,indices:a,texCoords:c}}function Ck(t){const e=new Float64Array(12);for(let i=0;i<t.length;i++)e[i*3+0]=t[i][0],e[i*3+1]=t[i][1],e[i*3+2]=t[i][2]||0;return{vertexCount:6,positions:e,indices:Sk,texCoords:Ak}}function xk(t,e,i){return qn(qn(t[0],t[1],i),qn(t[3],t[2],i),e)}const Pk=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,Mk=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,Ik=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

${Mk}

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,Ok={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:ge.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}},Jc=class Jc extends ji{getShaders(){return super.getShaders({vs:Pk,fs:Ik,modules:[Tr,Er]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const i=!0;e.add({indices:{size:1,isIndexed:!0,update:n=>n.value=this.state.mesh.indices,noAlloc:i},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:n=>n.value=this.state.mesh.positions,noAlloc:i},texCoords:{size:2,update:n=>n.value=this.state.mesh.texCoords,noAlloc:i}})}updateState({props:e,oldProps:i,changeFlags:n}){var r;const s=this.getAttributeManager();if(n.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),s.invalidateAll()),e.bounds!==i.bounds){const o=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(const c in a)o&&o[c]!==a[c]&&s.invalidate(c);this.setState({mesh:a,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==i._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:i}=this.props,n=e.info;if(!n.color||!i)return n.bitmap=null,n;const{width:s,height:r}=i;n.index=0;const o=Nk(n.color);return n.bitmap={size:{width:s,height:r},uv:o,pixel:[Math.floor(o[0]*s),Math.floor(o[1]*r)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let i=e;return $_(e)&&(i=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),Rk(i,this.context.viewport.resolution)}_getModel(){return new Yt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{uniforms:i,moduleParameters:n}=e,{model:s,coordinateConversion:r,bounds:o,disablePicking:a}=this.state,{image:c,desaturate:l,transparentColor:u,tintColor:h}=this.props;n.picking.isActive&&a||c&&s&&(s.setUniforms(i),s.setBindings({bitmapTexture:c}),s.setUniforms({desaturate:l,transparentColor:u.map(f=>f/255),tintColor:h.slice(0,3).map(f=>f/255),coordinateConversion:r,bounds:o}),s.draw(this.context.renderPass))}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:i,DEFAULT:n}=ge;let{_imageCoordinateSystem:s}=this.props;if(s!==n){const{bounds:r}=this.props;if(!$_(r))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:i;if(s=s===e?e:i,s===e&&o===i)return{coordinateConversion:-1,bounds:r};if(s===i&&o===e){const a=gn([r[0],r[1]]),c=gn([r[2],r[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],c[0],c[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}};Jc.layerName="BitmapLayer",Jc.defaultProps=Ok;let lf=Jc;function Nk(t){const[e,i,n]=t,s=(n&240)/256,r=(n&15)/16;return[(e+r)/256,(i+s)/256]}function $_(t){return Number.isFinite(t[0])}const kk=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,Dk=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Fk=1024,Lk=4,H_=()=>{},W_={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Bk={x:0,y:0,width:0,height:0};function Uk(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function zk(t,e,i,n){const s=Math.min(i/e.width,n/e.height),r=Math.floor(e.width*s),o=Math.floor(e.height*s);return s===1?{data:e,width:r,height:o}:(t.canvas.height=o,t.canvas.width=r,t.clearRect(0,0,r,o),t.drawImage(e,0,0,e.width,e.height,0,0,r,o),{data:t.canvas,width:r,height:o})}function Po(t){return t&&(t.id||t.url)}function Vk(t,e,i,n){const{width:s,height:r,device:o}=t,a=o.createTexture({format:"rgba8unorm",width:e,height:i,sampler:n}),c=o.createCommandEncoder();return c.copyTextureToTexture({source:t,destination:a,width:s,height:r}),c.finish(),t.destroy(),a}function X_(t,e,i){for(let n=0;n<e.length;n++){const{icon:s,xOffset:r}=e[n],o=Po(s);t[o]={...s,x:r,y:i}}}function jk({icons:t,buffer:e,mapping:i={},xOffset:n=0,yOffset:s=0,rowHeight:r=0,canvasWidth:o}){let a=[];for(let c=0;c<t.length;c++){const l=t[c],u=Po(l);if(!i[u]){const{height:h,width:f}=l;n+f+e>o&&(X_(i,a,s),n=0,s=r+s+e,r=0,a=[]),a.push({icon:l,xOffset:n}),n=n+f+e,r=Math.max(r,h)}}return a.length>0&&X_(i,a,s),{mapping:i,rowHeight:r,xOffset:n,yOffset:s,canvasWidth:o,canvasHeight:Uk(r+s+e)}}function $k(t,e,i){if(!t||!e)return null;i=i||{};const n={},{iterable:s,objectInfo:r}=Tl(t);for(const o of s){r.index++;const a=e(o,r),c=Po(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!n[c]&&(!i[c]||a.url!==i[c].url)&&(n[c]={...a,source:o,sourceIndex:r.index})}return n}class Hk{constructor(e,{onUpdate:i=H_,onError:n=H_}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Lk,this._canvasWidth=Fk,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=i,this.onError=n}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const i=this._autoPacking?Po(e):e;return this._mapping[i]||Bk}setProps({loadOptions:e,autoPacking:i,iconAtlas:n,iconMapping:s,textureParameters:r}){var o;e&&(this._loadOptions=e),i!==void 0&&(this._autoPacking=i),s&&(this._mapping=s),n&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=n),r&&(this._textureParameters=r)}get isLoaded(){return this._pendingCount===0}packIcons(e,i){if(!this._autoPacking||typeof document>"u")return;const n=Object.values($k(e,i,this._mapping)||{});if(n.length>0){const{mapping:s,xOffset:r,yOffset:o,rowHeight:a,canvasHeight:c}=jk({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=s,this._xOffset=r,this._yOffset=o,this._canvasHeight=c,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||W_})),this._texture.height!==this._canvasHeight&&(this._texture=Vk(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||W_)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(e){const i=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,Hn(n.url,this._loadOptions).then(s=>{const r=Po(n),o=this._mapping[r],{x:a,y:c,width:l,height:u}=o,{data:h,width:f,height:d}=zk(i,s,l,u);this._texture.setSubImageData({data:h,x:a+(l-f)/2,y:c+(u-d)/2,width:f,height:d}),o.width=f,o.height=d,this._texture.generateMipmap(),this.onUpdate()}).catch(s=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const wv=[0,0,0,255],Wk={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:wv},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},Qc=class Qc extends ji{getShaders(){return super.getShaders({vs:kk,fs:Dk,modules:[Tr,Er]})}initializeState(){this.state={iconManager:new Hk(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:wv},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var d;super.updateState(e);const{props:i,oldProps:n,changeFlags:s}=e,r=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:c,getIcon:l,textureParameters:u}=i,{iconManager:h}=this.state;if(typeof o=="string")return;const f=o||this.internalState.isAsyncPropLoading("iconAtlas");h.setProps({loadOptions:i.loadOptions,autoPacking:!f,iconAtlas:o,iconMapping:f?a:null,textureParameters:u}),f?n.iconMapping!==i.iconMapping&&r.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&h.packIcons(c,l),s.extensionsChanged&&((d=this.state.model)==null||d.destroy(),this.state.model=this._getModel(),r.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:i,sizeMinPixels:n,sizeMaxPixels:s,sizeUnits:r,billboard:o,alphaCutoff:a}=this.props,{iconManager:c}=this.state,l=c.getTexture();if(l){const u=this.state.model;u.setBindings({iconsTexture:l}),u.setUniforms(e),u.setUniforms({iconsTextureDim:[l.width,l.height],sizeUnits:os[r],sizeScale:i,sizeMinPixels:n,sizeMaxPixels:s,billboard:o,alphaCutoff:a}),u.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Yt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new mr({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())==null?void 0:n.props.onIconError;i?i(e):fe.error(e.error.message)()}getInstanceOffset(e){const{width:i,height:n,anchorX:s=i/2,anchorY:r=n/2}=this.state.iconManager.getIconMapping(e);return[i/2-s,n/2-r]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:i,y:n,width:s,height:r}=this.state.iconManager.getIconMapping(e);return[i,n,s,r]}};Qc.defaultProps=Wk,Qc.layerName="IconLayer";let yr=Qc;const Xk=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,qk=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,q_=[0,0,0,255],Yk={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:q_},getLineColor:{type:"accessor",value:q_},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},el=class el extends ji{getShaders(){return super.getShaders({vs:Xk,fs:qk,modules:[Tr,Er]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var i;super.updateState(e),e.changeFlags.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:i,radiusScale:n,radiusMinPixels:s,radiusMaxPixels:r,stroked:o,filled:a,billboard:c,antialiasing:l,lineWidthUnits:u,lineWidthScale:h,lineWidthMinPixels:f,lineWidthMaxPixels:d}=this.props,p=this.state.model;p.setUniforms(e),p.setUniforms({stroked:o?1:0,filled:a,billboard:c,antialiasing:l,radiusUnits:os[i],radiusScale:n,radiusMinPixels:s,radiusMaxPixels:r,lineWidthUnits:os[u],lineWidthScale:h,lineWidthMinPixels:f,lineWidthMaxPixels:d}),p.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Yt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new mr({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};el.defaultProps=Yk,el.layerName="ScatterplotLayer";let uf=el;const Tv={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Ev(t,e,i={}){return Kk(t,i)!==e?(Gk(t,i),!0):!1}function Kk(t,e={}){return Math.sign(Zk(t,e))}const Y_={x:0,y:1,z:2};function Zk(t,e={}){const{start:i=0,end:n=t.length,plane:s="xy"}=e,r=e.size||2;let o=0;const a=Y_[s[0]],c=Y_[s[1]];for(let l=i,u=n-r;l<n;l+=r)o+=(t[l+a]-t[u+a])*(t[l+c]+t[u+c]),u=l;return o/2}function Gk(t,e){const{start:i=0,end:n=t.length,size:s=2}=e,r=(n-i)/s,o=Math.floor(r/2);for(let a=0;a<o;++a){const c=i+a*s,l=i+(r-1-a)*s;for(let u=0;u<s;++u){const h=t[c+u];t[c+u]=t[l+u],t[l+u]=h}}}function ui(t,e){const i=e.length,n=t.length;if(n>0){let s=!0;for(let r=0;r<i;r++)if(t[n-i+r]!==e[r]){s=!1;break}if(s)return!1}for(let s=0;s<i;s++)t[n+s]=e[s];return!0}function hf(t,e){const i=e.length;for(let n=0;n<i;n++)t[n]=e[n]}function Mo(t,e,i,n,s=[]){const r=n+e*i;for(let o=0;o<i;o++)s[o]=t[r+o];return s}function ff(t,e,i,n,s=[]){let r,o;if(i&8)r=(n[3]-t[1])/(e[1]-t[1]),o=3;else if(i&4)r=(n[1]-t[1])/(e[1]-t[1]),o=1;else if(i&2)r=(n[2]-t[0])/(e[0]-t[0]),o=2;else if(i&1)r=(n[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)s[a]=(o&1)===a?n[o]:r*(e[a]-t[a])+t[a];return s}function Va(t,e){let i=0;return t[0]<e[0]?i|=1:t[0]>e[2]&&(i|=2),t[1]<e[1]?i|=4:t[1]>e[3]&&(i|=8),i}function Sv(t,e){const{size:i=2,broken:n=!1,gridResolution:s=10,gridOffset:r=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},c=(a-o)/i;let l=[];const u=[l],h=Mo(t,0,i,o);let f,d;const p=Rv(h,s,r,[]),g=[];ui(l,h);for(let _=1;_<c;_++){for(f=Mo(t,_,i,o,f),d=Va(f,p);d;){ff(h,f,d,p,g);const b=Va(g,p);b&&(ff(h,g,b,p,g),d=b),ui(l,g),hf(h,g),Qk(p,s,d),n&&l.length>i&&(l=[],u.push(l),ui(l,h)),d=Va(f,p)}ui(l,f),hf(h,f)}return n?u:u[0]}const K_=0,Jk=1;function Av(t,e=null,i){if(!t.length)return[];const{size:n=2,gridResolution:s=10,gridOffset:r=[0,0],edgeTypes:o=!1}=i||{},a=[],c=[{pos:t,types:o?new Array(t.length/n).fill(Jk):null,holes:e||[]}],l=[[],[]];let u=[];for(;c.length;){const{pos:h,types:f,holes:d}=c.shift();e4(h,n,d[0]||h.length,l),u=Rv(l[0],s,r,u);const p=Va(l[1],u);if(p){let g=Z_(h,f,n,0,d[0]||h.length,u,p);const _={pos:g[0].pos,types:g[0].types,holes:[]},b={pos:g[1].pos,types:g[1].types,holes:[]};c.push(_,b);for(let T=0;T<d.length;T++)g=Z_(h,f,n,d[T],d[T+1]||h.length,u,p),g[0]&&(_.holes.push(_.pos.length),_.pos=wa(_.pos,g[0].pos),o&&(_.types=wa(_.types,g[0].types))),g[1]&&(b.holes.push(b.pos.length),b.pos=wa(b.pos,g[1].pos),o&&(b.types=wa(b.types,g[1].types)))}else{const g={positions:h};o&&(g.edgeTypes=f),d.length&&(g.holeIndices=d),a.push(g)}}return a}function Z_(t,e,i,n,s,r,o){const a=(s-n)/i,c=[],l=[],u=[],h=[],f=[];let d,p,g;const _=Mo(t,a-1,i,n);let b=Math.sign(o&8?_[1]-r[3]:_[0]-r[2]),T=e&&e[a-1],v=0,E=0;for(let R=0;R<a;R++)d=Mo(t,R,i,n,d),p=Math.sign(o&8?d[1]-r[3]:d[0]-r[2]),g=e&&e[n/i+R],p&&b&&b!==p&&(ff(_,d,o,r,f),ui(c,f)&&u.push(T),ui(l,f)&&h.push(T)),p<=0?(ui(c,d)&&u.push(g),v-=p):u.length&&(u[u.length-1]=K_),p>=0?(ui(l,d)&&h.push(g),E+=p):h.length&&(h[h.length-1]=K_),hf(_,d),b=p,T=g;return[v?{pos:c,types:e&&u}:null,E?{pos:l,types:e&&h}:null]}function Rv(t,e,i,n){const s=Math.floor((t[0]-i[0])/e)*e+i[0],r=Math.floor((t[1]-i[1])/e)*e+i[1];return n[0]=s,n[1]=r,n[2]=s+e,n[3]=r+e,n}function Qk(t,e,i){i&8?(t[1]+=e,t[3]+=e):i&4?(t[1]-=e,t[3]-=e):i&2?(t[0]+=e,t[2]+=e):i&1&&(t[0]-=e,t[2]-=e)}function e4(t,e,i,n){let s=1/0,r=-1/0,o=1/0,a=-1/0;for(let c=0;c<i;c+=e){const l=t[c],u=t[c+1];s=l<s?l:s,r=l>r?l:r,o=u<o?u:o,a=u>a?u:a}return n[0][0]=s,n[0][1]=o,n[1][0]=r,n[1][1]=a,n}function wa(t,e){for(let i=0;i<e.length;i++)t.push(e[i]);return t}const t4=85.051129;function i4(t,e){const{size:i=2,startIndex:n=0,endIndex:s=t.length,normalize:r=!0}=e||{},o=t.slice(n,s);Cv(o,i,0,s-n);const a=Sv(o,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(r)for(const c of a)xv(c,i);return a}function n4(t,e=null,i){const{size:n=2,normalize:s=!0,edgeTypes:r=!1}=i||{};e=e||[];const o=[],a=[];let c=0,l=0;for(let h=0;h<=e.length;h++){const f=e[h]||t.length,d=l,p=s4(t,n,c,f);for(let g=p;g<f;g++)o[l++]=t[g];for(let g=c;g<p;g++)o[l++]=t[g];Cv(o,n,d,l),r4(o,n,d,l,i==null?void 0:i.maxLatitude),c=f,a[h]=l}a.pop();const u=Av(o,a,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:r});if(s)for(const h of u)xv(h.positions,n);return u}function s4(t,e,i,n){let s=-1,r=-1;for(let o=i+1;o<n;o+=e){const a=Math.abs(t[o]);a>s&&(s=a,r=o-1)}return r}function r4(t,e,i,n,s=t4){const r=t[i],o=t[n-e];if(Math.abs(r-o)>180){const a=Mo(t,0,e,i);a[0]+=Math.round((o-r)/360)*360,ui(t,a),a[1]=Math.sign(a[1])*s,ui(t,a),a[0]=r,ui(t,a)}}function Cv(t,e,i,n){let s=t[0],r;for(let o=i;o<n;o+=e){r=t[o];const a=r-s;(a>180||a<-180)&&(r-=Math.round(a/360)*360),t[o]=s=r}}function xv(t,e){let i;const n=t.length/e;for(let r=0;r<n&&(i=t[r*e],(i+180)%360===0);r++);const s=-Math.round(i/360)*360;if(s!==0)for(let r=0;r<n;r++)t[r*e]+=s}function o4(t,e,i,n){let s;if(Array.isArray(t[0])){const r=t.length*e;s=new Array(r);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)s[o*e+a]=t[o][a]||0}else s=t;return i?Sv(s,{size:e,gridResolution:i}):n?i4(s,{size:e}):s}const a4=1,c4=2,xu=4;class l4 extends bv{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?o4(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(G_(e)){let n=0;for(const s of e)n+=this.getGeometrySize(s);return n}const i=this.getPathLength(e);return i<2?0:this.isClosed(e)?i<3?0:i+2:i}updateGeometryAttributes(e,i){if(i.geometrySize!==0)if(e&&G_(e))for(const n of e){const s=this.getGeometrySize(n);i.geometrySize=s,this.updateGeometryAttributes(n,i),i.vertexStart+=s}else this._updateSegmentTypes(e,i),this._updatePositions(e,i)}_updateSegmentTypes(e,i){const n=this.attributes.segmentTypes,s=e?this.isClosed(e):!1,{vertexStart:r,geometrySize:o}=i;n.fill(0,r,r+o),s?(n[r]=xu,n[r+o-2]=xu):(n[r]+=a4,n[r+o-2]+=c4),n[r+o-1]=xu}_updatePositions(e,i){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:s,geometrySize:r}=i,o=new Array(3);for(let a=s,c=0;c<r;a++,c++)this.getPointOnPath(e,c,o),n[a*3]=o[0],n[a*3+1]=o[1],n[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,i,n=[]){const{positionSize:s}=this;i*s>=e.length&&(i+=1-e.length/s);const r=i*s;return n[0]=e[r],n[1]=e[r+1],n[2]=s===3&&e[r+2]||0,n}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:i}=this,n=e.length-i;return e[0]===e[n]&&e[1]===e[n+1]&&(i===2||e[2]===e[n+2])}}function G_(t){return Array.isArray(t[0])}const u4=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,h4=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Pv=[0,0,0,255],f4={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:Pv},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Pu={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},tl=class tl extends ji{getShaders(){return super.getShaders({vs:u4,fs:h4,modules:[Tr,Er]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Pu,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Pu,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Pu,defaultValue:Pv},instancePickingColors:{size:4,type:"uint8",accessor:(n,{index:s,target:r})=>this.encodePickingColor(n&&n.__source?n.__source.index:s,r)}}),this.setState({pathTesselator:new l4({fp64:this.use64bitPositions()})})}updateState(e){var o;super.updateState(e);const{props:i,changeFlags:n}=e,s=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,c=i.data.attributes||{};a.updateGeometry({data:i.data,geometryBuffer:c.getPath,buffers:c,normalize:!i._pathType,loop:i._pathType==="loop",getGeometry:i.getPath,positionFormat:i.positionFormat,wrapLongitude:i.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),n.dataChanged||s.invalidateAll()}n.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),s.invalidateAll())}getPickingInfo(e){const i=super.getPickingInfo(e),{index:n}=i,s=this.props.data;return s[0]&&s[0].__source&&(i.object=s.find(r=>r.__source.index===n)),i}disablePickingIndex(e){const i=this.props.data;if(i[0]&&i[0].__source)for(let n=0;n<i.length;n++)i[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:i,capRounded:n,billboard:s,miterLimit:r,widthUnits:o,widthScale:a,widthMinPixels:c,widthMaxPixels:l}=this.props,u=this.state.model;u.setUniforms(e),u.setUniforms({jointType:Number(i),capType:Number(n),billboard:s,widthUnits:os[o],widthScale:a,miterLimit:r,widthMinPixels:c,widthMaxPixels:l}),u.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Yt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new mr({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("positions")}calculateSegmentTypes(e){const{pathTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("segmentTypes")}};tl.defaultProps=f4,tl.layerName="PathLayer";let df=tl;const Ta=Tv.CLOCKWISE,J_=Tv.COUNTER_CLOCKWISE,ln={isClosed:!0};function d4(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Gr(t){return"positions"in t?t.positions:t}function ja(t){return"holeIndices"in t?t.holeIndices:null}function p4(t){return Array.isArray(t[0])}function g4(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function _4(t){const e=t[0],i=t[t.length-1];return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]}function m4(t,e,i,n){for(let s=0;s<e;s++)if(t[i+s]!==t[n-e+s])return!1;return!0}function Q_(t,e,i,n,s){let r=e;const o=i.length;for(let a=0;a<o;a++)for(let c=0;c<n;c++)t[r++]=i[a][c]||0;if(!_4(i))for(let a=0;a<n;a++)t[r++]=i[0][a]||0;return ln.start=e,ln.end=r,ln.size=n,Ev(t,s,ln),r}function e0(t,e,i,n,s=0,r,o){r=r||i.length;const a=r-s;if(a<=0)return e;let c=e;for(let l=0;l<a;l++)t[c++]=i[s+l];if(!m4(i,n,s,r))for(let l=0;l<n;l++)t[c++]=i[s+l];return ln.start=e,ln.end=c,ln.size=n,Ev(t,o,ln),c}function y4(t,e){d4(t);const i=[],n=[];if("positions"in t){const{positions:s,holeIndices:r}=t;if(r){let o=0;for(let a=0;a<=r.length;a++)o=e0(i,o,s,e,r[a-1],r[a],a===0?Ta:J_),n.push(o);return n.pop(),{positions:i,holeIndices:n}}t=s}if(!p4(t))return e0(i,0,t,e,0,i.length,Ta),i;if(!g4(t)){let s=0;for(const[r,o]of t.entries())s=Q_(i,s,o,e,r===0?Ta:J_),n.push(s);return n.pop(),{positions:i,holeIndices:n}}return Q_(i,0,t,e,Ta),i}function Mu(t,e,i){const n=t.length/3;let s=0;for(let r=0;r<n;r++){const o=(r+1)%n;s+=t[r*3+e]*t[o*3+i],s-=t[o*3+e]*t[r*3+i]}return Math.abs(s/2)}function t0(t,e,i,n){const s=t.length/3;for(let r=0;r<s;r++){const o=r*3,a=t[o+0],c=t[o+1],l=t[o+2];t[o+e]=a,t[o+i]=c,t[o+n]=l}}function v4(t,e,i,n){let s=ja(t);s&&(s=s.map(a=>a/e));let r=Gr(t);const o=n&&e===3;if(i){const a=r.length;r=r.slice();const c=[];for(let l=0;l<a;l+=e){c[0]=r[l],c[1]=r[l+1],o&&(c[2]=r[l+2]);const u=i(c);r[l]=u[0],r[l+1]=u[1],o&&(r[l+2]=u[2])}}if(o){const a=Mu(r,0,1),c=Mu(r,0,2),l=Mu(r,1,2);if(!a&&!c&&!l)return[];a>c&&a>l||(c>l?(i||(r=r.slice()),t0(r,0,2,1)):(i||(r=r.slice()),t0(r,2,0,1)))}return kE(r,s,e)}class b4 extends bv{constructor(e){const{fp64:i,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:i?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:i}=this;return e==="indices"?i.indices&&i.indices.subarray(0,this.vertexCount):i[e]}updateGeometry(e){super.updateGeometry(e);const i=this.buffers.indices;if(i)this.vertexCount=(i.value||i).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const i=y4(e,this.positionSize);return this.opts.resolution?Av(Gr(i),ja(i),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?n4(Gr(i),ja(i),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):i}return e}getGeometrySize(e){if(i0(e)){let i=0;for(const n of e)i+=this.getGeometrySize(n);return i}return Gr(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,i){if(e&&i0(e))for(const n of e){const s=this.getGeometrySize(n);i.geometrySize=s,this.updateGeometryAttributes(n,i),i.vertexStart+=s,i.indexStart=this.indexStarts[i.geometryIndex+1]}else{const n=e;this._updateIndices(n,i),this._updatePositions(n,i),this._updateVertexValid(n,i)}}_updateIndices(e,{geometryIndex:i,vertexStart:n,indexStart:s}){const{attributes:r,indexStarts:o,typedArrayManager:a}=this;let c=r.indices;if(!c||!e)return;let l=s;const u=v4(e,this.positionSize,this.opts.preproject,this.opts.full3d);c=a.allocate(c,s+u.length,{copy:!0});for(let h=0;h<u.length;h++)c[l++]=u[h]+n;o[i+1]=s+u.length,r.indices=c}_updatePositions(e,{vertexStart:i,geometrySize:n}){const{attributes:{positions:s},positionSize:r}=this;if(!s||!e)return;const o=Gr(e);for(let a=i,c=0;c<n;a++,c++){const l=o[c*r],u=o[c*r+1],h=r>2?o[c*r+2]:0;s[a*3]=l,s[a*3+1]=u,s[a*3+2]=h}}_updateVertexValid(e,{vertexStart:i,geometrySize:n}){const{positionSize:s}=this,r=this.attributes.vertexValid,o=e&&ja(e);if(e&&e.edgeTypes?r.set(e.edgeTypes,i):r.fill(1,i,i+n),o)for(let a=0;a<o.length;a++)r[i+o[a]/s-1]=0;r[i+n-1]=0}}function i0(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const Mv=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
out vec4 vColor;
struct PolygonProps {
vec4 fillColors;
vec4 lineColors;
vec3 positions;
vec3 positions64Low;
vec3 pickingColors;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? props.lineColors : props.fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = props.pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,w4=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
${Mv}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.fillColors = fillColors;
props.lineColors = lineColors;
props.pickingColors = pickingColors;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,T4=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 instancePositions;
in vec3 instanceNextPositions;
in vec3 instancePositions64Low;
in vec3 instanceNextPositions64Low;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
in float instanceVertexValid;
${Mv}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = instancePositions;
pos64Low = instancePositions64Low;
nextPos = instanceNextPositions;
nextPos64Low = instanceNextPositions64Low;
#else
pos = instanceNextPositions;
pos64Low = instanceNextPositions64Low;
nextPos = instancePositions;
nextPos64Low = instancePositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = instanceElevations * positions.y;
props.fillColors = instanceFillColors;
props.lineColors = instanceLineColors;
props.pickingColors = instancePickingColors;
calculatePosition(props);
}
`,E4=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Sc=[0,0,0,255],S4={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Sc},getLineColor:{type:"accessor",value:Sc},material:!0},Ea={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},il=class il extends ji{getShaders(e){return super.getShaders({vs:e==="top"?w4:T4,fs:E4,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Tr,ox,Er]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:n}=this.props;e.isGeospatial&&i===ge.DEFAULT&&(i=ge.LNGLAT);let s;i===ge.LNGLAT&&(n?s=e.projectPosition.bind(e):s=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new b4({preproject:s,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const r=this.getAttributeManager(),o=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:Ea,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{instancePositions:{vertexOffset:0,divisor:1},instanceNextPositions:{vertexOffset:1,divisor:1}}},instanceVertexValid:{size:1,type:"uint16",divisor:1,update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,transition:Ea,accessor:"getElevation",shaderAttributes:{instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:Ea,accessor:"getFillColor",defaultValue:Sc,shaderAttributes:{instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:Ea,accessor:"getLineColor",defaultValue:Sc,shaderAttributes:{instanceLineColors:{divisor:1}}},pickingColors:{size:4,type:"uint8",accessor:(a,{index:c,target:l})=>this.encodePickingColor(a&&a.__source?a.__source.index:c,l),shaderAttributes:{instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const i=super.getPickingInfo(e),{index:n}=i,s=this.props.data;return s[0]&&s[0].__source&&(i.object=s.find(r=>r.__source.index===n)),i}disablePickingIndex(e){const i=this.props.data;if(i[0]&&i[0].__source)for(let n=0;n<i.length;n++)i[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:i,filled:n,wireframe:s,elevationScale:r}=this.props,{topModel:o,sideModel:a,wireframeModel:c,polygonTesselator:l}=this.state,u={...e,extruded:!!i,elevationScale:r};c&&s&&(c.setInstanceCount(l.instanceCount-1),c.setUniforms(u),c.draw(this.context.renderPass)),a&&n&&(a.setInstanceCount(l.instanceCount-1),a.setUniforms(u),a.draw(this.context.renderPass)),o&&n&&(o.setVertexCount(l.vertexCount),o.setUniforms(u),o.draw(this.context.renderPass))}updateState(e){var a;super.updateState(e),this.updateGeometry(e);const{props:i,oldProps:n,changeFlags:s}=e,r=this.getAttributeManager();(s.extensionsChanged||i.filled!==n.filled||i.extruded!==n.extruded)&&((a=this.state.models)==null||a.forEach(c=>c.destroy()),this.setState(this._getModels()),r.invalidateAll())}updateGeometry({props:e,oldProps:i,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:r}=this.state,o=e.data.attributes||{};r.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:r.instanceCount,startIndices:r.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:i,extruded:n}=this.props;let s,r,o;const a=this.getAttributeManager().getBufferLayouts();if(i){const c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1,s=new Yt(this.context.device,{...c,id:`${e}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:a,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}return n&&(r=new Yt(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,uniforms:{isWireframe:!1},geometry:new mr({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new Yt(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,uniforms:{isWireframe:!0},geometry:new mr({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})),{models:[r,o,s].filter(Boolean),topModel:s,sideModel:r,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:i}=this.state;e.startIndices=i.indexStarts,e.value=i.get("indices")}calculatePositions(e){const{polygonTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}};il.defaultProps=S4,il.layerName="SolidPolygonLayer";let pf=il;function A4({data:t,getIndex:e,dataRange:i,replace:n}){const{startRow:s=0,endRow:r=1/0}=i,o=t.length;let a=o,c=o;for(let f=0;f<o;f++){const d=e(t[f]);if(a>f&&d>=s&&(a=f),d>=r){c=f;break}}let l=a;const h=c-a!==n.length?t.slice(c):void 0;for(let f=0;f<n.length;f++)t[l++]=n[f];if(h){for(let f=0;f<h.length;f++)t[l++]=h[f];t.length=l}return{startRow:a,endRow:a+n.length}}function R4(t,e){if(!t)return null;const i="startIndices"in t?t.startIndices[e]:e,n=t.featureIds.value[i];return i!==-1?C4(t,n,i):null}function C4(t,e,i){const n={properties:{...t.properties[e]}};for(const s in t.numericProps)n.properties[s]=t.numericProps[s].value[i];return n}function x4(t,e){const i={points:null,lines:null,polygons:null};for(const n in i){const s=t[n].globalFeatureIds.value;i[n]=new Uint8ClampedArray(s.length*3);const r=[];for(let o=0;o<s.length;o++)e(s[o],r),i[n][o*3+0]=r[0],i[n][o*3+1]=r[1],i[n][o*3+2]=r[2]}return i}const P4=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Iu=192/256,n0=[],M4={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},nl=class nl extends yr{getShaders(){return{...super.getShaders(),fs:P4}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(i,{index:n,target:s})=>this.encodePickingColor(n,s)}})}updateState(e){super.updateState(e);const{props:i,oldProps:n}=e;let{outlineColor:s}=i;s!==n.outlineColor&&(s=s.map(r=>r/255),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!i.sdf&&i.outlineWidth&&fe.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:i,smoothing:n,outlineWidth:s}=this.props,{outlineColor:r}=this.state,o=s?Math.max(n,Iu*(1-s)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:Iu,outlineBuffer:o,gamma:n,sdf:!!i,outlineColor:r},super.draw(e),i&&s){const{iconManager:a}=this.state,c=a.getTexture(),l=this.state.model;c&&(l.setUniforms({outlineBuffer:Iu}),l.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(i=>super.getInstanceOffset(i)):n0}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(i=>super.getInstanceIconFrame(i)):n0}};nl.defaultProps=M4,nl.layerName="MultiIconLayer";let gf=nl;const oo=1e20;class I4{constructor({fontSize:e=24,buffer:i=3,radius:n=8,cutoff:s=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=i,this.cutoff=s,this.radius=n;const c=this.size=e+i*4,l=this._createCanvas(c),u=this.ctx=l.getContext("2d",{willReadFrequently:!0});u.font=`${a} ${o} ${e}px ${r}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(c*c),this.gridInner=new Float64Array(c*c),this.f=new Float64Array(c),this.z=new Float64Array(c+1),this.v=new Uint16Array(c)}_createCanvas(e){const i=document.createElement("canvas");return i.width=i.height=e,i}draw(e){const{width:i,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(n),c=0,l=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),u=Math.min(this.size-this.buffer,a+Math.ceil(s)),h=l+2*this.buffer,f=u+2*this.buffer,d=Math.max(h*f,0),p=new Uint8ClampedArray(d),g={data:p,width:h,height:f,glyphWidth:l,glyphHeight:u,glyphTop:a,glyphLeft:c,glyphAdvance:i};if(l===0||u===0)return g;const{ctx:_,buffer:b,gridInner:T,gridOuter:v}=this;_.clearRect(b,b,l,u),_.fillText(e,b,b+a);const E=_.getImageData(b,b,l,u);v.fill(oo,0,d),T.fill(0,0,d);for(let R=0;R<u;R++)for(let P=0;P<l;P++){const M=E.data[4*(R*l+P)+3]/255;if(M===0)continue;const U=(R+b)*h+P+b;if(M===1)v[U]=0,T[U]=oo;else{const O=.5-M;v[U]=O>0?O*O:0,T[U]=O<0?O*O:0}}s0(v,0,0,h,f,h,this.f,this.v,this.z),s0(T,b,b,l,u,h,this.f,this.v,this.z);for(let R=0;R<d;R++){const P=Math.sqrt(v[R])-Math.sqrt(T[R]);p[R]=Math.round(255-255*(P/this.radius+this.cutoff))}return g}}function s0(t,e,i,n,s,r,o,a,c){for(let l=e;l<e+n;l++)r0(t,i*r+l,r,s,o,a,c);for(let l=i;l<i+s;l++)r0(t,l*r+e,1,n,o,a,c)}function r0(t,e,i,n,s,r,o){r[0]=0,o[0]=-oo,o[1]=oo,s[0]=t[e];for(let a=1,c=0,l=0;a<n;a++){s[a]=t[e+a*i];const u=a*a;do{const h=r[c];l=(s[a]-s[h]+u-h*h)/(a-h)/2}while(l<=o[c]&&--c>-1);c++,r[c]=a,o[c]=l,o[c+1]=oo}for(let a=0,c=0;a<n;a++){for(;o[c+1]<a;)c++;const l=r[c],u=a-l;t[e+a*i]=s[l]+u*u}}const O4=32,N4=[];function k4(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function D4({characterSet:t,getFontWidth:e,fontHeight:i,buffer:n,maxCanvasWidth:s,mapping:r={},xOffset:o=0,yOffset:a=0}){let c=0,l=o;const u=i+n*2;for(const h of t)if(!r[h]){const f=e(h);l+f+n*2>s&&(l=0,c++),r[h]={x:l+n,y:a+c*u+n,width:f,height:u,layoutWidth:f,layoutHeight:i},l+=f+n*2}return{mapping:r,xOffset:l,yOffset:a+c*u,canvasHeight:k4(a+(c+1)*u)}}function Iv(t,e,i,n){var r;let s=0;for(let o=e;o<i;o++){const a=t[o];s+=((r=n[a])==null?void 0:r.layoutWidth)||0}return s}function Ov(t,e,i,n,s,r){let o=e,a=0;for(let c=e;c<i;c++){const l=Iv(t,c,c+1,s);a+l>n&&(o<c&&r.push(c),o=c,a=0),a+=l}return a}function F4(t,e,i,n,s,r){let o=e,a=e,c=e,l=0;for(let u=e;u<i;u++)if((t[u]===" "||t[u+1]===" "||u+1===i)&&(c=u+1),c>a){let h=Iv(t,a,c,s);l+h>n&&(o<a&&(r.push(a),o=a,l=0),h>n&&(h=Ov(t,a,c,n,s,r),o=r[r.length-1])),a=c,l+=h}return l}function L4(t,e,i,n,s=0,r){r===void 0&&(r=t.length);const o=[];return e==="break-all"?Ov(t,s,r,i,n,o):F4(t,s,r,i,n,o),o}function B4(t,e,i,n,s,r){let o=0,a=0;for(let c=e;c<i;c++){const l=t[c],u=n[l];u?(a||(a=u.layoutHeight),s[c]=o+u.layoutWidth/2,o+=u.layoutWidth):(fe.warn(`Missing character: ${l} (${l.codePointAt(0)})`)(),s[c]=o,o+=O4)}r[0]=o,r[1]=a}function U4(t,e,i,n,s){var _;const r=Array.from(t),o=r.length,a=new Array(o),c=new Array(o),l=new Array(o),u=(i==="break-word"||i==="break-all")&&isFinite(n)&&n>0,h=[0,0],f=[0,0];let d=0,p=0,g=0;for(let b=0;b<=o;b++){const T=r[b];if((T===`
`||b===o)&&(g=b),g>p){const v=u?L4(r,i,n,s,p,g):N4;for(let E=0;E<=v.length;E++){const R=E===0?p:v[E-1],P=E<v.length?v[E]:g;B4(r,R,P,s,a,f);for(let M=R;M<P;M++){const U=r[M],O=((_=s[U])==null?void 0:_.layoutOffsetY)||0;c[M]=d+f[1]/2+O,l[M]=f[0]}d=d+f[1]*e,h[0]=Math.max(h[0],f[0])}p=g}T===`
`&&(a[p]=0,c[p]=0,l[p]=0,p++)}return h[1]=d,{x:a,y:c,rowWidth:l,size:h}}function z4({value:t,length:e,stride:i,offset:n,startIndices:s,characterSet:r}){const o=t.BYTES_PER_ELEMENT,a=i?i/o:1,c=n?n/o:0,l=s[e]||Math.ceil((t.length-c)/a),u=r&&new Set,h=new Array(e);let f=t;if(a>1||c>0){const d=t.constructor;f=new d(l);for(let p=0;p<l;p++)f[p]=t[p*a+c]}for(let d=0;d<e;d++){const p=s[d],g=s[d+1]||l,_=f.subarray(p,g);h[d]=String.fromCodePoint.apply(null,_),u&&_.forEach(u.add,u)}if(u)for(const d of u)r.add(String.fromCodePoint(d));return{texts:h,characterCount:l}}class Nv{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const i=this._cache[e];return i&&(this._deleteOrder(e),this._appendOrder(e)),i}set(e,i){this._cache[e]?(this.delete(e),this._cache[e]=i,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=i,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const i=this._order.indexOf(e);i>=0&&this._order.splice(i,1)}_appendOrder(e){this._order.push(e)}}function V4(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Qs={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:V4(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},o0=1024,a0=.9,c0=1.2,kv=3;let Ac=new Nv(kv);function j4(t,e){let i;typeof e=="string"?i=new Set(Array.from(e)):i=new Set(e);const n=Ac.get(t);if(!n)return i;for(const s in n.mapping)i.has(s)&&i.delete(s);return i}function $4(t,e){for(let i=0;i<t.length;i++)e.data[4*i+3]=t[i]}function l0(t,e,i,n){t.font=`${n} ${i}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function H4(t){fe.assert(Number.isFinite(t)&&t>=kv,"Invalid cache limit"),Ac=new Nv(t)}class W4{constructor(){this.props={...Qs}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:i}=this.props;return(e*c0+i*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const i=j4(this._key,this.props.characterSet),n=Ac.get(this._key);if(n&&i.size===0){this._atlas!==n&&(this._atlas=n);return}const s=this._generateFontAtlas(i,n);this._atlas=s,Ac.set(this._key,s)}_generateFontAtlas(e,i){const{fontFamily:n,fontWeight:s,fontSize:r,buffer:o,sdf:a,radius:c,cutoff:l}=this.props;let u=i&&i.data;u||(u=document.createElement("canvas"),u.width=o0);const h=u.getContext("2d",{willReadFrequently:!0});l0(h,n,r,s);const{mapping:f,canvasHeight:d,xOffset:p,yOffset:g}=D4({getFontWidth:_=>h.measureText(_).width,fontHeight:r*c0,buffer:o,characterSet:e,maxCanvasWidth:o0,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(u.height!==d){const _=h.getImageData(0,0,u.width,u.height);u.height=d,h.putImageData(_,0,0)}if(l0(h,n,r,s),a){const _=new I4({fontSize:r,buffer:o,radius:c,cutoff:l,fontFamily:n,fontWeight:`${s}`});for(const b of e){const{data:T,width:v,height:E,glyphTop:R}=_.draw(b);f[b].width=v,f[b].layoutOffsetY=r*a0-R;const P=h.createImageData(v,E);$4(T,P),h.putImageData(P,f[b].x,f[b].y)}}else for(const _ of e)h.fillText(_,f[_].x,f[_].y+o+r*a0);return{xOffset:p,yOffset:g,mapping:f,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:e,fontWeight:i,fontSize:n,buffer:s,sdf:r,radius:o,cutoff:a}=this.props;return r?`${e} ${i} ${n} ${s} ${o} ${a}`:`${e} ${i} ${n} ${s}`}}const X4=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,q4=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Y4={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},sl=class sl extends ji{getShaders(){return super.getShaders({vs:X4,fs:q4,modules:[Tr,Er]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e);const{changeFlags:i}=e;i.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:i,sizeScale:n,sizeUnits:s,sizeMinPixels:r,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:c}=this.props;c.length<4&&(c=[c[0],c[1],c[0],c[1]]);const l=this.state.model;l.setUniforms(e),l.setUniforms({billboard:i,stroked:!!a,padding:c,sizeUnits:os[s],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:o}),l.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,1,1,0,1];return new Yt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new mr({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}};sl.defaultProps=Y4,sl.layerName="TextBackgroundLayer";let _f=sl;const u0={start:1,middle:0,end:-1},h0={top:1,center:0,bottom:-1},Ou=[0,0,0,255],K4=1,Z4={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Ou},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Qs.characterSet},fontFamily:Qs.fontFamily,fontWeight:Qs.fontWeight,lineHeight:K4,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Ou},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Ou},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},rl=class rl extends xo{constructor(){super(...arguments),this.getBoundingRect=(e,i)=>{let{size:[n,s]}=this.transformParagraph(e,i);const{fontSize:r}=this.state.fontAtlasManager.props;n/=r,s/=r;const{getTextAnchor:o,getAlignmentBaseline:a}=this.props,c=u0[typeof o=="function"?o(e,i):o],l=h0[typeof a=="function"?a(e,i):a];return[(c-1)*n/2,(l-1)*s/2,n,s]},this.getIconOffsets=(e,i)=>{const{getTextAnchor:n,getAlignmentBaseline:s}=this.props,{x:r,y:o,rowWidth:a,size:[c,l]}=this.transformParagraph(e,i),u=u0[typeof n=="function"?n(e,i):n],h=h0[typeof s=="function"?s(e,i):s],f=r.length,d=new Array(f*2);let p=0;for(let g=0;g<f;g++){const _=(1-u)*(c-a[g])/2;d[p++]=(u-1)*c/2+_+r[g],d[p++]=(h-1)*l/2+o[g]}return d}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new W4},this.props.maxWidth>0&&fe.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:i,oldProps:n,changeFlags:s}=e;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||i.lineHeight!==n.lineHeight||i.wordBreak!==n.wordBreak||i.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:i,fontWeight:n}=this.props,{fontAtlasManager:s,characterSet:r}=this.state,o={...e,characterSet:r,fontFamily:i,fontWeight:n};if(!s.mapping)return s.setProps(o),!0;for(const a in o)if(o[a]!==s.props[a])return s.setProps(o),!0;return!1}_updateText(){var c;const{data:e,characterSet:i}=this.props,n=(c=e.attributes)==null?void 0:c.getText;let{getText:s}=this.props,r=e.startIndices,o;const a=i==="auto"&&new Set;if(n&&r){const{texts:l,characterCount:u}=z4({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:r,characterSet:a});o=u,s=(h,{index:f})=>l[f]}else{const{iterable:l,objectInfo:u}=Tl(e);r=[0],o=0;for(const h of l){u.index++;const f=Array.from(s(h,u)||"");a&&f.forEach(a.add,a),o+=f.length,r.push(o)}}this.setState({getText:s,startIndices:r,numInstances:o,characterSet:a||i})}transformParagraph(e,i){const{fontAtlasManager:n}=this.state,s=n.mapping,r=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:c}=this.props,l=r(e,i)||"";return U4(l,a,o,c*n.props.fontSize,s)}renderLayers(){const{startIndices:e,numInstances:i,getText:n,fontAtlasManager:{scale:s,atlas:r,mapping:o},styleVersion:a}=this.state,{data:c,_dataDiff:l,getPosition:u,getColor:h,getSize:f,getAngle:d,getPixelOffset:p,getBackgroundColor:g,getBorderColor:_,getBorderWidth:b,backgroundPadding:T,background:v,billboard:E,fontSettings:R,outlineWidth:P,outlineColor:M,sizeScale:U,sizeUnits:O,sizeMinPixels:D,sizeMaxPixels:I,transitions:V,updateTriggers:k}=this.props,B=this.getSubLayerClass("characters",gf),F=this.getSubLayerClass("background",_f);return[v&&new F({getFillColor:g,getLineColor:_,getLineWidth:b,padding:T,getPosition:u,getSize:f,getAngle:d,getPixelOffset:p,billboard:E,sizeScale:U,sizeUnits:O,sizeMinPixels:D,sizeMaxPixels:I,transitions:V&&{getPosition:V.getPosition,getAngle:V.getAngle,getSize:V.getSize,getFillColor:V.getBackgroundColor,getLineColor:V.getBorderColor,getLineWidth:V.getBorderWidth,getPixelOffset:V.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:k.getPosition,getAngle:k.getAngle,getSize:k.getSize,getFillColor:k.getBackgroundColor,getLineColor:k.getBorderColor,getLineWidth:k.getBorderWidth,getPixelOffset:k.getPixelOffset,getBoundingRect:{getText:k.getText,getTextAnchor:k.getTextAnchor,getAlignmentBaseline:k.getAlignmentBaseline,styleVersion:a}}}),{data:c.attributes&&c.attributes.background?{length:c.length,attributes:c.attributes.background}:c,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new B({sdf:R.sdf,smoothing:Number.isFinite(R.smoothing)?R.smoothing:Qs.smoothing,outlineWidth:P/(R.radius||Qs.radius),outlineColor:M,iconAtlas:r,iconMapping:o,getPosition:u,getColor:h,getSize:f,getAngle:d,getPixelOffset:p,billboard:E,sizeScale:U*s,sizeUnits:O,sizeMinPixels:D*s,sizeMaxPixels:I*s,transitions:V&&{getPosition:V.getPosition,getAngle:V.getAngle,getColor:V.getColor,getSize:V.getSize,getPixelOffset:V.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:k.getText,getPosition:k.getPosition,getAngle:k.getAngle,getColor:k.getColor,getSize:k.getSize,getPixelOffset:k.getPixelOffset,getIconOffsets:{getTextAnchor:k.getTextAnchor,getAlignmentBaseline:k.getAlignmentBaseline,styleVersion:a}}}),{data:c,_dataDiff:l,startIndices:e,numInstances:i,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){H4(e)}};rl.defaultProps=Z4,rl.layerName="TextLayer";let Rc=rl;const $a={circle:{type:uf,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:yr,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Rc,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Ha={type:df,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},mf={type:pf,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Br({type:t,props:e}){const i={};for(const n in e)i[n]=t.defaultProps[e[n]];return i}function Nu(t,e){const{transitions:i,updateTriggers:n}=t.props,s={updateTriggers:{},transitions:i&&{getPosition:i.geometry}};for(const r in e){const o=e[r];let a=t.props[r];r.startsWith("get")&&(a=t.getSubLayerAccessor(a),s.updateTriggers[o]=n[r],i&&(s.transitions[o]=i[r])),s[o]=a}return s}function G4(t){if(Array.isArray(t))return t;switch(fe.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return fe.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function f0(t,e,i={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:r=t.length}=i;for(let o=s;o<r;o++){const a=t[o],{geometry:c}=a;if(c)if(c.type==="GeometryCollection"){fe.assert(Array.isArray(c.geometries),"GeoJSON does not have geometries array");const{geometries:l}=c;for(let u=0;u<l.length;u++){const h=l[u];d0(h,n,e,a,o)}}else d0(c,n,e,a,o)}return n}function d0(t,e,i,n,s){const{type:r,coordinates:o}=t,{pointFeatures:a,lineFeatures:c,polygonFeatures:l,polygonOutlineFeatures:u}=e;if(!Q4(r,o)){fe.warn(`${r} coordinates are malformed`)();return}switch(r){case"Point":a.push(i({geometry:t},n,s));break;case"MultiPoint":o.forEach(h=>{a.push(i({geometry:{type:"Point",coordinates:h}},n,s))});break;case"LineString":c.push(i({geometry:t},n,s));break;case"MultiLineString":o.forEach(h=>{c.push(i({geometry:{type:"LineString",coordinates:h}},n,s))});break;case"Polygon":l.push(i({geometry:t},n,s)),o.forEach(h=>{u.push(i({geometry:{type:"LineString",coordinates:h}},n,s))});break;case"MultiPolygon":o.forEach(h=>{l.push(i({geometry:{type:"Polygon",coordinates:h}},n,s)),h.forEach(f=>{u.push(i({geometry:{type:"LineString",coordinates:f}},n,s))})});break}}const J4={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Q4(t,e){let i=J4[t];for(fe.assert(i,`Unknown GeoJSON type ${t}`);e&&--i>0;)e=e[0];return e&&Number.isFinite(e[0])}function Dv(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Sa(t){return t.geometry.coordinates}function eD(t,e){const i=Dv(),{pointFeatures:n,lineFeatures:s,polygonFeatures:r,polygonOutlineFeatures:o}=t;return i.points.data=n,i.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),i.points.getPosition=Sa,i.lines.data=s,i.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),i.lines.getPath=Sa,i.polygons.data=r,i.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),i.polygons.getPolygon=Sa,i.polygonsOutline.data=o,i.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),i.polygonsOutline.getPath=Sa,i}function tD(t,e){const i=Dv(),{points:n,lines:s,polygons:r}=t,o=x4(t,e);return i.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:3,value:o.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},i.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.lines._pathType="open",i.polygons.data={length:r.polygonIndices.value.length-1,startIndices:r.polygonIndices.value,attributes:{...r.attributes,getPolygon:r.positions,pickingColors:{size:3,value:o.polygons}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},i.polygons._normalize=!1,r.triangles&&(i.polygons.data.attributes.indices=r.triangles.value),i.polygonsOutline.data={length:r.primitivePolygonIndices.value.length-1,startIndices:r.primitivePolygonIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:o.polygons}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},i.polygonsOutline._pathType="open",i}const iD=["points","linestrings","polygons"],nD={...Br($a.circle),...Br($a.icon),...Br($a.text),...Br(Ha),...Br(mf),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}},ol=class ol extends xo{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:i}){if(!i.dataChanged)return;const{data:n}=this.props,s=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:s}),s?this._updateStateBinary({props:e,changeFlags:i}):this._updateStateJSON({props:e,changeFlags:i})}_updateStateBinary({props:e,changeFlags:i}){const n=tD(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:i}){const n=G4(e.data),s=this.getSubLayerRow.bind(this);let r={};const o={};if(Array.isArray(i.dataChanged)){const c=this.state.features;for(const l in c)r[l]=c[l].slice(),o[l]=[];for(const l of i.dataChanged){const u=f0(n,s,l);for(const h in c)o[h].push(A4({data:r[h],getIndex:f=>f.__source.index,dataRange:l,replace:u[h]}))}}else r=f0(n,s);const a=eD(r,o);this.setState({features:r,featuresDiff:o,layerProps:a})}getPickingInfo(e){const i=super.getPickingInfo(e),{index:n,sourceLayer:s}=i;return i.featureType=iD.find(r=>s.id.startsWith(`${this.id}-${r}-`)),n>=0&&s.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(i.index=this.props.data.points.globalFeatureIds.value[n]),i}_updateAutoHighlight(e){const i=`${this.id}-points-`,n=e.featureType==="points";for(const s of this.getSubLayers())s.id.startsWith(i)===n&&s.updateAutoHighlight(e)}_renderPolygonLayer(){var o;const{extruded:e,wireframe:i}=this.props,{layerProps:n}=this.state,s="polygons-fill",r=this.shouldRenderSubLayer(s,(o=n.polygons)==null?void 0:o.data)&&this.getSubLayerClass(s,mf.type);if(r){const a=Nu(this,mf.props),c=e&&i;return c||delete a.getLineColor,a.updateTriggers.lineColors=c,new r(a,this.getSubLayerProps({id:s,updateTriggers:a.updateTriggers}),n.polygons)}return null}_renderLineLayers(){var c,l;const{extruded:e,stroked:i}=this.props,{layerProps:n}=this.state,s="polygons-stroke",r="linestrings",o=!e&&i&&this.shouldRenderSubLayer(s,(c=n.polygonsOutline)==null?void 0:c.data)&&this.getSubLayerClass(s,Ha.type),a=this.shouldRenderSubLayer(r,(l=n.lines)==null?void 0:l.data)&&this.getSubLayerClass(r,Ha.type);if(o||a){const u=Nu(this,Ha.props);return[o&&new o(u,this.getSubLayerProps({id:s,updateTriggers:u.updateTriggers}),n.polygonsOutline),a&&new a(u,this.getSubLayerProps({id:r,updateTriggers:u.updateTriggers}),n.lines)]}return null}_renderPointLayers(){var a;const{pointType:e}=this.props,{layerProps:i,binary:n}=this.state;let{highlightedObjectIndex:s}=this.props;!n&&Number.isFinite(s)&&(s=i.points.data.findIndex(c=>c.__source.index===s));const r=new Set(e.split("+")),o=[];for(const c of r){const l=`points-${c}`,u=$a[c],h=u&&this.shouldRenderSubLayer(l,(a=i.points)==null?void 0:a.data)&&this.getSubLayerClass(l,u.type);if(h){const f=Nu(this,u.props);let d=i.points;if(c==="text"&&n){const{instancePickingColors:p,...g}=d.data.attributes;d={...d,data:{...d.data,attributes:g}}}o.push(new h(f,this.getSubLayerProps({id:l,updateTriggers:f.updateTriggers,highlightedObjectIndex:s}),d))}}return o}renderLayers(){const{extruded:e}=this.props,i=this._renderPolygonLayer(),n=this._renderLineLayers(),s=this._renderPointLayers();return[!e&&i,n,s,e&&i]}getSubLayerAccessor(e){const{binary:i}=this.state;return!i||typeof e!="function"?super.getSubLayerAccessor(e):(n,s)=>{const{data:r,index:o}=s,a=R4(r,o);return e(a,s)}}};ol.layerName="GeoJsonLayer",ol.defaultProps=nD;let yf=ol;class sD{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:i,onLoad:n,onError:s}){const{index:r,id:o,bbox:a,userData:c,zoom:l}=this,u=this._loaderId;this._abortController=new AbortController;const{signal:h}=this._abortController,f=await i.scheduleRequest(this,g=>g.isSelected?1:-1);if(!f){this._isCancelled=!0;return}if(this._isCancelled){f.done();return}let d=null,p;try{d=await e({index:r,id:o,bbox:a,userData:c,zoom:l,signal:h})}catch(g){p=g||!0}finally{f.done()}if(u===this._loaderId){if(this._loader=void 0,this.content=d,this._isCancelled&&!d){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,p?s(p,this):n(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const Et={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},p0=new J,rD=new J;class gd{constructor(e=[0,0,0],i=[0,0,0],n){n=n||p0.copy(e).add(i).scale(.5),this.center=new J(n),this.halfDiagonal=new J(i).subtract(this.center),this.minimum=new J(e),this.maximum=new J(i)}clone(){return new gd(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:i}=this,n=rD.from(e.normal),s=i.x*Math.abs(n.x)+i.y*Math.abs(n.y)+i.z*Math.abs(n.z),r=this.center.dot(n)+e.distance;return r-s>0?Et.INSIDE:r+s<0?Et.OUTSIDE:Et.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const i=p0.from(e).subtract(this.center),{halfDiagonal:n}=this;let s=0,r;return r=Math.abs(i.x)-n.x,r>0&&(s+=r*r),r=Math.abs(i.y)-n.y,r>0&&(s+=r*r),r=Math.abs(i.z)-n.z,r>0&&(s+=r*r),s}}const Ur=new J,g0=new J;class _d{constructor(e=[0,0,0],i=0){this.radius=-0,this.center=new J,this.fromCenterRadius(e,i)}fromCenterRadius(e,i){return this.center.from(e),this.radius=i,this}fromCornerPoints(e,i){return i=Ur.from(i),this.center=new J().from(e).add(i).scale(.5),this.radius=this.center.distance(i),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new _d(this.center,this.radius)}union(e){const i=this.center,n=this.radius,s=e.center,r=e.radius,o=Ur.copy(s).subtract(i),a=o.magnitude();if(n>=a+r)return this.clone();if(r>=a+n)return e.clone();const c=(n+a+r)*.5;return g0.copy(o).scale((-n+c)/a).add(i),this.center.copy(g0),this.radius=c,this}expand(e){const n=Ur.from(e).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(e){this.center.transform(e);const i=pC(Ur,e);return this.radius=Math.max(i[0],Math.max(i[1],i[2]))*this.radius,this}distanceSquaredTo(e){const i=this.distanceTo(e);return i*i}distanceTo(e){const n=Ur.from(e).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(e){const i=this.center,n=this.radius,r=e.normal.dot(i)+e.distance;return r<-n?Et.OUTSIDE:r<n?Et.INTERSECTING:Et.INSIDE}}const oD=new J,aD=new J,Aa=new J,Ra=new J,Ca=new J,cD=new J,lD=new J,Di={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class md{constructor(e=[0,0,0],i=[0,0,0,0,0,0,0,0,0]){this.center=new J().from(e),this.halfAxes=new mt(i)}get halfSize(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new J(e).len(),new J(i).len(),new J(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),s=new J(e).normalize(),r=new J(i).normalize(),o=new J(n).normalize();return new zg().fromMatrix3(new mt([...s,...r,...o]))}fromCenterHalfSizeQuaternion(e,i,n){const s=new zg(n),r=new mt().fromQuaternion(s);return r[0]=r[0]*i[0],r[1]=r[1]*i[0],r[2]=r[2]*i[0],r[3]=r[3]*i[1],r[4]=r[4]*i[1],r[5]=r[5]*i[1],r[6]=r[6]*i[2],r[7]=r[7]*i[2],r[8]=r[8]*i[2],this.center=new J().from(e),this.halfAxes=r,this}clone(){return new md(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new _d){const i=this.halfAxes,n=i.getColumn(0,Aa),s=i.getColumn(1,Ra),r=i.getColumn(2,Ca),o=oD.copy(n).add(s).add(r);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const i=this.center,n=e.normal,s=this.halfAxes,r=n.x,o=n.y,a=n.z,c=Math.abs(r*s[Di.COLUMN0ROW0]+o*s[Di.COLUMN0ROW1]+a*s[Di.COLUMN0ROW2])+Math.abs(r*s[Di.COLUMN1ROW0]+o*s[Di.COLUMN1ROW1]+a*s[Di.COLUMN1ROW2])+Math.abs(r*s[Di.COLUMN2ROW0]+o*s[Di.COLUMN2ROW1]+a*s[Di.COLUMN2ROW2]),l=n.dot(i)+e.distance;return l<=-c?Et.OUTSIDE:l>=c?Et.INSIDE:Et.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const i=aD.from(e).subtract(this.center),n=this.halfAxes,s=n.getColumn(0,Aa),r=n.getColumn(1,Ra),o=n.getColumn(2,Ca),a=s.magnitude(),c=r.magnitude(),l=o.magnitude();s.normalize(),r.normalize(),o.normalize();let u=0,h;return h=Math.abs(i.dot(s))-a,h>0&&(u+=h*h),h=Math.abs(i.dot(r))-c,h>0&&(u+=h*h),h=Math.abs(i.dot(o))-l,h>0&&(u+=h*h),u}computePlaneDistances(e,i,n=[-0,-0]){let s=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,c=a.getColumn(0,Aa),l=a.getColumn(1,Ra),u=a.getColumn(2,Ca),h=cD.copy(c).add(l).add(u).add(o),f=lD.copy(h).subtract(e);let d=i.dot(f);return s=Math.min(d,s),r=Math.max(d,r),h.copy(o).add(c).add(l).subtract(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),h.copy(o).add(c).subtract(l).add(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),h.copy(o).add(c).subtract(l).subtract(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),o.copy(h).subtract(c).add(l).add(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),o.copy(h).subtract(c).add(l).subtract(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),o.copy(h).subtract(c).subtract(l).add(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),o.copy(h).subtract(c).subtract(l).subtract(u),f.copy(h).subtract(e),d=i.dot(f),s=Math.min(d,s),r=Math.max(d,r),n[0]=s,n[1]=r,n}transform(e){this.center.transformAsPoint(e);const i=this.halfAxes.getColumn(0,Aa);i.transformAsPoint(e);const n=this.halfAxes.getColumn(1,Ra);n.transformAsPoint(e);const s=this.halfAxes.getColumn(2,Ca);return s.transformAsPoint(e),this.halfAxes=new mt([...i,...n,...s]),this}getTransform(){throw new Error("not implemented")}}const _0=new J,m0=new J;class Io{constructor(e=[0,0,1],i=0){this.normal=new J,this.distance=-0,this.fromNormalDistance(e,i)}fromNormalDistance(e,i){return Ao(Number.isFinite(i)),this.normal.from(e).normalize(),this.distance=i,this}fromPointNormal(e,i){e=_0.from(e),this.normal.from(i).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,i,n,s){return this.normal.set(e,i,n),Ao(zi(this.normal.len(),1)),this.distance=s,this}clone(){return new Io(this.normal,this.distance)}equals(e){return zi(this.distance,e.distance)&&zi(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const i=m0.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,i)}projectPointOntoPlane(e,i=[0,0,0]){const n=_0.from(e),s=this.getPointDistance(n),r=m0.copy(this.normal).scale(s);return n.subtract(r).to(i)}}const y0=[new J([1,0,0]),new J([0,1,0]),new J([0,0,1])],v0=new J,uD=new J;class Ui{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*y0.length;const i=e.center,n=e.radius;let s=0;for(const r of y0){let o=this.planes[s],a=this.planes[s+1];o||(o=this.planes[s]=new Io),a||(a=this.planes[s+1]=new Io);const c=v0.copy(r).scale(-n).add(i);o.fromPointNormal(c,r);const l=v0.copy(r).scale(n).add(i),u=uD.copy(r).negate();a.fromPointNormal(l,u),s+=2}return this}computeVisibility(e){let i=Et.INSIDE;for(const n of this.planes)switch(e.intersectPlane(n)){case Et.OUTSIDE:return Et.OUTSIDE;case Et.INTERSECTING:i=Et.INTERSECTING;break}return i}computeVisibilityWithPlaneMask(e,i){if(Ao(Number.isFinite(i),"parentPlaneMask is required."),i===Ui.MASK_OUTSIDE||i===Ui.MASK_INSIDE)return i;let n=Ui.MASK_INSIDE;const s=this.planes;for(let r=0;r<this.planes.length;++r){const o=r<31?1<<r:0;if(r<31&&!(i&o))continue;const a=s[r],c=e.intersectPlane(a);if(c===Et.OUTSIDE)return Ui.MASK_OUTSIDE;c===Et.INTERSECTING&&(n|=o)}return n}}Ui.MASK_OUTSIDE=4294967295;Ui.MASK_INSIDE=0;Ui.MASK_INDETERMINATE=2147483647;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;const Ei=new mt,hD=new mt,fD=new mt,xa=new mt,b0=new mt;function dD(t,e={}){const i=JC,n=10;let s=0,r=0;const o=hD,a=fD;o.identity(),a.copy(t);const c=i*pD(a);for(;r<n&&gD(a)>c;)_D(a,xa),b0.copy(xa).transpose(),a.multiplyRight(xa),a.multiplyLeft(b0),o.multiplyRight(xa),++s>2&&(++r,s=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function pD(t){let e=0;for(let i=0;i<9;++i){const n=t[i];e+=n*n}return Math.sqrt(e)}const vf=[1,0,0],bf=[2,2,1];function gD(t){let e=0;for(let i=0;i<3;++i){const n=t[Ei.getElementIndex(bf[i],vf[i])];e+=2*n*n}return Math.sqrt(e)}function _D(t,e){const i=GC;let n=0,s=1;for(let l=0;l<3;++l){const u=Math.abs(t[Ei.getElementIndex(bf[l],vf[l])]);u>n&&(s=l,n=u)}const r=vf[s],o=bf[s];let a=1,c=0;if(Math.abs(t[Ei.getElementIndex(o,r)])>i){const l=t[Ei.getElementIndex(o,o)],u=t[Ei.getElementIndex(r,r)],h=t[Ei.getElementIndex(o,r)],f=(l-u)/2/h;let d;f<0?d=-1/(-f+Math.sqrt(1+f*f)):d=1/(f+Math.sqrt(1+f*f)),a=1/Math.sqrt(1+d*d),c=d*a}return mt.IDENTITY.to(e),e[Ei.getElementIndex(r,r)]=e[Ei.getElementIndex(o,o)]=a,e[Ei.getElementIndex(o,r)]=c,e[Ei.getElementIndex(r,o)]=-c,e}const Ji=new J,mD=new J,yD=new J,vD=new J,bD=new J,wD=new mt,TD={diagonal:new mt,unitary:new mt};function ED(t,e=new md){if(!t||t.length===0)return e.halfAxes=new mt([0,0,0,0,0,0,0,0,0]),e.center=new J,e;const i=t.length,n=new J(0,0,0);for(const O of t)n.add(O);const s=1/i;n.multiplyByScalar(s);let r=0,o=0,a=0,c=0,l=0,u=0;for(const O of t){const D=Ji.copy(O).subtract(n);r+=D.x*D.x,o+=D.x*D.y,a+=D.x*D.z,c+=D.y*D.y,l+=D.y*D.z,u+=D.z*D.z}r*=s,o*=s,a*=s,c*=s,l*=s,u*=s;const h=wD;h[0]=r,h[1]=o,h[2]=a,h[3]=o,h[4]=c,h[5]=l,h[6]=a,h[7]=l,h[8]=u;const{unitary:f}=dD(h,TD),d=e.halfAxes.copy(f);let p=d.getColumn(0,yD),g=d.getColumn(1,vD),_=d.getColumn(2,bD),b=-Number.MAX_VALUE,T=-Number.MAX_VALUE,v=-Number.MAX_VALUE,E=Number.MAX_VALUE,R=Number.MAX_VALUE,P=Number.MAX_VALUE;for(const O of t)Ji.copy(O),b=Math.max(Ji.dot(p),b),T=Math.max(Ji.dot(g),T),v=Math.max(Ji.dot(_),v),E=Math.min(Ji.dot(p),E),R=Math.min(Ji.dot(g),R),P=Math.min(Ji.dot(_),P);p=p.multiplyByScalar(.5*(E+b)),g=g.multiplyByScalar(.5*(R+T)),_=_.multiplyByScalar(.5*(P+v)),e.center.copy(p).add(g).add(_);const M=mD.set(b-E,T-R,v-P).multiplyByScalar(.5),U=new mt([M[0],0,0,0,M[1],0,0,0,M[2]]);return e.halfAxes.multiplyRight(U),e}const Xs=512,w0=3,Fv=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],Lv=Fv.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),SD=Lv.concat([[.25,.5],[.75,.5]]);class qs{constructor(e,i,n){this.x=e,this.y=i,this.z=n}get children(){if(!this._children){const e=this.x*2,i=this.y*2,n=this.z+1;this._children=[new qs(e,i,n),new qs(e,i+1,n),new qs(e+1,i,n),new qs(e+1,i+1,n)]}return this._children}update(e){const{viewport:i,cullingVolume:n,elevationBounds:s,minZ:r,maxZ:o,bounds:a,offset:c,project:l}=e,u=this.getBoundingVolume(s,c,l);if(a&&!this.insideBounds(a)||n.computeVisibility(u)<0)return!1;if(!this.childVisible){let{z:f}=this;if(f<o&&f>=r){const d=u.distanceTo(i.cameraPosition)*i.scale/i.height;f+=Math.floor(Math.log2(d))}if(f>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const f of this.children)f.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const i of this._children)i.getSelected(e);return e}insideBounds([e,i,n,s]){const r=Math.pow(2,this.z),o=Xs/r;return this.x*o<n&&this.y*o<s&&(this.x+1)*o>e&&(this.y+1)*o>i}getBoundingVolume(e,i,n){if(n){const c=this.z<1?SD:this.z<2?Lv:Fv,l=[];for(const u of c){const h=Tf(this.x+u[0],this.y+u[1],this.z);h[2]=e[0],l.push(n(h)),e[0]!==e[1]&&(h[2]=e[1],l.push(n(h)))}return ED(l)}const s=Math.pow(2,this.z),r=Xs/s,o=this.x*r+i*Xs,a=Xs-(this.y+1)*r;return new gd([o,a,e[0]],[o+r,a+r,e[1]])}}function AD(t,e,i,n){const s=t instanceof yk&&t.resolution?t.projectPosition:null,r=Object.values(t.getFrustumPlanes()).map(({normal:d,distance:p})=>new Io(d.clone().negate(),p)),o=new Ui(r),a=t.distanceScales.unitsPerMeter[2],c=i&&i[0]*a||0,l=i&&i[1]*a||0,u=t instanceof _r&&t.pitch<=60?e:0;if(n){const[d,p,g,_]=n,b=gn([d,_]),T=gn([g,p]);n=[b[0],Xs-b[1],T[0],Xs-T[1]]}const h=new qs(0,0,0),f={viewport:t,project:s,cullingVolume:o,elevationBounds:[c,l],minZ:u,maxZ:e,bounds:n,offset:0};if(h.update(f),t instanceof _r&&t.subViewports&&t.subViewports.length>1){for(f.offset=-1;h.update(f)&&!(--f.offset<-w0););for(f.offset=1;h.update(f)&&!(++f.offset>w0););}return h.getSelected()}const $i=512,RD=[-1/0,-1/0,1/0,1/0],CD={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(i=>typeof i=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const i=t.length;if(i!==e.length)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}};function Bv(t,e){const i=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...i.map(s=>s[0])),Math.min(...i.map(s=>s[1])),Math.max(...i.map(s=>s[0])),Math.max(...i.map(s=>s[1]))]}function xD(t){return Math.abs(t.split("").reduce((e,i)=>(e<<5)-e+i.charCodeAt(0)|0,0))}function PD(t,e){if(!t||!t.length)return null;const{index:i,id:n}=e;if(Array.isArray(t)){const r=xD(n)%t.length;t=t[r]}let s=t;for(const r of Object.keys(i)){const o=new RegExp(`{${r}}`,"g");s=s.replace(o,String(i[r]))}return Number.isInteger(i.y)&&Number.isInteger(i.z)&&(s=s.replace(/\{-y\}/g,String(Math.pow(2,i.z)-i.y-1))),s}function MD(t,e,i){let n;if(e&&e.length===2){const[s,r]=e,o=t.getBounds({z:s}),a=t.getBounds({z:r});n=[Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.max(o[2],a[2]),Math.max(o[3],a[3])]}else n=t.getBounds();return t.isGeospatial?[Math.max(n[0],i[0]),Math.max(n[1],i[1]),Math.min(n[2],i[2]),Math.min(n[3],i[3])]:[Math.max(Math.min(n[0],i[2]),i[0]),Math.max(Math.min(n[1],i[3]),i[1]),Math.min(Math.max(n[2],i[0]),i[2]),Math.min(Math.max(n[3],i[1]),i[3])]}function ID({viewport:t,z:e,cullRect:i}){return(t.subViewports||[t]).map(s=>wf(s,e||0,i))}function wf(t,e,i){if(!Array.isArray(e)){const r=i.x-t.x,o=i.y-t.y,{width:a,height:c}=i,l={targetZ:e},u=t.unproject([r,o],l),h=t.unproject([r+a,o],l),f=t.unproject([r,o+c],l),d=t.unproject([r+a,o+c],l);return[Math.min(u[0],h[0],f[0],d[0]),Math.min(u[1],h[1],f[1],d[1]),Math.max(u[0],h[0],f[0],d[0]),Math.max(u[1],h[1],f[1],d[1])]}const n=wf(t,e[0],i),s=wf(t,e[1],i);return[Math.min(n[0],s[0]),Math.min(n[1],s[1]),Math.max(n[2],s[2]),Math.max(n[3],s[3])]}function OD(t,e,i){return i?Bv(t,i).map(s=>s*e/$i):t.map(n=>n*e/$i)}function yd(t,e){return Math.pow(2,t)*$i/e}function Tf(t,e,i){const n=yd(i,$i),s=t/n*360-180,r=Math.PI-2*Math.PI*e/n,o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[s,o]}function T0(t,e,i,n){const s=yd(i,n);return[t/s*$i,e/s*$i]}function ND(t,e,i,n,s=$i){if(t.isGeospatial){const[l,u]=Tf(e,i,n),[h,f]=Tf(e+1,i+1,n);return{west:l,north:u,east:h,south:f}}const[r,o]=T0(e,i,n,s),[a,c]=T0(e+1,i+1,n,s);return{left:r,top:o,right:a,bottom:c}}function kD(t,e,i,n,s){const r=MD(t,null,n),o=yd(e,i),[a,c,l,u]=OD(r,o,s),h=[];for(let f=Math.floor(a);f<l;f++)for(let d=Math.floor(c);d<u;d++)h.push({x:f,y:d,z:e});return h}function DD({viewport:t,maxZoom:e,minZoom:i,zRange:n,extent:s,tileSize:r=$i,modelMatrix:o,modelMatrixInverse:a,zoomOffset:c=0}){let l=t.isGeospatial?Math.round(t.zoom+Math.log2($i/r))+c:Math.ceil(t.zoom)+c;if(typeof i=="number"&&Number.isFinite(i)&&l<i){if(!s)return[];l=i}typeof e=="number"&&Number.isFinite(e)&&l>e&&(l=e);let u=s;return o&&a&&s&&!t.isGeospatial&&(u=Bv(s,o)),t.isGeospatial?AD(t,l,n,s):kD(t,l,r,u||RD,a)}function FD(t){let e={},i;return n=>{for(const s in n)if(!LD(n[s],e[s])){i=t(n),e=n;break}return i}}function LD(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}return!1}const E0=1,El=2,BD="never",UD="no-overlap",vd="best-available",zD=5,VD={[vd]:HD,[UD]:WD,[BD]:()=>{}},jD={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class $D{constructor(e){this._getCullBounds=FD(ID),this.opts={...jD,...e},this.setOptions(this.opts),this.onTileLoad=i=>{var n,s;(s=(n=this.opts).onTileLoad)==null||s.call(n,i),this.opts.maxCacheByteSize&&(this._cacheByteSize+=i.byteLength,this._resizeCache())},this._requestScheduler=new TS({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new yt,this._modelMatrixInverse=new yt}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const i=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(i)?this._cache.delete(e):i.setNeedsReload()}}update(e,{zRange:i,modelMatrix:n}={zRange:null,modelMatrix:null}){const s=n?new yt(n):new yt,r=!s.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!zi(this._zRange,i)||r){r&&(this._modelMatrixInverse=s.clone().invert(),this._modelMatrix=s),this._viewport=e,this._zRange=i;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:i,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(c=>this._getTile(c,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,i){if(!e.isVisible)return!1;if(i&&this._viewport){const n=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:i}),{bbox:s}=e;for(const[r,o,a,c]of n){let l;if("west"in s)l=s.west<a&&s.east>r&&s.south<c&&s.north>o;else{const u=Math.min(s.top,s.bottom),h=Math.max(s.top,s.bottom);l=s.left<a&&s.right>r&&u<c&&h>o}if(l)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:i,minZoom:n,zRange:s,modelMatrix:r,modelMatrixInverse:o}){const{tileSize:a,extent:c,zoomOffset:l}=this.opts;return DD({viewport:e,maxZoom:i,minZoom:n,zRange:s,tileSize:a,extent:c,modelMatrix:r,modelMatrixInverse:o,zoomOffset:l})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:i}=this.opts;return{bbox:ND(this._viewport,e.x,e.y,e.z,i)}}getParentIndex(e){const i=Math.floor(e.x/2),n=Math.floor(e.y/2),s=e.z-1;return{x:i,y:n,z:s}}updateTileStates(){const e=this.opts.refinementStrategy||vd,i=new Array(this._cache.size);let n=0;for(const s of this._cache.values())i[n++]=s.isVisible,s.isSelected=!1,s.isVisible=!1;for(const s of this._selectedTiles)s.isSelected=!0,s.isVisible=!0;(typeof e=="function"?e:VD[e])(Array.from(this._cache.values())),n=0;for(const s of this._cache.values())if(i[n++]!==s.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,i=[];let n=0;for(const s of this._cache.values())s.isLoading&&(n++,!s.isSelected&&!s.isVisible&&i.push(s));for(;e>0&&n>e&&i.length>0;)i.shift().abort(),n--}_rebuildTree(){const{_cache:e}=this;for(const i of e.values())i.parent=null,i.children&&(i.children.length=0);for(const i of e.values()){const n=this._getNearestAncestor(i);i.parent=n,n!=null&&n.children&&n.children.push(i)}}_resizeCache(){var o,a;const{_cache:e,opts:i}=this,n=i.maxCacheSize||(i.maxCacheByteSize?1/0:zD*this.selectedTiles.length),s=i.maxCacheByteSize||1/0;if(e.size>n||this._cacheByteSize>s){for(const[c,l]of e)if(!l.isVisible&&!l.isSelected&&(this._cacheByteSize-=i.maxCacheByteSize?l.byteLength:0,e.delete(c),(a=(o=this.opts).onTileUnload)==null||a.call(o,l)),e.size<=n&&this._cacheByteSize<=s)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((c,l)=>c.zoom-l.zoom),this._dirty=!1)}_getTile(e,i){const n=this.getTileId(e);let s=this._cache.get(n),r=!1;return!s&&i?(s=new sD(e),Object.assign(s,this.getTileMetadata(s.index)),Object.assign(s,{id:n,zoom:this.getTileZoom(s.index)}),r=!0,this._cache.set(n,s),this._dirty=!0):s&&s.needsReload&&(r=!0),s&&r&&s.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),s}_getNearestAncestor(e){const{_minZoom:i=0}=this;let n=e.index;for(;this.getTileZoom(n)>i;){n=this.getParentIndex(n);const s=this._getTile(n);if(s)return s}return null}}function HD(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!Uv(e)&&bd(e);for(const e of t)e.isVisible=!!(e.state&El)}function WD(t){for(const i of t)i.state=0;for(const i of t)i.isSelected&&Uv(i);const e=Array.from(t).sort((i,n)=>i.zoom-n.zoom);for(const i of e)if(i.isVisible=!!(i.state&El),i.children&&(i.isVisible||i.state&E0))for(const n of i.children)n.state=E0;else i.isSelected&&bd(i)}function Uv(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=El,!0;e=e.parent}return!1}function bd(t){for(const e of t.children)e.isLoaded||e.content?e.state|=El:bd(e)}const XD={TilesetClass:$D,data:{type:"data",value:[]},dataComparator:CD.equal,renderSubLayers:{type:"function",value:t=>new yf(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:vd,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0},al=class al extends xo{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,i;(i=(e=this.state)==null?void 0:e.tileset)==null||i.finalize()}get isLoaded(){var e,i,n;return!!((n=(i=(e=this.state)==null?void 0:e.tileset)==null?void 0:i.selectedTiles)!=null&&n.every(s=>s.isLoaded&&s.layers&&s.layers.every(r=>r.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:i}=this.state;const n=e.propsOrDataChanged||e.updateTriggersChanged,s=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);i?n&&(i.setOptions(this._getTilesetOptions()),s?i.reloadAll():i.tiles.forEach(r=>{r.layers=null})):(i=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:i})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:i,maxCacheByteSize:n,refinementStrategy:s,extent:r,maxZoom:o,minZoom:a,maxRequests:c,debounceTime:l,zoomOffset:u}=this.props;return{maxCacheSize:i,maxCacheByteSize:n,maxZoom:o,minZoom:a,tileSize:e,refinementStrategy:s,extent:r,maxRequests:c,debounceTime:l,zoomOffset:u,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:i,modelMatrix:n}=this.props,s=e.update(this.context.viewport,{zRange:i,modelMatrix:n}),{isLoaded:r}=e,o=this.state.isLoaded!==r,a=this.state.frameNumber!==s;r&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:s}),this.state.isLoaded=r}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:i}=this.props;i&&i(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,i){this.props.onTileError(e),i.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:i,getTileData:n,fetch:s}=this.props,{signal:r}=e;return e.url=typeof i=="string"||Array.isArray(i)?PD(i,e):null,n?n(e):s&&e.url?s(e.url,{propName:"data",layer:this,signal:r}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const i=e.sourceLayer,n=i.props.tile,s=e.info;return s.picked&&(s.tile=n),s.sourceTile=n,s.sourceTileSubLayer=i,s}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const i=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)i&&e.layers[0]&&Object.keys(i).some(n=>e.layers[0].props[n]!==i[n])&&(e.layers=e.layers.map(n=>n.clone(i)));else{const n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=ml(n,Boolean).map(s=>s.clone({tile:e,...i}))}return e.layers})}filterSubLayer({layer:e,cullRect:i}){const{tile:n}=e.props;return this.state.tileset.isTileVisible(n,i)}};al.defaultProps=XD,al.layerName="TileLayer";let Ef=al;const qD="4.2.0";function YD(t){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,t)}function KD(t){var i,n;return((n=(i=globalThis.loaders)==null?void 0:i.modules)==null?void 0:n[t])||null}function ZD(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.0"),globalThis._loadersgl_.version}const GD=ZD();function JD(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const zo=typeof process!="object"||String(process)!=="[object process]"||process.browser,wd=typeof importScripts=="function",S0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);S0&&parseFloat(S0[1]);const ku={};async function Cc(t,e=null,i={},n=null){return e&&(t=QD(t,e,i,n)),ku[t]=ku[t]||eF(t),await ku[t]}function QD(t,e,i={},n=null){if(!i.useLocalLibraries&&t.startsWith("http"))return t;n=n||t;const s=i.modules||{};return s[n]?s[n]:zo?i.CDN?(JD(i.CDN.startsWith("http")),`${i.CDN}/${e}@${GD}/dist/libs/${n}`):wd?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function eF(t){if(t.endsWith("wasm"))return await iF(t);if(!zo)try{const{requireFromFile:i}=globalThis.loaders||{};return await(i==null?void 0:i(t))}catch(i){return console.error(i),null}if(wd)return importScripts(t);const e=await nF(t);return tF(e,t)}function tF(t,e){if(!zo){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(t,e)}if(wd)return eval.call(globalThis,t),null;const i=document.createElement("script");i.id=e;try{i.appendChild(document.createTextNode(t))}catch{i.text=t}return document.body.appendChild(i),null}async function iF(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return zo||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function nF(t){const{readFileAsText:e}=globalThis.loaders||{};return zo||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}const xc={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let A0;async function R0(t){YD(t.modules);const e=KD("basis");return e||(A0||(A0=sF(t)),await A0)}async function sF(t){let e=null,i=null;return[e,i]=await Promise.all([await Cc(xc.TRANSCODER,"textures",t),await Cc(xc.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await rF(e,i)}function rF(t,e){const i={};return e&&(i.wasmBinary=e),new Promise(n=>{t(i).then(s=>{const{BasisFile:r,initializeBasis:o}=s;o(),n({BasisFile:r})})})}let Du;async function C0(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(Du=Du||oF(t),await Du)}async function oF(t){let e=null,i=null;return[e,i]=await Promise.all([await Cc(xc.ENCODER,"textures",t),await Cc(xc.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await aF(e,i)}function aF(t,e){const i={};return e&&(i.wasmBinary=e),new Promise(n=>{t(i).then(s=>{const{BasisFile:r,KTX2File:o,initializeBasis:a,BasisEncoder:c}=s;a(),n({BasisFile:r,KTX2File:o,BasisEncoder:c})})})}const xs={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},cF=["","WEBKIT_","MOZ_"],x0={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Pa=null;function lF(t){if(!Pa){t=t||uF()||void 0,Pa=new Set;for(const e of cF)for(const i in x0)if(t&&t.getExtension(`${e}${i}`)){const n=x0[i];Pa.add(n)}}return Pa}function uF(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var P0,M0,I0,O0,N0,k0,D0,F0;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(P0||(P0={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(M0||(M0={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(I0||(I0={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(O0||(O0={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(N0||(N0={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(k0||(k0={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(D0||(D0={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(F0||(F0={}));const Bt=[171,75,84,88,32,50,48,187,13,10,26,10];function hF(t){const e=new Uint8Array(t);return!(e.byteLength<Bt.length||e[0]!==Bt[0]||e[1]!==Bt[1]||e[2]!==Bt[2]||e[3]!==Bt[3]||e[4]!==Bt[4]||e[5]!==Bt[5]||e[6]!==Bt[6]||e[7]!==Bt[7]||e[8]!==Bt[8]||e[9]!==Bt[9]||e[10]!==Bt[10]||e[11]!==Bt[11])}const fF={etc1:{basisFormat:0,compressed:!0,format:xs.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:xs.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:xs.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:xs.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:xs.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:xs.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function dF(t,e){if(e.basis.containerFormat==="auto"){if(hF(t)){const n=await C0(e);return L0(n.KTX2File,t,e)}const{BasisFile:i}=await R0(e);return Fu(i,t,e)}switch(e.basis.module){case"encoder":const i=await C0(e);switch(e.basis.containerFormat){case"ktx2":return L0(i.KTX2File,t,e);case"basis":default:return Fu(i.BasisFile,t,e)}case"transcoder":default:const{BasisFile:n}=await R0(e);return Fu(n,t,e)}}function Fu(t,e,i){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const s=n.getNumImages(),r=[];for(let o=0;o<s;o++){const a=n.getNumLevels(o),c=[];for(let l=0;l<a;l++)c.push(pF(n,o,l,i));r.push(c)}return r}finally{n.close(),n.delete()}}function pF(t,e,i,n){const s=t.getImageWidth(e,i),r=t.getImageHeight(e,i),o=t.getHasAlpha(),{compressed:a,format:c,basisFormat:l}=zv(n,o),u=t.getImageTranscodedSizeInBytes(e,i,l),h=new Uint8Array(u);if(!t.transcodeImage(h,e,i,l,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:r,data:h,compressed:a,format:c,hasAlpha:o}}function L0(t,e,i){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=n.getLevels(),r=[];for(let o=0;o<s;o++){r.push(gF(n,o,i));break}return[r]}finally{n.close(),n.delete()}}function gF(t,e,i){const{alphaFlag:n,height:s,width:r}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:c}=zv(i,n),l=t.getImageTranscodedSizeInBytes(e,0,0,c),u=new Uint8Array(l);if(!t.transcodeImage(u,e,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:r,height:s,data:u,compressed:o,levelSize:l,hasAlpha:n,format:a}}function zv(t,e){let i=t&&t.basis&&t.basis.format;return i==="auto"&&(i=Vv()),typeof i=="object"&&(i=e?i.alpha:i.noAlpha),i=i.toLowerCase(),fF[i]}function Vv(){const t=lF();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const _F={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:qD,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},mF={..._F,parse:dF};function B0(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1}function yF(t){const e=t-1;return e*e*e+1}function U0(t,{delay:e=0,duration:i=400,easing:n=Nm}={}){const s=+getComputedStyle(t).opacity;return{delay:e,duration:i,easing:n,css:r=>`opacity: ${r*s}`}}function Pi(t,{delay:e=0,duration:i=400,easing:n=yF,x:s=0,y:r=0,opacity:o=0}={}){const a=getComputedStyle(t),c=+a.opacity,l=a.transform==="none"?"":a.transform,u=c*(1-o),[h,f]=zd(s),[d,p]=zd(r);return{delay:e,duration:i,easing:n,css:(g,_)=>`
			transform: ${l} translate(${(1-g)*h}${f}, ${(1-g)*d}${p});
			opacity: ${c-u*_}`}}function z0(t){return Object.prototype.toString.call(t)==="[object Date]"}function Sf(t,e){if(t===e||t!==t)return()=>t;const i=typeof t;if(i!==typeof e||Array.isArray(t)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(t)){const n=e.map((s,r)=>Sf(t[r],s));return s=>n.map(r=>r(s))}if(i==="object"){if(!t||!e)throw new Error("Object cannot be null");if(z0(t)&&z0(e)){t=t.getTime(),e=e.getTime();const r=e-t;return o=>new Date(t+o*r)}const n=Object.keys(e),s={};return n.forEach(r=>{s[r]=Sf(t[r],e[r])}),r=>{const o={};return n.forEach(a=>{o[a]=s[a](r)}),o}}if(i==="number"){const n=e-t;return s=>t+s*n}throw new Error(`Cannot interpolate ${i} values`)}function Af(t,e={}){const i=ll(t);let n,s=t;function r(o,a){if(t==null)return i.set(t=o),Promise.resolve();s=o;let c=n,l=!1,{delay:u=0,duration:h=400,easing:f=Nm,interpolate:d=Sf}=Vd(Vd({},e),a);if(h===0)return c&&(c.abort(),c=null),i.set(t=s),Promise.resolve();const p=Yb()+u;let g;return n=Kb(_=>{if(_<p)return!0;l||(g=d(t,o),typeof h=="function"&&(h=h(t,o)),l=!0),c&&(c.abort(),c=null);const b=_-p;return b>h?(i.set(t=o),!1):(i.set(t=g(f(b/h))),!0)}),n.promise}return{set:r,update:(o,a)=>r(o(s,t),a),subscribe:i.subscribe}}function vF(t){console.log(t);let e=t.length;for(;e!=0;){let i=Math.floor(Math.random()*e);e--,[t[e],t[i]]=[t[i],t[e]]}}function bF(t){let e,i,n,s;return{c(){e=K("div"),i=K("canvas"),this.h()},l(r){e=Z(r,"DIV",{class:!0});var o=oe(e);i=Z(o,"CANVAS",{width:!0,height:!0,style:!0,class:!0});var a=oe(i);a.forEach(j),o.forEach(j),this.h()},h(){L(i,"width",n=t[1]*2),L(i,"height",s=t[0]*2),ot(i,"width",t[1]+"px"),ot(i,"height",t[0]+"px"),ot(i,"opacity",Math.max(t[2],1)),L(i,"class","svelte-oi0wyw"),L(e,"class","canvas-container svelte-oi0wyw"),Ds(e,"introFinished",t[4])},m(r,o){re(r,e,o),H(e,i),t[18](i)},p(r,o){o&2&&n!==(n=r[1]*2)&&L(i,"width",n),o&1&&s!==(s=r[0]*2)&&L(i,"height",s),o&2&&ot(i,"width",r[1]+"px"),o&1&&ot(i,"height",r[0]+"px"),o&4&&ot(i,"opacity",Math.max(r[2],1)),o&16&&Ds(e,"introFinished",r[4])},d(r){r&&j(e),t[18](null)}}}function wF(t){let e,i=t[5]&&bF(t);return{c(){i&&i.c(),e=nr()},l(n){i&&i.l(n),e=nr()},m(n,s){i&&i.m(n,s),re(n,e,s)},p(n,[s]){n[5]&&i.p(n,s)},i:St,o:St,d(n){n&&j(e),i&&i.d(n)}}}let TF=1e4;function EF(t,e){return[t,e]}function SF(t,e,i){let n,s,r,o,a,c;const l=km();let{sizes:u}=e,{geoJSON:h}=e,{courtData:f}=e,{viewportHeight:d}=e,{viewportWidth:p}=e,g=yh().domain([.2,1]).range([0,1]).exponent(10).clamp(!0),_=yh().domain([0,1]).range([3,1]).exponent(.5).clamp(!0);vF(f);let b=f.map(D=>D.latLong);const T={type:"Sphere"};let v=Af(0,{duration:TF,easing:B0});un(t,v,D=>i(2,a=D));let E=Af(0,{duration:2e3,easing:B0});un(t,E,D=>i(17,c=D)),cy(EF).fitWidth(p*2,T).scale(1e3);let R,P,M,U;cl(()=>{i(12,M=P.getContext("2d")),v.set(1).then(()=>{i(11,R=!0),console.log("here"),E.set(1).then(()=>{i(4,U=!0),l("finished",{text:"Hello!"})}),o()})});function O(D){Gu[D?"unshift":"push"](()=>{P=D,i(3,P)})}return t.$$set=D=>{"sizes"in D&&i(8,u=D.sizes),"geoJSON"in D&&i(9,h=D.geoJSON),"courtData"in D&&i(10,f=D.courtData),"viewportHeight"in D&&i(0,d=D.viewportHeight),"viewportWidth"in D&&i(1,p=D.viewportWidth)},t.$$.update=()=>{t.$$.dirty&7&&i(16,n=$T().fitWidth(d,T).rotate([110*_(a),-40]).translate([p,d]).scale(1e3*Math.max(a*1.5,.1)).precision(0)),t.$$.dirty&512&&i(15,s=h?gE(h,h.objects.land):null),t.$$.dirty&65536&&i(14,r=IT(n).pointRadius(2)),t.$$.dirty&253191&&i(13,o=()=>{M&&(M.clearRect(0,0,p*2,d*2),R?(i(12,M.fillStyle=`rgba(54,53,49,${1-c})`,M),M.beginPath(),r.context(M),r(s),M.fill(),f.forEach((D,I)=>{let V=$m(n(b[I]),D.coordinates.map(ee=>ee*2)),k=mo(1.5/2,u.size*2);i(12,M.fillStyle=D.color.slice(0,7),M);let B=V(c),F=k(c);M.beginPath(),M.rect(B[0],B[1],F,F),M.fill()})):(i(12,M.fillStyle="rgba(12,12,11,1)",M),M.beginPath(),r.context(M),r(T),M.fill(),i(12,M.fillStyle="rgba(54,53,49,1)",M),M.beginPath(),r.context(M),r(s),M.fill(),i(12,M.fillStyle="#7d6a51",M),M.beginPath(),r.context(M),r({type:"MultiPoint",coordinates:b.slice(0,Math.floor(b.length*g(a)))}),M.fill()))}),t.$$.dirty&24576&&o()},[d,p,a,P,U,b,v,E,u,h,f,R,M,o,r,s,n,c,O]}class AF extends vn{constructor(e){super(),bn(this,e,SF,wF,Hi,{sizes:8,geoJSON:9,courtData:10,viewportHeight:0,viewportWidth:1})}}let RF=function(t,e,i){var n,s,r=Math.ceil(Math.sqrt(t*e/i));Math.floor(r*i/e)*r<t?n=i/Math.ceil(r*i/e):n=e/r;var o=Math.ceil(Math.sqrt(t*i/e));return Math.floor(o*e/i)*o<t?s=e/Math.ceil(e*o/i):s=i/o,Math.max(n,s)};function CF(t,e,i,n){let s,r=t,o=i,a=e,c;return c=RF(o,r,a),s=c,s=Math.round(s*100)/100,{rowSize:Math.floor(r/s),size:s}}let xF=function(t,e,i){var n,s,r=Math.ceil(Math.sqrt(t*e/i));Math.floor(r*i/e)*r<t?n=i/Math.ceil(r*i/e):n=e/r;var o=Math.ceil(Math.sqrt(t*i/e));return Math.floor(o*e/i)*o<t?s=e/Math.ceil(e*o/i):s=i/o,Math.max(n,s)};function PF(t,e,i,n){let s,r=t,o=i,a=e,c;return c=xF(o,r,a),s=c,s=Math.round(s*100)/100,{rowSize:Math.floor(r/s),size:s}}const jv='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 218 52"><path id="color-stroke" fill="#3AE660" d="M212.5 10.8a5 5 0 0 0-2.2.5h-.3a6 6 0 0 0-3.8-.3 27 27 0 0 0-4.6 1.8h-.2l-1.2.6h-.2a32.2 32.2 0 0 1-2.1 1.3l-1.3.8h-.2c-.2-.4-.6-.7-1-1a43 43 0 0 0-2.8-2c-1.5-1-2.8-1.7-4.4-1.7-1 0-2.2.3-3.6.9h-.2a5.7 5.7 0 0 0-4.5-.5l-2.2.7c-.2.6-.4 1-.8 1.5-.1.2-.3.2-.4 0l-.5-.5c-.1-.2 0-.4.2-.5l1.5-.5a5.9 5.9 0 0 0-1.4-6l-2.6-2.6a5.8 5.8 0 0 0-7.6-.5h-.4a5.8 5.8 0 0 0-6-1.6l-6 1.9a4.8 4.8 0 0 0-2.3 7.8c.3.3.4.6.6 1v.6l-.6.2-1.3.7-1.2.6-.6.4c-.2.1-.4 0-.4-.2V6.7a5.8 5.8 0 0 0-7.6-5.5l-6 1.9a4.8 4.8 0 0 0-2.3 7.8l.6 1v.6l-.6.2h-.1l-1.2.7-1.2.6-1.2.8h-.2a5.8 5.8 0 0 0-7.2-3.6l-4.3 1.3h-.2a5.8 5.8 0 0 0-5.8-1.3l-2 .6c-.1 0-.3 0-.3-.2v-2a5.9 5.9 0 0 0-3.9-5.6l-1.3-.6-1-.4a23.5 23.5 0 0 0-3.5-1.4 25 25 0 0 0-2-.6c-.4-.2-1-.2-1.4-.2-1.3 0-2.8.3-4.6 1.1a45.6 45.6 0 0 0-2.3 1l-.2-.2-1-.5a9.3 9.3 0 0 0-1.6-.8c-.3-.1-.6-.3-1-.3-.5-.2-1-.3-1.6-.3a6.3 6.3 0 0 0-3.5 1l-.8.5a14 14 0 0 0-2 1.4l-1.2.9A23.6 23.6 0 0 0 72 7.9a14.4 14.4 0 0 0-1.5 2.3c-.4.7-.6 1.5-.6 2.3 0 .1 0 .2-.1 0a6.2 6.2 0 0 0-.9-.7 5 5 0 0 0-3-1c-.5 0-1 0-1.6.2a44.8 44.8 0 0 0-5.8 2.5l-2 1.2-1 .6c-.2.1-.3.1-.4 0l-.9-.8-2.8-2a8.1 8.1 0 0 0-4.4-1.7h-.4a.3.3 0 0 1-.4-.3V6.7a5.8 5.8 0 0 0-7.5-5.6l-4.1 1.3a5 5 0 0 0-2.6.8l-.5.3c-.1 0-.2.1-.2 0a18 18 0 0 1-3.7-.7l-5.7-1.5A102.8 102.8 0 0 0 14.7.1a8.5 8.5 0 0 0-3.4.9 16.7 16.7 0 0 0-3.7 2 31.8 31.8 0 0 0-4.5 3.7l-.8.8-.1.2-.8 1L.6 10c-.4.8-.6 1.7-.6 2.6 0 1.1.3 2.3.9 3.8l1.2 2.4a5 5 0 0 0 1.5 1.7v.4L3.3 23v.1a22.3 22.3 0 0 0 0 6l.1.1v.1a17.8 17.8 0 0 0 2.2 5.8c.5.8 1 1.5 1.6 2.1v.1l.2.2a15.8 15.8 0 0 0 4.3 3.3h.3a18.3 18.3 0 0 0 18-1.2h.1l.2-.2h.5a4.9 4.9 0 0 0 4.1 2.4h7.3c.5 0 .9 0 1.3-.2h.2l1.4.2h7.3c1.2 0 2.3-.4 3.2-1.1h.4l.2.1h.3l.9.5h.1a16.4 16.4 0 0 0 5.1 1.2c.7 0 1.5-.2 2.2-.5.3 0 .6-.2.9-.4.3-.2.7-.3 1-.6h.2l.7-.6 1-.7.7-.6 1-.9c.1 0 .3 0 .3.2a5 5 0 0 0 5 4.4 5 5 0 0 0 1.6-.3c.2 0 .4.1.3.3v.1l-.3.6-.1.2v.3l-.3.4a4.9 4.9 0 0 0 4.4 7h9a4.9 4.9 0 0 0 4.4-7l-.3-.8v-.1a8 8 0 0 1-.3-.6v-.1l-.2-.4a12 12 0 0 0 2.8-1.4l1.3-.7.1-.1 1.6-1 1.8-1 2-1V37h.1c.2-.1.3 0 .4 0 .4.7.9 1.2 1.4 1.7l2.8 2c1.7 1 3 1.7 4.5 1.7 1.1 0 2.3-.4 3.7-1h.3a5.7 5.7 0 0 0 3.9.5l6-1.4h.6l.3.2h.1c1.7 1 3 1.7 4.4 1.7 1.2 0 2.3-.4 3.8-1.1h.3a5.6 5.6 0 0 0 4 .6l6-1.4h.5l.3.2h.1c1.7 1 3 1.7 4.4 1.7 1.2 0 2.3-.4 3.8-1.1h.3a5.7 5.7 0 0 0 4 .6l4-1h.3c.7.5 1.6.8 2.5.8h7.4c.4 0 .7 0 1.1-.2h.2l1.3.2h7.3c.5 0 1 0 1.4-.2h.2l1.3.2h4.2c.1 0 .3.2.2.3v.6c.1 1.7.9 3.2 2.1 4.3l2.7 2c2.1 1.6 4 2.4 6 2.4.5 0 1 0 1.6-.2l1.7-.5 1.2-.5 1.5-.8a17 17 0 0 0 2.6-1.7 16 16 0 0 0 2.6-2.1 15.2 15.2 0 0 0 4.2-5.9l.3-2.1V15.7a5 5 0 0 0-5-5ZM78 27.8l-.1.3a16.8 16.8 0 0 0-3.4 2.5c-.1.2-.4.1-.5 0a4.9 4.9 0 0 0-4.6-3.3c-.2 0-.3-.2-.2-.3l2.4-1.7a6 6 0 0 0 2.4-3.8c0-.3.2-.4.4-.3l1.3.5c.2 0 .3.1.3.3v.4c0 1.5.6 3 1.7 4.1l.3.3v1Z"/><path id="color-stroke" fill="#3AE660" d="m78.1 27.8-.1.3a16.8 16.8 0 0 0-3.4 2.5c-.1.2-.4.1-.5 0a4.9 4.9 0 0 0-4.6-3.3c-.2 0-.3-.2-.2-.3l2.4-1.7a6 6 0 0 0 2.4-3.8c0-.3.2-.4.4-.3l1.3.5c.2 0 .3.1.3.3v.4c0 1.5.6 3 1.7 4.1l.3.3v1ZM177.7 12c-.2.6-.6 1.2-1 1.8a4 4 0 0 0-1-1.2l2-.7Z"/><path id="color-stroke" fill="#3AE660" d="M177.7 12c-.2.6-.6 1.2-1 1.8a4 4 0 0 0-1-1.2l2-.7Z"/><path fill="#111" d="M168.8 13.4c.5.4 1.1.4 1.5 0l2.6-2.6c.4-.4.4-1 0-1.5l-2.6-2.6a1 1 0 0 0-1.5 0l-2.5 2.6a1 1 0 0 0 0 1.5l2.5 2.6ZM19.2 31l3.7-2c.3-.3.5-.6.5-1V14.2a1 1 0 0 0-1.5-.9l-3.7 2a1 1 0 0 0-.5 1V30a1 1 0 0 0 1.5 1Z"/><path fill="#111" d="m51.8 33.5-.2-4.6V19a1 1 0 0 0-.4-.8 36.2 36.2 0 0 0-4.3-2.7 6 6 0 0 0-2.3.7l-1.6 1c-.7.3-1.6-.2-1.6-1V6.7a1 1 0 0 0-1.4-1l-5 1.6h-.2c0-.1-.2-.1-.2 0l-.2.1-.2.1-.3.1v.2l-.7.3c-.5.2-1 .3-1.6.3-.4 0-1 0-1.8-.2l-3.5-.8L20.7 6a98 98 0 0 0-6-1.1L14 5c-.3 0-.5.2-.8.3a11.4 11.4 0 0 0-1.8 1 16.5 16.5 0 0 0-2 1.5 29.6 29.6 0 0 0-2.9 2.4l-.7.7a11 11 0 0 0-.9 1.3l-.1.4c0 .4.1 1 .5 1.9l1 2c.3.5 1 .7 1.4.4l2.6-1.4c.5-.3.7-1 .4-1.4l-2-3.7c-.5-1-.6-1.6-.3-1.6a1653.6 1653.6 0 0 1 8.1 1.8l5.7 1.4 1.8.5.7.2c.4.1.8.5.8 1V32c0 .6-.4 1-1 1h-.2l-1.2.1c-3.2 0-5.7-.8-7.5-2.6-1.7-1.7-2.6-4.3-2.6-8 0-1.4.2-2.9.5-4.5.4-1.6 1.1-3 2.2-4.5v-.1h-.2a14.5 14.5 0 0 0-2.2 1.3A21.2 21.2 0 0 0 11 17a21.4 21.4 0 0 0-2 3 14.9 14.9 0 0 0-.5 10.7 11 11 0 0 0 9.2 7.1 12.7 12.7 0 0 0 12-4.6l1-1.3a11 11 0 0 0 1.4-2.5.2.2 0 0 0-.4-.2 10.7 10.7 0 0 1-4.3 3.2c-.7.3-1.3-.2-1.3-.9V14.2c0-.6.5-1 1.1-1l1 .2c.8 0 1.8-.6 3-1.7a23 23 0 0 0 2.1-2.3c.5-.5 1.3-.5 1.6.1l.3.7c.4 1 .6 2.2.6 3.6V29a26.4 26.4 0 0 1-1 7.9h7.5a16 16 0 0 1-.8-3.4l-.2-4.5v-9.3a5.8 5.8 0 0 0 0-.6l.1-.2v-.3h.1l.2-.2h.1c.5 0 1.1.3 1.9.9l2 1.5c.3.2.4.5.4.8V29c0 1.7 0 3.2-.2 4.4a13 13 0 0 1-.8 3.4v.1h7.4a16 16 0 0 1-.7-3.4Zm17.6-1.4a9.4 9.4 0 0 1-3 1.7 16.9 16.9 0 0 1-5.2-1.6 1 1 0 0 1-.5-1v-3.4c0-.4.2-.7.4-.9l7.8-5.5c.5-.3.6-1 .3-1.3A21.3 21.3 0 0 0 67 17a5.5 5.5 0 0 0-.7-1 2.2 2.2 0 0 0-.4-.4h-.6l-.7.3a50.5 50.5 0 0 0-3.7 1.7l-1 .6-1 .6c-.4.2-.8.4-1 .7l-1 .6a15.6 15.6 0 0 0-1.2 1l-.3.5-.2.4v12c0 .3.2.6.4.8l.6.4 1 .6a36.6 36.6 0 0 1 2.1 1 10 10 0 0 0 2 .5 5.6 5.6 0 0 0 1.4.3l.4-.1.5-.3.7-.3.6-.5.8-.6.8-.6.8-.6.7-.7a12.6 12.6 0 0 0 1.2-1.1l.4-.4V32h-.2Zm-8.7-9.5v-4.5h.1V18h.1c.3 0 .8.5 1.6 1.6l2 3c.3.5.2 1.1-.2 1.5l-2 1.3a1 1 0 0 1-1.6-.8v-2Zm132.4 10.8L193 29V19a1 1 0 0 0-.4-.8 36.1 36.1 0 0 0-4.3-2.7c-.5 0-1.2.2-2.3.8l-2 1a1 1 0 0 1-1.4-.7c0-.7-.6-1.1-1.2-1l-6 2-.1.1v.1c.6.7 1.1 1.5 1.5 2.5.3 1 .5 2.1.5 3.6v5c0 1.8 0 3.3-.2 4.5-.1 1-.4 2.2-.8 3.3l.1.1h7.3c-.4-1.2-.7-2.3-.8-3.5-.2-1.2-.2-2.6-.2-4.4v-9.4a5.7 5.7 0 0 0 0-.8 1.1 1.1 0 0 1 .2-.4h.3c.5 0 1 .2 1.8.8l2 1.5c.3.2.5.5.5.8V29c0 1.7 0 3.2-.2 4.4-.2 1.2-.4 2.3-.8 3.4v.1h7.4a16 16 0 0 1-.8-3.4Zm19.4-17.8h-.1l-1.2 1a1 1 0 0 1-1.2.1 18.2 18.2 0 0 0-2.3-1.1h-.6l-.7.3a34.8 34.8 0 0 0-4 1.7 34.2 34.2 0 0 1-2 1.2c-.4.2-.8.4-1 .7a23.5 23.5 0 0 0-2.3 1.7l-.4.5-.1.3v12c0 .3.1.6.4.8a40 40 0 0 0 2.6 1.9c1 .6 1.6.9 2 .9a34.5 34.5 0 0 0 4-1.9c.6-.5 1.5 0 1.5.9v7.1l-.2.1h-.6l-.6-.3-.7-.4a15.7 15.7 0 0 1-2.7-1.8l-.9-.7-.8-.7a18.8 18.8 0 0 1-.8-.7 1 1 0 0 0-1.4.1l-2.4 2.3a1 1 0 0 0 0 1.6l2.6 2c1.2.8 2.2 1.3 3 1.3h.7l1-.4 1-.4 1-.6 1.1-.6 1.1-.8a11.4 11.4 0 0 0 2.2-1.7l1-1a7.7 7.7 0 0 0 1.3-1.8l.5-1V15.7ZM207 29.3V32a8.7 8.7 0 0 1 0 1.5v.4l-.1.2v.3h-.3c-.6 0-1.2-.2-2-.7l-2.2-1.3a1 1 0 0 1-.4-.9V19.3a5.7 5.7 0 0 0 0-.6 4.7 4.7 0 0 1 .2-.6V18h.4c.4 0 1 .3 1.9 1l2.1 1.6c.3.2.4.5.4.9v7.8ZM102.8 8.5a38.8 38.8 0 0 1-1.5-.6l-1.2-.5a19.6 19.6 0 0 0-2.1-1 15.6 15.6 0 0 0-2.8-.9A56 56 0 0 0 88.8 8c-.4.3-.8.2-1.2 0l-.2-.2a21.3 21.3 0 0 0-4.5-2.2h-.5l-.6.4a7 7 0 0 0-.7.4 9.8 9.8 0 0 0-1.7 1.1l-.9.7a18.4 18.4 0 0 0-2.3 2.2 13.3 13.3 0 0 0-1.4 1.7l-.1.2v.2c0 .5 0 1.1.4 2l1 2c.3.5 1 .7 1.5.4l2.6-1.5c.5-.2.7-.9.4-1.4a53.5 53.5 0 0 1-2.3-5.2l1.7.8 2.5 1.6c.3.2.5.5.5.9v7.4l-.4.7-1.4 1.4a1 1 0 0 0 0 1.5l1.4 1.5c.2.1.4.4.4.7v6c0 .2-.3.4-.6.4H82c-.7 0-1.7.5-3 1.5s-2.4 2.4-3.5 4.5l.1.2h.2c.5-.5.9-1 1.3-1.2.5-.4 1-.6 1.7-.6a74.7 74.7 0 0 1 3.2.3c.6.1 1 .6 1 1v.8a19.6 19.6 0 0 1-.3 3.5l-.1 1a8.8 8.8 0 0 1-.5 1.7l-.4 1-.4 1v.1h9.1v-.1a16.9 16.9 0 0 1-1.5-4.7v-1l-.2-1.2v-1.3c0-.3.3-.5.6-.5a36.4 36.4 0 0 0 2 .3c.2 0 .4 0 .7-.2a12.4 12.4 0 0 0 2.2-1 47.9 47.9 0 0 1 3-1.8 734 734 0 0 1 5.7-3c.3-.2.6-.6.6-1V9.5a1 1 0 0 0-.7-1ZM90.8 32c0 .6-.5 1-1 .9h-.2c-.5-.2-.9-.6-.9-1.1v-22a5.7 5.7 0 0 0 0-.6l.1-.1v-.4h.1l.2-.2h.2l.6.1.2.1c.5.1.8.5.8 1V32Zm6.9-2.2V33a3.7 3.7 0 0 1 0 .7l-.1.1v.3l-.1.1-.2.1H97c-.2 0-1 0-2-.3l-2.8-.6a1 1 0 0 1-.8-1v-7.2c0-.5.3-.9.8-1l4-1.2a1 1 0 0 1 1.4 1v5.8Zm0-8.6c0 .5-.3.9-.8 1l-4 1.2a1 1 0 0 1-1.4-1v-.9c0-.4.3-.8.8-1l4-1.2a1 1 0 0 1 1.4 1v1Zm0-3.7c0 .5-.3.9-.8 1l-4 1.2a1 1 0 0 1-1.4-1v-8a1 1 0 0 1 1.4-1l1.6.7 2.6 1.2c.4.1.6.5.6 1v5ZM173 33.4a28 28 0 0 1-.3-4.5V16.7a1 1 0 0 0-1.4-1l-6 2-.1.2v.1c.7.7 1.1 1.6 1.5 2.5.3 1 .5 2.1.5 3.6v4.8a27.3 27.3 0 0 1-1 7.9h7.5l-.8-3.4Zm-47.7 2-.2-.2-.3-.4-.4-.6a21.8 21.8 0 0 1-.5-1.4l-.1-1-.1-1.3V16.7a1 1 0 0 0-1.4-1l-6 2-.1.2v.1c.7.7 1.2 1.6 1.5 2.5.3 1 .5 2.1.5 3.6V32a8.7 8.7 0 0 1 0 1.4v.2l-.1.3a4.8 4.8 0 0 0 0 .3.5.5 0 0 1-.1.2h-.3c-.5 0-1-.2-1.8-.6l-2-1.4a1 1 0 0 1-.5-.8V16.8a1 1 0 0 0-1.3-1l-6 1.9c-.1 0-.2 0-.2.2l.1.1c.6.7 1.1 1.6 1.4 2.5.4 1 .5 2.1.5 3.6v10c0 .3.2.6.4.8a44 44 0 0 0 4.4 2.7 37.6 37.6 0 0 0 4.3-2c.6-.5 1.4 0 1.4.7 0 .6.6 1 1.2.9l6-1.4h.1l-.4-.4Zm19.5 0-.2-.2-.3-.4-.3-.5v-.1a15.4 15.4 0 0 1-.5-1.4 49.8 49.8 0 0 1-.3-2l-.1-1.3V6.7a1 1 0 0 0-1.4-1l-6 2c.6.8 1 1.6 1.4 2.5.3 1 .5 2.2.5 3.7v1c0 .5-.3.8-.7 1a35.9 35.9 0 0 0-4 1.7l-1 .6a23 23 0 0 0-2 1.3 25 25 0 0 0-2.3 1.7l-.4.4V34c0 .3 0 .6.3.8l2.6 1.9c1 .6 1.6.9 2 .9a6 6 0 0 0 2.3-1l2-1.2a1 1 0 0 1 1.4.8c0 .7.6 1.1 1.2 1l6.1-1.4v-.1l-.3-.3Zm-7.2-6.1V32a8.7 8.7 0 0 1 0 1.5v.4l-.1.2v.3h-.4a4 4 0 0 1-2-.7l-2.2-1.3a1 1 0 0 1-.4-.9V19.3a5.7 5.7 0 0 0 0-.6 4.7 4.7 0 0 1 .2-.6V18h.4c.4 0 1 .3 1.9 1l2.1 1.6c.3.2.4.5.4.9v7.8Zm26.6 6.1-.2-.2-.3-.4-.3-.5v-.1a15.3 15.3 0 0 1-.5-1.4 49.8 49.8 0 0 1-.3-2V6.7a1 1 0 0 0-1.4-1l-6.1 2c.6.8 1 1.6 1.4 2.5.4 1 .5 2.2.5 3.7v1c0 .5-.3.8-.7 1a36.3 36.3 0 0 0-4 1.7l-1 .6a23 23 0 0 0-2 1.3 25 25 0 0 0-2.3 1.7c-.2.2-.3.3-.3.5l-.2.3v12c0 .3.2.6.4.8l2.6 1.9c1 .6 1.7.9 2 .9a6 6 0 0 0 2.3-1l2-1.2a1 1 0 0 1 1.5.8c0 .7.5 1.1 1.1 1l6.1-1.4v-.1l-.3-.3Zm-7.2-6.1V32a8.7 8.7 0 0 1 0 1.5v.6l-.1.1a.4.4 0 0 1-.1.2h-.3c-.4 0-1-.2-2-.7l-2-1.3a1 1 0 0 1-.5-.9V19.3a5.7 5.7 0 0 0 0-.6 4.7 4.7 0 0 1 .2-.6l.1-.1h.3c.5 0 1 .3 1.9 1l2.2 1.6c.2.2.3.5.3.9v7.8Z"/></svg>',Pc=ll(!1),ao=ll(!1),Lu=ll(!1);function MF(t){let e,i,n="Close",s,r,o='By <a target="_blank" href="https://pudding.cool/author/matt-daniels/" class="svelte-1248pje">Matthew Daniels</a>. Reach out at matt@pudding.cool',a,c,l='Court Locations are retrieved from <a href="https://www.openstreetmap.org/#map=4/38.01/-95.84" class="svelte-1248pje">Open Street Map</a>.',u,h;return{c(){e=K("div"),i=K("button"),i.textContent=n,s=ue(),r=K("p"),r.innerHTML=o,a=ue(),c=K("p"),c.innerHTML=l,this.h()},l(f){e=Z(f,"DIV",{class:!0});var d=oe(e);i=Z(d,"BUTTON",{class:!0,"data-svelte-h":!0}),We(i)!=="svelte-bxc8wg"&&(i.textContent=n),s=he(d),r=Z(d,"P",{class:!0,"data-svelte-h":!0}),We(r)!=="svelte-ha7xmh"&&(r.innerHTML=o),a=he(d),c=Z(d,"P",{class:!0,"data-svelte-h":!0}),We(c)!=="svelte-123pxj2"&&(c.innerHTML=l),d.forEach(j),this.h()},h(){L(i,"class","close svelte-1248pje"),L(r,"class","svelte-1248pje"),L(c,"class","svelte-1248pje"),L(e,"class","about svelte-1248pje")},m(f,d){re(f,e,d),H(e,i),H(e,s),H(e,r),H(e,a),H(e,c),u||(h=hi(i,"click",t[0]),u=!0)},p:St,i:St,o:St,d(f){f&&j(e),u=!1,h()}}}function IF(t,e,i){let n;un(t,Pc,r=>i(1,n=r));function s(){Ln(Pc,n=!1,n)}return[s]}class OF extends vn{constructor(e){super(),bn(this,e,IF,MF,Hi,{})}}function NF(t){let e,i="",n,s,r,o='<div id="cesiumContainer" style="" class="svelte-9iqq6b"></div>',a,c;return{c(){e=K("script"),e.innerHTML=i,s=ue(),r=K("div"),r.innerHTML=o,this.h()},l(l){const u=Om("svelte-rc6uig",document.head);e=Z(u,"SCRIPT",{src:!0,"data-svelte-h":!0}),We(e)!=="svelte-qvkiq1"&&(e.innerHTML=i),u.forEach(j),s=he(l),r=Z(l,"DIV",{class:!0,"data-svelte-h":!0}),We(r)!=="svelte-xdau3z"&&(r.innerHTML=o),this.h()},h(){Wb(e.src,n="https://ajax.googleapis.com/ajax/libs/cesiumjs/1.105/Build/Cesium/Cesium.js")||L(e,"src",n),L(r,"class","parent svelte-9iqq6b")},m(l,u){H(document.head,e),re(l,s,u),re(l,r,u),a||(c=hi(e,"load",t[0]),a=!0)},p:St,i:St,o:St,d(l){l&&(j(s),j(r)),j(e),a=!1,c()}}}function kF(t,e,i){const n="AIzaSyBRQrRe8Ife25sH5b32ELrhwqkABnlXAqM";let{coords:s}=e;function r(){console.log("playing");const o=new Cesium.Viewer("cesiumContainer",{imageryProvider:!1,requestRenderMode:!0,navigationHelpButton:!1,animation:!1,timeline:!1,baseLayerPicker:!1,geocoder:!1,sceneModePicker:!1,fullscreenButton:!1,homeButton:!1,infoBox:!1,selectionIndicator:!1,navigationInstructionsInitiallyVisible:!1});o.scene.primitives.add(new Cesium.Cesium3DTileset({url:`https://tile.googleapis.com/v1/3dtiles/root.json?key=${n}`}));var a=.96,c=-1.2,l=0,u=400;console.log("setting coords",s[0],s[1]);var h=Cesium.Cartesian3.fromDegrees(s[0]-2e-4,s[1]-1e-4,u),f={heading:a,pitch:c,roll:l};o.camera.setView({destination:h,orientation:f,endTransform:Cesium.Matrix4.IDENTITY}),o.camera.changed.addEventListener(function(){var d=o.camera.positionCartographic,p=Cesium.Math.toDegrees(d.latitude),g=Cesium.Math.toDegrees(d.longitude),_=o.camera.heading,b=o.camera.pitch,T=o.camera.roll;console.log(g,p,_,b,T)})}return cl(async()=>{}),t.$$set=o=>{"coords"in o&&i(1,s=o.coords)},t.$$.update=()=>{t.$$.dirty&2&&console.log(s)},[r,s]}class DF extends vn{constructor(e){super(),bn(this,e,kF,NF,Hi,{coords:1})}}const FF=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...i)=>rr(()=>Promise.resolve().then(()=>Vo),void 0,import.meta.url).then(({default:n})=>n(...i)):e=fetch,(...i)=>e(...i)};class Td extends Error{constructor(e,i="FunctionsError",n){super(e),this.name=i,this.context=n}}class LF extends Td{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class BF extends Td{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class UF extends Td{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Rf;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Rf||(Rf={}));var zF=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};class VF{constructor(e,{headers:i={},customFetch:n,region:s=Rf.Any}={}){this.url=e,this.headers=i,this.region=s,this.fetch=FF(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,i={}){var n;return zF(this,void 0,void 0,function*(){try{const{headers:s,method:r,body:o}=i;let a={},{region:c}=i;c||(c=this.region),c&&c!=="any"&&(a["x-region"]=c);let l;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",l=o):typeof o=="string"?(a["Content-Type"]="text/plain",l=o):typeof FormData<"u"&&o instanceof FormData?l=o:(a["Content-Type"]="application/json",l=JSON.stringify(o)));const u=yield this.fetch(`${this.url}/${e}`,{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:l}).catch(p=>{throw new LF(p)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new BF(u);if(!u.ok)throw new UF(u);let f=((n=u.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),d;return f==="application/json"?d=yield u.json():f==="application/octet-stream"?d=yield u.blob():f==="text/event-stream"?d=u:f==="multipart/form-data"?d=yield u.formData():d=yield u.text(),{data:d,error:null}}catch(s){return{data:null,error:s}}})}}var jF=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},vr=jF();const $F=vr.fetch,Ed=vr.fetch.bind(vr),$v=vr.Headers,HF=vr.Request,WF=vr.Response,Vo=Object.freeze(Object.defineProperty({__proto__:null,Headers:$v,Request:HF,Response:WF,default:Ed,fetch:$F},Symbol.toStringTag,{value:"Module"}));class XF extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}class qF{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Ed:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{var o,a,c;let l=null,u=null,h=null,f=r.status,d=r.statusText;if(r.ok){if(this.method!=="HEAD"){const b=await r.text();b===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=b:u=JSON.parse(b))}const g=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),_=(a=r.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");g&&_&&_.length>1&&(h=parseInt(_[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(l={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,f=406,d="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const g=await r.text();try{l=JSON.parse(g),Array.isArray(l)&&r.status===404&&(u=[],l=null,f=200,d="OK")}catch{r.status===404&&g===""?(f=204,d="No Content"):l={message:g}}if(l&&this.isMaybeSingle&&(!((c=l==null?void 0:l.details)===null||c===void 0)&&c.includes("0 rows"))&&(l=null,f=200,d="OK"),l&&this.shouldThrowOnError)throw new XF(l)}return{error:l,data:u,count:h,status:f,statusText:d}});return this.shouldThrowOnError||(s=s.catch(r=>{var o,a,c;return{error:{message:`${(o=r==null?void 0:r.name)!==null&&o!==void 0?o:"FetchError"}: ${r==null?void 0:r.message}`,details:`${(a=r==null?void 0:r.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(c=r==null?void 0:r.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,i)}}class YF extends qF{select(e){let i=!1;const n=(e??"*").split("").map(s=>/\s/.test(s)&&!i?"":(s==='"'&&(i=!i),s)).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:i=!0,nullsFirst:n,foreignTable:s,referencedTable:r=s}={}){const o=r?`${r}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${i?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:i,referencedTable:n=i}={}){const s=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,i,{foreignTable:n,referencedTable:s=n}={}){const r=typeof s>"u"?"offset":`${s}.offset`,o=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this.url.searchParams.set(o,`${i-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:i=!1,settings:n=!1,buffers:s=!1,wal:r=!1,format:o="text"}={}){var a;const c=[e?"analyze":null,i?"verbose":null,n?"settings":null,s?"buffers":null,r?"wal":null].filter(Boolean).join("|"),l=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${l}"; options=${c};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class ks extends YF{eq(e,i){return this.url.searchParams.append(e,`eq.${i}`),this}neq(e,i){return this.url.searchParams.append(e,`neq.${i}`),this}gt(e,i){return this.url.searchParams.append(e,`gt.${i}`),this}gte(e,i){return this.url.searchParams.append(e,`gte.${i}`),this}lt(e,i){return this.url.searchParams.append(e,`lt.${i}`),this}lte(e,i){return this.url.searchParams.append(e,`lte.${i}`),this}like(e,i){return this.url.searchParams.append(e,`like.${i}`),this}likeAllOf(e,i){return this.url.searchParams.append(e,`like(all).{${i.join(",")}}`),this}likeAnyOf(e,i){return this.url.searchParams.append(e,`like(any).{${i.join(",")}}`),this}ilike(e,i){return this.url.searchParams.append(e,`ilike.${i}`),this}ilikeAllOf(e,i){return this.url.searchParams.append(e,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(e,i){return this.url.searchParams.append(e,`ilike(any).{${i.join(",")}}`),this}is(e,i){return this.url.searchParams.append(e,`is.${i}`),this}in(e,i){const n=Array.from(new Set(i)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,i){return typeof i=="string"?this.url.searchParams.append(e,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(e,`cs.{${i.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(i)}`),this}containedBy(e,i){return typeof i=="string"?this.url.searchParams.append(e,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(e,`cd.{${i.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(i)}`),this}rangeGt(e,i){return this.url.searchParams.append(e,`sr.${i}`),this}rangeGte(e,i){return this.url.searchParams.append(e,`nxl.${i}`),this}rangeLt(e,i){return this.url.searchParams.append(e,`sl.${i}`),this}rangeLte(e,i){return this.url.searchParams.append(e,`nxr.${i}`),this}rangeAdjacent(e,i){return this.url.searchParams.append(e,`adj.${i}`),this}overlaps(e,i){return typeof i=="string"?this.url.searchParams.append(e,`ov.${i}`):this.url.searchParams.append(e,`ov.{${i.join(",")}}`),this}textSearch(e,i,{config:n,type:s}={}){let r="";s==="plain"?r="pl":s==="phrase"?r="ph":s==="websearch"&&(r="w");const o=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${r}fts${o}.${i}`),this}match(e){return Object.entries(e).forEach(([i,n])=>{this.url.searchParams.append(i,`eq.${n}`)}),this}not(e,i,n){return this.url.searchParams.append(e,`not.${i}.${n}`),this}or(e,{foreignTable:i,referencedTable:n=i}={}){const s=n?`${n}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,i,n){return this.url.searchParams.append(e,`${i}.${n}`),this}}class KF{constructor(e,{headers:i={},schema:n,fetch:s}){this.url=e,this.headers=i,this.schema=n,this.fetch=s}select(e,{head:i=!1,count:n}={}){const s=i?"HEAD":"GET";let r=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!r?"":(a==='"'&&(r=!r),a)).join("");return this.url.searchParams.set("select",o),n&&(this.headers.Prefer=`count=${n}`),new ks({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:i,defaultToNull:n=!0}={}){const s="POST",r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),i&&r.push(`count=${i}`),n||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){const o=e.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(o.length>0){const a=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new ks({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:i,ignoreDuplicates:n=!1,count:s,defaultToNull:r=!0}={}){const o="POST",a=[`resolution=${n?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),r||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const c=e.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(c.length>0){const l=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new ks({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:i}={}){const n="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),i&&s.push(`count=${i}`),this.headers.Prefer=s.join(","),new ks({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const i="DELETE",n=[];return e&&n.push(`count=${e}`),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),new ks({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const ZF="1.15.2",GF={"X-Client-Info":`postgrest-js/${ZF}`};class Sd{constructor(e,{headers:i={},schema:n,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},GF),i),this.schemaName=n,this.fetch=s}from(e){const i=new URL(`${this.url}/${e}`);return new KF(i,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Sd(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,i={},{head:n=!1,get:s=!1,count:r}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let c;n||s?(o=n?"HEAD":"GET",Object.entries(i).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{a.searchParams.append(u,h)})):(o="POST",c=i);const l=Object.assign({},this.headers);return r&&(l.Prefer=`count=${r}`),new ks({method:o,url:a,headers:l,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}}const JF="2.9.5",QF={"X-Client-Info":`realtime-js/${JF}`},e6="1.0.0",Hv=1e4,t6=1e3;var er;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(er||(er={}));var Ut;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Ut||(Ut={}));var ni;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(ni||(ni={}));var Cf;(function(t){t.websocket="websocket"})(Cf||(Cf={}));var kn;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(kn||(kn={}));class Wv{constructor(e,i){this.callback=e,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class i6{constructor(){this.HEADER_LENGTH=1}decode(e,i){return e.constructor===ArrayBuffer?i(this._binaryDecode(e)):i(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const i=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,i,n)}_decodeBroadcast(e,i,n){const s=i.getUint8(1),r=i.getUint8(2);let o=this.HEADER_LENGTH+2;const a=n.decode(e.slice(o,o+s));o=o+s;const c=n.decode(e.slice(o,o+r));o=o+r;const l=JSON.parse(n.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:c,payload:l}}}class Bu{constructor(e,i,n={},s=Hv){this.channel=e,this.event=i,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,i){var n;return this._hasReceived(e)&&i((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:i}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(i))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var V0;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(V0||(V0={}));class co{constructor(e,i){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(i==null?void 0:i.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=co.syncState(this.state,s,r,o),this.pendingDiffs.forEach(c=>{this.state=co.syncDiff(this.state,c,r,o)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},s=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=co.syncDiff(this.state,s,r,o),a())}),this.onJoin((s,r,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:r,newPresences:o})}),this.onLeave((s,r,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:r,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,i,n,s){const r=this.cloneDeep(e),o=this.transformState(i),a={},c={};return this.map(r,(l,u)=>{o[l]||(c[l]=u)}),this.map(o,(l,u)=>{const h=r[l];if(h){const f=u.map(_=>_.presence_ref),d=h.map(_=>_.presence_ref),p=u.filter(_=>d.indexOf(_.presence_ref)<0),g=h.filter(_=>f.indexOf(_.presence_ref)<0);p.length>0&&(a[l]=p),g.length>0&&(c[l]=g)}else a[l]=u}),this.syncDiff(r,{joins:a,leaves:c},n,s)}static syncDiff(e,i,n,s){const{joins:r,leaves:o}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(r,(a,c)=>{var l;const u=(l=e[a])!==null&&l!==void 0?l:[];if(e[a]=this.cloneDeep(c),u.length>0){const h=e[a].map(d=>d.presence_ref),f=u.filter(d=>h.indexOf(d.presence_ref)<0);e[a].unshift(...f)}n(a,u,c)}),this.map(o,(a,c)=>{let l=e[a];if(!l)return;const u=c.map(h=>h.presence_ref);l=l.filter(h=>u.indexOf(h.presence_ref)<0),e[a]=l,s(a,l,c),l.length===0&&delete e[a]}),e}static map(e,i){return Object.getOwnPropertyNames(e).map(n=>i(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((i,n)=>{const s=e[n];return"metas"in s?i[n]=s.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):i[n]=s,i},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ue;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Ue||(Ue={}));const j0=(t,e,i={})=>{var n;const s=(n=i.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((r,o)=>(r[o]=n6(o,t,e,s),r),{})},n6=(t,e,i,n)=>{const s=e.find(a=>a.name===t),r=s==null?void 0:s.type,o=i[t];return r&&!n.includes(r)?Xv(r,o):xf(o)},Xv=(t,e)=>{if(t.charAt(0)==="_"){const i=t.slice(1,t.length);return a6(e,i)}switch(t){case Ue.bool:return s6(e);case Ue.float4:case Ue.float8:case Ue.int2:case Ue.int4:case Ue.int8:case Ue.numeric:case Ue.oid:return r6(e);case Ue.json:case Ue.jsonb:return o6(e);case Ue.timestamp:return c6(e);case Ue.abstime:case Ue.date:case Ue.daterange:case Ue.int4range:case Ue.int8range:case Ue.money:case Ue.reltime:case Ue.text:case Ue.time:case Ue.timestamptz:case Ue.timetz:case Ue.tsrange:case Ue.tstzrange:return xf(e);default:return xf(e)}},xf=t=>t,s6=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},r6=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},o6=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},a6=(t,e)=>{if(typeof t!="string")return t;const i=t.length-1,n=t[i];if(t[0]==="{"&&n==="}"){let r;const o=t.slice(1,i);try{r=JSON.parse("["+o+"]")}catch{r=o?o.split(","):[]}return r.map(a=>Xv(e,a))}return t},c6=t=>typeof t=="string"?t.replace(" ","T"):t;var $0;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})($0||($0={}));var H0;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes"})(H0||(H0={}));var W0;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(W0||(W0={}));class Ad{constructor(e,i={config:{}},n){this.topic=e,this.params=i,this.socket=n,this.bindings={},this.state=Ut.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},i.config),this.timeout=this.socket.timeout,this.joinPush=new Bu(this,ni.join,this.params,this.timeout),this.rejoinTimer=new Wv(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ut.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ut.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Ut.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ut.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ni.reply,{},(s,r)=>{this._trigger(this._replyEventName(r),s)}),this.presence=new co(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,i=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:r,presence:o}}=this.params;this._onError(l=>e&&e("CHANNEL_ERROR",l)),this._onClose(()=>e&&e("CLOSED"));const a={},c={broadcast:r,presence:o,postgres_changes:(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(l=>l.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:c},a)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",({postgres_changes:l})=>{var u;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),l===void 0){e&&e("SUBSCRIBED");return}else{const h=this.bindings.postgres_changes,f=(u=h==null?void 0:h.length)!==null&&u!==void 0?u:0,d=[];for(let p=0;p<f;p++){const g=h[p],{filter:{event:_,schema:b,table:T,filter:v}}=g,E=l&&l[p];if(E&&E.event===_&&E.schema===b&&E.table===T&&E.filter===v)d.push(Object.assign(Object.assign({},g),{id:E.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=d,e&&e("SUBSCRIBED");return}}).receive("error",l=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(l).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,i={}){return await this.send({type:"presence",event:"track",payload:e},i.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,i,n){return this._on(e,i,n)}async send(e,i={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:r,payload:o}=e,a={method:"POST",headers:{apikey:(n=this.socket.apiKey)!==null&&n!==void 0?n:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:o}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=i.timeout)!==null&&s!==void 0?s:this.timeout)).ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var o,a,c;const l=this._push(e.type,e,i.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&r("ok"),l.receive("ok",()=>r("ok")),l.receive("error",()=>r("error")),l.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ut.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ni.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(n=>{const s=new Bu(this,ni.leave,{},e);s.receive("ok",()=>{i(),n("ok")}).receive("timeout",()=>{i(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,i,n){const s=new AbortController,r=setTimeout(()=>s.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},i),{signal:s.signal}));return clearTimeout(r),o}_push(e,i,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Bu(this,e,i,n);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,i,n){return i}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,i,n){var s,r;const o=e.toLocaleLowerCase(),{close:a,error:c,leave:l,join:u}=ni;if(n&&[a,c,l,u].indexOf(o)>=0&&n!==this._joinRef())return;let f=this._onMessage(o,i,n);if(i&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(d=>{var p,g,_;return((p=d.filter)===null||p===void 0?void 0:p.event)==="*"||((_=(g=d.filter)===null||g===void 0?void 0:g.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===o}).map(d=>d.callback(f,n)):(r=this.bindings[o])===null||r===void 0||r.filter(d=>{var p,g,_,b,T,v;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in d){const E=d.id,R=(p=d.filter)===null||p===void 0?void 0:p.event;return E&&((g=i.ids)===null||g===void 0?void 0:g.includes(E))&&(R==="*"||(R==null?void 0:R.toLocaleLowerCase())===((_=i.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const E=(T=(b=d==null?void 0:d.filter)===null||b===void 0?void 0:b.event)===null||T===void 0?void 0:T.toLocaleLowerCase();return E==="*"||E===((v=i==null?void 0:i.event)===null||v===void 0?void 0:v.toLocaleLowerCase())}else return d.type.toLocaleLowerCase()===o}).map(d=>{if(typeof f=="object"&&"ids"in f){const p=f.data,{schema:g,table:_,commit_timestamp:b,type:T,errors:v}=p;f=Object.assign(Object.assign({},{schema:g,table:_,commit_timestamp:b,eventType:T,new:{},old:{},errors:v}),this._getPayloadRecords(p))}d.callback(f,n)})}_isClosed(){return this.state===Ut.closed}_isJoined(){return this.state===Ut.joined}_isJoining(){return this.state===Ut.joining}_isLeaving(){return this.state===Ut.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,i,n){const s=e.toLocaleLowerCase(),r={type:s,filter:i,callback:n};return this.bindings[s]?this.bindings[s].push(r):this.bindings[s]=[r],this}_off(e,i){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(s=>{var r;return!(((r=s.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===n&&Ad.isEqual(s.filter,i))}),this}static isEqual(e,i){if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const n in e)if(e[n]!==i[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ni.close,{},e)}_onError(e){this._on(ni.error,{},i=>e(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ut.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const i={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(i.new=j0(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(i.old=j0(e.columns,e.old_record)),i}}const l6=()=>{},u6=typeof WebSocket<"u";class h6{constructor(e,i){var n;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=QF,this.params={},this.timeout=Hv,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=l6,this.conn=null,this.sendBuffer=[],this.serializer=new i6,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=r=>{let o;return r?o=r:typeof fetch>"u"?o=(...a)=>rr(()=>Promise.resolve().then(()=>Vo),void 0,import.meta.url).then(({default:c})=>c(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${Cf.websocket}`,i!=null&&i.transport?this.transport=i.transport:this.transport=null,i!=null&&i.params&&(this.params=i.params),i!=null&&i.headers&&(this.headers=Object.assign(Object.assign({},this.headers),i.headers)),i!=null&&i.timeout&&(this.timeout=i.timeout),i!=null&&i.logger&&(this.logger=i.logger),i!=null&&i.heartbeatIntervalMs&&(this.heartbeatIntervalMs=i.heartbeatIntervalMs);const s=(n=i==null?void 0:i.params)===null||n===void 0?void 0:n.apikey;s&&(this.accessToken=s,this.apiKey=s),this.reconnectAfterMs=i!=null&&i.reconnectAfterMs?i.reconnectAfterMs:r=>[1e3,2e3,5e3,1e4][r-1]||1e4,this.encode=i!=null&&i.encode?i.encode:(r,o)=>o(JSON.stringify(r)),this.decode=i!=null&&i.decode?i.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Wv(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(i==null?void 0:i.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(u6){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new f6(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),rr(()=>import("../chunks/browser.BVZztmgU.js").then(e=>e.b),__vite__mapDeps([0,1,2,3]),import.meta.url).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,i){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,i??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const i=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const e=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.disconnect(),e}log(e,i,n){this.logger(e,i,n)}connectionState(){switch(this.conn&&this.conn.readyState){case er.connecting:return kn.Connecting;case er.open:return kn.Open;case er.closing:return kn.Closing;default:return kn.Closed}}isConnected(){return this.connectionState()===kn.Open}channel(e,i={config:{}}){const n=new Ad(`realtime:${e}`,i,this);return this.channels.push(n),n}push(e){const{topic:i,event:n,payload:s,ref:r}=e,o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${i} ${n} (${r})`,s),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(i=>{e&&i.updateJoinPayload({access_token:e}),i.joinedOnce&&i._isJoined()&&i._push(ni.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let i=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${e}"`),i.unsubscribe())}_remove(e){this.channels=this.channels.filter(i=>i._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:e6}))}_onConnMessage(e){this.decode(e.data,i=>{let{topic:n,event:s,payload:r,ref:o}=i;(o&&o===this.pendingHeartbeatRef||s===(r==null?void 0:r.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${n} ${s} ${o&&"("+o+")"||""}`,r),this.channels.filter(a=>a._isMember(n)).forEach(a=>a._trigger(s,r,o)),this.stateChangeCallbacks.message.forEach(a=>a(i))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(i=>i(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(i=>i(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(ni.error))}_appendParams(e,i){if(Object.keys(i).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(i);return`${e}${n}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(t6,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class f6{constructor(e,i,n){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=er.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=n.close}}class Rd extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function wt(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class d6 extends Rd{constructor(e,i){super(e),this.name="StorageApiError",this.status=i}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class X0 extends Rd{constructor(e,i){super(e),this.name="StorageUnknownError",this.originalError=i}}var p6=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const qv=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...i)=>rr(()=>Promise.resolve().then(()=>Vo),void 0,import.meta.url).then(({default:n})=>n(...i)):e=fetch,(...i)=>e(...i)},g6=()=>p6(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield rr(()=>Promise.resolve().then(()=>Vo),void 0,import.meta.url)).Response:Response});var Ar=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const Uu=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),_6=(t,e)=>Ar(void 0,void 0,void 0,function*(){const i=yield g6();t instanceof i?t.json().then(n=>{e(new d6(Uu(n),t.status||500))}).catch(n=>{e(new X0(Uu(n),n))}):e(new X0(Uu(t),t))}),m6=(t,e,i,n)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),i))};function Sl(t,e,i,n,s,r){return Ar(this,void 0,void 0,function*(){return new Promise((o,a)=>{t(i,m6(e,n,s,r)).then(c=>{if(!c.ok)throw c;return n!=null&&n.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>_6(c,a))})})}function Pf(t,e,i,n){return Ar(this,void 0,void 0,function*(){return Sl(t,"GET",e,i,n)})}function nn(t,e,i,n,s){return Ar(this,void 0,void 0,function*(){return Sl(t,"POST",e,n,s,i)})}function y6(t,e,i,n,s){return Ar(this,void 0,void 0,function*(){return Sl(t,"PUT",e,n,s,i)})}function Yv(t,e,i,n,s){return Ar(this,void 0,void 0,function*(){return Sl(t,"DELETE",e,n,s,i)})}var jt=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const v6={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},q0={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class b6{constructor(e,i={},n,s){this.url=e,this.headers=i,this.bucketId=n,this.fetch=qv(s)}uploadOrUpdate(e,i,n,s){return jt(this,void 0,void 0,function*(){try{let r;const o=Object.assign(Object.assign({},q0),s),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&n instanceof Blob?(r=new FormData,r.append("cacheControl",o.cacheControl),r.append("",n)):typeof FormData<"u"&&n instanceof FormData?(r=n,r.append("cacheControl",o.cacheControl)):(r=n,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const c=this._removeEmptyFolders(i),l=this._getFinalPath(c),u=yield this.fetch(`${this.url}/object/${l}`,Object.assign({method:e,body:r,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),h=yield u.json();return u.ok?{data:{path:c,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(r){if(wt(r))return{data:null,error:r};throw r}})}upload(e,i,n){return jt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,i,n)})}uploadToSignedUrl(e,i,n,s){return jt(this,void 0,void 0,function*(){const r=this._removeEmptyFolders(e),o=this._getFinalPath(r),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",i);try{let c;const l=Object.assign({upsert:q0.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",l.cacheControl)):(c=n,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:u}),f=yield h.json();return h.ok?{data:{path:r,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(wt(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e){return jt(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e);const n=yield nn(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:this.headers}),s=new URL(this.url+n.url),r=s.searchParams.get("token");if(!r)throw new Rd("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:r},error:null}}catch(i){if(wt(i))return{data:null,error:i};throw i}})}update(e,i,n){return jt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,i,n)})}move(e,i){return jt(this,void 0,void 0,function*(){try{return{data:yield nn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i},{headers:this.headers}),error:null}}catch(n){if(wt(n))return{data:null,error:n};throw n}})}copy(e,i){return jt(this,void 0,void 0,function*(){try{return{data:{path:(yield nn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i},{headers:this.headers})).Key},error:null}}catch(n){if(wt(n))return{data:null,error:n};throw n}})}createSignedUrl(e,i,n){return jt(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),r=yield nn(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:i},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return r={signedUrl:encodeURI(`${this.url}${r.signedURL}${o}`)},{data:r,error:null}}catch(s){if(wt(s))return{data:null,error:s};throw s}})}createSignedUrls(e,i,n){return jt(this,void 0,void 0,function*(){try{const s=yield nn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:i,paths:e},{headers:this.headers}),r=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${r}`):null})),error:null}}catch(s){if(wt(s))return{data:null,error:s};throw s}})}download(e,i){return jt(this,void 0,void 0,function*(){const s=typeof(i==null?void 0:i.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((i==null?void 0:i.transform)||{}),o=r?`?${r}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Pf(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(wt(a))return{data:null,error:a};throw a}})}getPublicUrl(e,i){const n=this._getFinalPath(e),s=[],r=i!=null&&i.download?`download=${i.download===!0?"":i.download}`:"";r!==""&&s.push(r);const a=typeof(i==null?void 0:i.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((i==null?void 0:i.transform)||{});c!==""&&s.push(c);let l=s.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${l}`)}}}remove(e){return jt(this,void 0,void 0,function*(){try{return{data:yield Yv(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(i){if(wt(i))return{data:null,error:i};throw i}})}list(e,i,n){return jt(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},v6),i),{prefix:e||""});return{data:yield nn(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(wt(s))return{data:null,error:s};throw s}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const i=[];return e.width&&i.push(`width=${e.width}`),e.height&&i.push(`height=${e.height}`),e.resize&&i.push(`resize=${e.resize}`),e.format&&i.push(`format=${e.format}`),e.quality&&i.push(`quality=${e.quality}`),i.join("&")}}const w6="2.5.5",T6={"X-Client-Info":`storage-js/${w6}`};var Ps=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};class E6{constructor(e,i={},n){this.url=e,this.headers=Object.assign(Object.assign({},T6),i),this.fetch=qv(n)}listBuckets(){return Ps(this,void 0,void 0,function*(){try{return{data:yield Pf(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(wt(e))return{data:null,error:e};throw e}})}getBucket(e){return Ps(this,void 0,void 0,function*(){try{return{data:yield Pf(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(i){if(wt(i))return{data:null,error:i};throw i}})}createBucket(e,i={public:!1}){return Ps(this,void 0,void 0,function*(){try{return{data:yield nn(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(wt(n))return{data:null,error:n};throw n}})}updateBucket(e,i){return Ps(this,void 0,void 0,function*(){try{return{data:yield y6(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(wt(n))return{data:null,error:n};throw n}})}emptyBucket(e){return Ps(this,void 0,void 0,function*(){try{return{data:yield nn(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(i){if(wt(i))return{data:null,error:i};throw i}})}deleteBucket(e){return Ps(this,void 0,void 0,function*(){try{return{data:yield Yv(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(i){if(wt(i))return{data:null,error:i};throw i}})}}class S6 extends E6{constructor(e,i={},n){super(e,i,n)}from(e){return new b6(this.url,this.headers,e,this.fetch)}}const A6="2.43.4";let Jr="";typeof Deno<"u"?Jr="deno":typeof document<"u"?Jr="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Jr="react-native":Jr="node";const R6={"X-Client-Info":`supabase-js-${Jr}/${A6}`},C6={headers:R6},x6={schema:"public"},P6={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},M6={};var I6=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const O6=t=>{let e;return t?e=t:typeof fetch>"u"?e=Ed:e=fetch,(...i)=>e(...i)},N6=()=>typeof Headers>"u"?$v:Headers,k6=(t,e,i)=>{const n=O6(i),s=N6();return(r,o)=>I6(void 0,void 0,void 0,function*(){var a;const c=(a=yield e())!==null&&a!==void 0?a:t;let l=new s(o==null?void 0:o.headers);return l.has("apikey")||l.set("apikey",t),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),n(r,Object.assign(Object.assign({},o),{headers:l}))})};function D6(t){return t.replace(/\/$/,"")}function F6(t,e){const{db:i,auth:n,realtime:s,global:r}=t,{db:o,auth:a,realtime:c,global:l}=e;return{db:Object.assign(Object.assign({},o),i),auth:Object.assign(Object.assign({},a),n),realtime:Object.assign(Object.assign({},c),s),global:Object.assign(Object.assign({},l),r)}}const Kv="2.64.2",L6="http://localhost:9999",B6="supabase.auth.token",U6={"X-Client-Info":`gotrue-js/${Kv}`},Y0=10,Mf="X-Supabase-Api-Version",Zv={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function z6(t){return Math.round(Date.now()/1e3)+t}function V6(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const ii=()=>typeof document<"u",xn={tested:!1,writable:!1},lo=()=>{if(!ii())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(xn.tested)return xn.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),xn.tested=!0,xn.writable=!0}catch{xn.tested=!0,xn.writable=!1}return xn.writable};function zu(t){const e={},i=new URL(t);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((s,r)=>{e[r]=s})}catch{}return i.searchParams.forEach((n,s)=>{e[s]=n}),e}const Gv=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...i)=>rr(()=>Promise.resolve().then(()=>Vo),void 0,import.meta.url).then(({default:n})=>n(...i)):e=fetch,(...i)=>e(...i)},j6=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Jv=async(t,e,i)=>{await t.setItem(e,JSON.stringify(i))},Ma=async(t,e)=>{const i=await t.getItem(e);if(!i)return null;try{return JSON.parse(i)}catch{return i}},Vu=async(t,e)=>{await t.removeItem(e)};function $6(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let i="",n,s,r,o,a,c,l,u=0;for(t=t.replace("-","+").replace("_","/");u<t.length;)o=e.indexOf(t.charAt(u++)),a=e.indexOf(t.charAt(u++)),c=e.indexOf(t.charAt(u++)),l=e.indexOf(t.charAt(u++)),n=o<<2|a>>4,s=(a&15)<<4|c>>2,r=(c&3)<<6|l,i=i+String.fromCharCode(n),c!=64&&s!=0&&(i=i+String.fromCharCode(s)),l!=64&&r!=0&&(i=i+String.fromCharCode(r));return i}class Al{constructor(){this.promise=new Al.promiseConstructor((e,i)=>{this.resolve=e,this.reject=i})}}Al.promiseConstructor=Promise;function K0(t){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,i=t.split(".");if(i.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(i[1]))throw new Error("JWT is not valid: payload is not in base64url format");const n=i[1];return JSON.parse($6(n))}async function H6(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function W6(t,e){return new Promise((n,s)=>{(async()=>{for(let r=0;r<1/0;r++)try{const o=await t(r);if(!e(r,null,o)){n(o);return}}catch(o){if(!e(r,o)){s(o);return}}})()})}function X6(t){return("0"+t.toString(16)).substr(-2)}function q6(){const e=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=i.length;let s="";for(let r=0;r<56;r++)s+=i.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,X6).join("")}async function Y6(t){const i=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",i),s=new Uint8Array(n);return Array.from(s).map(r=>String.fromCharCode(r)).join("")}function K6(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Z6(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const i=await Y6(t);return K6(i)}async function Ms(t,e,i=!1){const n=q6();let s=n;i&&(s+="/PASSWORD_RECOVERY"),await Jv(t,`${e}-code-verifier`,s);const r=await Z6(n);return[r,n===r?"plain":"s256"]}const G6=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function J6(t){const e=t.headers.get(Mf);if(!e||!e.match(G6))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class Cd extends Error{constructor(e,i,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=n}}function le(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class Q6 extends Cd{constructor(e,i,n){super(e,i,n),this.name="AuthApiError",this.status=i,this.code=n}}function eL(t){return le(t)&&t.name==="AuthApiError"}class Qv extends Cd{constructor(e,i){super(e),this.name="AuthUnknownError",this.originalError=i}}class gs extends Cd{constructor(e,i,n,s){super(e,n,s),this.name=i,this.status=n}}class Pn extends gs{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class ju extends gs{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ia extends gs{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Oa extends gs{constructor(e,i=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Z0 extends gs{constructor(e,i=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class If extends gs{constructor(e,i){super(e,"AuthRetryableFetchError",i,void 0)}}function $u(t){return le(t)&&t.name==="AuthRetryableFetchError"}class G0 extends gs{constructor(e,i,n){super(e,"AuthWeakPasswordError",i,"weak_password"),this.reasons=n}}var tL=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(i[n[s]]=t[n[s]]);return i};const On=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),iL=[502,503,504];async function J0(t){var e;if(!j6(t))throw new If(On(t),0);if(iL.includes(t.status))throw new If(On(t),t.status);let i;try{i=await t.json()}catch(r){throw new Qv(On(r),r)}let n;const s=J6(t);if(s&&s.getTime()>=Zv["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?n=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(n=i.error_code),n){if(n==="weak_password")throw new G0(On(i),t.status,((e=i.weak_password)===null||e===void 0?void 0:e.reasons)||[])}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((r,o)=>r&&typeof o=="string",!0))throw new G0(On(i),t.status,i.weak_password.reasons);throw new Q6(On(i),t.status||500,n)}const nL=(t,e,i,n)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),i))};async function de(t,e,i,n){var s;const r=Object.assign({},n==null?void 0:n.headers);r[Mf]||(r[Mf]=Zv["2024-01-01"].name),n!=null&&n.jwt&&(r.Authorization=`Bearer ${n.jwt}`);const o=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await sL(t,e,i+a,{headers:r,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(c):{data:Object.assign({},c),error:null}}async function sL(t,e,i,n,s,r){const o=nL(e,n,s,r);let a;try{a=await t(i,Object.assign({},o))}catch(c){throw console.error(c),new If(On(c),0)}if(a.ok||await J0(a),n!=null&&n.noResolveJson)return a;try{return await a.json()}catch(c){await J0(c)}}function en(t){var e;let i=null;cL(t)&&(i=Object.assign({},t),t.expires_at||(i.expires_at=z6(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:i,user:n},error:null}}function Q0(t){const e=en(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((i,n)=>i&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function rn(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function rL(t){return{data:t,error:null}}function oL(t){const{action_link:e,email_otp:i,hashed_token:n,redirect_to:s,verification_type:r}=t,o=tL(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:i,hashed_token:n,redirect_to:s,verification_type:r},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function aL(t){return t}function cL(t){return t.access_token&&t.refresh_token&&t.expires_in}var lL=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(i[n[s]]=t[n[s]]);return i};class uL{constructor({url:e="",headers:i={},fetch:n}){this.url=e,this.headers=i,this.fetch=Gv(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,i="global"){try{return await de(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(le(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,i={}){try{return await de(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:rn})}catch(n){if(le(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:i}=e,n=lL(e,["options"]),s=Object.assign(Object.assign({},n),i);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await de(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:oL,redirectTo:i==null?void 0:i.redirectTo})}catch(i){if(le(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(e){try{return await de(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:rn})}catch(i){if(le(i))return{data:{user:null},error:i};throw i}}async listUsers(e){var i,n,s,r,o,a,c;try{const l={nextPage:null,lastPage:0,total:0},u=await de(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(i=e==null?void 0:e.page)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:"",per_page:(r=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:""},xform:aL});if(u.error)throw u.error;const h=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,d=(c=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return d.length>0&&(d.forEach(p=>{const g=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(p.split(";")[1].split("=")[1]);l[`${_}Page`]=g}),l.total=parseInt(f)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if(le(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await de(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:rn})}catch(i){if(le(i))return{data:{user:null},error:i};throw i}}async updateUserById(e,i){try{return await de(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:i,headers:this.headers,xform:rn})}catch(n){if(le(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,i=!1){try{return await de(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:i},xform:rn})}catch(n){if(le(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){try{const{data:i,error:n}=await de(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:i,error:n}}catch(i){if(le(i))return{data:null,error:i};throw i}}async _deleteFactor(e){try{return{data:await de(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(i){if(le(i))return{data:null,error:i};throw i}}}const hL={getItem:t=>lo()?globalThis.localStorage.getItem(t):null,setItem:(t,e)=>{lo()&&globalThis.localStorage.setItem(t,e)},removeItem:t=>{lo()&&globalThis.localStorage.removeItem(t)}};function em(t={}){return{getItem:e=>t[e]||null,setItem:(e,i)=>{t[e]=i},removeItem:e=>{delete t[e]}}}function fL(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Is={debug:!!(globalThis&&lo()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class eb extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class dL extends eb{}async function pL(t,e,i){Is.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Is.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Is.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await i()}finally{Is.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw Is.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new dL(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Is.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}})}fL();const gL={url:L6,storageKey:B6,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:U6,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},zr=30*1e3,tm=3;async function im(t,e,i){return await i()}class Oo{constructor(e){var i,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Oo.nextInstanceID,Oo.nextInstanceID+=1,this.instanceID>0&&ii()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},gL),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new uL({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Gv(s.fetch),this.lock=s.lock||im,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:ii()&&(!((i=globalThis==null?void 0:globalThis.navigator)===null||i===void 0)&&i.locks)?this.lock=pL:this.lock=im,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:lo()?this.storage=hL:(this.memoryStorage={},this.storage=em(this.memoryStorage)):(this.memoryStorage={},this.storage=em(this.memoryStorage)),ii()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",r)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async r=>{this._debug("received broadcast notification from other tab or client",r),await this._notifyAllSubscribers(r.data.event,r.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Kv}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=ii()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:i,error:n}=await this._getSessionFromURL(e);if(n)return this._debug("#_initialize()","error detecting session from URL",n),(n==null?void 0:n.message)==="Identity is already linked"||(n==null?void 0:n.message)==="Identity is already linked to another user"?{error:n}:(await this._removeSession(),{error:n});const{session:s,redirectType:r}=i;return this._debug("#_initialize()","detected session in URL",s,"redirect type",r),await this._saveSession(s),setTimeout(async()=>{r==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return le(e)?{error:e}:{error:new Qv("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var i,n,s;try{await this._removeSession();const r=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:en}),{data:o,error:a}=r;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(r){if(le(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(e){var i,n,s;try{await this._removeSession();let r;if("email"in e){const{email:u,password:h,options:f}=e;let d=null,p=null;this.flowType==="pkce"&&([d,p]=await Ms(this.storage,this.storageKey)),r=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:h,data:(i=f==null?void 0:f.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:d,code_challenge_method:p},xform:en})}else if("phone"in e){const{phone:u,password:h,options:f}=e;r=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(n=f==null?void 0:f.data)!==null&&n!==void 0?n:{},channel:(s=f==null?void 0:f.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:en})}else throw new Ia("You must provide either an email or phone number and a password");const{data:o,error:a}=r;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(r){if(le(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(e){try{await this._removeSession();let i;if("email"in e){const{email:r,password:o,options:a}=e;i=await de(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Q0})}else if("phone"in e){const{phone:r,password:o,options:a}=e;i=await de(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Q0})}else throw new Ia("You must provide either an email or phone number and a password");const{data:n,error:s}=i;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new ju}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(i){if(le(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOAuth(e){var i,n,s,r;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(r=e.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const i=await Ma(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(i??"").split("/"),{data:r,error:o}=await de(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:en});return await Vu(this.storage,`${this.storageKey}-code-verifier`),o?{data:{user:null,session:null,redirectType:null},error:o}:!r||!r.session||!r.user?{data:{user:null,session:null,redirectType:null},error:new ju}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign(Object.assign({},r),{redirectType:s??null}),error:o})}async signInWithIdToken(e){await this._removeSession();try{const{options:i,provider:n,token:s,access_token:r,nonce:o}=e,a=await de(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:r,nonce:o,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:en}),{data:c,error:l}=a;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new ju}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(i){if(le(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOtp(e){var i,n,s,r,o;try{if(await this._removeSession(),"email"in e){const{email:a,options:c}=e;let l=null,u=null;this.flowType==="pkce"&&([l,u]=await Ms(this.storage,this.storageKey));const{error:h}=await de(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(i=c==null?void 0:c.data)!==null&&i!==void 0?i:{},create_user:(n=c==null?void 0:c.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:c}=e,{data:l,error:u}=await de(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:u}}throw new Ia("You must provide either an email or phone number.")}catch(a){if(le(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var i,n;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let s,r;"options"in e&&(s=(i=e.options)===null||i===void 0?void 0:i.redirectTo,r=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:a}=await de(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:s,xform:en});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,l=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(s){if(le(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var i,n,s;try{await this._removeSession();let r=null,o=null;return this.flowType==="pkce"&&([r,o]=await Ms(this.storage,this.storageKey)),await de(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(i=e.options)===null||i===void 0?void 0:i.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:o}),headers:this.headers,xform:rL})}catch(r){if(le(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:i},error:n}=e;if(n)throw n;if(!i)throw new Pn;const{error:s}=await de(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(le(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const i=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:r}=e,{error:o}=await de(this.fetch,"POST",i,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},redirectTo:r==null?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:n,type:s,options:r}=e,{data:o,error:a}=await de(this.fetch,"POST",i,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new Ia("You must provide either an email or phone number and a type")}catch(i){if(le(i))return{data:{user:null,session:null},error:i};throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async i=>i))}async _acquireLock(e,i){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await i()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=i();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await e(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const i=await Ma(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?e=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.storage.isServer){const o=this.suppressGetSessionWarning;e=new Proxy(e,{get(c,l,u){return!o&&l==="user"&&console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),Reflect.get(c,l,u)}})}return{data:{session:e},error:null}}const{session:s,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await de(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:rn}):await this._useSession(async i=>{var n,s,r;const{data:o,error:a}=i;if(a)throw a;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Pn}:await de(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0,xform:rn})})}catch(i){if(le(i))return{data:{user:null},error:i};throw i}}async updateUser(e,i={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,i))}async _updateUser(e,i={}){try{return await this._useSession(async n=>{const{data:s,error:r}=n;if(r)throw r;if(!s.session)throw new Pn;const o=s.session;let a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=await Ms(this.storage,this.storageKey));const{data:l,error:u}=await de(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i==null?void 0:i.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:o.access_token,xform:rn});if(u)throw u;return o.user=l.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(n){if(le(n))return{data:{user:null},error:n};throw n}}_decodeJWT(e){return K0(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Pn;const i=Date.now()/1e3;let n=i,s=!0,r=null;const o=K0(e.access_token);if(o.exp&&(n=o.exp,s=n<=i),s){const{session:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};r=a}else{const{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;r={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-i,expires_at:n},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(i){if(le(i))return{data:{session:null,user:null},error:i};throw i}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async i=>{var n;if(!e){const{data:o,error:a}=i;if(a)throw a;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Pn;const{session:s,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(i){if(le(i))return{data:{user:null,session:null},error:i};throw i}}async _getSessionFromURL(e){try{if(!ii())throw new Oa("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Oa("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new Z0("Not a valid PKCE flow url.");const i=zu(window.location.href);if(e){if(!i.code)throw new Z0("No code detected.");const{data:T,error:v}=await this._exchangeCodeForSession(i.code);if(v)throw v;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:T.session,redirectType:null},error:null}}if(i.error||i.error_description||i.error_code)throw new Oa(i.error_description||"Error in URL with unspecified error_description",{error:i.error||"unspecified_error",code:i.error_code||"unspecified_code"});const{provider_token:n,provider_refresh_token:s,access_token:r,refresh_token:o,expires_in:a,expires_at:c,token_type:l}=i;if(!r||!a||!o||!l)throw new Oa("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(a);let f=u+h;c&&(f=parseInt(c));const d=f-u;d*1e3<=zr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${h}s`);const p=f-h;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,f,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",p,f,u);const{data:g,error:_}=await this._getUser(r);if(_)throw _;const b={provider_token:n,provider_refresh_token:s,access_token:r,expires_in:h,expires_at:f,refresh_token:o,token_type:l,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:i.type},error:null}}catch(i){if(le(i))return{data:{session:null,redirectType:null},error:i};throw i}}_isImplicitGrantFlow(){const e=zu(window.location.href);return!!(ii()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=zu(window.location.href),i=await Ma(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&i)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async i=>{var n;const{data:s,error:r}=i;if(r)return{error:r};const o=(n=s.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(eL(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Vu(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const i=V6(),n={id:i,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async i=>{var n,s;try{const{data:{session:r},error:o}=i;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(r){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r),console.error(r)}})}async resetPasswordForEmail(e,i={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Ms(this.storage,this.storageKey,!0));try{return await de(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(r){if(le(r))return{data:null,error:r};throw r}}async getUserIdentities(){var e;try{const{data:i,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=i.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(i){if(le(i))return{data:null,error:i};throw i}}async linkIdentity(e){var i;try{const{data:n,error:s}=await this._useSession(async r=>{var o,a,c,l,u;const{data:h,error:f}=r;if(f)throw f;const d=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await de(this.fetch,"GET",d,{headers:this.headers,jwt:(u=(l=h.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return ii()&&!(!((i=e.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(le(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async i=>{var n,s;const{data:r,error:o}=i;if(o)throw o;return await de(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(i){if(le(i))return{data:null,error:i};throw i}}async _refreshAccessToken(e){const i=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{const n=Date.now();return await W6(async s=>(s>0&&await H6(200*Math.pow(2,s-1)),this._debug(i,"refreshing attempt",s),await de(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:en})),(s,r)=>{const o=200*Math.pow(2,s);return r&&$u(r)&&Date.now()+o-n<zr})}catch(n){if(this._debug(i,"error",n),le(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(i,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,i){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",i,"url",n),ii()&&!i.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const n=await Ma(this.storage,this.storageKey);if(this._debug(i,"session from storage",n),!this._isValidSession(n)){this._debug(i,"session is not valid"),n!==null&&await this._removeSession();return}const s=Math.round(Date.now()/1e3),r=((e=n.expires_at)!==null&&e!==void 0?e:1/0)<s+Y0;if(this._debug(i,`session has${r?"":" not"} expired with margin of ${Y0}s`),r){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),$u(o)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(i,"error",n),console.error(n);return}finally{this._debug(i,"end")}}async _callRefreshToken(e){var i,n;if(!e)throw new Pn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Al;const{data:r,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!r.session)throw new Pn;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const a={session:r.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(r){if(this._debug(s,"error",r),le(r)){const o={session:null,error:r};return $u(r)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(r),r}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,i,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",i,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:i});const r=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,i)}catch(c){r.push(c)}});if(await Promise.all(o),r.length>0){for(let a=0;a<r.length;a+=1)console.error(r[a]);throw r[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Jv(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Vu(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ii()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),zr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async i=>{const{data:{session:n}}=i;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/zr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${zr}ms, refresh threshold is ${tm} ticks`),s<=tm&&await this._callRefreshToken(n.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof eb)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ii()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const i=`#_onVisibilityChanged(${e})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,i,n){const s=[`provider=${encodeURIComponent(i)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[r,o]=await Ms(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(n!=null&&n.queryParams){const r=new URLSearchParams(n.queryParams);s.push(r.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async i=>{var n;const{data:s,error:r}=i;return r?{data:null,error:r}:await de(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(i){if(le(i))return{data:null,error:i};throw i}}async _enroll(e){try{return await this._useSession(async i=>{var n,s;const{data:r,error:o}=i;if(o)return{data:null,error:o};const{data:a,error:c}=await de(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(!((s=a==null?void 0:a.totp)===null||s===void 0)&&s.qr_code&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(i){if(le(i))return{data:null,error:i};throw i}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var n;const{data:s,error:r}=i;if(r)return{data:null,error:r};const{data:o,error:a}=await de(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(i){if(le(i))return{data:null,error:i};throw i}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var n;const{data:s,error:r}=i;return r?{data:null,error:r}:await de(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(i){if(le(i))return{data:null,error:i};throw i}})}async _challengeAndVerify(e){const{data:i,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:i.id,code:e.code})}async _listFactors(){const{data:{user:e},error:i}=await this.getUser();if(i)return{data:null,error:i};const n=(e==null?void 0:e.factors)||[],s=n.filter(r=>r.factor_type==="totp"&&r.status==="verified");return{data:{all:n,totp:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var i,n;const{data:{session:s},error:r}=e;if(r)return{data:null,error:r};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const o=this._decodeJWT(s.access_token);let a=null;o.aal&&(a=o.aal);let c=a;((n=(i=s.user.factors)===null||i===void 0?void 0:i.filter(h=>h.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}}Oo.nextInstanceID=0;const _L=Oo;class mL extends _L{constructor(e){super(e)}}var yL=function(t,e,i,n){function s(r){return r instanceof i?r:new i(function(o){o(r)})}return new(i||(i=Promise))(function(r,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};class vL{constructor(e,i,n){var s,r,o;if(this.supabaseUrl=e,this.supabaseKey=i,!e)throw new Error("supabaseUrl is required.");if(!i)throw new Error("supabaseKey is required.");const a=D6(e);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:x6,realtime:M6,auth:Object.assign(Object.assign({},P6),{storageKey:c}),global:C6},u=F6(n??{},l);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(r=u.global.headers)!==null&&r!==void 0?r:{},this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=k6(i,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},u.realtime)),this.rest=new Sd(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new VF(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new S6(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,i={},n={}){return this.rest.rpc(e,i,n)}channel(e,i={config:{}}){return this.realtime.channel(e,i)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,i;return yL(this,void 0,void 0,function*(){const{data:n}=yield this.auth.getSession();return(i=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&i!==void 0?i:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:i,detectSessionInUrl:n,storage:s,storageKey:r,flowType:o,debug:a},c,l){var u;const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new mL({url:this.authUrl,headers:Object.assign(Object.assign({},h),c),storageKey:r,autoRefreshToken:e,persistSession:i,detectSessionInUrl:n,storage:s,flowType:o,debug:a,fetch:l,hasCustomAuthorizationHeader:(u="Authorization"in this.headers)!==null&&u!==void 0?u:!1})}_initRealtimeClient(e){return new h6(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((i,n)=>{this._handleTokenChanged(i,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,i,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?(this.realtime.setAuth(n??null),this.changedAccessToken=n):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),i=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const bL=(t,e,i)=>new vL(t,e,i),tb="https://dbmtysppmiwwjwaeneex.supabase.co",ib="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRibXR5c3BwbWl3d2p3YWVuZWV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2NDQ5NTI0NDUsImV4cCI6MTk2MDUyODQ0NX0.i_1JrAfv5fieeVaiJrVIQPL6V0_-H9sR-PKIuGDAIfI";console.log(tb,ib);const Rl=bL(tb,ib),wL=async t=>{let{data:e,error:i}=await Rl.from("courts_comments").select().eq("court_id",t);if(i){console.error(i);return}return e},TL=async(t,e)=>{const i=await Rl.from("courts_comments").insert([{court_id:t,comment:e}],{returning:"minimal"}).select();if(i.error)throw console.log(i.error),new Error("insert failed");return!0},EL=async()=>{try{const{data:t,error:e}=await Rl.rpc("courts_calc");if(e)throw e;return t}catch(t){console.error("Error fetching map counts:",t)}},SL=async t=>{const e=await Rl.from("courts_faves").insert([{court_id:t}],{returning:"minimal"}).select();if(e.error)throw console.log(e.error),new Error("insert failed");return!0};function nm(t,e,i){const n=t.slice();n[1]=e[i];const s=new Date(n[1].created_at);return n[9]=s,n}function sm(t){let e,i=t[0].length+"",n,s,r,o=t[0].length>1?"s":"",a;return{c(){e=K("p"),n=Ot(i),s=Ot(" comment"),r=K("span"),a=Ot(o),this.h()},l(c){e=Z(c,"P",{class:!0});var l=oe(e);n=Nt(l,i),s=Nt(l," comment"),r=Z(l,"SPAN",{});var u=oe(r);a=Nt(u,o),u.forEach(j),l.forEach(j),this.h()},h(){L(e,"class","comment-count svelte-13hikzc")},m(c,l){re(c,e,l),H(e,n),H(e,s),H(e,r),H(r,a)},p(c,l){l&1&&i!==(i=c[0].length+"")&&Zn(n,i),l&1&&o!==(o=c[0].length>1?"s":"")&&Zn(a,o)},d(c){c&&j(e)}}}function rm(t){let e,i,n=t[9].toLocaleDateString("en-US",t[4])+"",s,r=t[1].comment+"",o;return{c(){e=K("p"),i=K("span"),s=Ot(n),o=Ot(r),this.h()},l(a){e=Z(a,"P",{class:!0});var c=oe(e);i=Z(c,"SPAN",{class:!0});var l=oe(i);s=Nt(l,n),l.forEach(j),o=Nt(c,r),c.forEach(j),this.h()},h(){L(i,"class","svelte-13hikzc"),L(e,"class","comment svelte-13hikzc")},m(a,c){re(a,e,c),H(e,i),H(i,s),H(e,o)},p(a,c){c&1&&n!==(n=a[9].toLocaleDateString("en-US",a[4])+"")&&Zn(s,n),c&1&&r!==(r=a[1].comment+"")&&Zn(o,r)},d(a){a&&j(e)}}}function AL(t){let e,i,n,s,r="Close",o,a,c,l,u="Share your comments:",h,f,d,p,g,_,b,T,v,E,R,P=t[0].length>0&&sm(t),M=sr(t[0]),U=[];for(let O=0;O<M.length;O+=1)U[O]=rm(nm(t,M,O));return{c(){e=K("div"),i=K("div"),n=K("div"),s=K("button"),s.textContent=r,o=ue(),P&&P.c(),a=ue();for(let O=0;O<U.length;O+=1)U[O].c();c=ue(),l=K("p"),l.textContent=u,h=ue(),f=K("form"),d=K("textarea"),p=ue(),g=K("button"),_=Ot("Submit Comment"),this.h()},l(O){e=Z(O,"DIV",{class:!0});var D=oe(e);i=Z(D,"DIV",{class:!0});var I=oe(i);n=Z(I,"DIV",{class:!0});var V=oe(n);s=Z(V,"BUTTON",{class:!0,"data-svelte-h":!0}),We(s)!=="svelte-bxc8wg"&&(s.textContent=r),o=he(V),P&&P.l(V),a=he(V);for(let F=0;F<U.length;F+=1)U[F].l(V);c=he(V),l=Z(V,"P",{class:!0,"data-svelte-h":!0}),We(l)!=="svelte-161vlou"&&(l.textContent=u),h=he(V),f=Z(V,"FORM",{});var k=oe(f);d=Z(k,"TEXTAREA",{rows:!0,placeholder:!0,class:!0}),oe(d).forEach(j),p=he(k),g=Z(k,"BUTTON",{type:!0});var B=oe(g);_=Nt(B,"Submit Comment"),B.forEach(j),k.forEach(j),V.forEach(j),I.forEach(j),D.forEach(j),this.h()},h(){L(s,"class","close svelte-13hikzc"),L(l,"class","instructions svelte-13hikzc"),L(d,"rows","4"),L(d,"placeholder","Write your comment..."),L(d,"class","svelte-13hikzc"),L(g,"type","submit"),g.disabled=b=t[1].trim()==="",L(n,"class","comment-wrapper svelte-13hikzc"),L(i,"class","modal svelte-13hikzc"),L(e,"class","blackout svelte-13hikzc")},m(O,D){re(O,e,D),H(e,i),H(i,n),H(n,s),H(n,o),P&&P.m(n,null),H(n,a);for(let I=0;I<U.length;I+=1)U[I]&&U[I].m(n,null);H(n,c),H(n,l),H(n,h),H(n,f),H(f,d),jd(d,t[1]),H(f,p),H(f,g),H(g,_),v=!0,E||(R=[hi(s,"click",t[2]),hi(d,"input",t[6]),hi(f,"submit",Xb(t[3]))],E=!0)},p(O,[D]){if(O[0].length>0?P?P.p(O,D):(P=sm(O),P.c(),P.m(n,a)):P&&(P.d(1),P=null),D&17){M=sr(O[0]);let I;for(I=0;I<M.length;I+=1){const V=nm(O,M,I);U[I]?U[I].p(V,D):(U[I]=rm(V),U[I].c(),U[I].m(n,c))}for(;I<U.length;I+=1)U[I].d(1);U.length=M.length}D&2&&jd(d,O[1]),(!v||D&2&&b!==(b=O[1].trim()===""))&&(g.disabled=b)},i(O){v||(O&&ls(()=>{v&&(T||(T=dn(i,Pi,{y:-100,duration:300},!0)),T.run(1))}),v=!0)},o(O){O&&(T||(T=dn(i,Pi,{y:-100,duration:300},!1)),T.run(0)),v=!1},d(O){O&&j(e),P&&P.d(),Of(U,O),O&&T&&T.end(),E=!1,Dm(R)}}}function RL(t,e,i){let n;un(t,ao,f=>i(7,n=f));const s=km();let{commentId:r}=e,o="",a=[];new Promise(async(f,d)=>{i(0,a=await wL(r))});function c(){Ln(ao,n=!1,n)}function l(){o.trim()!==""&&(i(1,o=o.trim()),TL(r,o),Ln(ao,n=!1,n),s("formSubmit",r))}const u={year:"numeric",month:"long",day:"numeric"};function h(){o=this.value,i(1,o)}return t.$$set=f=>{"commentId"in f&&i(5,r=f.commentId)},[a,o,c,l,u,r,h]}class CL extends vn{constructor(e){super(),bn(this,e,RL,AL,Hi,{commentId:5})}}var Rr=PL,xL=Object.prototype.hasOwnProperty;function PL(){for(var t={},e=0;e<arguments.length;e++){var i=arguments[e];for(var n in i)xL.call(i,n)&&(t[n]=i[n])}return t}var nb={exports:{}};(function(t,e){(function(){var i={};t.exports=i,i.simpleFilter=function(n,s){return s.filter(function(r){return i.test(n,r)})},i.test=function(n,s){return i.match(n,s)!==null},i.match=function(n,s,r){r=r||{};var o=0,a=[],c=s.length,l=0,u=0,h=r.pre||"",f=r.post||"",d=r.caseSensitive&&s||s.toLowerCase(),p;n=r.caseSensitive&&n||n.toLowerCase();for(var g=0;g<c;g++)p=s[g],d[g]===n[o]?(p=h+p+f,o+=1,u+=1+u):u=0,l+=u,a[a.length]=p;return o===n.length?(l=d===n?1/0:l,{rendered:a.join(""),score:l}):null},i.filter=function(n,s,r){return!s||s.length===0?[]:typeof n!="string"?s:(r=r||{},s.reduce(function(o,a,c,l){var u=a;r.extract&&(u=r.extract(a));var h=i.match(n,u,r);return h!=null&&(o[o.length]={string:h.rendered,score:h.score,index:c,original:a}),o},[]).sort(function(o,a){var c=a.score-o.score;return c||o.index-a.index}))}})()})(nb);var ML=nb.exports,Dt=function(t){return this.component=t,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};Dt.prototype.show=function(){this.element.style.display="block"};Dt.prototype.hide=function(){this.element.style.display="none"};Dt.prototype.add=function(t){this.items.push(t)};Dt.prototype.clear=function(){this.items=[],this.active=0};Dt.prototype.isEmpty=function(){return!this.items.length};Dt.prototype.isVisible=function(){return this.element.style.display==="block"};Dt.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()};Dt.prototype.drawItem=function(t,e){var i=document.createElement("li"),n=document.createElement("a");e&&(i.className+=" active"),n.innerHTML=t.string,i.appendChild(n),this.element.appendChild(i),i.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),i.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,t)}).bind(this))};Dt.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()};Dt.prototype.move=function(t){this.active=t,this.draw()};Dt.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Dt.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Dt.prototype.drawError=function(t){var e=document.createElement("li");e.innerHTML=t,this.element.appendChild(e),this.show()};var IL=Dt,OL=Rr,NL=ML,kL=IL,At=function(t,e,i){return i=i||{},this.options=OL({minLength:2,limit:5,filter:!0,hideOnBlur:!0},i),this.el=t,this.data=e||[],this.list=new kL(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(n){this.handleKeyUp(n.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(n){this.handleKeyDown(n)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(n){this.handlePaste(n)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};At.prototype.handleKeyUp=function(t){t===40||t===38||t===27||t===13||t===9||this.handleInputChange(this.el.value)};At.prototype.handleKeyDown=function(t){switch(t.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&t.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};At.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};At.prototype.handlePaste=function(t){if(t.clipboardData)this.handleInputChange(t.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(t.target.value)},100)}};At.prototype.handleInputChange=function(t){if(this.query=this.normalize(t),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(e){for(var i=0;i<e.length&&(this.list.add(e[i]),i!==this.options.limit-1);i++);this.list.draw()}).bind(this))};At.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};At.prototype.update=function(t){this.data=t,this.handleKeyUp()};At.prototype.clear=function(){this.data=[],this.list.clear()};At.prototype.normalize=function(t){return t=t.toLowerCase(),t};At.prototype.match=function(t,e){return t.indexOf(e)>-1};At.prototype.value=function(t){if(this.selected=t,this.el.value=this.getItemValue(t),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")};At.prototype.getCandidates=function(t){var e={pre:"<strong>",post:"</strong>",extract:(function(n){return this.getItemValue(n)}).bind(this)},i;this.options.filter?(i=NL.filter(this.query,this.data,e),i=i.map((function(n){return{original:n.original,string:this.render(n.original,n.string)}}).bind(this))):i=this.data.map((function(n){var s=this.render(n);return{original:n,string:s}}).bind(this)),t(i)};At.prototype.getItemValue=function(t){return t};At.prototype.render=function(t,e){if(e)return e;for(var i=t.original?this.getItemValue(t.original):this.getItemValue(t),n=this.normalize(i),s=n.lastIndexOf(this.query);s>-1;){var r=s+this.query.length;i=i.slice(0,s)+"<strong>"+i.slice(s,r)+"</strong>"+i.slice(r),s=n.slice(0,s).lastIndexOf(this.query)}return i};At.prototype.renderError=function(t){this.list.drawError(t)};var DL=At,sb=DL,FL=sb;typeof window<"u"&&(window.Suggestions=sb);var xd={exports:{}},tr=typeof Reflect=="object"?Reflect:null,om=tr&&typeof tr.apply=="function"?tr.apply:function(e,i,n){return Function.prototype.apply.call(e,i,n)},Wa;tr&&typeof tr.ownKeys=="function"?Wa=tr.ownKeys:Object.getOwnPropertySymbols?Wa=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Wa=function(e){return Object.getOwnPropertyNames(e)};function LL(t){console&&console.warn&&console.warn(t)}var rb=Number.isNaN||function(e){return e!==e};function Ne(){Ne.init.call(this)}xd.exports=Ne;xd.exports.once=VL;Ne.EventEmitter=Ne;Ne.prototype._events=void 0;Ne.prototype._eventsCount=0;Ne.prototype._maxListeners=void 0;var am=10;function Cl(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Ne,"defaultMaxListeners",{enumerable:!0,get:function(){return am},set:function(t){if(typeof t!="number"||t<0||rb(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");am=t}});Ne.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ne.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||rb(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ob(t){return t._maxListeners===void 0?Ne.defaultMaxListeners:t._maxListeners}Ne.prototype.getMaxListeners=function(){return ob(this)};Ne.prototype.emit=function(e){for(var i=[],n=1;n<arguments.length;n++)i.push(arguments[n]);var s=e==="error",r=this._events;if(r!==void 0)s=s&&r.error===void 0;else if(!s)return!1;if(s){var o;if(i.length>0&&(o=i[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=r[e];if(c===void 0)return!1;if(typeof c=="function")om(c,this,i);else for(var l=c.length,u=hb(c,l),n=0;n<l;++n)om(u[n],this,i);return!0};function ab(t,e,i,n){var s,r,o;if(Cl(i),r=t._events,r===void 0?(r=t._events=Object.create(null),t._eventsCount=0):(r.newListener!==void 0&&(t.emit("newListener",e,i.listener?i.listener:i),r=t._events),o=r[e]),o===void 0)o=r[e]=i,++t._eventsCount;else if(typeof o=="function"?o=r[e]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),s=ob(t),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,LL(a)}return t}Ne.prototype.addListener=function(e,i){return ab(this,e,i,!1)};Ne.prototype.on=Ne.prototype.addListener;Ne.prototype.prependListener=function(e,i){return ab(this,e,i,!0)};function BL(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function cb(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},s=BL.bind(n);return s.listener=i,n.wrapFn=s,s}Ne.prototype.once=function(e,i){return Cl(i),this.on(e,cb(this,e,i)),this};Ne.prototype.prependOnceListener=function(e,i){return Cl(i),this.prependListener(e,cb(this,e,i)),this};Ne.prototype.removeListener=function(e,i){var n,s,r,o,a;if(Cl(i),s=this._events,s===void 0)return this;if(n=s[e],n===void 0)return this;if(n===i||n.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||i));else if(typeof n!="function"){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===i||n[o].listener===i){a=n[o].listener,r=o;break}if(r<0)return this;r===0?n.shift():UL(n,r),n.length===1&&(s[e]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",e,a||i)}return this};Ne.prototype.off=Ne.prototype.removeListener;Ne.prototype.removeAllListeners=function(e){var i,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var r=Object.keys(n),o;for(s=0;s<r.length;++s)o=r[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=n[e],typeof i=="function")this.removeListener(e,i);else if(i!==void 0)for(s=i.length-1;s>=0;s--)this.removeListener(e,i[s]);return this};function lb(t,e,i){var n=t._events;if(n===void 0)return[];var s=n[e];return s===void 0?[]:typeof s=="function"?i?[s.listener||s]:[s]:i?zL(s):hb(s,s.length)}Ne.prototype.listeners=function(e){return lb(this,e,!0)};Ne.prototype.rawListeners=function(e){return lb(this,e,!1)};Ne.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):ub.call(t,e)};Ne.prototype.listenerCount=ub;function ub(t){var e=this._events;if(e!==void 0){var i=e[t];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}Ne.prototype.eventNames=function(){return this._eventsCount>0?Wa(this._events):[]};function hb(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}function UL(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function zL(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}function VL(t,e){return new Promise(function(i,n){function s(o){t.removeListener(e,r),n(o)}function r(){typeof t.removeListener=="function"&&t.removeListener("error",s),i([].slice.call(arguments))}fb(t,e,r,{once:!0}),e!=="error"&&jL(t,s,{once:!0})})}function jL(t,e,i){typeof t.on=="function"&&fb(t,"error",e,i)}function fb(t,e,i,n){if(typeof t.on=="function")n.once?t.once(e,i):t.on(e,i);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(r){n.once&&t.removeEventListener(e,s),i(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var $L=xd.exports,HL={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function WL(t){var e=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return e?{key:e[1],value:e[2]}:null}function XL(t){var e=t.match(/<?([^>]*)>(.*)/);if(!e)return null;var i=e[1],n=e[2].split(";"),s=null,r=n.reduce(function(o,a){var c=WL(a);return c?c.key==="rel"?(s||(s=c.value),o):(o[c.key]=c.value,o):o},{});return s?{url:i,rel:s,params:r}:null}function qL(t){return t?t.split(/,\s*</).reduce(function(e,i){var n=XL(i);if(!n)return e;var s=n.rel.split(/\s+/);return s.forEach(function(r){e[r]||(e[r]={url:n.url,params:n.params})}),e},{}):{}}var YL=qL,KL=YL;function Pd(t,e){this.request=t,this.headers=e.headers,this.rawBody=e.body,this.statusCode=e.statusCode;try{this.body=JSON.parse(e.body||"{}")}catch{this.body=e.body}this.links=KL(this.headers.link)}Pd.prototype.hasNextPage=function(){return!!this.links.next};Pd.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var ZL=Pd,xl={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},cm=xl;function GL(t){var e=t.type||cm.ERROR_HTTP,i;if(t.body)try{i=JSON.parse(t.body)}catch{i=t.body}else i=null;var n=t.message||null;n||(typeof i=="string"?n=i:i&&typeof i.message=="string"?n=i.message:e===cm.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=e,this.statusCode=t.statusCode||null,this.request=t.request,this.body=i}var JL=GL;function QL(t){var e=t.indexOf(":"),i=t.substring(0,e).trim().toLowerCase(),n=t.substring(e+1).trim();return{name:i,value:n}}function eB(t){var e={};return t&&t.trim().split(/[\r|\n]+/).forEach(function(i){var n=QL(i);e[n.name]=n.value}),e}var tB=eB,iB=ZL,lm=JL,Hu=xl,nB=tB,Mc={};function sB(t){var e=Mc[t.id];e&&(e.abort(),delete Mc[t.id])}function rB(t,e){return new iB(t,{body:e.response,headers:nB(e.getAllResponseHeaders()),statusCode:e.status})}function um(t){var e=t.total,i=t.loaded,n=100*i/e;return{total:e,transferred:i,percent:n}}function db(t,e){return new Promise(function(i,n){e.onprogress=function(o){t.emitter.emit(Hu.EVENT_PROGRESS_DOWNLOAD,um(o))};var s=t.file;s&&(e.upload.onprogress=function(o){t.emitter.emit(Hu.EVENT_PROGRESS_UPLOAD,um(o))}),e.onerror=function(o){n(o)},e.onabort=function(){var o=new lm({request:t,type:Hu.ERROR_REQUEST_ABORTED});n(o)},e.onload=function(){if(delete Mc[t.id],e.status<200||e.status>=400){var o=new lm({request:t,body:e.response,statusCode:e.status});n(o);return}i(e)};var r=t.body;typeof r=="string"?e.send(r):r?e.send(JSON.stringify(r)):s?e.send(s):e.send(),Mc[t.id]=e}).then(function(i){return rB(t,i)})}function pb(t,e){var i=t.url(e),n=new window.XMLHttpRequest;return n.open(t.method,i),Object.keys(t.headers).forEach(function(s){n.setRequestHeader(s,t.headers[s])}),n}function oB(t){return Promise.resolve().then(function(){var e=pb(t,t.client.accessToken);return db(t,e)})}var aB={browserAbort:sB,sendRequestXhr:db,browserSend:oB,createRequestXhr:pb},Ic={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */Ic.exports;(function(t,e){(function(i){var n=e,s=t&&t.exports==n&&t,r=typeof Ys=="object"&&Ys;(r.global===r||r.window===r)&&(i=r);var o=function(p){this.message=p};o.prototype=new Error,o.prototype.name="InvalidCharacterError";var a=function(p){throw new o(p)},c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=/[\t\n\f\r ]/g,u=function(p){p=String(p).replace(l,"");var g=p.length;g%4==0&&(p=p.replace(/==?$/,""),g=p.length),(g%4==1||/[^+a-zA-Z0-9/]/.test(p))&&a("Invalid character: the string to be decoded is not correctly encoded.");for(var _=0,b,T,v="",E=-1;++E<g;)T=c.indexOf(p.charAt(E)),b=_%4?b*64+T:T,_++%4&&(v+=String.fromCharCode(255&b>>(-2*_&6)));return v},h=function(p){p=String(p),/[^\0-\xFF]/.test(p)&&a("The string to be encoded contains characters outside of the Latin1 range.");for(var g=p.length%3,_="",b=-1,T,v,E,R,P=p.length-g;++b<P;)T=p.charCodeAt(b)<<16,v=p.charCodeAt(++b)<<8,E=p.charCodeAt(++b),R=T+v+E,_+=c.charAt(R>>18&63)+c.charAt(R>>12&63)+c.charAt(R>>6&63)+c.charAt(R&63);return g==2?(T=p.charCodeAt(b)<<8,v=p.charCodeAt(++b),R=T+v,_+=c.charAt(R>>10)+c.charAt(R>>4&63)+c.charAt(R<<2&63)+"="):g==1&&(R=p.charCodeAt(b),_+=c.charAt(R>>2)+c.charAt(R<<4&63)+"=="),_},f={encode:h,decode:u,version:"0.1.0"};if(n&&!n.nodeType)if(s)s.exports=f;else for(var d in f)f.hasOwnProperty(d)&&(n[d]=f[d]);else i.base64=f})(Ys)})(Ic,Ic.exports);var cB=Ic.exports,lB=cB,Wu={};function uB(t){if(Wu[t])return Wu[t];var e=t.split("."),i=e[0],n=e[1];if(!n)throw new Error("Invalid token");var s=hB(n),r={usage:i,user:s.u};return Mn(s,"a")&&(r.authorization=s.a),Mn(s,"exp")&&(r.expires=s.exp*1e3),Mn(s,"iat")&&(r.created=s.iat*1e3),Mn(s,"scopes")&&(r.scopes=s.scopes),Mn(s,"client")&&(r.client=s.client),Mn(s,"ll")&&(r.lastLogin=s.ll),Mn(s,"iu")&&(r.impersonator=s.iu),Wu[t]=r,r}function hB(t){try{return JSON.parse(lB.decode(t))}catch{throw new Error("Invalid token")}}function Mn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var gb=uB,_b={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(i=!1));function s(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function r(c,l,u,h,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new s(u,h||c,f),p=i?i+l:l;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],d]:c._events[p].push(d):(c._events[p]=d,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new n:delete c._events[l]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,h;if(this._eventsCount===0)return l;for(h in u=this._events)e.call(u,h)&&l.push(i?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=i?i+l:l,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,d=h.length,p=new Array(d);f<d;f++)p[f]=h[f].fn;return p},a.prototype.listenerCount=function(l){var u=i?i+l:l,h=this._events[u];return h?h.fn?1:h.length:0},a.prototype.emit=function(l,u,h,f,d,p){var g=i?i+l:l;if(!this._events[g])return!1;var _=this._events[g],b=arguments.length,T,v;if(_.fn){switch(_.once&&this.removeListener(l,_.fn,void 0,!0),b){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,u),!0;case 3:return _.fn.call(_.context,u,h),!0;case 4:return _.fn.call(_.context,u,h,f),!0;case 5:return _.fn.call(_.context,u,h,f,d),!0;case 6:return _.fn.call(_.context,u,h,f,d,p),!0}for(v=1,T=new Array(b-1);v<b;v++)T[v-1]=arguments[v];_.fn.apply(_.context,T)}else{var E=_.length,R;for(v=0;v<E;v++)switch(_[v].once&&this.removeListener(l,_[v].fn,void 0,!0),b){case 1:_[v].fn.call(_[v].context);break;case 2:_[v].fn.call(_[v].context,u);break;case 3:_[v].fn.call(_[v].context,u,h);break;case 4:_[v].fn.call(_[v].context,u,h,f);break;default:if(!T)for(R=1,T=new Array(b-1);R<b;R++)T[R-1]=arguments[R];_[v].fn.apply(_[v].context,T)}}return!0},a.prototype.on=function(l,u,h){return r(this,l,u,h,!1)},a.prototype.once=function(l,u,h){return r(this,l,u,h,!0)},a.prototype.removeListener=function(l,u,h,f){var d=i?i+l:l;if(!this._events[d])return this;if(!u)return o(this,d),this;var p=this._events[d];if(p.fn)p.fn===u&&(!f||p.once)&&(!h||p.context===h)&&o(this,d);else{for(var g=0,_=[],b=p.length;g<b;g++)(p[g].fn!==u||f&&!p[g].once||h&&p[g].context!==h)&&_.push(p[g]);_.length?this._events[d]=_.length===1?_[0]:_:o(this,d)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=i?i+l:l,this._events[u]&&o(this,u)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a})(_b);var fB=_b.exports;function dB(t){return t.map(encodeURIComponent).join(",")}function mb(t){return Array.isArray(t)?dB(t):encodeURIComponent(String(t))}function yb(t,e,i){if(i===!1||i===null)return t;var n=/\?/.test(t)?"&":"?",s=encodeURIComponent(e);return i!==void 0&&i!==""&&i!==!0&&(s+="="+mb(i)),""+t+n+s}function pB(t,e){if(!e)return t;var i=t;return Object.keys(e).forEach(function(n){var s=e[n];s!==void 0&&(Array.isArray(s)&&(s=s.filter(function(r){return r!=null}).join(",")),i=yb(i,n,s))}),i}function gB(t,e){if(!e||t.slice(0,4)==="http")return t;var i=t[0]==="/"?"":"/";return""+e.replace(/\/$/,"")+i+t}function _B(t,e){return e?t.replace(/\/:([a-zA-Z0-9]+)/g,function(i,n){var s=e[n];if(s===void 0)throw new Error("Unspecified route parameter "+n);var r=mb(s);return"/"+r}):t}var mB={appendQueryObject:pB,appendQueryParam:yb,prependOrigin:gB,interpolateRouteParams:_B},yB=gb,Md=Rr,vB=fB,Na=mB,hm=xl,bB=1;function mn(t,e){if(!t)throw new Error("MapiRequest requires a client");if(!e||!e.path||!e.method)throw new Error("MapiRequest requires an options object with path and method properties");var i={};e.body&&(i["content-type"]="application/json");var n=Md(i,e.headers),s=Object.keys(n).reduce(function(r,o){return r[o.toLowerCase()]=n[o],r},{});this.id=bB++,this._options=e,this.emitter=new vB,this.client=t,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=e.path,this.method=e.method,this.origin=e.origin||t.origin,this.query=e.query||{},this.params=e.params||{},this.body=e.body||null,this.file=e.file||null,this.encoding=e.encoding||"utf8",this.sendFileAs=e.sendFileAs||null,this.headers=s}mn.prototype.url=function(e){var i=Na.prependOrigin(this.path,this.origin);i=Na.appendQueryObject(i,this.query);var n=this.params,s=e??this.client.accessToken;if(s){i=Na.appendQueryParam(i,"access_token",s);var r=yB(s).user;n=Md({ownerId:r},n)}return i=Na.interpolateRouteParams(i,n),i};mn.prototype.send=function(){var e=this;if(e.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return e.sent=!0,e.client.sendRequest(e).then(function(i){return e.response=i,e.emitter.emit(hm.EVENT_RESPONSE,i),i},function(i){throw e.error=i,e.emitter.emit(hm.EVENT_ERROR,i),i})};mn.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};mn.prototype.eachPage=function(e){var i=this;function n(o){function a(){delete i._nextPageRequest;var c=o.nextPage();c&&(i._nextPageRequest=c,r(c))}e(null,o,a)}function s(o){e(o,null,function(){})}function r(o){o.send().then(n,s)}r(this)};mn.prototype.clone=function(){return this._extend()};mn.prototype._extend=function(e){var i=Md(this._options,e);return new mn(this.client,i)};var wB=mn,TB=gb,EB=wB,SB=xl;function vb(t){if(!t||!t.accessToken)throw new Error("Cannot create a client without an access token");TB(t.accessToken),this.accessToken=t.accessToken,this.origin=t.origin||SB.API_ORIGIN}vb.prototype.createRequest=function(e){return new EB(this,e)};var bb=vb,wb=aB,Tb=bb;function br(t){Tb.call(this,t)}br.prototype=Object.create(Tb.prototype);br.prototype.constructor=br;br.prototype.sendRequest=wb.browserSend;br.prototype.abortRequest=wb.browserAbort;function AB(t){return new br(t)}var Eb=AB,RB=Eb,CB=RB,xB=Object.prototype.toString,PB=function(t){var e;return xB.call(t)==="[object Object]"&&(e=Object.getPrototypeOf(t),e===null||e===Object.getPrototypeOf({}))},MB=PB,IB=Rr,Sb="value",Xu=`
  `,Ve={};Ve.assert=function(t,e){return e=e||{},function(i){var n=yn(t,i);if(n){var s=Id(n,e);throw e.apiName&&(s=e.apiName+": "+s),new Error(s)}}};Ve.shape=function(e){var i=DB(e);return function(s){var r=yn(Ve.plainObject,s);if(r)return r;for(var o,a,c=[],l=0;l<i.length;l++)o=i[l].key,a=i[l].value,r=yn(a,s[o]),r&&c.push([o].concat(r));return c.length<2?c[0]:function(u){c=c.map(function(d){var p=d[0],g=Id(d,u).split(`
`).join(Xu);return"- "+p+": "+g});var h=u.path.join("."),f=h===Sb?"":" of "+h;return"The following properties"+f+" have invalid values:"+Xu+c.join(Xu)}}};Ve.strictShape=function(e){var i=Ve.shape(e);return function(s){var r=i(s);if(r)return r;var o=Object.keys(s).reduce(function(a,c){return e[c]===void 0&&a.push(c),a},[]);if(o.length!==0)return function(){return"The following keys are invalid: "+o.join(", ")}}};Ve.arrayOf=function(e){return Ab(e)};Ve.tuple=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return Ab(e)};function Ab(t){var e=Array.isArray(t),i=function(n){return e?t[n]:t};return function(s){var r=yn(Ve.plainArray,s);if(r)return r;if(e&&s.length!==t.length)return"an array with "+t.length+" items";for(var o=0;o<s.length;o++)if(r=yn(i(o),s[o]),r)return[o].concat(r)}}Ve.required=function(e){function i(n){return n==null?function(s){return Rb(s,Cb(s.path)?"cannot be undefined/null.":"is required.")}:e.apply(this,arguments)}return i.__required=!0,i};Ve.oneOfType=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(n){var s=e.map(function(r){return yn(r,n)}).filter(Boolean);if(s.length===e.length)return s.every(function(r){return r.length===1&&typeof r[0]=="string"})?OB(s.map(function(r){return r[0]})):s.reduce(function(r,o){return o.length>r.length?o:r})}};Ve.equal=function(e){return function(n){if(n!==e)return JSON.stringify(e)}};Ve.oneOf=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),i=e.map(function(n){return Ve.equal(n)});return Ve.oneOfType.apply(this,i)};Ve.range=function(e){var i=e[0],n=e[1];return function(r){var o=yn(Ve.number,r);if(o||r<i||r>n)return"number between "+i+" & "+n+" (inclusive)"}};Ve.any=function(){};Ve.boolean=function(e){if(typeof e!="boolean")return"boolean"};Ve.number=function(e){if(typeof e!="number")return"number"};Ve.plainArray=function(e){if(!Array.isArray(e))return"array"};Ve.plainObject=function(e){if(!MB(e))return"object"};Ve.string=function(e){if(typeof e!="string")return"string"};Ve.func=function(e){if(typeof e!="function")return"function"};function yn(t,e){if(!(e==null&&!t.hasOwnProperty("__required"))){var i=t(e);if(i)return Array.isArray(i)?i:[i]}}function Id(t,e){var i=t.length,n=t[i-1],s=t.slice(0,i-1);return s.length===0&&(s=[Sb]),e=IB(e,{path:s}),typeof n=="function"?n(e):Rb(e,NB(n))}function OB(t){return t.length<2?t[0]:t.length===2?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t.slice(-1)}function NB(t){return"must be "+kB(t)+"."}function kB(t){return/^an? /.test(t)?t:/^[aeiou]/i.test(t)?"an "+t:/^[a-z]/i.test(t)?"a "+t:t}function Rb(t,e){var i=Cb(t.path),n=t.path.join(".")+" "+e,s=i?"Item at position ":"";return s+n}function Cb(t){return typeof t[t.length-1]=="number"||typeof t[0]=="number"}function DB(t){return Object.keys(t||{}).map(function(e){return{key:e,value:t[e]}})}Ve.validate=yn;Ve.processMessage=Id;var FB=Ve,LB=Rr,ir=FB;function BB(t){if(typeof window<"u")return t instanceof Ys.Blob||t instanceof Ys.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof t=="string"||t.pipe!==void 0))return"Filename or Readable stream"}function UB(t,e){return ir.assert(ir.strictShape(t),e)}function zB(t){var e="date";if(typeof t=="boolean")return e;try{var i=new Date(t);if(i.getTime&&isNaN(i.getTime()))return e}catch{return e}}function VB(t){return ir.tuple(ir.number,ir.number)(t)}var jB=LB(ir,{file:BB,date:zB,coordinates:VB,assertShape:UB});function $B(t,e){var i=function(n,s){return e.indexOf(n)!==-1&&s!==void 0};return typeof e=="function"&&(i=e),Object.keys(t).filter(function(n){return i(n,t[n])}).reduce(function(n,s){return n[s]=t[s],n},{})}var HB=$B;function WB(t,e){return Object.keys(t).reduce(function(i,n){return i[n]=e(n,t[n]),i},{})}var XB=WB,qB=XB;function YB(t){return qB(t,function(e,i){return typeof i=="boolean"?JSON.stringify(i):i})}var KB=YB,ZB=bb,GB=Eb;function JB(t){return function(e){var i;ZB.prototype.isPrototypeOf(e)?i=e:i=GB(e);var n=Object.create(t);return n.client=i,n}}var QB=JB,xb=Rr,pe=jB,Oc=HB,Pb=KB,eU=QB,Od={},Mb=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Od.forwardGeocode=function(t){pe.assertShape({query:pe.required(pe.string),mode:pe.oneOf("mapbox.places","mapbox.places-permanent"),countries:pe.arrayOf(pe.string),proximity:pe.oneOf(pe.coordinates,"ip"),types:pe.arrayOf(pe.oneOf(Mb)),autocomplete:pe.boolean,bbox:pe.arrayOf(pe.number),limit:pe.number,language:pe.arrayOf(pe.string),routing:pe.boolean,fuzzyMatch:pe.boolean,worldview:pe.string})(t),t.mode=t.mode||"mapbox.places";var e=Pb(xb({country:t.countries},Oc(t,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Oc(t,["mode","query"]),query:e})};Od.reverseGeocode=function(t){pe.assertShape({query:pe.required(pe.coordinates),mode:pe.oneOf("mapbox.places","mapbox.places-permanent"),countries:pe.arrayOf(pe.string),types:pe.arrayOf(pe.oneOf(Mb)),bbox:pe.arrayOf(pe.number),limit:pe.number,language:pe.arrayOf(pe.string),reverseMode:pe.oneOf("distance","score"),routing:pe.boolean,worldview:pe.string})(t),t.mode=t.mode||"mapbox.places";var e=Pb(xb({country:t.countries},Oc(t,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Oc(t,["mode","query"]),query:e})};var tU=eU(Od);let iU="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Ib=t=>crypto.getRandomValues(new Uint8Array(t)),Ob=(t,e,i)=>{let n=(2<<Math.log(t.length-1)/Math.LN2)-1,s=-~(1.6*n*e/t.length);return(r=e)=>{let o="";for(;;){let a=i(s),c=s;for(;c--;)if(o+=t[a[c]&n]||"",o.length===r)return o}}},nU=(t,e=21)=>Ob(t,e,Ib),sU=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,i)=>(i&=63,i<36?e+=i.toString(36):i<62?e+=(i-26).toString(36).toUpperCase():i>62?e+="-":e+="_",e),"");const rU=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:nU,customRandom:Ob,nanoid:sU,random:Ib,urlAlphabet:iU},Symbol.toStringTag,{value:"Module"})),oU=Gb(rU);var aU=oU.nanoid;function Nb(t){this.origin=t.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=t.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=t,this.send=this.send.bind(this),this.countries=t.countries?t.countries.split(","):null,this.types=t.types?t.types.split(","):null,this.bbox=t.bbox?t.bbox:null,this.language=t.language?t.language.split(","):null,this.limit=t.limit?+t.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(t),this.eventQueue=new Array,this.flushInterval=t.flushInterval||1e3,this.maxQueueSize=t.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}Nb.prototype={select:function(t,e){var i=this.getSelectedIndex(t,e),n=this.getEventPayload("search.select",e);if(n.resultIndex=i,n.resultPlaceName=t.place_name,n.resultId=t.id,!(i===this.lastSentIndex&&n.queryString===this.lastSentInput||i==-1)&&(this.lastSentIndex=i,this.lastSentInput=n.queryString,!!n.queryString))return this.push(n)},start:function(t){var e=this.getEventPayload("search.start",t);if(e.queryString)return this.push(e)},keyevent:function(t,e){if(t.key&&!(t.metaKey||[9,27,37,39,13,38,40].indexOf(t.keyCode)!==-1)){var i=this.getEventPayload("search.keystroke",e);if(i.lastAction=t.key,!!i.queryString)return this.push(i)}},send:function(t,e){if(!this.enableEventLogging)return e?e():void 0;var i=this.getRequestOptions(t);this.request(i,(function(n){if(n)return this.handleError(n,e);if(e)return e()}).bind(this))},getRequestOptions:function(t){Array.isArray(t)||(t=[t]);var e={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return e},getEventPayload:function(t,e){var i;e.options.proximity?typeof e.options.proximity=="object"?i=[e.options.proximity.longitude,e.options.proximity.latitude]:e.options.proximity==="ip"?i=[999,999]:i=e.options.proximity:i=null;var n=e._map?e._map.getZoom():void 0,s={event:t,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:e.options.autocomplete,fuzzyMatch:e.options.fuzzyMatch,proximity:i,limit:e.options.limit,routing:e.options.routing,worldview:e.options.worldview,mapZoom:n,keyboardLocale:this.locale};return t==="search.select"?s.queryString=e.inputString:t!="search.select"&&e._inputEl?s.queryString=e._inputEl.value:s.queryString=e.inputString,s},request:function(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(this.readyState==4)return this.status==204?e(null):e(this.statusText)},i.open(t.method,t.host+"/"+t.path,!0);for(var n in t.headers){var s=t.headers[n];i.setRequestHeader(n,s)}i.send(t.body)},handleError:function(t,e){if(e)return e(t)},generateSessionID:function(){return aU()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(t,e){if(e._typeahead){var i=e._typeahead.data,n=t.id,s=i.map(function(o){return o.id}),r=s.indexOf(n);return r}},shouldEnableLogging:function(t){return!(t.enableEventLogging===!1||t.origin&&t.origin!=="https://api.mapbox.com"||t.localGeocoder||t.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(t,e){this.eventQueue.push(t),(this.eventQueue.length>=this.maxQueueSize||e)&&this.flush()},remove:function(){this.flush()}};var cU=Nb,lU={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},uU={placeholder:lU},kb={exports:{}};(function(t){(function(e,i,n){t.exports?t.exports=n():e[i]=n()})(Ys,"subtag",function(){var e="",i=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(c){return c.match(i)||[]}function s(c){return n(c).filter(function(l,u){return l&&u})}function r(c){return c=n(c),{language:c[1]||e,extlang:c[2]||e,script:c[3]||e,region:c[4]||e}}function o(c,l,u){Object.defineProperty(c,l,{value:u,enumerable:!0})}function a(c,l,u){function h(f){return n(f)[c]||e}o(h,"pattern",l),o(r,u,h)}return a(1,/^[a-zA-Z]{2,3}$/,"language"),a(2,/^[a-zA-Z]{3}$/,"extlang"),a(3,/^[a-zA-Z]{4}$/,"script"),a(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),o(r,"split",s),r})})(kb);var hU=kb.exports;function Db(){}Db.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const t={enableHighAccuracy:!0};return new Promise(function(e,i){window.navigator.geolocation.getCurrentPosition(e,i,t)})}};var fU=Db;function dU(t,e){const i=Fb(t),n=["address","street","place","country"];var s;if(typeof e=="function")return e(i);const r=n.indexOf(e);return r===-1?s=n:s=n.slice(r),s.reduce(function(o,a){return i[a]?(o!==""&&(o=o+", "),o+i[a]):o},"")}function Fb(t){const e=t.address||"",i=t.text||"",n=t.place_name||"",r={address:n.split(",")[0],houseNumber:e,street:i,placeName:n};return t.context.forEach(function(o){const a=o.id.split(".")[0];r[a]=o.text}),r}const pU=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var gU={transformFeatureToGeolocationText:dU,getAddressInfo:Fb,REVERSE_GEOCODE_COORD_RGX:pU},_U=FL,mU=Jb,Nn=Rr,yU=$L.EventEmitter,fm=HL,qu=CB,Yu=tU,vU=cU,bU=uU,wU=hU,TU=fU,dm=gU;const Qi={FORWARD:0,LOCAL:1,REVERSE:2};function EU(){var t=document.createElement("div");return t.className="mapboxgl-ctrl-geocoder--powered-by",t.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',t}function Lb(t){this._eventEmitter=new yU,this.options=Nn({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new TU}Lb.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(t){return t.place_name},render:function(t){var e=t.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"}},addTo:function(t){function e(i,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const s=i.onAdd();n.appendChild(s)}if(t._controlContainer)t.addControl(this);else if(t instanceof HTMLElement)e(this,t);else if(typeof t=="string"){const i=document.querySelectorAll(t);if(i.length===0)throw new Error("Element ",t,"not found.");if(i.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,i[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(t){if(t&&typeof t!="string"&&(this._map=t),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Yu(qu({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new vU(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var i=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",mU(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(l){this.eventManager.keyevent(l,this)}).bind(this));var n=document.createElement("div");n.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var s=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(s),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),e.appendChild(i),e.appendChild(this._inputEl),e.appendChild(n),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var r=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(r),n.appendChild(this._geolocateEl),this._showGeolocateButton()}var o=this._typeahead=new _U(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),o.getItemValue=this.options.getItemValue;var a=o.list.draw,c=this._footerNode=EU();return o.list.draw=function(){a.call(this),c.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),c.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(c)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),e},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(t){this._hideLoadingIcon();const e={geometry:{type:"Point",coordinates:[t.coords.longitude,t.coords.latitude]}};this._handleMarker(e),this._fly(e),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(e),this._showClearButton(),this.fresh=!1;const i={limit:1,language:[this.options.language],query:e.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const n=e.geometry.coordinates[0]+","+e.geometry.coordinates[1];this._setInputValue(n),this._eventEmitter.emit("result",{result:e})}else this.geocoderService.reverseGeocode(i).send().then((function(n){const s=n.body.features[0];if(s){const r=dm.transformFeatureToGeolocationText(s,this.options.addressAccuracy);this._setInputValue(r),s.user_coordinates=e.geometry.coordinates,this._eventEmitter.emit("result",{result:s})}else this._eventEmitter.emit("result",{result:{user_coordinates:e.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(t){t.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+t),i.setAttribute("viewBox","0 0 18 18"),i.setAttribute("xml:space","preserve"),i.setAttribute("width",18),i.setAttribute("height",18),i.innerHTML=e,i},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(t){this._inputEl.value=t,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(t){var e=(t.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this._geocode(e)},_onKeyDown:function(t){var e=27,i=9;if(t.keyCode===e&&this.options.clearAndBlurOnEsc)return this._clear(t),this._inputEl.blur();var n=t.target&&t.target.shadowRoot?t.target.shadowRoot.activeElement:t.target,s=n?n.value:"";if(!s)return this.fresh=!0,t.keyCode!==i&&this.clear(t),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(t.metaKey||[i,e,37,39,13,38,40].indexOf(t.keyCode)!==-1)&&n.value.length>=this.options.minLength&&this._geocode(n.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(t){this.options.clearOnBlur&&this._clearOnBlur(t),this.options.collapsed&&this._collapse()},_onChange:function(){var t=this._typeahead.selected;t&&JSON.stringify(t)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(t),this.options.marker&&this._mapboxgl&&this._handleMarker(t),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(t),this._eventEmitter.emit("result",{result:t}),this.eventManager.select(t,this))},_fly:function(t){var e;if(t.properties&&fm[t.properties.short_code])e=Nn({},this.options.flyTo),this._map&&this._map.fitBounds(fm[t.properties.short_code].bbox,e);else if(t.bbox){var i=t.bbox;e=Nn({},this.options.flyTo),this._map&&this._map.fitBounds([[i[0],i[1]],[i[2],i[3]]],e)}else{var n={zoom:this.options.zoom};e=Nn({},n,this.options.flyTo),t.center?e.center=t.center:t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&(e.center=t.geometry.coordinates),this._map&&this._map.flyTo(e)}},_requestType:function(t,e){var i;return t.localGeocoderOnly?i=Qi.LOCAL:t.reverseGeocode&&dm.REVERSE_GEOCODE_COORD_RGX.test(e)?i=Qi.REVERSE:i=Qi.FORWARD,i},_setupConfig:function(t,e){const i=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],n=/[\s,]+/;var s=this,r=i.reduce(function(a,c){if(s.options[c]===void 0||s.options[c]===null)return a;["countries","types","language"].indexOf(c)>-1?a[c]=s.options[c].split(n):a[c]=s.options[c];const l=typeof s.options[c].longitude=="number"&&typeof s.options[c].latitude=="number";if(c==="proximity"&&l){const u=s.options[c].longitude,h=s.options[c].latitude;a[c]=[u,h]}return a},{});switch(t){case Qi.REVERSE:{var o=e.split(n).map(function(a){return parseFloat(a,10)});s.options.flipCoordinates||o.reverse(),r.types&&r.types[0],r=Nn(r,{query:o,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(a){a in r&&delete r[a]})}break;case Qi.FORWARD:{const a=e.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(a)&&(e=e.replace(/,/g," ")),r=Nn(r,{query:e})}break}return r},_geocode:function(t){this.inputString=t,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:t});const e=this._requestType(this.options,t),i=this._setupConfig(e,t);var n;switch(e){case Qi.LOCAL:n=Promise.resolve();break;case Qi.FORWARD:n=this.geocoderService.forwardGeocode(i).send();break;case Qi.REVERSE:n=this.geocoderService.reverseGeocode(i).send();break}var s=this.options.localGeocoder?this.options.localGeocoder(t)||[]:[],r=[],o=null;return n.catch((function(a){o=a}).bind(this)).then((function(a){this._hideLoadingIcon();var c={};return a?a.statusCode=="200"&&(c=a.body,c.request=a.request,c.headers=a.headers):c={type:"FeatureCollection",features:[]},c.config=i,this.fresh&&(this.eventManager.start(this),this.fresh=!1),c.features=c.features?s.concat(c.features):s,this.options.externalGeocoder?(r=this.options.externalGeocoder(t,c.features)||Promise.resolve([]),r.then(function(l){return c.features=c.features?l.concat(c.features):l,c},function(){return c})):c}).bind(this)).then((function(a){if(o)throw o;this.options.filter&&a.features.length&&(a.features=a.features.filter(this.options.filter)),a.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",a),this._typeahead.update(a.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",a))}).bind(this)).catch((function(a){this._hideLoadingIcon(),this._hideAttribution(),s.length&&this.options.localGeocoder||r.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(s)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:s}),this._eventEmitter.emit("error",{error:a})}).bind(this)),n},_clear:function(t){t&&t.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(t){this._clear(t),this._inputEl.focus()},_clearOnBlur:function(t){var e=this;t.relatedTarget&&e._clear(t)},_onQueryResult:function(t){var e=t.body;if(e.features.length){var i=e.features[0];this._typeahead.selected=i,this._inputEl.value=i.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var t=this._map.getCenter().wrap();this.setProximity({longitude:t.lng,latitude:t.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(t){return this._geocode(t).then(this._onQueryResult),this},_renderError:function(){var t="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(t)},_renderLocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(t)},_renderNoResults:function(){var t="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(t)},_renderUserDeniedGeolocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(t)},_renderMessage:function(t){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(t)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var t=this.options.language.split(",")[0],e=wU.language(t),i=bU.placeholder[e];if(i)return i}return"Search"},setInput:function(t,e){return e===void 0&&(e=!1),this._inputEl.value=t,this._typeahead.selected=null,this._typeahead.clear(),t.length>=this.options.minLength&&(e?this._geocode(t):this._onChange()),this},setProximity:function(t,e=!0){return this.options.proximity=t,e&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(t){return t&&typeof t=="function"&&(this._typeahead.render=t),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(t){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=t||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(t){return this.options.zoom=t,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(t){return this.options.flyTo=t,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(t){return this.options.placeholder=t||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(t){return this.options.bbox=t,this},getCountries:function(){return this.options.countries},setCountries:function(t){return this.options.countries=t,this},getTypes:function(){return this.options.types},setTypes:function(t){return this.options.types=t,this},getMinLength:function(){return this.options.minLength},setMinLength:function(t){return this.options.minLength=t,this._typeahead&&(this._typeahead.options.minLength=t),this},getLimit:function(){return this.options.limit},setLimit:function(t){return this.options.limit=t,this._typeahead&&(this._typeahead.options.limit=t),this},getFilter:function(){return this.options.filter},setFilter:function(t){return this.options.filter=t,this},setOrigin:function(t){return this.options.origin=t,this.geocoderService=Yu(qu({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(t){return this.options.accessToken=t,this.geocoderService=Yu(qu({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(t){return this.options.autocomplete=t,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(t){return this.options.fuzzyMatch=t,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(t){return this.options.routing=t,this},getRouting:function(){return this.options.routing},setWorldview:function(t){return this.options.worldview=t,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(t){if(this._map){this._removeMarker();var e={color:"#4668F2"},i=Nn({},e,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(i),t.center?this.mapMarker.setLngLat(t.center).addTo(this._map):t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&this.mapMarker.setLngLat(t.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(t,e){return this._eventEmitter.on(t,e),this},off:function(t,e){return this._eventEmitter.removeListener(t,e),this.eventManager.remove(),this}};var SU=Lb;const AU=kf(SU);function pm(t,e,i){const n=t.slice();return n[94]=e[i],n[96]=i,n}function gm(t){let e,i,n="Close",s,r,o,a="↗️ Google Maps",c,l,u,h="Explore by Pan and Zooming",f,d,p,g,_,b;return d=new DF({props:{coords:t[16]}}),{c(){e=K("div"),i=K("button"),i.textContent=n,s=ue(),r=K("a"),o=K("button"),o.textContent=a,l=ue(),u=K("p"),u.textContent=h,f=ue(),Gn(d.$$.fragment),this.h()},l(T){e=Z(T,"DIV",{class:!0});var v=oe(e);i=Z(v,"BUTTON",{class:!0,"data-svelte-h":!0}),We(i)!=="svelte-1bot2i0"&&(i.textContent=n),s=he(v),r=Z(v,"A",{target:!0,href:!0});var E=oe(r);o=Z(E,"BUTTON",{class:!0,"data-svelte-h":!0}),We(o)!=="svelte-1du5rck"&&(o.textContent=a),E.forEach(j),l=he(v),u=Z(v,"P",{class:!0,"data-svelte-h":!0}),We(u)!=="svelte-w0hcp3"&&(u.textContent=h),f=he(v),Jn(d.$$.fragment,v),v.forEach(j),this.h()},h(){L(i,"class","three-d-close svelte-1ljt30m"),L(o,"class","maps-link svelte-1ljt30m"),L(r,"target","_blank"),L(r,"href",c="http://maps.google.com/maps?q="+t[16][1]+","+t[16][0]),L(u,"class","instructions svelte-1ljt30m"),L(e,"class","three-d svelte-1ljt30m")},m(T,v){re(T,e,v),H(e,i),H(e,s),H(e,r),H(r,o),H(e,l),H(e,u),H(e,f),Qn(d,e,null),g=!0,_||(b=hi(i,"click",t[35]),_=!0)},p(T,v){(!g||v[0]&65536&&c!==(c="http://maps.google.com/maps?q="+T[16][1]+","+T[16][0]))&&L(r,"href",c);const E={};v[0]&65536&&(E.coords=T[16]),d.$set(E)},i(T){g||(se(d.$$.fragment,T),T&&(p||ls(()=>{p=Nf(e,Pi,{y:-20,duration:500}),p.start()})),g=!0)},o(T){Ae(d.$$.fragment,T),g=!1},d(T){T&&j(e),es(d),_=!1,b()}}}function _m(t){let e,i,n,s,r=t[19]&&t[12]&&mm(t),o=t[18]&&ym(t),a=t[20]&&t[6]&&bm(t);return{c(){e=K("div"),r&&r.c(),i=ue(),o&&o.c(),n=ue(),a&&a.c(),this.h()},l(c){e=Z(c,"DIV",{class:!0,style:!0});var l=oe(e);r&&r.l(l),i=he(l),o&&o.l(l),n=he(l),a&&a.l(l),l.forEach(j),this.h()},h(){L(e,"class","loading-overlay svelte-1ljt30m"),ot(e,"display",(t[15],""))},m(c,l){re(c,e,l),r&&r.m(e,null),H(e,i),o&&o.m(e,null),H(e,n),a&&a.m(e,null),s=!0},p(c,l){c[19]&&c[12]?r?(r.p(c,l),l[0]&528384&&se(r,1)):(r=mm(c),r.c(),se(r,1),r.m(e,i)):r&&(si(),Ae(r,1,1,()=>{r=null}),ri()),c[18]?o?(o.p(c,l),l[0]&262144&&se(o,1)):(o=ym(c),o.c(),se(o,1),o.m(e,n)):o&&(si(),Ae(o,1,1,()=>{o=null}),ri()),c[20]&&c[6]?a?(a.p(c,l),l[0]&1048640&&se(a,1)):(a=bm(c),a.c(),se(a,1),a.m(e,null)):a&&(si(),Ae(a,1,1,()=>{a=null}),ri()),(!s||l[0]&32768)&&ot(e,"display",(c[15],""))},i(c){s||(se(r),se(o),se(a),s=!0)},o(c){Ae(r),Ae(o),Ae(a),s=!1},d(c){c&&j(e),r&&r.d(),o&&o.d(),a&&a.d()}}}function mm(t){let e,i,n,s,r;return i=new AF({props:{sizes:t[11],geoJSON:t[19],courtData:t[12],viewportHeight:t[0],viewportWidth:t[1]}}),i.$on("finished",t[34]),{c(){e=K("div"),Gn(i.$$.fragment),n=ue(),s=Ot("}"),this.h()},l(o){e=Z(o,"DIV",{class:!0});var a=oe(e);Jn(i.$$.fragment,a),n=he(a),a.forEach(j),s=Nt(o,"}"),this.h()},h(){L(e,"class","world-map svelte-1ljt30m")},m(o,a){re(o,e,a),Qn(i,e,null),H(e,n),re(o,s,a),r=!0},p(o,a){const c={};a[0]&2048&&(c.sizes=o[11]),a[0]&524288&&(c.geoJSON=o[19]),a[0]&4096&&(c.courtData=o[12]),a[0]&1&&(c.viewportHeight=o[0]),a[0]&2&&(c.viewportWidth=o[1]),i.$set(c)},i(o){r||(se(i.$$.fragment,o),r=!0)},o(o){Ae(i.$$.fragment,o),r=!1},d(o){o&&(j(e),j(s)),es(i)}}}function ym(t){let e,i,n,s=!t[20]&&vm(t);return{c(){e=K("div"),s&&s.c(),this.h()},l(r){e=Z(r,"DIV",{class:!0});var o=oe(e);s&&s.l(o),o.forEach(j),this.h()},h(){L(e,"class","loading-text svelte-1ljt30m")},m(r,o){re(r,e,o),s&&s.m(e,null),n=!0},p(r,o){r[20]?s&&(si(),Ae(s,1,1,()=>{s=null}),ri()):s?(s.p(r,o),o[0]&1048576&&se(s,1)):(s=vm(r),s.c(),se(s,1),s.m(e,null))},i(r){n||(se(s),r&&ls(()=>{n&&(i||(i=dn(e,Pi,{y:20,duration:1e3,delay:500},!0)),i.run(1))}),n=!0)},o(r){Ae(s),r&&(i||(i=dn(e,Pi,{y:20,duration:1e3,delay:500},!1)),i.run(0)),n=!1},d(r){r&&j(e),s&&s.d(),r&&i&&i.end()}}}function vm(t){var h,f;let e,i,n=t[28](Math.round(t[26]*((h=t[12])==null?void 0:h.length)/100)*100)+"",s,r,o=t[28]((f=t[12])==null?void 0:f.length)+"",a,c,l,u;return{c(){e=K("p"),i=Ot("Loading Satellite Imagery of "),s=Ot(n),r=Ot(" of "),a=Ot(o),c=Ot(" Basketball Courts"),this.h()},l(d){e=Z(d,"P",{class:!0});var p=oe(e);i=Nt(p,"Loading Satellite Imagery of "),s=Nt(p,n),r=Nt(p," of "),a=Nt(p,o),c=Nt(p," Basketball Courts"),p.forEach(j),this.h()},h(){L(e,"class","every svelte-1ljt30m")},m(d,p){re(d,e,p),H(e,i),H(e,s),H(e,r),H(e,a),H(e,c),u=!0},p(d,p){var g,_;(!u||p[0]&67112960)&&n!==(n=d[28](Math.round(d[26]*((g=d[12])==null?void 0:g.length)/100)*100)+"")&&Zn(s,n),(!u||p[0]&4096)&&o!==(o=d[28]((_=d[12])==null?void 0:_.length)+"")&&Zn(a,o)},i(d){u||(d&&ls(()=>{u&&(l||(l=dn(e,Pi,{y:20,duration:1e3,delay:0},!0)),l.run(1))}),u=!0)},o(d){d&&(l||(l=dn(e,Pi,{y:20,duration:1e3,delay:0},!1)),l.run(0)),u=!1},d(d){d&&j(e),d&&l&&l.end()}}}function bm(t){let e,i,n,s,r,o,a='<span class="svelte-1ljt30m">Every Outdoor Basketball Court in the U.S.A.</span>',c,l,u='<span class="svelte-1ljt30m">Help us by documenting important outdoor courts.</span>',h,f,d,p="Begin Exploring",g,_,b,T;return{c(){e=K("div"),i=K("div"),n=K("a"),s=new Fm(!1),r=ue(),o=K("p"),o.innerHTML=a,c=ue(),l=K("p"),l.innerHTML=u,h=ue(),f=K("div"),d=K("button"),d.textContent=p,this.h()},l(v){e=Z(v,"DIV",{class:!0});var E=oe(e);i=Z(E,"DIV",{class:!0});var R=oe(i);n=Z(R,"A",{href:!0,target:!0,class:!0});var P=oe(n);s=Lm(P,!1),P.forEach(j),R.forEach(j),r=he(E),o=Z(E,"P",{class:!0,"data-svelte-h":!0}),We(o)!=="svelte-1x853zu"&&(o.innerHTML=a),c=he(E),l=Z(E,"P",{class:!0,"data-svelte-h":!0}),We(l)!=="svelte-107826k"&&(l.innerHTML=u),h=he(E),f=Z(E,"DIV",{class:!0});var M=oe(f);d=Z(M,"BUTTON",{class:!0,"data-svelte-h":!0}),We(d)!=="svelte-1ibfhhu"&&(d.textContent=p),M.forEach(j),E.forEach(j),this.h()},h(){s.a=null,L(n,"href","https://pudding.cool"),L(n,"target","_blank"),L(n,"class","svelte-1ljt30m"),L(i,"class","logo svelte-1ljt30m"),L(o,"class","every svelte-1ljt30m"),L(l,"class","every every-small svelte-1ljt30m"),L(d,"class","start-button svelte-1ljt30m"),L(f,"class","start-button-container"),L(e,"class","loading-text svelte-1ljt30m")},m(v,E){re(v,e,E),H(e,i),H(i,n),s.m(jv,n),H(e,r),H(e,o),H(e,c),H(e,l),H(e,h),H(e,f),H(f,d),_=!0,b||(T=hi(d,"click",t[36]),b=!0)},p:St,i(v){_||(v&&ls(()=>{_&&(g||(g=dn(e,Pi,{y:20,duration:1e3,delay:500},!0)),g.run(1))}),_=!0)},o(v){v&&(g||(g=dn(e,Pi,{y:20,duration:1e3,delay:500},!1)),g.run(0)),_=!1},d(v){v&&j(e),v&&g&&g.end(),b=!1,T()}}}function wm(t){let e,i;return e=new CL({props:{commentId:t[13]}}),e.$on("formSubmit",t[29]),{c(){Gn(e.$$.fragment)},l(n){Jn(e.$$.fragment,n)},m(n,s){Qn(e,n,s),i=!0},p(n,s){const r={};s[0]&8192&&(r.commentId=n[13]),e.$set(r)},i(n){i||(se(e.$$.fragment,n),i=!0)},o(n){Ae(e.$$.fragment,n),i=!1},d(n){es(e,n)}}}function Tm(t){let e,i;return e=new OF({}),{c(){Gn(e.$$.fragment)},l(n){Jn(e.$$.fragment,n)},m(n,s){Qn(e,n,s),i=!0},i(n){i||(se(e.$$.fragment,n),i=!0)},o(n){Ae(e.$$.fragment,n),i=!1},d(n){es(e,n)}}}function Em(t){let e,i='<p class="svelte-1ljt30m">Zoom-in to Explore, like a Map!</p> <div class="finger svelte-1ljt30m"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 76 114"><path fill="#fff" d="M75 67v16c0 6-2 12-6 16-2 3-4 7-4 10v3a1 1 0 0 1-1 2 1 1 0 0 1-2-1v-4c0-4 2-8 5-12s5-9 5-14V67a4 4 0 0 0-1-3 3 3 0 0 0-4 0 4 4 0 0 0-2 3 1 1 0 1 1-3 0v-5a3 3 0 0 0-3-4 3 3 0 0 0-4 4v5a1 1 0 1 1-3 0v-5a3 3 0 0 0-2-3 4 4 0 0 0-4 0 3 3 0 0 0-1 3v5a1 1 0 1 1-3 0V35a4 4 0 0 0-4-4 4 4 0 0 0-4 4v42a1 1 0 1 1-3 0V66a4 4 0 0 0-4 4v13c0 5 2 10 5 14s5 8 5 12v4a2 2 0 0 1-2 1 2 2 0 0 1-1-2v-3c0-3-2-7-4-10-4-4-6-10-6-16V70a7 7 0 0 1 7-7V35a7 7 0 0 1 7-7 7 7 0 0 1 7 7v21a7 7 0 0 1 7 0l2 2a7 7 0 0 1 5-3 6 6 0 0 1 6 6h1a6 6 0 0 1 9 6ZM27 47a2 2 0 0 0 1-3 14 14 0 1 1 20 0 1 1 0 1 0 2 3 17 17 0 1 0-24 0h1ZM17 33H5l2-2a2 2 0 0 0-2-2l-4 5a1 1 0 0 0 0 2l4 5a2 2 0 0 0 2-3l-2-2h12a2 2 0 0 0 0-3Zm58 1-4-5a1 1 0 0 0-2 2l2 2H60a2 2 0 0 0 0 3h11l-2 2a1 1 0 1 0 2 3l4-5a1 1 0 0 0 0-2ZM40 5v10a1 1 0 1 1-3 0V5l-2 2a1 1 0 0 1-3-2l5-5a2 2 0 0 1 2 0l5 5a1 1 0 0 1-2 2l-2-2Z"></path></svg></div>',n,s,r;return{c(){e=K("div"),e.innerHTML=i,this.h()},l(o){e=Z(o,"DIV",{class:!0,"data-svelte-h":!0}),We(e)!=="svelte-bk9v5p"&&(e.innerHTML=i),this.h()},h(){L(e,"class","helper svelte-1ljt30m")},m(o,a){re(o,e,a),r=!0},i(o){r||(o&&ls(()=>{r&&(s&&s.end(1),n=Nf(e,U0,{delay:1e3,duration:2e3}),n.start())}),r=!0)},o(o){n&&n.invalidate(),o&&(s=Zb(e,U0,{duration:3e3})),r=!1},d(o){o&&j(e),o&&s&&s.end()}}}function Sm(t){let e,i,n="About",s,r;return{c(){e=K("div"),i=K("button"),i.textContent=n,this.h()},l(o){e=Z(o,"DIV",{class:!0});var a=oe(e);i=Z(a,"BUTTON",{class:!0,"data-svelte-h":!0}),We(i)!=="svelte-1pi4t56"&&(i.textContent=n),a.forEach(j),this.h()},h(){L(i,"class","svelte-1ljt30m"),L(e,"class","about svelte-1ljt30m")},m(o,a){re(o,e,a),H(e,i),s||(r=hi(i,"click",t[37]),s=!0)},p:St,d(o){o&&j(e),s=!1,r()}}}function Am(t){let e,i,n,s;function r(){return t[39](t[94])}return{c(){e=K("button"),this.h()},l(o){e=Z(o,"BUTTON",{class:!0,style:!0});var a=oe(e);a.forEach(j),this.h()},h(){L(e,"class",i=$d(t[94]==t[7]?"swatch-selected":"")+" svelte-1ljt30m"),ot(e,"background",t[94]),ot(e,"border-top-right-radius",t[96]==t[27].length-1?"5px":""),ot(e,"border-bottom-right-radius",t[96]==t[27].length-1?"5px":""),ot(e,"border-top-left-radius",t[96]==0?"5px":""),ot(e,"border-bottom-left-radius",t[96]==0?"5px":"")},m(o,a){re(o,e,a),n||(s=hi(e,"click",r),n=!0)},p(o,a){t=o,a[0]&128&&i!==(i=$d(t[94]==t[7]?"swatch-selected":"")+" svelte-1ljt30m")&&L(e,"class",i)},d(o){o&&j(e),n=!1,s()}}}function Rm(t){let e,i,n,s;return{c(){e=K("div"),i=Hd("svg"),n=Hd("path"),this.h()},l(r){e=Z(r,"DIV",{class:!0,style:!0});var o=oe(e);i=Wd(o,"svg",{viewBox:!0,fill:!0,xmlns:!0,class:!0});var a=oe(i);n=Wd(a,"path",{d:!0,fill:!0}),oe(n).forEach(j),a.forEach(j),o.forEach(j),this.h()},h(){L(n,"d","M108.993 28.105C109.106 33.5843 107.785 38.7298 105.622 43.7363C103.599 48.409 101.013 52.7481 97.7541 56.6698C96.3211 58.3664 94.86 60.0352 93.2865 61.5928C84.9975 69.9091 76.54 78.0586 67.7172 85.8186C64.8512 88.3219 61.9852 90.8251 58.782 92.939C56.5903 94.3853 52.8252 94.3575 50.6335 92.8278C49.5939 92.1046 48.5262 91.3814 47.5708 90.5748C36.4158 81.1459 25.6262 71.2998 15.286 60.9809C9.35732 55.0566 4.97401 48.1865 2.22039 40.2874C0.871683 36.3935 -0.0274579 32.3327 0.000640266 28.2162C0.0568366 18.843 3.51291 10.9995 11.549 5.52015C14.1902 3.71225 17.1124 2.4606 20.0908 1.32024C21.9172 0.652705 23.7998 0.430212 25.7104 0.207701C33.6903 -0.682341 40.8834 1.29246 47.2898 6.04862C49.3129 7.55057 51.2517 9.2194 53.2185 10.8326C53.8367 11.3332 55.2697 11.361 55.8879 10.8882C56.3936 10.4988 56.9275 10.1651 57.4333 9.77566C58.4167 8.96906 59.3158 8.07904 60.2993 7.27243C61.2827 6.46583 62.2942 5.71487 63.362 5.01952C68.5601 1.62624 74.2359 -0.0982711 80.5018 0.0129841C87.8074 0.124239 94.1856 2.62753 99.8053 7.189C103.879 10.471 106.549 14.7265 108.066 19.6774C108.909 22.4309 108.965 25.2679 108.993 28.105Z"),L(n,"fill","#FF0000"),L(i,"viewBox","0 0 109 94"),L(i,"fill","none"),L(i,"xmlns","http://www.w3.org/2000/svg"),L(i,"class","svelte-1ljt30m"),L(e,"class","heart-popup svelte-1ljt30m"),ot(e,"width",30/Math.pow(2,6-t[2])+10+"px"),ot(e,"left",t[21][0]+"px"),ot(e,"top",t[21][1]-50+"px")},m(r,o){re(r,e,o),H(e,i),H(i,n)},p(r,o){o[0]&4&&ot(e,"width",30/Math.pow(2,6-r[2])+10+"px"),o[0]&2097152&&ot(e,"left",r[21][0]+"px"),o[0]&2097152&&ot(e,"top",r[21][1]-50+"px")},i(r){r&&(s||ls(()=>{s=Nf(e,Pi,{y:20,duration:5e3}),s.start()}))},o:St,d(r){r&&j(e)}}}function Cm(t){let e,i="";return{c(){e=K("div"),e.innerHTML=i,this.h()},l(n){e=Z(n,"DIV",{class:!0,"data-svelte-h":!0}),We(e)!=="svelte-18f8tb9"&&(e.innerHTML=i),this.h()},h(){L(e,"class","search-results svelte-1ljt30m")},m(n,s){re(n,e,s)},d(n){n&&j(e)}}}function xm(t){let e,i="";return{c(){e=K("div"),e.innerHTML=i,this.h()},l(n){e=Z(n,"DIV",{class:!0,style:!0,"data-svelte-h":!0}),We(e)!=="svelte-d43qxq"&&(e.innerHTML=i),this.h()},h(){L(e,"class","noise-overlay mounted svelte-1ljt30m"),ot(e,"background","url(assets/noise-light.png)")},m(n,s){re(n,e,s)},d(n){n&&j(e)}}}function RU(t){let e,i,n,s,r,o,a,c,l,u,h,f,d,p,g="",_,b,T,v="Court Color",E,R,P,M,U="Sort By",O,D,I,V="♡",k,B,F="💬",ee,_e,ae,Ee="",vt,ke,Je=t[21],Qe,je,et,Zt,Ye,at,be,me,Ft,di,Re=t[25]==!0&&gm(t),Ce=!t[3]&&_m(t),ye=t[24]==!0&&wm(t),we=t[23]&&Tm(),Te=t[5]&&Em(),$e=t[3]&&Sm(t),Pt=sr(t[27]),He=[];for(let q=0;q<Pt.length;q+=1)He[q]=Am(pm(t,Pt,q));let De=Rm(t),st=t[12]&&Cm(),ct=t[14]&&xm();return{c(){Re&&Re.c(),e=ue(),Ce&&Ce.c(),i=ue(),n=K("div"),ye&&ye.c(),s=ue(),we&&we.c(),r=ue(),Te&&Te.c(),o=ue(),$e&&$e.c(),a=ue(),c=K("div"),l=K("div"),u=K("a"),h=new Fm(!1),f=ue(),d=K("div"),p=K("div"),p.innerHTML=g,_=ue(),b=K("div"),T=K("span"),T.textContent=v,E=ue(),R=K("div");for(let q=0;q<He.length;q+=1)He[q].c();P=ue(),M=K("span"),M.textContent=U,O=ue(),D=K("div"),I=K("button"),I.textContent=V,k=ue(),B=K("button"),B.textContent=F,_e=ue(),ae=K("div"),ae.innerHTML=Ee,vt=ue(),ke=K("div"),De.c(),Qe=ue(),je=K("p"),et=Ot("Like Added to Court "),Zt=Ot(t[9]),Ye=ue(),st&&st.c(),at=ue(),ct&&ct.c(),be=nr(),this.h()},l(q){Re&&Re.l(q),e=he(q),Ce&&Ce.l(q),i=he(q),n=Z(q,"DIV",{class:!0,id:!0});var te=oe(n);ye&&ye.l(te),s=he(te),we&&we.l(te),te.forEach(j),r=he(q),Te&&Te.l(q),o=he(q),$e&&$e.l(q),a=he(q),c=Z(q,"DIV",{class:!0});var Fe=oe(c);l=Z(Fe,"DIV",{class:!0});var Gt=oe(l);u=Z(Gt,"A",{href:!0,target:!0,class:!0});var En=oe(u);h=Lm(En,!1),En.forEach(j),Gt.forEach(j),f=he(Fe),d=Z(Fe,"DIV",{class:!0});var Jt=oe(d);p=Z(Jt,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),We(p)!=="svelte-4myv6e"&&(p.innerHTML=g),_=he(Jt),b=Z(Jt,"DIV",{class:!0});var Rt=oe(b);T=Z(Rt,"SPAN",{class:!0,"data-svelte-h":!0}),We(T)!=="svelte-1x22fca"&&(T.textContent=v),E=he(Rt),R=Z(Rt,"DIV",{class:!0});var pi=oe(R);for(let Sn=0;Sn<He.length;Sn+=1)He[Sn].l(pi);pi.forEach(j),P=he(Rt),M=Z(Rt,"SPAN",{class:!0,"data-svelte-h":!0}),We(M)!=="svelte-1eada5v"&&(M.textContent=U),O=he(Rt),D=Z(Rt,"DIV",{class:!0});var gi=oe(D);I=Z(gi,"BUTTON",{class:!0,"data-svelte-h":!0}),We(I)!=="svelte-195x6av"&&(I.textContent=V),k=he(gi),B=Z(gi,"BUTTON",{class:!0,"data-svelte-h":!0}),We(B)!=="svelte-1qi6c7q"&&(B.textContent=F),gi.forEach(j),Rt.forEach(j),Jt.forEach(j),Fe.forEach(j),_e=he(q),ae=Z(q,"DIV",{style:!0,class:!0,"data-svelte-h":!0}),We(ae)!=="svelte-1r38rh7"&&(ae.innerHTML=Ee),vt=he(q),ke=Z(q,"DIV",{class:!0});var Wi=oe(ke);De.l(Wi),Qe=he(Wi),je=Z(Wi,"P",{class:!0});var Xi=oe(je);et=Nt(Xi,"Like Added to Court "),Zt=Nt(Xi,t[9]),Xi.forEach(j),Wi.forEach(j),Ye=he(q),st&&st.l(q),at=he(q),ct&&ct.l(q),be=nr(),this.h()},h(){L(n,"class","overlay svelte-1ljt30m"),L(n,"id","overlay"),h.a=null,L(u,"href","https://pudding.cool"),L(u,"target","_blank"),L(u,"class","svelte-1ljt30m"),L(l,"class","toolbar-logo svelte-1ljt30m"),L(p,"id","geocoder"),L(p,"class","geocoder svelte-1ljt30m"),L(T,"class","svelte-1ljt30m"),L(R,"class","color-swatches svelte-1ljt30m"),L(M,"class","sorted-by svelte-1ljt30m"),L(I,"class","svelte-1ljt30m"),L(B,"class","svelte-1ljt30m"),L(D,"class","sort-buttons svelte-1ljt30m"),L(b,"class","color-finder svelte-1ljt30m"),L(d,"class","settings svelte-1ljt30m"),L(c,"class",ee="toolbar "+(t[3]?"toolbar-visible":"")+" svelte-1ljt30m"),L(ae,"style",""),L(ae,"class","el svelte-1ljt30m"),Ds(ae,"showEl",t[4]),L(je,"class","svelte-1ljt30m"),L(ke,"class","favorite-text svelte-1ljt30m"),Ds(ke,"favoriteActive",t[17])},m(q,te){Re&&Re.m(q,te),re(q,e,te),Ce&&Ce.m(q,te),re(q,i,te),re(q,n,te),ye&&ye.m(n,null),H(n,s),we&&we.m(n,null),re(q,r,te),Te&&Te.m(q,te),re(q,o,te),$e&&$e.m(q,te),re(q,a,te),re(q,c,te),H(c,l),H(l,u),h.m(jv,u),H(c,f),H(c,d),H(d,p),t[38](p),H(d,_),H(d,b),H(b,T),H(b,E),H(b,R);for(let Fe=0;Fe<He.length;Fe+=1)He[Fe]&&He[Fe].m(R,null);H(b,P),H(b,M),H(b,O),H(b,D),H(D,I),H(D,k),H(D,B),re(q,_e,te),re(q,ae,te),t[42](ae),re(q,vt,te),re(q,ke,te),De.m(ke,null),H(ke,Qe),H(ke,je),H(je,et),H(je,Zt),re(q,Ye,te),st&&st.m(q,te),re(q,at,te),ct&&ct.m(q,te),re(q,be,te),me=!0,Ft||(di=[hi(I,"click",t[40]),hi(B,"click",t[41])],Ft=!0)},p(q,te){if(q[25]==!0?Re?(Re.p(q,te),te[0]&33554432&&se(Re,1)):(Re=gm(q),Re.c(),se(Re,1),Re.m(e.parentNode,e)):Re&&(si(),Ae(Re,1,1,()=>{Re=null}),ri()),q[3]?Ce&&(si(),Ae(Ce,1,1,()=>{Ce=null}),ri()):Ce?(Ce.p(q,te),te[0]&8&&se(Ce,1)):(Ce=_m(q),Ce.c(),se(Ce,1),Ce.m(i.parentNode,i)),q[24]==!0?ye?(ye.p(q,te),te[0]&16777216&&se(ye,1)):(ye=wm(q),ye.c(),se(ye,1),ye.m(n,s)):ye&&(si(),Ae(ye,1,1,()=>{ye=null}),ri()),q[23]?we?te[0]&8388608&&se(we,1):(we=Tm(),we.c(),se(we,1),we.m(n,null)):we&&(si(),Ae(we,1,1,()=>{we=null}),ri()),q[5]?Te?te[0]&32&&se(Te,1):(Te=Em(),Te.c(),se(Te,1),Te.m(o.parentNode,o)):Te&&(si(),Ae(Te,1,1,()=>{Te=null}),ri()),q[3]?$e?$e.p(q,te):($e=Sm(q),$e.c(),$e.m(a.parentNode,a)):$e&&($e.d(1),$e=null),te[0]&134217856|te[1]&2){Pt=sr(q[27]);let Fe;for(Fe=0;Fe<Pt.length;Fe+=1){const Gt=pm(q,Pt,Fe);He[Fe]?He[Fe].p(Gt,te):(He[Fe]=Am(Gt),He[Fe].c(),He[Fe].m(R,null))}for(;Fe<He.length;Fe+=1)He[Fe].d(1);He.length=Pt.length}(!me||te[0]&8&&ee!==(ee="toolbar "+(q[3]?"toolbar-visible":"")+" svelte-1ljt30m"))&&L(c,"class",ee),(!me||te[0]&16)&&Ds(ae,"showEl",q[4]),te[0]&2097152&&Hi(Je,Je=q[21])?(si(),Ae(De,1,1,St),ri(),De=Rm(q),De.c(),se(De,1),De.m(ke,Qe)):De.p(q,te),(!me||te[0]&512)&&Zn(Zt,q[9]),(!me||te[0]&131072)&&Ds(ke,"favoriteActive",q[17]),q[12]?st||(st=Cm(),st.c(),st.m(at.parentNode,at)):st&&(st.d(1),st=null),q[14]?ct||(ct=xm(),ct.c(),ct.m(be.parentNode,be)):ct&&(ct.d(1),ct=null)},i(q){me||(se(Re),se(Ce),se(ye),se(we),se(Te),se(De),me=!0)},o(q){Ae(Re),Ae(Ce),Ae(ye),Ae(we),Ae(Te),Ae(De),me=!1},d(q){q&&(j(e),j(i),j(n),j(r),j(o),j(a),j(c),j(_e),j(ae),j(vt),j(ke),j(Ye),j(at),j(be)),Re&&Re.d(q),Ce&&Ce.d(q),ye&&ye.d(),we&&we.d(),Te&&Te.d(q),$e&&$e.d(q),t[38](null),Of(He,q),t[42](null),De.d(q),st&&st.d(q),ct&&ct.d(q),Ft=!1,Dm(di)}}}let Ku=4.99,CU=64,xU=64;function PU(t,e,i){let n,s,r,o,a,c=St,l=()=>(c(),c=qb(n,X=>i(26,a=X)),n);un(t,Pc,X=>i(23,s=X)),un(t,ao,X=>i(24,r=X)),un(t,Lu,X=>i(25,o=X)),t.$$.on_destroy.push(()=>c());let{viewportHeight:u}=e,{viewportWidth:h}=e,f=!1,d=!1,p,g=!1,_,b,T=!1,v=null,E=["rgb(45, 181, 77)","rgb(66, 102, 235)","rgb(96, 216, 230)","rgb(168, 59, 157)","rgb(207, 21, 24)","rgb(225, 108, 51)","rgb(227, 198, 36)","rgb(235, 122, 184)"],R=Uf(","),P=[],M,U=0,O,D,I,V,k,B,F,ee=[],_e=!1,ae,Ee,vt=!1,ke={},Je,Qe=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],je=[],et=[],Zt=[],Ye,at={},be={},me=[0];function Ft(X,W){let ie=Object.keys(at),ne=Object.keys(be),Q;X.length>0?Q=W.filter(xe=>X.indexOf(xe.id)>-1):Q=W.map(xe=>xe),_=PF(h,u,Q.length);let Se=_.rowSize;return Q=Q.map((xe,Pe)=>{let lt=0,ut=0,tt=xe.id.replace(".jpg",""),Mt=Je.has(+tt)?Je.get(+tt):null;Mt&&(lt=Mt.count?Mt.count:0,ut=Mt.comment_count?Mt.comment_count:0),ie.indexOf(tt)>-1&&(lt=lt+at[tt]),ne.indexOf(tt)>-1&&(ut=ut+be[tt]);let Rn=Pe%Se*k.size+Pe%Se*.1,vs=Math.floor(Pe/Se)*k.size+Math.floor(Pe/Se)*.1;return{coordinates:[Rn,vs],id:tt,color:xe.color,court_count:Pe,latLong:xe.center.split(",").map(xr=>+xr),location:xe.location,state:xe.state,geo:xe.geo,squareSize:Se,likes:lt,comments:ut}}),ei&&(Q=Q.sort((xe,Pe)=>{if(ei=="heart")return Pe.likes-xe.likes;if(ei=="comment")return Pe.comments-xe.comments}),Q.forEach((xe,Pe)=>{let lt=Pe%Se*k.size+Pe%Se*.1,ut=Math.floor(Pe/Se)*k.size+Math.floor(Pe/Se)*.1;xe.coordinates=[lt,ut]}),console.log(Q.slice(0,10))),Q}async function di(){let X={};for(let W of Qe){let ie=b.map(Q=>({geo:Q.geo,x:+Q.x,y:+Q.y,width:CU,height:xU,mask:!1,id:Q.id.replace(".jpg","").replace(".jpeg","")})).filter(Q=>Q.geo==W);const ne={};for(let Q of ie)ne[Q.id]=Q;X[W]=ne}return X}function Re(){return new Promise(async(X,W)=>{await Hn("assets/load.basis").then(()=>{console.log("BasisLoader preloaded"),X()})})}function Ce(X){return new Promise(async(W,ie)=>{await Hn(`assets/${X}.basis`).then(ne=>{console.log("basis loaded ",X);let Se={data:ne[0],width:4096,height:4096,compressed:!0};je[X].iconAtlas=Se,W()})})}let ye=0,we=Qe.length-1,Te,$e,Pt;async function He(){let X={marker:{width:1500,height:1510,x:0,y:0,mask:!1}},W={id:"IconLayer_test",getIcon:ie=>"marker",data:B,getPosition:ie=>ie.coordinates,getSize:k.size,sizeUnits:"common",iconMapping:X,iconAtlas:"assets/toolbar-3.png",transitions:{getPosition:{duration:500}}};$e=new yr({...W})}async function De(){let X=[];for(let W of B){let ie=JSON.stringify(W.likes),ne=JSON.stringify(W.comments);X.push({text:`${W.location}, ${W.state}`,position:[W.coordinates[0]-.48*k.size,W.coordinates[1]+.44*k.size],size:.08*k.size}),X.push({text:ie,position:[W.coordinates[0]+.41*k.size,W.coordinates[1]+.438*k.size],size:.066*k.size}),X.push({text:ne,position:[W.coordinates[0]+.41*k.size,W.coordinates[1]+.314*k.size],size:.066*k.size})}return X}async function st(){let X=await De();Pt=new Rc({data:X,id:"TextLayer-test",getPosition:W=>W.position,getText:W=>W.text,maxWidth:10,getAlignmentBaseline:"top",fontFamily:"-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif",getAlignmentBaseline:"center",getColor:[255,255,255],getSize:W=>W.size,getTextAnchor:"start",sizeUnits:"common",updateTriggers:{getText:me}})}async function ct(){for(;await q();)Jt(),D.setProps({layers:et});i(6,T=!0),console.log("loading done")}function q(){return console.log("fetching new chunk"),ye<we?(ye++,new Promise(async(X,W)=>{console.log(ye),await Hn(`assets/${ye}.basis`).then(ie=>{console.log("basis loaded ",ye);let Q={data:ie[0],width:4096,height:4096,compressed:!0};je[ye].iconAtlas=Q,X(!0)})})):null}async function te(){for(let X of Qe){let W={id:`IconLayer_${X}`,getIcon:ie=>ie.id,getPosition:ie=>ie.coordinates,getSize:k.size,mask:!1,sizeUnits:"common",iconMapping:ke[X],transitions:{getPosition:{duration:750,easing:sp}}};je.push(W)}return await Re(),f||n.set(1).then(()=>{i(20,Gt=!0)}),await Promise.all(Qe.slice(0,1).map(async X=>{await Ce(X)})),!0}async function Fe(){console.log(je);for(let X in je){let W=B.filter(ie=>ie.geo==Qe[X]);je[X].data=W}return!0}let Gt;async function En(){Te=new Ef({tileSize:256,minZoom:5,debounceTime:100,id:"tileLayer_",coordinateSystem:ge.CARTESIAN,onViewportLoad:W=>{let ie=Zt.length;if(Zt=Array.from(W.flatMap(ne=>ne.content?ne.content:[]).reduce((ne,Q)=>(ne.has(+Q.id)||ne.set(+Q.id,Q),ne),new Map).values()),ie==0&&Zt.length>0){const ne=h,Q=u,Se=[O[0],O[1],0],xe=-ne/2,Pe=ne/2,lt=Q/2,ut=-Q/2,tt=new vv({width:ne,height:Q,left:xe,right:Pe,top:lt,bottom:ut,target:Se,zoom:U});pi(tt)}},getTileData:async({id:W,bbox:ie,signal:ne})=>U<Ku||ne.aborted?null:gi(ie,W,ne),updateTriggers:{getTileData:[me,ei,v]},renderSubLayers:W=>{W.tile;let ie=[];if(W.data&&W.data.length>0)for(let ne in W.data){W.data[ne].tileId=W.id;let Q=W.data[ne].id,Se=W.data[ne].coordinates,xe=[Se[0]-k.size/2,Se[1]+k.size/2,Se[0]+k.size/2,Se[1]-k.size/2],Pe="webp",ut=`https://s3.amazonaws.com/pudding.cool/projects/courts/${Pe}/150/${Q}.${Pe}`;U>Ku&&(Pe="jpg",ut=`https://s3.amazonaws.com/pudding.cool/projects/courts/${Pe}/${Q}.${Pe}`);const tt=new lf(W,{image:ut,id:`${W.id}_${Q}_bitmap`,bounds:xe,visible:U>Ku});console.log("pushing"),ie.push(tt)}return ie}})}async function Jt(){et=[];for(let X in je.slice(0,ye+1)){let W=new yr({...je[X]});et.push(W)}return!0}function Rt(X,W){return X&&W?W.project([X[0]-k.size/2,X[1]-k.size/2]):[0,0]}function pi(X){P=Zt.map(W=>{let ie=Rt(W.coordinates,X),ne=Rt([k.size*2,0],X)[0]-Rt([k.size,0],X)[0];return{id:W.id,screenPosition:ie,screenWidth:ne,info:W}})}async function gi(X,W,ie){if(await new Promise(lt=>setTimeout(lt,100)),!b)return[];if(ie.aborted)return null;const{left:ne,right:Q,top:Se,bottom:xe}=X;let Pe=[];for(let lt=0;lt<B.length;lt++){const ut=B[lt],[tt,Mt]=ut.coordinates;tt+k.size/2>=ne&&tt+k.size/2<=Q&&Mt+k.size/2>=Se&&Mt+k.size/2<=xe&&Pe.push(ut)}return console.log(Pe),Pe}cl(async()=>{i(14,_e=!0),b=await new Promise(async(W,ie)=>{const ne=await qw("assets/data.csv");W(ne)}),i(11,k=CF(h,u,b.length)),await new Promise(async(W,ie)=>{const Q=await(await fetch("assets/land-110m.json")).json();W(Q)}).then(W=>{i(19,Ye=W)}),await new Promise(async(W,ie)=>{i(18,Je=tw(await EL(),ne=>ne.court_id)),W(Je)}).then(W=>{console.log(W)});let X=Vv();ZS({basis:{format:X,maxConcurrency:1,CDN:!1,worker:!0,useLocalLibraries:!0,workerUrl:"libs-2/basis-worker.js"},worker:!0,CDN:!1,maxConcurrency:1,useLocalLibraries:!0}),Py(mF),i(12,B=await Ft([],b)),console.log("sprite positions loaded"),ke=await di(),await te(),await Fe(),await Jt(),p=new AU({accessToken:"pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2x5YzVlcXZ4MW1qajJsb3RoeWI0bzhmZyJ9.DY653tAkLZCDMMEPuFvoGA",types:"region,postcode,district,place,neighborhood",countries:"us",options:{marker:!1,countries:"us"}}),p.addTo(V),p.setPlaceholder("Search for a location..."),p.setCountries("us"),p.on("result",async W=>{ei=null,i(7,v=null),await An(W,!1),Qt()}),p.on("clear",async W=>{ei=null,i(7,v=null),await An(!1,!1),Qt()}),D=new tf({parent:M,views:new Ws,initialViewState:{target:[h/2,u/2,0],zoom:1,transitionInterpolator:new Ro(["zoom","target"]),transitionDuration:1e3},onClick:({x:W,y:ie})=>{console.log(W,ie);let ne=P.filter(Q=>{let Se=[Q.screenPosition[0],Q.screenPosition[0]+Q.screenWidth,Q.screenPosition[1],Q.screenPosition[1]+Q.screenWidth];return Se[0]<W&&Se[1]>W&&Se[2]<ie&&ie<Se[3]});if(ne.length>0){let Q=ne[0],Se=(W-Q.screenPosition[0])/Q.screenWidth,xe=(ie-Q.screenPosition[1])/Q.screenWidth;Se>.79?xe>.89?(console.log("heart clicked"),Sn(Q.id,Q,[W,ie])):xe>.75&&Pl(Q.id):Se<.1&&xe<.13&&(Q.info.id,i(16,Ee=Q.info.latLong),Ln(Lu,o=!0,o))}},onLoad:()=>{i(15,ae=!0),ct()},onViewStateChange:({viewState:W})=>{i(2,U=W.zoom),O=W.target;let ie=h,ne=u,Q=new Ws().makeViewport({width:ie,height:ne,viewState:W});pi(Q)},controller:!0,layers:et})});function Wi(X){return new Promise((W,ie)=>{console.log("zoomStart");const ne=new Ro({transitionProps:["zoom","target"]});let Q=[Math.floor(_.rowSize*k.size/2),Math.floor(B.length/_.rowSize)*k.size/2,0];ei?(X=5.5,Q=[0,0,0],D.setProps({views:new Ws,initialViewState:{target:Q,zoom:X,controller:!0,layers:et}})):D.setProps({views:new Ws,initialViewState:{target:Q,zoom:X,controller:!0,transitionDuration:1e3,transitionInterpolator:ne,transitionEasing:sp,layers:et,onTransitionEnd:()=>{}}})})}let Xi=[-100,-100];async function Sn(X,W,ie){i(21,Xi=ie),i(9,I=`#${R(W.info.court_count)} in ${W.info.location}, ${W.info.state}`),i(17,vt=!0),at[X]=(at[X]||0)+1,me=[me[0]+1],me=[...me],i(12,B=await Ft(ee,b)),await st(),D.setProps({layers:et.concat([Te,$e,Pt])}),SL(X),setTimeout(()=>{i(17,vt=!1)},3e3)}async function Pl(X){i(13,F=X),Ln(ao,r=!0,r)}async function Ml(X){const W=X.detail;be[W]=(be[W]||0)+1,me=[me[0]+1],me=[...me],i(12,B=await Ft(ee,b)),await st(),D.setProps({layers:et.concat([Te,$e,Pt])})}async function Qt(){let X;_.rowSize==0||(X=Math.log2(_.size/k.size),Wi(X-.2)),await Fe(),await Jt(),await En(),await He(),await st(),D.setProps({layers:et.concat([Te,$e,Pt])})}function An(X,W){return new Promise((ie,ne)=>{X?(ee=DE(b,X,"bbox"),ee.length==0&&(ee=["none"])):W?(ee=FE(b,W),ee.length==0&&(ee=["none"])):ee=[],i(12,B=Ft(ee,b)),ie()})}let ei=null;async function _s(X){ei=X,i(7,v=null),await An(!1,!1),Qt()}async function Cr(){Ln(Pc,s=!0,s)}async function ms(X){ei=null,p.setInput(""),v!==X?(i(7,v=X),await An(!1,X),Qt()):(i(7,v=null),await An(!1,!1),Qt())}function jo(){i(3,f=!0),Qt(),i(5,g=!0),setTimeout(()=>{i(5,g=!1)},6e3)}function Il(){console.log("world finished"),i(4,d=!0)}const Ol=()=>{console.log("button click"),Ln(Lu,o=!1,o)},$o=()=>jo(),Nl=()=>Cr();function kl(X){Gu[X?"unshift":"push"](()=>{V=X,i(10,V)})}const Dl=X=>ms(X),ys=()=>_s("heart"),Fl=()=>_s("comment");function Ll(X){Gu[X?"unshift":"push"](()=>{M=X,i(8,M)})}return t.$$set=X=>{"viewportHeight"in X&&i(0,u=X.viewportHeight),"viewportWidth"in X&&i(1,h=X.viewportWidth)},t.$$.update=()=>{t.$$.dirty[0]&4&&console.log(U)},l(i(22,n=Af(0,{duration:1e4}))),[u,h,U,f,d,g,T,v,M,I,V,k,B,F,_e,ae,Ee,vt,Je,Ye,Gt,Xi,n,s,r,o,a,E,R,Ml,_s,Cr,ms,jo,Il,Ol,$o,Nl,kl,Dl,ys,Fl,Ll]}class MU extends vn{constructor(e){super(),bn(this,e,PU,RU,Hi,{viewportHeight:0,viewportWidth:1},null,[-1,-1,-1,-1])}}function Pm(t){let e,i;return e=new MU({props:{viewportWidth:t[0].width,viewportHeight:t[0].height}}),{c(){Gn(e.$$.fragment)},l(n){Jn(e.$$.fragment,n)},m(n,s){Qn(e,n,s),i=!0},p(n,s){const r={};s&1&&(r.viewportWidth=n[0].width),s&1&&(r.viewportHeight=n[0].height),e.$set(r)},i(n){i||(se(e.$$.fragment,n),i=!0)},o(n){Ae(e.$$.fragment,n),i=!1},d(n){es(e,n)}}}function IU(t){let e,i,n="",s,r=t[1]&&t[0]&&Pm(t);return{c(){r&&r.c(),e=ue(),i=K("div"),i.innerHTML=n,this.h()},l(o){r&&r.l(o),e=he(o),i=Z(o,"DIV",{class:!0,"data-svelte-h":!0}),We(i)!=="svelte-199sfvp"&&(i.innerHTML=n),this.h()},h(){L(i,"class","overlay svelte-16ft1lt")},m(o,a){r&&r.m(o,a),re(o,e,a),re(o,i,a),s=!0},p(o,[a]){o[1]&&o[0]?r?(r.p(o,a),a&3&&se(r,1)):(r=Pm(o),r.c(),se(r,1),r.m(e.parentNode,e)):r&&(si(),Ae(r,1,1,()=>{r=null}),ri())},i(o){s||(se(r),s=!0)},o(o){Ae(r),s=!1},d(o){o&&(j(e),j(i)),r&&r.d(o)}}}function OU(t,e,i){let n;un(t,Qb,r=>i(0,n=r));let s;return cl(async()=>{i(1,s=!0)}),t.$$.update=()=>{t.$$.dirty&1&&console.log(n)},[n,s]}class NU extends vn{constructor(e){super(),bn(this,e,OU,IU,Hi,{})}}const kU="Title TK",DU="Description tk.",Mm={title:kU,description:DU};function FU(){console.log("--- --- --- --- --- ---"),console.log("svelte-starter: 5.17.0"),console.log("build: 2024-09-08-12:19"),console.log("--- --- --- --- --- ---")}function LU(t){let e,i,n,s;return e=new rw({props:{title:t[1],description:t[2],url:t[3],preloadFont:t[0],keywords:t[4]}}),n=new NU({}),{c(){Gn(e.$$.fragment),i=ue(),Gn(n.$$.fragment)},l(r){Jn(e.$$.fragment,r),i=he(r),Jn(n.$$.fragment,r)},m(r,o){Qn(e,r,o),re(r,i,o),Qn(n,r,o),s=!0},p:St,i(r){s||(se(e.$$.fragment,r),se(n.$$.fragment,r),s=!0)},o(r){Ae(e.$$.fragment,r),Ae(n.$$.fragment,r),s=!1},d(r){r&&j(i),es(e,r),es(n,r)}}}function BU(t,e,i){let{data:n}=e;FU();const s=[],{title:r,description:o,url:a,keywords:c}=Mm;return Xd("copy",Mm),Xd("data",n.data),t.$$set=l=>{"data"in l&&i(5,n=l.data)},[s,r,o,a,c,n]}class ZU extends vn{constructor(e){super(),bn(this,e,BU,LU,Hi,{data:5})}}export{ZU as component};
